<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/" xmlns:html="http://www.w3.org/1999/xhtml">
<html:head>
	<html:title><![CDATA[Code Snippets for CB Editor]]></html:title>
	<html:link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAASUlEQVQ4jWOIi/v/nxLMMIwMWLfuPwbAJQ6TQzEAlyJcAKcB6E7EJU6yAchg3ToSDCA5DAiFOkED0G3BBYiORqLDYOBT4oAZAAAWpQvq9WCGqAAAAABJRU5ErkJggg=="/>
	<html:style type="text/css"><![CDATA[body{font-size:medium;margin:0}body,code:before,help:before,initcode:before{font-family:"Verdana",sans-serif}#wrapper{position:fixed;top:1em;right:1em;max-width:15%;text-align:center}#button{background-color:#299a0b;border:1px solid #3a7404;border-radius:.5em;padding:0;margin-bottom:1em;box-shadow:1px 2px 3px rgba(0,0,0,.25)}#button a{color:#f0f0f0;font-weight:700;text-shadow:-.5pt -.5px .5pt rgba(0,0,0,1);padding:.8em;text-decoration:none}:-moz-any-link:focus{color:grey;outline-color:transparent;text-decoration:none}#button a,code,code:before,initcode,initcode:before,help,help:before{display:block}#credits{position:fixed;bottom:1em;right:1em;font-size:small}#about{font-size:small}custombutton{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABAElEQVQ4jW2TQXLFMAhDff+b2vEHYw5AF38eVTNdZAIxCEkmw31VptU5T7mvOuepc56K2B2f85TZrEwr99VxptUwm2U2695PZVrH937KfZX76txsVsTus0yrEbEr0/4F4AyQc56eDMiI2F0IbYoj9h9ZSCV2XzXUA1BVL8BvBvSMiN20zWY38VZ5gDEkYtfAYTRToA3qiQJk2hcA7W8gpaxG0nPvp4aiQ5UCzOV2GKAgLUEfpsGCfaBR92TonapmdCoAjHTIgLa6/14gbgow8oj9uwe6SMQ0qTz9P9oDZOgCkfMNJnqWaV8P3ouDRorUXEA4H1wbtMmVjcrQ7TSb9QMtXcwa4wpbXgAAAABJRU5ErkJggg==) fixed #f6f6f1;margin:1em}date,image,mode,accelkey{display:none}name{font-weight:700;font-size:x-large}code:before,help:before,initcode:before{font-weight:700;font-size:large;margin:0 0 1em;padding:.5em}code:before{content:"Code Tab"}help:before{content:"Help Tab"}initcode:before{content:"Initialization Code Tab"}code,initcode,help{background-color:#fcfcfc;font-size:.875em;font-family:Consolas,"Bitstream Vera Sans Mono","Courier New",Courier,monospace!important;margin:1em 2em 1em 0 !important;padding:1em;text-align:left;box-shadow:2px 2px 0 rgba(170,160,130,0.5),4px 4px 0 rgba(200,190,165,0.5);max-width:80%;min-width:80%;white-space:pre-wrap;word-wrap:break-word}]]></html:style>
</html:head>
<html:body>
	<html:div id="wrapper">
		<html:div id="button">
			<html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3ECode%20Snippets%20for%20CB%20Editor%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAASUlEQVQ4jWOIi/v/nxLMMIwMWLfuPwbAJQ6TQzEAlyJcAKcB6E7EJU6yAchg3ToSDCA5DAiFOkED0G3BBYiORqLDYOBT4oAZAAAWpQvq9WCGqAAAAABJRU5ErkJggg%3D%3D%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5Bif%20%28self.parentNode%20%26%26%20self.parentNode.id.match%28%22wrapper-%22%29%29%0A%09return%3B%0A%0Aif%20%28%21%28%22Services%22%20in%20window%29%29%0A%09Cu.import%28%22resource%3A//gre/modules/Services.jsm%22%29%3B%0A%0Avar%20PREF_BRANCH%20%3D%20%22CB.CodeSnippetsForCBEditor.Id%22%20+%20self.id.slice%2820%29%3B%0A%0Avar%20_UID%20%3D%20%22code-snippets-for-cb-editor%22%20+%20self.id.slice%2820%29%3B%0A%0A//%20Menu%20items%20marker.%20Can%20be%20changed.%0A//%20Have%20to%20be%20UNIQUE%20and%20CAN%20NOT%20be%20used%20inside%20the%20code%20snippets%21%21%21%0Avar%20mItemsMarker%20%3D%20%22//%u25BA%u25BA%u25BA%22%3B%0A%0A//%20Menu%20marker.%20Can%20be%20changed.%0A//%20Have%20to%20be%20UNIQUE%20and%20CAN%20NOT%20be%20used%20inside%20the%20code%20snippets%21%21%21%0Avar%20menuMarker%20%3D%20%22//%u25CF%u25CF%u25CF%22%3B%0A%0Avar%20insertButtonImageOnSelf%20%3D%20%22data%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/%22%20+%0A%09%229hAAAAUUlEQVQ4jWNgYGCIDw8P/08OZmBgiGeAMrTJweHh4f+RDSAV0NCA/3gAQQPwaSbJALK9QKTtNAwDXIAoAwgFIM%22%20+%0A%09%22UGEB0GRALqG0BeZmKgMDsDABOrQmBgEfd7AAAAAElFTkSuQmCC%22%3B%0A%0Avar%20insertButtonImage%20%3D%20%22data%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA%22%20+%0A%09%22u0lEQVQ4ja2TwQrCMAyGMzyLFnrSS714EhzbnqAT8Q3yGHv9Qg7xYKpZ11WcCwRK0v9rkrYAAAMi8hIHgAFk0S1xRGQN%22%20+%0A%09%22+NXWBbQ6E0J48Ms24szMnpmrrxUQ0U0EHGP8Ma8AtQZcZKNX4vdpxphdjBNRL+FGA05abK3dpg075/ZJJddRC2nZM1ap%22%20+%0A%09%22fSPAgYj6XPmFNo4acJYBZiGJ+C7hdjLEDKR0C/PvIEISgBZPAKs85Zw3hVwn2v++8xNoFTpR5t2/VgAAAABJRU5ErkJg%22%20+%0A%09%22gg%3D%3D%22%3B%0A%0Avar%20editorURL%20%3D%20%22chrome%3A//custombuttons/content/editor.xul%22%3B%0A%0A//START//%20Default%20preferences%20management%0AbP.root%20%3D%20PREF_BRANCH%3B%0A%0AbP.defaults%20%3D%20%7B%0A%09ButtonBgColor%3A%20%22rgb%2824%2C188%2C156%29%22%2C%0A%09CursorAnchor%3A%20%22/*%3D%3E%7C%3C%3D*/%22%2C%0A%09CustomLabel%3A%20%22Code%20Snippets%22%2C%0A%09CustomLabelShow%3A%20false%2C%0A%09AllowSelection%3A%20false%2C%0A%09AllowChecked%3A%20true%2C%0A%09Off%3A%20false%2C%0A%09OpenOnMouseOver%3A%20true%2C%0A%09OpenCloseDelay%3A%20100%2C%0A%09ShowOnSelfItems%3A%20true%0A%7D%3B%0A%0Afor%20%28let%20key%20in%20bP.defaults%29%20%7B%0A%09if%20%28bP.defaults.hasOwnProperty%28key%29%29%20%7B%0A%09%09let%20val%20%3D%20bP.defaults%5Bkey%5D%3B%0A%09%09switch%20%28typeof%20val%29%20%7B%0A%09%09%09case%20%22boolean%22%3A%0A%09%09%09%09Services.prefs.getDefaultBranch%28PREF_BRANCH%29.setBoolPref%28key%2C%20val%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%20%22number%22%3A%0A%09%09%09%09Services.prefs.getDefaultBranch%28PREF_BRANCH%29.setIntPref%28key%2C%20val%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%20%22string%22%3A%0A%09%09%09%09let%20str%20%3D%20Cc%5B%22@mozilla.org/supports-string%3B1%22%5D.createInstance%28Ci.nsISupportsString%29%3B%0A%09%09%09%09str.data%20%3D%20val%3B%0A%09%09%09%09Services.prefs.getDefaultBranch%28PREF_BRANCH%29.setComplexValue%28%28key%29%2C%0A%09%09%09%09%09Ci.nsISupportsString%2C%20str%29%3B%0A%09%09%09%09break%3B%0A%09%09%7D%0A%09%7D%0A%7D%0A%0AbP.observe%20%3D%20function%28aPrefs%2C%20aCallback%29%20%7B%0A%09let%20%7B%0A%09%09root%0A%09%7D%20%3D%20bP%3B%0A%0A%09function%20observe%28subject%2C%20topic%2C%20data%29%20%7B%0A%09%09if%20%28topic%20%21%3D%3D%20%22nsPref%3Achanged%22%29%0A%09%09%09return%3B%0A%09%09let%20pref%20%3D%20data.slice%28root.length%29%3B%0A%09%09if%20%28aPrefs.indexOf%28pref%29%20%3D%3D%3D%20-1%29%0A%09%09%09return%3B%0A%09%09aCallback%28pref%29%3B%0A%09%7D%0A%09Services.prefs.addObserver%28root%2C%20observe%2C%20false%29%3B%0A%09unload%28function%28%29%20Services.prefs.removeObserver%28root%2C%20observe%29%29%3B%0A%7D%3B%0A%0Afunction%20bP%28aKey%29%20%7B%0A%09let%20%7B%0A%09%09branch%2C%0A%09%09defaults%0A%09%7D%20%3D%20bP%3B%0A%09if%20%28%21branch%29%0A%09%09branch%20%3D%20Services.prefs.getBranch%28bP.root%29%3B%0A%09switch%20%28typeof%20defaults%5BaKey%5D%29%20%7B%0A%09%09case%20%22boolean%22%3A%0A%09%09%09return%20branch.getBoolPref%28aKey%29%3B%0A%09%09case%20%22number%22%3A%0A%09%09%09return%20branch.getIntPref%28aKey%29%3B%0A%09%09case%20%22string%22%3A%0A%09%09%09return%20branch.getComplexValue%28aKey%2C%20Ci.nsISupportsString%29.data%3B%0A%09%7D%0A%09return%20null%3B%0A%7D%0A%0Afunction%20unload%28aCallback%2C%20aContainer%29%20%7B%0A%09let%20callback%3B%0A%09let%20unloaders%20%3D%20unload.unloaders%3B%0A%09if%20%28unloaders%20%3D%3D%3D%20null%29%0A%09%09unloaders%20%3D%20unload.unloaders%20%3D%20%5B%5D%3B%0A%09if%20%28aCallback%20%3D%3D%3D%20null%29%20%7B%0A%09%09unloaders.slice%28%29.forEach%28function%28unloader%29%20unloader%28%29%29%3B%0A%09%09unloaders.length%20%3D%200%3B%0A%09%7D%0A%09if%20%28aContainer%20%21%3D%3D%20null%29%20%7B%0A%09%09aContainer.addEventListener%28%22unload%22%2C%20removeUnloader%2C%20false%29%3B%0A%09%09let%20origCallback%20%3D%20aCallback%3B%0A%09%09callback%20%3D%20function%28%29%20%7B%0A%09%09%09aContainer.removeEventListener%28%22unload%22%2C%20removeUnloader%2C%20false%29%3B%0A%09%09%09origCallback%28%29%3B%0A%09%09%7D%3B%0A%09%09return%20null%3B%0A%09%7D%0A%0A%09function%20unloader%28%29%20%7B%0A%09%09try%20%7B%0A%09%09%09callback%28%29%3B%0A%09%09%7D%20catch%20%28err%29%20%7B%0A%09%09%09Components.utils.reportError%28err%29%3B%0A%09%09%7D%0A%09%7D%0A%09unloaders.push%28unloader%29%3B%0A%0A%09function%20removeUnloader%28%29%20%7B%0A%09%09let%20index%20%3D%20unloaders.indexOf%28unloader%29%3B%0A%09%09if%20%28index%20%21%3D%3D%20-1%29%0A%09%09%09unloaders.splice%28index%2C%201%29%3B%0A%09%7D%0A%09return%20removeUnloader%3B%0A%7D%0A//END//%20Default%20preferences%20management%0A%0AmItemsMarker%20%3D%20%22%5Cn%22%20+%20mItemsMarker%3B%0A%0AmenuMarker%20%3D%20%22%5Cn%22%20+%20menuMarker%3B%0A%0Athis.style.opacity%20%3D%20%221%22%3B%0A%0Athis.tooltipText%20%3D%20self.name%20+%20%22%5Cn%5Cn%22%20+%0A%09%22%5CtL%20%3A%20Show/Hide%20button%20on%20CB%20Editor%5Cn%22%20+%0A%09%22%5CtM%20%3A%20Open%20options%20menu%5Cn%5Cn%22%20+%0A%09%22%5CtL%20on%20menu%20items%20%3A%20Insert%20Snippet%5Cn%22%20+%0A%09%22%5CtM%20on%20menu%20items%20%3A%20Insert%20Snippet%20without%20closing%20menu%5Ct%5Cn%5Cn%22%3B%0A%0Aif%20%28bP%28%22AllowChecked%22%29%29%0A%09this.checked%20%3D%20true%3B%0A%0Afunction%20setButtonDesign%28aDoc%29%20%7B%0A%09let%20button%20%3D%20aDoc.getElementById%28_UID%20+%20%22-toolbarbutton%22%29%3B%0A%09let%20label%20%3D%20bP%28%22CustomLabel%22%29%3B%0A%09button.tooltipText%20%3D%20label%3B%0A%09button.style.MozAppearance%20%3D%20%22none%22%3B%0A%09button.style.margin%20%3D%20%220px%22%3B%0A%09button.style.padding%20%3D%20%220px%22%3B%0A%09bP%28%22CustomLabelShow%22%29%20%26%26%20%28button.label%20%3D%20%22%20%22%20+%20label%20+%20%22%20%22%29%3B%0A%09let%20image%20%3D%20aDoc.getAnonymousElementByAttribute%28button%2C%20%22class%22%2C%20%22toolbarbutton-icon%22%29%3B%0A%09image.style.backgroundColor%20%3D%20bP%28%22ButtonBgColor%22%29%3B%0A%09image.style.MozMargin%20%3D%20%220px%22%3B%0A%09image.style.margin%20%3D%20%221px%22%3B%0A%09let%20dropmarker%20%3D%20aDoc.getAnonymousElementByAttribute%28button%2C%20%22class%22%2C%20%22toolbarbutton-menu-dropmarker%22%29%3B%0A%09dropmarker.hidden%20%3D%20true%3B%0A%7D%0A%0Avar%20place%20%3D%20null%3B%0Avar%20focusedElement%20%3D%20null%3B%0A%0Afunction%20createButton%28aDoc%29%20%7B%0A%09let%20button%20%3D%20document.createElementNS%28xulns%2C%20%22toolbarbutton%22%29%3B%0A%09var%20subMenus%20%3D%20self.getAttribute%28%22Help%22%29.split%28%22%5B%2C%5D%22%29%5B1%5D.split%28menuMarker%29%3B%0A%09button.setAttribute%28%22image%22%2C%20insertButtonImage%29%3B%0A%09button.setAttribute%28%22id%22%2C%20_UID%20+%20%22-toolbarbutton%22%29%3B%0A%09button.setAttribute%28%22type%22%2C%20%22menu%22%29%3B%0A%09button.timer%20%3D%200%3B%0A%09button.onmouseover%20%3D%20function%28%29%20%7B%0A%09%09place%20%3D%20aDoc.commandDispatcher.focusedElement%3B%0A%09%09if%20%28bP%28%22OpenOnMouseOver%22%29%29%20%7B%0A%09%09%09let%20thisMenupopup%20%3D%20aDoc.getElementById%28_UID%20+%20%22-mpop-inserter%22%29%3B%0A%09%09%09clearTimeout%28button.timer%29%3B%0A%09%09%09button.timer%20%3D%20setTimeout%28function%28%29%20%7B%0A%09%09%09%09thisMenupopup%20%26%26%20thisMenupopup.openPopup%28button%2C%20%22after_start%22%2C%200%2C%200%2C%20false%2C%20false%29%3B%0A%09%09%09%7D%2C%20bP%28%22OpenCloseDelay%22%29%29%3B%0A%09%09%7D%0A%09%7D%3B%0A%09button.onmouseout%20%3D%20function%28%29%20%7B%0A%09%09if%20%28bP%28%22OpenOnMouseOver%22%29%29%20%7B%0A%09%09%09let%20thisMenupopup%20%3D%20aDoc.getElementById%28_UID%20+%20%22-mpop-inserter%22%29%3B%0A%09%09%09clearTimeout%28button.timer%29%3B%0A%09%09%09button.timer%20%3D%20setTimeout%28function%28%29%20%7B%0A%09%09%09%09thisMenupopup%20%26%26%20thisMenupopup.hidePopup%28%29%3B%0A%09%09%09%7D%2C%20bP%28%22OpenCloseDelay%22%29%29%3B%0A%09%09%7D%0A%09%7D%3B%0A%09var%20mainMenupopup%20%3D%20document.createElementNS%28xulns%2C%20%22menupopup%22%29%3B%0A%09mainMenupopup.setAttribute%28%22id%22%2C%20_UID%20+%20%22-mpop-inserter%22%29%3B%0A%09var%20onSelf%20%3D%20false%3B%0A%09if%20%28aDoc.location.href.split%28%22custombuttons-button%22%29%5B1%5D%20%3D%3D%3D%20self.id.replace%28%22custombuttons-button%22%2C%20%22%22%29%29%20%7B%0A%09%09onSelf%20%3D%20true%3B%0A%09%09button.setAttribute%28%22image%22%2C%20insertButtonImageOnSelf%29%3B%0A%09%09if%20%28bP%28%22ShowOnSelfItems%22%29%29%20%7B%0A%09%09%09let%20selfItems%20%3D%20%5B%0A%09%09%09%09%5B%22Insert%20Menuitem%20Sep.%22%2C%20mItemsMarker%5D%2C%0A%09%09%09%09%5B%22Insert%20Menu%20Sep.%22%2C%20menuMarker%5D%2C%0A%09%09%09%09%5B%22Insert%20Cursor%20Anchor%22%2C%20bP%28%22CursorAnchor%22%29%20+%20bP%28%22CursorAnchor%22%29%5D%0A%09%09%09%5D%3B%0A%09%09%09for%20%28let%20s%20%3D%200%3B%20s%20%3C%20selfItems.length%3B%20s++%29%0A%09%09%09%09mainMenupopup.appendChild%28createMItems%28aDoc%2C%20selfItems%5Bs%5D%5B0%5D%2C%20selfItems%5Bs%5D%5B1%5D%2C%20true%29%29%3B%0A%09%09%7D%0A%09%7D%0A%09button.appendChild%28mainMenupopup%29%3B%0A%09for%20%28let%20m%20%3D%200%3B%20m%20%3C%20subMenus.length%3B%20m++%29%20%7B%0A%09%09if%20%28subMenus%5Bm%5D%20%21%3D%3D%20%22%22%29%20%7B%0A%09%09%09if%20%28subMenus.length%20%3E%201%29%20%7B%0A%09%09%09%09let%20items%20%3D%20subMenus%5Bm%5D.split%28mItemsMarker%29%2C%0A%09%09%09%09%09menu%20%3D%20document.createElementNS%28xulns%2C%20%22menu%22%29%2C%0A%09%09%09%09%09menuLabel%20%3D%20subMenus%5Bm%5D.split%28%22%5Cn%22%2C%201%29%3B%0A%09%09%09%09menu.setAttribute%28%22label%22%2C%20menuLabel%29%3B%0A%09%09%09%09items.splice%280%2C%201%29%3B%20//%20Removes%20what%20would%20be%20the%20Menu%20Label%0A%09%09%09%09var%20subMenupopup%20%3D%20document.createElementNS%28xulns%2C%20%22menupopup%22%29%3B%0A%09%09%09%09for%20%28let%20i%20%3D%200%3B%20i%20%3C%20items.length%3B%20i++%29%20%7B%0A%09%09%09%09%09if%20%28items%5Bi%5D%20%21%3D%3D%20%22%22%29%20%7B%0A%09%09%09%09%09%09let%20label%20%3D%20items%5Bi%5D.split%28%22%5Cn%22%2C%201%29%3B%0A%09%09%09%09%09%09let%20insertText%20%3D%20items%5Bi%5D.replace%28label%20+%20%22%5Cn%22%2C%20%22%22%29%3B%0A%09%09%09%09%09%09let%20menuitem%20%3D%20createMItems%28aDoc%2C%20label%2C%20insertText%29%3B%0A%09%09%09%09%09%09subMenupopup.appendChild%28menuitem%29%3B%0A%09%09%09%09%09%09menu.appendChild%28subMenupopup%29%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%7D%0A%09%09%09%09mainMenupopup.appendChild%28menu%29%3B%0A%09%09%09%7D%20else%20%7B%0A%09%09%09%09let%20items%20%3D%20subMenus%5Bm%5D.split%28mItemsMarker%29%3B%0A%09%09%09%09for%20%28let%20i%20%3D%200%3B%20i%20%3C%20items.length%3B%20i++%29%20%7B%0A%09%09%09%09%09if%20%28items%5Bi%5D%20%21%3D%3D%20%22%22%29%20%7B%0A%09%09%09%09%09%09let%20label%20%3D%20items%5Bi%5D.split%28%22%5Cn%22%2C%201%29%3B%0A%09%09%09%09%09%09let%20insertText%20%3D%20items%5Bi%5D.replace%28label%20+%20%22%5Cn%22%2C%20%22%22%29%3B%0A%09%09%09%09%09%09let%20menuitem%20%3D%20createMItems%28aDoc%2C%20label%2C%20insertText%29%3B%0A%09%09%09%09%09%09mainMenupopup.appendChild%28menuitem%29%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%0A%09return%20button%3B%0A%7D%0A%0Afunction%20createMItems%28aDoc%2C%20aLabel%2C%20aInsText%2C%20aSelf%29%20%7B%0A%09let%20menuitem%20%3D%20document.createElementNS%28xulns%2C%20%22menuitem%22%29%3B%0A%09menuitem.setAttribute%28%22label%22%2C%20aLabel%29%3B%0A%09menuitem.insertText%20%3D%20aInsText%3B%0A%09menuitem.inserter%20%3D%20function%20inserter%28aText%29%20%7B%0A%09%09var%20firstPart%20%3D%20aText.split%28bP%28%22CursorAnchor%22%29%29%5B0%5D%3B%0A%09%09var%20cursorPosition%20%3D%20place.selectionStart%20+%20firstPart.length%3B%0A%09%09var%20cursorAnchorPresent%20%3D%20aText.length%20%21%3D%3D%20firstPart.length%3B%0A%09%09aText%20%3D%20aText.replace%28bP%28%22CursorAnchor%22%29%2C%20%22%22%29%3B%0A%09%09if%20%28aText%20%3D%3D%3D%20bP%28%22CursorAnchor%22%29%29%0A%09%09%09cursorPosition%20%3D%20place.selectionStart%20+%20bP%28%22CursorAnchor%22%29.length%3B%0A%09%09var%20controller%20%3D%20aDoc.commandDispatcher.getControllerForCommand%28%22cmd_insertText%22%29%3B%0A%09%09if%20%28controller%20%26%26%20controller.isCommandEnabled%28%22cmd_insertText%22%29%29%20%7B%0A%09%09%09controller%20%3D%20controller.QueryInterface%28Ci.nsICommandController%29%3B%0A%09%09%09var%20params%20%3D%20Cc%5B%22@mozilla.org/embedcomp/command-params%3B1%22%5D%0A%09%09%09%09.createInstance%28Ci.nsICommandParams%29%3B%0A%09%09%09params.setStringValue%28%22state_data%22%2C%20aText%29%3B%0A%09%09%09controller.doCommandWithParams%28%22cmd_insertText%22%2C%20params%29%3B%0A%09%09%7D%0A%09%09if%20%28bP%28%22AllowSelection%22%29%20%26%26%20%21cursorAnchorPresent%29%0A%09%09%09place.setSelectionRange%28place.selectionStart%20-%20aText.length%2C%20place.selectionStart%29%3B%20//%20selects%20the%20pasted%0A%09%09else%0A%09%09%09place.selectionStart%20%3D%20place.selectionEnd%20%3D%20cursorPosition%3B%0A%09%7D%3B%0A%09aSelf%20%26%26%20menuitem.setAttribute%28%22style%22%2C%20%22font-weight%3A%20bold%3B%20color%3A%20rgb%28250%2C53%2C47%29%20%21important%3B%22%29%3B%0A%09let%20commandString%20%3D%20%22inserter%28event.target.insertText%29%22%3B%0A%09menuitem.setAttribute%28%22oncommand%22%2C%20%22event.preventDefault%28%29%3Bevent.stopPropagation%28%29%3B%22%29%3B%0A%09menuitem.setAttribute%28%22onclick%22%2C%20commandString%29%3B%0A%09return%20menuitem%3B%0A%7D%0A%0Afunction%20isButtonAlreadyPresent%28aDoc%29%20%7B%0A%09return%20%21%21aDoc.getElementById%28_UID%20+%20%22-toolbarbutton%22%29%3B%0A%7D%0A%0Avar%20observer%20%3D%20%7B%0A%09observe%3A%20function%28subject%2C%20topic%2C%20data%29%20%7B%0A%09%09subject.addEventListener%28%22load%22%2C%20this%2C%20false%29%3B%0A%09%7D%2C%0A%09handleEvent%3A%20function%28aEvt%29%20%7B%0A%09%09var%20doc%20%3D%20aEvt.target%3B%0A%09%09var%20win%20%3D%20doc.defaultView%3B%0A%09%09win.removeEventListener%28%22load%22%2C%20this%2C%20false%29%3B%0A%09%09if%20%28doc.location.href.substring%280%2C%2041%29%20%21%3D%3D%20editorURL%20%7C%7C%0A%09%09%09Services.prefs.getPrefType%28PREF_BRANCH%20+%20%22Off%22%29%20%3D%3D%3D%200%29%0A%09%09%09return%3B%0A%09%09if%20%28%21isButtonAlreadyPresent%28doc%29%29%20%7B%0A%09%09%09var%20tabs%20%3D%20doc.getElementsByTagName%28%22tabs%22%29%3B%0A%09%09%09tabs%5B0%5D.appendChild%28createButton%28doc%29%29%3B%0A%09%09%09setButtonDesign%28doc%29%3B%0A%09%09%7D%0A%09%7D%0A%7D%3B%0A%0Avar%20activeWin%20%3D%20null%3B%0A%0Athis.onmouseover%20%3D%20function%28%29%20%7B%0A%09activeWin%20%3D%20Services.ww.activeWindow%3B%0A%7D%3B%0A%0Afunction%20alsoForTab%28aEvt%29%20%7B%0A%09var%20doc%20%3D%20aEvt.target%3B%0A%09if%20%28doc.location.href.substring%280%2C%2041%29%20%21%3D%3D%20editorURL%20%7C%7C%0A%09%09Services.prefs.getPrefType%28PREF_BRANCH%20+%20%22Off%22%29%20%3D%3D%3D%200%29%0A%09%09return%3B%0A%09if%20%28%21isButtonAlreadyPresent%28doc%29%29%20%7B%0A%09%09var%20tabs%20%3D%20doc.getElementsByTagName%28%22tabs%22%29%3B%0A%09%09tabs%5B0%5D.appendChild%28createButton%28doc%29%29%3B%0A%09%09setButtonDesign%28doc%29%3B%0A%09%7D%0A%7D%0A%0Athis.initSnippets%20%3D%20function%28aDestroyer%29%20%7B%0A%09if%20%28%21bP%28%22Off%22%29%20%26%26%20%21aDestroyer%29%20%7B%0A%09%09Services.obs.addObserver%28observer%2C%20%22domwindowopened%22%2C%20false%29%3B%0A%09%09%28typeof%20gBrowser%20%3D%3D%3D%20%22object%22%29%20%26%26%20window.addEventListener%28%22DOMContentLoaded%22%2C%20alsoForTab%2C%20false%29%3B%0A%09%09Services.prefs.setBoolPref%28PREF_BRANCH%20+%20%22Off%22%2C%20false%29%3B%0A%09%7D%0A%09if%20%28bP%28%22Off%22%29%20%7C%7C%20aDestroyer%29%20%7B%0A%09%09Services.obs.removeObserver%28observer%2C%20%22domwindowopened%22%29%3B%0A%09%09%28typeof%20gBrowser%20%3D%3D%3D%20%22object%22%29%20%26%26%20window.removeEventListener%28%22DOMContentLoaded%22%2C%20alsoForTab%2C%20false%29%3B%0A%09%09aDestroyer%20%7C%7C%20Services.prefs.setBoolPref%28PREF_BRANCH%20+%20%22Off%22%2C%20true%29%3B%0A%09%7D%0A%09if%20%28typeof%20gBrowser%20%3D%3D%3D%20%22object%22%29%20%7B%0A%09%09var%20tabContainer%20%3D%20gBrowser.mTabContainer%3B%0A%09%09var%20tabs%20%3D%20tabContainer.childNodes%3B%0A%09%09for%20%28let%20t%20%3D%200%3B%20t%20%3C%20tabContainer.itemCount%3B%20t++%29%20%7B%0A%09%09%09var%20pageDoc%20%3D%20tabs%5Bt%5D.linkedBrowser.contentDocument%3B%0A%09%09%09if%20%28pageDoc.location.href.substring%280%2C%2041%29%20%21%3D%3D%20editorURL%29%0A%09%09%09%09continue%3B%0A%09%09%09if%20%28%21bP%28%22Off%22%29%20%26%26%20%21aDestroyer%29%20%7B%0A%09%09%09%09if%20%28isButtonAlreadyPresent%28pageDoc%29%29%0A%09%09%09%09%09continue%3B%0A%09%09%09%09let%20tbs%20%3D%20pageDoc.getElementsByTagName%28%22tabs%22%29%3B%0A%09%09%09%09tbs%5B0%5D.appendChild%28createButton%28pageDoc%29%29%3B%0A%09%09%09%09setButtonDesign%28pageDoc%29%3B%0A%09%09%09%7D%0A%09%09%09if%20%28bP%28%22Off%22%29%20%7C%7C%20aDestroyer%29%20%7B%0A%09%09%09%09var%20b%20%3D%20pageDoc.getElementById%28_UID%20+%20%22-toolbarbutton%22%29%3B%0A%09%09%09%09while%20%28b%29%20%7B%0A%09%09%09%09%09b%20%3D%20pageDoc.getElementById%28_UID%20+%20%22-toolbarbutton%22%29%3B%0A%09%09%09%09%09b%20%26%26%20b.parentNode.removeChild%28b%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%0A%09var%20em%20%3D%20Services.ww.getWindowEnumerator%28%29%3B%0A%09var%20win%20%3D%20true%3B%0A%09while%20%28win%29%20%7B%0A%09%09win%20%3D%20em.getNext%28%29%3B%0A%09%09if%20%28%21win%29%0A%09%09%09return%3B%0A%09%09var%20doc%20%3D%20win.document%3B%0A%09%09if%20%28doc.location.href.substring%280%2C%2041%29%20%21%3D%3D%20editorURL%29%0A%09%09%09continue%3B%0A%09%09if%20%28%21bP%28%22Off%22%29%20%26%26%20%21aDestroyer%29%20%7B%0A%09%09%09if%20%28isButtonAlreadyPresent%28doc%29%29%0A%09%09%09%09continue%3B%0A%09%09%09let%20tbs%20%3D%20doc.getElementsByTagName%28%22tabs%22%29%3B%0A%09%09%09tbs%5B0%5D.appendChild%28createButton%28doc%29%29%3B%0A%09%09%09setButtonDesign%28doc%29%3B%0A%09%09%09if%20%28win%20%3D%3D%3D%20activeWin%29%0A%09%09%09%09win.focus%28%29%3B%0A%09%09%7D%0A%09%09if%20%28bP%28%22Off%22%29%20%7C%7C%20aDestroyer%29%20%7B%0A%09%09%09var%20insertBtn%20%3D%20doc.getElementById%28_UID%20+%20%22-toolbarbutton%22%29%3B%0A%09%09%09while%20%28insertBtn%29%20%7B%0A%09%09%09%09insertBtn%20%3D%20doc.getElementById%28_UID%20+%20%22-toolbarbutton%22%29%3B%0A%09%09%09%09insertBtn%20%26%26%20insertBtn.parentNode.removeChild%28insertBtn%29%3B%0A%09%09%09%09if%20%28win%20%3D%3D%3D%20activeWin%29%0A%09%09%09%09%09win.focus%28%29%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%0A%7D%3B%0A%0Aif%20%28%22CustomizableUI%22%20in%20window%29%20%7B%0A%09let%20_cui%20%3D%20_UID%20+%20%22customizable_ui_%22%3B%0A%09if%20%28%21window%5B_cui%5D%29%20%7B%0A%09%09window%5B_cui%5D%20%3D%20true%3B%0A%09%09CustomizableUI.addListener%28%7B%0A%09%09%09onCustomizeEnd%3A%20function%28aWindow%29%20%7B%0A%09%09%09%09var%20thisBtn%20%3D%20aWindow.document.getElementById%28self.id%29%3B%0A%09%09%09%09setTimeout%28function%28%29%20%7B%0A%09%09%09%09%09if%20%28window%5B_cui%5D%29%20%7B%0A%09%09%09%09%09%09thisBtn.destroy%28%22update%22%29%3B%0A%09%09%09%09%09%09setTimeout%28function%28%29%20%7B%0A%09%09%09%09%09%09%09thisBtn.init%28%29%3B%0A%09%09%09%09%09%09%7D%2C%20100%29%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%7D%2C%20Math.floor%28Math.random%28%29%20*%20%281%20+%202000%20-%20200%29%29%20+%20200%29%3B%0A%09%09%09%7D%0A%09%09%7D%29%3B%0A%09%7D%0A%7D%0A%0Afunction%20promptme%28aMsg%2C%20aVal%29%20%7B%0A%09let%20retVal%20%3D%20%7B%0A%09%09value%3A%20aVal%0A%09%7D%3B%0A%09if%20%28Services.prompt.prompt%28null%2C%20%28self.label%20%7C%7C%20self.name%29%2C%20aMsg%2C%20retVal%2C%20null%2C%20%7B%7D%29%29%0A%09%09return%20retVal.value%3B%0A%09else%0A%09%09return%20false%3B%0A%09return%20false%3B%0A%7D%0A%0Afunction%20%24XML%28aXML%29%20%7B%20//%20Return%20parsed%20XML%0A%09aXML%20%3D%20aXML.replace%28/%3E%5Cs+%3C/g%2C%20%22%3E%3C%22%29%3B%20//%20Linearize%20XML%0A%09return%20%28new%20DOMParser%28%29%29.parseFromString%28aXML%2C%20%22application/xml%22%29.documentElement%3B%0A%7D%0A%0Athis.onclick%20%3D%20function%28aEvt%29%20%7B%0A%09if%20%28%21aEvt.shiftKey%20%26%26%20%21aEvt.ctrlKey%20%26%26%20%21aEvt.altKey%20%26%26%20aEvt.button%20%3D%3D%3D%200%29%20%7B%20//%20Left%20Click%0A%09%09aEvt.preventDefault%28%29%3B%0A%09%09self.gSwitch%28%22switchSnippets%22%29%3B%0A%09%09aEvt.stopPropagation%28%29%3B%0A%09%7D%20else%20if%20%28%21aEvt.shiftKey%20%26%26%20%21aEvt.ctrlKey%20%26%26%20%21aEvt.altKey%20%26%26%20aEvt.button%20%3D%3D%3D%201%29%20%7B%20//%20Middle%20Click%0A%09%09aEvt.preventDefault%28%29%3B%0A%09%09var%20opt_tt%20%3D%20%7B%0A%09%09%09allowSel%3A%20%22If%20checked/enabled%2C%20the%20recently%20pasted%20text%20will%20be%20auto-selected%2C%20except%22%20+%0A%09%09%09%09%22%20when%20the%20pasted%20text%20contains%20a%20%26quot%3Bcursor%20anchor%26quot%3B.%22%2C%0A%09%09%09allowCheck%3A%20%22If%20checked/enabled%2C%20%22%20+%20self.name%20+%20%22%20will%20also%20reflect%20its%20enabled%20%22%20+%0A%09%09%09%09%22state%20by%20its%20pressed/checked%20state.%22%2C%0A%09%09%09openMouseOver%3A%20%22If%20checked/enabled%2C%20the%20Code%20Snippets%20button%20will%20open%20on%20mouse%20over.%22%2C%0A%09%09%09openCloseDelay%3A%20%22Sets%20the%20open/close%20delay%20for%20%26quot%3BOpen%20menu%20on%20mouseover%26quot%3B%22%20+%0A%09%09%09%09%22%20%28In%20milliseconds%29.%22%2C%0A%09%09%09btnBgColor%3A%20%22Sets%20the%20background%20color%20of%20the%20Code%20Snippets%20button%20inside%20CB%20Editor.%22%2C%0A%09%09%09cursorAnchor%3A%20%22Here%20you%20can%20change%20the%20%26quot%3Bcursor%20anchor%26quot%3B%20used%20to%20create%22%20+%0A%09%09%09%09%22%20%26quot%3Bcursor%27s%20insertion%20points%26quot%3B.%22%2C%0A%09%09%09onSelfItems%3A%20%22If%20checked/enabled%2C%20the%20Code%20Snippets%20button%20for%20this%20button%20will%20show%20%22%20+%0A%09%09%09%09%22some%20additional%20menu%20items%20to%20facilitate%20menus%20and%20menuitems%20creation.%22%2C%0A%09%09%09showBtnLabel%3A%20%22If%20checked/enabled%2C%20the%20Code%20Snippets%20button%20will%20display%20its%20label.%22%2C%0A%09%09%09btnLabel%3A%20%22It%20allows%20you%20to%20customize%20the%20button%20label.%22%0A%09%09%7D%3B%0A%09%09while%20%28self.hasChildNodes%28%29%29%0A%09%09%09self.removeChild%28self.lastChild%29%3B%0A%09%09self.appendChild%28%24XML%28%22%3Cmenupopup%20xmlns%3D%5C%22%22%20+%20xulns%20+%20%22%5C%22%22%20+%0A%09%09%09%22%20id%3D%5C%22%22%20+%20_UID%20+%20%22-options-mpop%5C%22%22%20+%0A%09%09%09%22%20onclick%3D%5C%22event.preventDefault%28%29%3Bevent.stopPropagation%28%29%3B%5C%22%22%20+%0A%09%09%09%22%20onpopuphiding%3D%5C%22this.parentNode.gSwitch%28%5C%27init%5C%27%29%3B%5C%22%3E%22%20+%0A%09%09%09%22%3Cdialogheader%3E%3Clabel%20value%3D%5C%22Button%20settings%5C%22/%3E%3C/dialogheader%3E%22%20+%0A%09%09%09%22%3Cmenuitem%20label%3D%5C%22Allow%20checked%5C%22%20tooltiptext%3D%5C%22%22%20+%20opt_tt.allowCheck%20+%20%22%5C%22%22%20+%0A%09%09%09%22%20oncommand%3D%5C%22this.parentNode.parentNode.gSwitch%28%5C%27allowChecked%5C%27%29%3B%22%20+%0A%09%09%09%22event.stopPropagation%28%29%3B%5C%22%22%20+%0A%09%09%09%22%20closemenu%3D%5C%22none%5C%22%20type%3D%5C%22checkbox%5C%22%22%20+%0A%09%09%09%22%20checked%3D%5C%22%22%20+%20bP%28%22AllowChecked%22%29%20+%20%22%5C%22/%3E%22%20+%0A%09%09%09%22%3Cdialogheader%3E%3Clabel%20value%3D%5C%22CD%20Editor%20button%20settings%5C%22/%3E%3C/dialogheader%3E%22%20+%0A%09%09%09%22%3Cmenuitem%20label%3D%5C%22Allow%20selection%5C%22%20tooltiptext%3D%5C%22%22%20+%20opt_tt.allowSel%20+%20%22%5C%22%22%20+%0A%09%09%09%22%20oncommand%3D%5C%22this.parentNode.parentNode.gSwitch%28%5C%27allowSelection%5C%27%29%3B%22%20+%0A%09%09%09%22event.stopPropagation%28%29%3B%5C%22%22%20+%0A%09%09%09%22%20closemenu%3D%5C%22none%5C%22%20type%3D%5C%22checkbox%5C%22%22%20+%0A%09%09%09%22%20checked%3D%5C%22%22%20+%20bP%28%22AllowSelection%22%29%20+%20%22%5C%22/%3E%22%20+%0A%09%09%09%22%3Cmenuitem%20label%3D%5C%22Button%20background%20color%5C%22%20tooltiptext%3D%5C%22%22%20+%20opt_tt.btnBgColor%20+%20%22%5C%22%22%20+%0A%09%09%09%22%20oncommand%3D%5C%22this.parentNode.parentNode.gSwitch%28%5C%27buttonBgColor%5C%27%29%3B%22%20+%0A%09%09%09%22event.stopPropagation%28%29%3B%5C%22/%3E%22%20+%0A%09%09%09%22%3Cmenuitem%20label%3D%5C%22Cursor%20anchor%5C%22%20tooltiptext%3D%5C%22%22%20+%20opt_tt.cursorAnchor%20+%20%22%5C%22%22%20+%0A%09%09%09%22%20oncommand%3D%5C%22this.parentNode.parentNode.gSwitch%28%5C%27cursorAnchor%5C%27%29%3B%22%20+%0A%09%09%09%22event.stopPropagation%28%29%3B%5C%22/%3E%22%20+%0A%09%09%09%22%3Cmenuitem%20label%3D%5C%22Change%20label%5C%22%20tooltiptext%3D%5C%22%22%20+%20opt_tt.btnLabel%20+%20%22%5C%22%22%20+%0A%09%09%09%22%20oncommand%3D%5C%22this.parentNode.parentNode.gSwitch%28%5C%27customLabel%5C%27%29%3B%22%20+%0A%09%09%09%22event.stopPropagation%28%29%3B%5C%22/%3E%22%20+%0A%09%09%09%22%3Cmenuitem%20label%3D%5C%22Open%20menu%20on%20mouseover%5C%22%20tooltiptext%3D%5C%22%22%20+%20opt_tt.openMouseOver%20+%20%22%5C%22%22%20+%0A%09%09%09%22%20oncommand%3D%5C%22this.parentNode.parentNode.gSwitch%28%5C%27openOnMouseOver%5C%27%29%3B%22%20+%0A%09%09%09%22event.stopPropagation%28%29%3B%5C%22%22%20+%0A%09%09%09%22%20closemenu%3D%5C%22none%5C%22%20type%3D%5C%22checkbox%5C%22%22%20+%0A%09%09%09%22%20checked%3D%5C%22%22%20+%20bP%28%22OpenOnMouseOver%22%29%20+%20%22%5C%22/%3E%22%20+%0A%09%09%09%22%3Cmenuitem%20label%3D%5C%22Open/Close%20delay%5C%22%20tooltiptext%3D%5C%22%22%20+%20opt_tt.openCloseDelay%20+%20%22%5C%22%22%20+%0A%09%09%09%22%20oncommand%3D%5C%22this.parentNode.parentNode.gSwitch%28%5C%27openCloseDelay%5C%27%29%3B%22%20+%0A%09%09%09%22event.stopPropagation%28%29%3B%5C%22/%3E%22%20+%0A%09%09%09%22%3Cmenuitem%20label%3D%5C%22Show%20%26quot%3Bon-self%26quot%3B%20items%5C%22%20tooltiptext%3D%5C%22%22%20+%20opt_tt.onSelfItems%20+%20%22%5C%22%22%20+%0A%09%09%09%22%20oncommand%3D%5C%22this.parentNode.parentNode.gSwitch%28%5C%27showOnSelfItems%5C%27%29%3B%22%20+%0A%09%09%09%22event.stopPropagation%28%29%3B%5C%22%22%20+%0A%09%09%09%22%20closemenu%3D%5C%22none%5C%22%20type%3D%5C%22checkbox%5C%22%22%20+%0A%09%09%09%22%20checked%3D%5C%22%22%20+%20bP%28%22ShowOnSelfItems%22%29%20+%20%22%5C%22/%3E%22%20+%0A%09%09%09%22%3Cmenuitem%20label%3D%5C%22Show%20button%20label%5C%22%20tooltiptext%3D%5C%22%22%20+%20opt_tt.showBtnLabel%20+%20%22%5C%22%22%20+%0A%09%09%09%22%20oncommand%3D%5C%22this.parentNode.parentNode.gSwitch%28%5C%27customLabelShow%5C%27%29%3B%22%20+%0A%09%09%09%22event.stopPropagation%28%29%3B%5C%22%22%20+%0A%09%09%09%22%20closemenu%3D%5C%22none%5C%22%20type%3D%5C%22checkbox%5C%22%22%20+%0A%09%09%09%22%20checked%3D%5C%22%22%20+%20bP%28%22CustomLabelShow%22%29%20+%20%22%5C%22/%3E%22%20+%0A%09%09%09%22%3C/menupopup%3E%22%29%29%3B%0A%09%09let%20optPopup%20%3D%20document.getElementById%28_UID%20+%20%22-options-mpop%22%29%3B%0A%09%09let%20optPopupHeader%20%3D%20optPopup.getElementsByTagName%28%22dialogheader%22%29%3B%0A%09%09Array.prototype.slice.call%28optPopupHeader%29.forEach%28function%28aHeader%29%20%7B%0A%09%09%09aHeader.style.fontWeight%20%3D%20%22bold%22%3B%0A%09%09%09aHeader.style.margin%20%3D%20%220px%200px%205px%200px%22%3B%0A%09%09%09aHeader.style.padding%20%3D%20%222px%200px%202px%2010px%22%3B%0A%09%09%09aHeader.style.border%20%3D%20%22none%22%3B%0A%09%09%7D%29%3B%0A%09%09optPopup.openPopup%28aEvt.target%2C%20%22after_start%22%2C%200%2C%200%2C%20false%2C%20false%29%3B%0A%09%09aEvt.stopPropagation%28%29%3B%0A%09%7D%0A%7D%3B%0A%0Athis.gSwitch%20%3D%20function%28aSwitch%29%20%7B%0A%09var%20value%3B%0A%09switch%20%28aSwitch%29%20%7B%0A%09%09case%20%22init%22%3A%0A%09%09%09setTimeout%28function%28%29%20%7B%0A%09%09%09%09self.init%28%29%3B%0A%09%09%09%7D%2C%20100%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22allowSelection%22%3A%0A%09%09%09Services.prefs.setBoolPref%28PREF_BRANCH%20+%20%22AllowSelection%22%2C%20%21bP%28%22AllowSelection%22%29%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22allowChecked%22%3A%0A%09%09%09Services.prefs.setBoolPref%28PREF_BRANCH%20+%20%22AllowChecked%22%2C%20%21bP%28%22AllowChecked%22%29%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22openOnMouseOver%22%3A%0A%09%09%09Services.prefs.setBoolPref%28PREF_BRANCH%20+%20%22OpenOnMouseOver%22%2C%20%21bP%28%22OpenOnMouseOver%22%29%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22openCloseDelay%22%3A%0A%09%09%09value%20%3D%20promptme%28%22Set%20open%20delay%20for%20%5C%22Open%20menu%20on%20mouseover%5C%22%5CnIn%20milliseconds%3A%22%2C%0A%09%09%09%09bP%28%22OpenCloseDelay%22%29%29%3B%0A%09%09%09if%20%28%21value%29%0A%09%09%09%09return%3B%0A%09%09%09let%20delay%20%3D%20parseInt%28value%2C%2010%29%3B%0A%09%09%09if%20%28delay%20%3C%3D%200%20%7C%7C%20%21delay%29%0A%09%09%09%09delay%20%3D%20200%3B%0A%09%09%09Services.prefs.setIntPref%28PREF_BRANCH%20+%20%22OpenCloseDelay%22%2C%20delay%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22buttonBgColor%22%3A%0A%09%09%09value%20%3D%20promptme%28%22Change%20Code%20Snippets%20background%20color.%5CnCan%20be%3A%5Cn%22%20+%0A%09%09%09%09%22An%20RGB%20color%3A%20rgb%2824%2C188%2C156%29%5Cn%22%20+%0A%09%09%09%09%22An%20HEX%20color%3A%20%2318bc9c%5Cn%22%20+%0A%09%09%09%09%22An%20HSL%20color%3A%20hsl%28168%2C%2087%25%2C%2060%25%29%5Cn%22%20+%0A%09%09%09%09%22A%20valid%20color%20keyword%3A%20green%22%2C%20bP%28%22ButtonBgColor%22%29%29%3B%0A%09%09%09if%20%28%21value%29%0A%09%09%09%09value%20%3D%20%22rgb%2824%2C188%2C156%29%22%3B%0A%09%09%09Services.prefs.setCharPref%28PREF_BRANCH%20+%20%22ButtonBgColor%22%2C%20value%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22cursorAnchor%22%3A%0A%09%09%09value%20%3D%20promptme%28%22Set%20a%20unique%20%5C%22anchor%5C%22%20to%20mark%20the%20cursor%20insertion%20point.%22%2C%20bP%28%22CursorAnchor%22%29%29%3B%0A%09%09%09if%20%28%21value%29%0A%09%09%09%09value%20%3D%20%22here%3D%3E%3C%3Dhere%22%3B%0A%09%09%09Services.prefs.setCharPref%28PREF_BRANCH%20+%20%22CursorAnchor%22%2C%20value%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22showOnSelfItems%22%3A%0A%09%09%09Services.prefs.setBoolPref%28PREF_BRANCH%20+%20%22ShowOnSelfItems%22%2C%20%21bP%28%22ShowOnSelfItems%22%29%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22customLabelShow%22%3A%0A%09%09%09Services.prefs.setBoolPref%28PREF_BRANCH%20+%20%22CustomLabelShow%22%2C%20%21bP%28%22CustomLabelShow%22%29%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22customLabel%22%3A%0A%09%09%09value%20%3D%20promptme%28%22Set%20a%20custom%20label%20for%20the%20button.%22%2C%0A%09%09%09%09Services.prefs.getComplexValue%28PREF_BRANCH%20+%20%22CustomLabel%22%2C%20Ci.nsISupportsString%29.data%29%3B%0A%09%09%09if%20%28%21value%29%0A%09%09%09%09value%20%3D%20%22Code%20Snippets%22%3B%0A%09%09%09let%20str%20%3D%20Cc%5B%22@mozilla.org/supports-string%3B1%22%5D.createInstance%28Ci.nsISupportsString%29%3B%0A%09%09%09str.data%20%3D%20value%3B%0A%09%09%09Services.prefs.setComplexValue%28%28PREF_BRANCH%20+%20%22CustomLabel%22%29%2C%20Ci.nsISupportsString%2C%20str%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22switchSnippets%22%3A%0A%09%09%09Services.prefs.setBoolPref%28PREF_BRANCH%20+%20%22Off%22%2C%20%21bP%28%22Off%22%29%29%3B%0A%09%09%09if%20%28bP%28%22Off%22%29%29%20%7B%0A%09%09%09%09self.style.opacity%20%3D%20%220.65%22%3B%0A%09%09%09%09self.checked%20%3D%20false%3B%0A%09%09%09%7D%20else%20%7B%0A%09%09%09%09self.style.opacity%20%3D%20%221%22%3B%0A%09%09%09%09if%20%28bP%28%22AllowChecked%22%29%29%0A%09%09%09%09%09self.checked%20%3D%20true%3B%0A%09%09%09%7D%0A%09%09%09self.initSnippets%28%29%3B%0A%09%09%09break%3B%0A%09%09default%3A%0A%09%09%09return%3B%0A%09%7D%0A%7D%3B%0A%0Athis.onDestroy%20%3D%20function%28aReason%29%20%7B%0A%09if%20%28aReason%20%3D%3D%3D%20%22update%22%29%20%7B%0A%09%09var%20on%20%3D%20%21bP%28%22Off%22%29%3B%0A%09%09if%20%28on%29%0A%09%09%09Services.prefs.setBoolPref%28PREF_BRANCH%20+%20%22Off%22%2C%20true%29%3B%0A%09%09self.initSnippets%28%29%3B%0A%09%09if%20%28on%29%0A%09%09%09Services.prefs.setBoolPref%28PREF_BRANCH%20+%20%22Off%22%2C%20false%29%3B%0A%09%7D%20else%20if%20%28aReason%20%3D%3D%3D%20%22delete%22%29%20%7B%0A%09%09self.initSnippets%28true%29%3B%0A%09%09setTimeout%28function%28%29%20%7B%0A%09%09%09%28Services.prefs.getBranch%28PREF_BRANCH%29%29.deleteBranch%28%22%22%29%3B%0A%09%09%7D%2C%20500%29%3B%0A%09%7D%0A%7D%3B%0A%0Aif%20%28bP%28%22Off%22%29%29%20%7B%0A%09this.style.opacity%20%3D%20%220.65%22%3B%0A%09this.checked%20%3D%20false%3B%0A%09return%3B%0A%7D%0A%0Athis.initSnippets%28%29%3B%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5Bif%28%21event.target%20%26%26%20%21this.disabled%29%0A%09this.gSwitch%28%22switchSnippets%22%29%3B%0A%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B//%u25CF%u25CF%u25CF%20%3D%20Menu%20marker%0A%0A//%u25BA%u25BA%u25BA%20%3D%20Menu%20item%20marker%0A%0A/*%3D%3E%7C%3C%3D*/%20%3D%20Cursor%20insertion%20point%20marker%0A%0AWARNING%21%21%21%0ADo%20not%20use%20any%20of%20this%20markers%20as%20part%20of%20your%20code%20snippets.%0ADo%20not%20change%20under%20any%20circumstances%20the%20%22comma%20inside%20square%20brackets%22%20that%20can%20be%20found%20inside%20the%20Help%20tab%20of%20this%20button%20neither%20use%20such%20separator%20in%20your%20code%20snippets.%0A%5B%2C%5D%0A//%u25CF%u25CF%u25CFOpen%20Pages%20in%20...%0A//%u25BA%u25BA%u25BACurrent%20tab%20-%20FX%20and%20SM%0A%0AloadURI%28%22https%3A//duckduckgo.com/%22%29%3B%0A%0A//%u25BA%u25BA%u25BANew%20tab%20background%20-%20FX%20and%20SM%0A%0AgBrowser.addTab%28%22https%3A//duckduckgo.com/%22%29%3B%0A%0A//%u25BA%u25BA%u25BANew%20tab%20foreground%20-%20FX%20and%20SM%0A%0AgBrowser.selectedTab%20%3D%20gBrowser.addTab%28%22https%3A//duckduckgo.com/%22%29%3B%0A%0A//%u25BA%u25BA%u25BANew%20window%20-%20FX%20and%20SM%0A%0Awindow.open%28%22https%3A//duckduckgo.com/%22%29%3B%0A%0A//%u25BA%u25BA%u25BAThunderbird%0A%0AopenContentTab%28%22https%3A//duckduckgo.com/%22%29%3B%0A%0A//%u25CF%u25CF%u25CFJavaScript%20Basics%0A//%u25BA%u25BA%u25BAfunction%0A%0Afunction%20functionName%28%29%20%7B%0A%09/*%3D%3E%7C%3C%3D*/%0A%7D%0A%0A//%u25BA%u25BA%u25BA%22Global%22%20function%0A%0Athis.functionName%20%3D%20function%20%28%29%20%7B%0A%09/*%3D%3E%7C%3C%3D*/%0A%7D%3B%0A%0A//%u25BA%u25BA%u25BAConstructor%0A%0Avar%20varName%20%3D%20%7B%0A%09key1%20%3A%20value%2C%0A%09key2%20%3A%20value%0A%7D%3B%0A%0A//%u25BA%u25BA%u25BA%22Global%22%20Constructor%0A%0Athis.varName%20%3D%20%7B%0A%09key1%20%3A%20value%2C%0A%09key2%20%3A%20value%0A%7D%3B%0A%0A//%u25BA%u25BA%u25BAfor...%20loop%0A%0Afor%20%28var%20index%20%3D%200%3B%20index%20%3C%20myArray.length%3B%20index++%29%20%7B%0A%09/*%3D%3E%7C%3C%3D*/%0A%7D%0A%0A//%u25BA%u25BA%u25BAfor...in%20loop%0A%0Afor%20%28var%20key%20in%20object%29%20%7B%0A%09if%20%28object.hasOwnProperty%28key%29%29%20%7B%0A%09%09let%20value%20%3D%20object%5Bkey%5D%3B%0A%09%09/*%3D%3E%7C%3C%3D*/%0A%09%7D%0A%7D%0A%0A//%u25BA%u25BA%u25BAsetTimeout%0A%0AsetTimeout%28function%20%28%29%20%7B%0A%09/*%3D%3E%7C%3C%3D*/%0A%7D%2C%20100%29%3B%0A%0A//%u25BA%u25BA%u25BAsetInterval%0A%0AsetInterval%28function%20%28%29%20%7B%0A%09/*%3D%3E%7C%3C%3D*/%0A%7D%2C%20100%29%3B%0A%0A//%u25BA%u25BA%u25BAswitch%0A%0Aswitch%20%28expression%29%20%7B%0Acase%20value1%3A%0A%09statement%3B%0A%09break%3B%0Acase%20value2%3A%0A%09statement%3B%0A%09break%3B%0Acase%20value3%3A%0A%09statement%3B%0A%09break%3B%0Adefault%3A%0A%09statement%3B%0A%7D%0A%0A//%u25BA%u25BA%u25BAtry-catch-finally%0A%0Atry%20%7B%0A%09/*%3D%3E%7C%3C%3D*/%0A%7D%20catch%20%28aEr%29%20%7B%0A%09%0A%7D%0Afinally%20%7B%0A%09%0A%7D%0A%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" rel="nofollow" title="Install Code Snippets for CB Editor">
				<![CDATA[Install this button]]>
			</html:a>
		</html:div>
		<html:a id="about" href="https://addons.mozilla.org/addon/custom-buttons/">
			<![CDATA[About CustomButtons]]>
		</html:a>
		<html:div id="credits">
			<html:a href="http://custombuttons.sourceforge.net/forum/viewtopic.php?t=3599">
				<![CDATA[XML created with]]>
				<html:br/>
				<![CDATA[CB Context Menu Extended]]>
			</html:a>
		</html:div>
	</html:div>
</html:body>
  <name>Code Snippets for CB Editor</name>
  <image><![CDATA[data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAASUlEQVQ4jWOIi/v/nxLMMIwMWLfuPwbAJQ6TQzEAlyJcAKcB6E7EJU6yAchg3ToSDCA5DAiFOkED0G3BBYiORqLDYOBT4oAZAAAWpQvq9WCGqAAAAABJRU5ErkJggg==]]></image>
  <mode>0</mode>
  <initcode><![CDATA[if (self.parentNode && self.parentNode.id.match("wrapper-"))
	return;

if (!("Services" in window))
	Cu.import("resource://gre/modules/Services.jsm");

var PREF_BRANCH = "CB.CodeSnippetsForCBEditor.Id" + self.id.slice(20);

var _UID = "code-snippets-for-cb-editor" + self.id.slice(20);

// Menu items marker. Can be changed.
// Have to be UNIQUE and CAN NOT be used inside the code snippets!!!
var mItemsMarker = "//►►►";

// Menu marker. Can be changed.
// Have to be UNIQUE and CAN NOT be used inside the code snippets!!!
var menuMarker = "//●●●";

var insertButtonImageOnSelf = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/" +
	"9hAAAAUUlEQVQ4jWNgYGCIDw8P/08OZmBgiGeAMrTJweHh4f+RDSAV0NCA/3gAQQPwaSbJALK9QKTtNAwDXIAoAwgFIM" +
	"UGEB0GRALqG0BeZmKgMDsDABOrQmBgEfd7AAAAAElFTkSuQmCC";

var insertButtonImage = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA" +
	"u0lEQVQ4ja2TwQrCMAyGMzyLFnrSS714EhzbnqAT8Q3yGHv9Qg7xYKpZ11WcCwRK0v9rkrYAAAMi8hIHgAFk0S1xRGQN" +
	"+NXWBbQ6E0J48Ms24szMnpmrrxUQ0U0EHGP8Ma8AtQZcZKNX4vdpxphdjBNRL+FGA05abK3dpg075/ZJJddRC2nZM1ap" +
	"fSPAgYj6XPmFNo4acJYBZiGJ+C7hdjLEDKR0C/PvIEISgBZPAKs85Zw3hVwn2v++8xNoFTpR5t2/VgAAAABJRU5ErkJg" +
	"gg==";

var editorURL = "chrome://custombuttons/content/editor.xul";

//START// Default preferences management
bP.root = PREF_BRANCH;

bP.defaults = {
	ButtonBgColor: "rgb(24,188,156)",
	CursorAnchor: "/*=>|<=*/",
	CustomLabel: "Code Snippets",
	CustomLabelShow: false,
	AllowSelection: false,
	AllowChecked: true,
	Off: false,
	OpenOnMouseOver: true,
	OpenCloseDelay: 100,
	ShowOnSelfItems: true
};

for (let key in bP.defaults) {
	if (bP.defaults.hasOwnProperty(key)) {
		let val = bP.defaults[key];
		switch (typeof val) {
			case "boolean":
				Services.prefs.getDefaultBranch(PREF_BRANCH).setBoolPref(key, val);
				break;
			case "number":
				Services.prefs.getDefaultBranch(PREF_BRANCH).setIntPref(key, val);
				break;
			case "string":
				let str = Cc["@mozilla.org/supports-string;1"].createInstance(Ci.nsISupportsString);
				str.data = val;
				Services.prefs.getDefaultBranch(PREF_BRANCH).setComplexValue((key),
					Ci.nsISupportsString, str);
				break;
		}
	}
}

bP.observe = function(aPrefs, aCallback) {
	let {
		root
	} = bP;

	function observe(subject, topic, data) {
		if (topic !== "nsPref:changed")
			return;
		let pref = data.slice(root.length);
		if (aPrefs.indexOf(pref) === -1)
			return;
		aCallback(pref);
	}
	Services.prefs.addObserver(root, observe, false);
	unload(function() Services.prefs.removeObserver(root, observe));
};

function bP(aKey) {
	let {
		branch,
		defaults
	} = bP;
	if (!branch)
		branch = Services.prefs.getBranch(bP.root);
	switch (typeof defaults[aKey]) {
		case "boolean":
			return branch.getBoolPref(aKey);
		case "number":
			return branch.getIntPref(aKey);
		case "string":
			return branch.getComplexValue(aKey, Ci.nsISupportsString).data;
	}
	return null;
}

function unload(aCallback, aContainer) {
	let callback;
	let unloaders = unload.unloaders;
	if (unloaders === null)
		unloaders = unload.unloaders = [];
	if (aCallback === null) {
		unloaders.slice().forEach(function(unloader) unloader());
		unloaders.length = 0;
	}
	if (aContainer !== null) {
		aContainer.addEventListener("unload", removeUnloader, false);
		let origCallback = aCallback;
		callback = function() {
			aContainer.removeEventListener("unload", removeUnloader, false);
			origCallback();
		};
		return null;
	}

	function unloader() {
		try {
			callback();
		} catch (err) {
			Components.utils.reportError(err);
		}
	}
	unloaders.push(unloader);

	function removeUnloader() {
		let index = unloaders.indexOf(unloader);
		if (index !== -1)
			unloaders.splice(index, 1);
	}
	return removeUnloader;
}
//END// Default preferences management

mItemsMarker = "\n" + mItemsMarker;

menuMarker = "\n" + menuMarker;

this.style.opacity = "1";

this.tooltipText = self.name + "\n\n" +
	"\tL : Show/Hide button on CB Editor\n" +
	"\tM : Open options menu\n\n" +
	"\tL on menu items : Insert Snippet\n" +
	"\tM on menu items : Insert Snippet without closing menu\t\n\n";

if (bP("AllowChecked"))
	this.checked = true;

function setButtonDesign(aDoc) {
	let button = aDoc.getElementById(_UID + "-toolbarbutton");
	let label = bP("CustomLabel");
	button.tooltipText = label;
	button.style.MozAppearance = "none";
	button.style.margin = "0px";
	button.style.padding = "0px";
	bP("CustomLabelShow") && (button.label = " " + label + " ");
	let image = aDoc.getAnonymousElementByAttribute(button, "class", "toolbarbutton-icon");
	image.style.backgroundColor = bP("ButtonBgColor");
	image.style.MozMargin = "0px";
	image.style.margin = "1px";
	let dropmarker = aDoc.getAnonymousElementByAttribute(button, "class", "toolbarbutton-menu-dropmarker");
	dropmarker.hidden = true;
}

var place = null;
var focusedElement = null;

function createButton(aDoc) {
	let button = document.createElementNS(xulns, "toolbarbutton");
	var subMenus = self.getAttribute("Help").split("[,]")[1].split(menuMarker);
	button.setAttribute("image", insertButtonImage);
	button.setAttribute("id", _UID + "-toolbarbutton");
	button.setAttribute("type", "menu");
	button.timer = 0;
	button.onmouseover = function() {
		place = aDoc.commandDispatcher.focusedElement;
		if (bP("OpenOnMouseOver")) {
			let thisMenupopup = aDoc.getElementById(_UID + "-mpop-inserter");
			clearTimeout(button.timer);
			button.timer = setTimeout(function() {
				thisMenupopup && thisMenupopup.openPopup(button, "after_start", 0, 0, false, false);
			}, bP("OpenCloseDelay"));
		}
	};
	button.onmouseout = function() {
		if (bP("OpenOnMouseOver")) {
			let thisMenupopup = aDoc.getElementById(_UID + "-mpop-inserter");
			clearTimeout(button.timer);
			button.timer = setTimeout(function() {
				thisMenupopup && thisMenupopup.hidePopup();
			}, bP("OpenCloseDelay"));
		}
	};
	var mainMenupopup = document.createElementNS(xulns, "menupopup");
	mainMenupopup.setAttribute("id", _UID + "-mpop-inserter");
	var onSelf = false;
	if (aDoc.location.href.split("custombuttons-button")[1] === self.id.replace("custombuttons-button", "")) {
		onSelf = true;
		button.setAttribute("image", insertButtonImageOnSelf);
		if (bP("ShowOnSelfItems")) {
			let selfItems = [
				["Insert Menuitem Sep.", mItemsMarker],
				["Insert Menu Sep.", menuMarker],
				["Insert Cursor Anchor", bP("CursorAnchor") + bP("CursorAnchor")]
			];
			for (let s = 0; s < selfItems.length; s++)
				mainMenupopup.appendChild(createMItems(aDoc, selfItems[s][0], selfItems[s][1], true));
		}
	}
	button.appendChild(mainMenupopup);
	for (let m = 0; m < subMenus.length; m++) {
		if (subMenus[m] !== "") {
			if (subMenus.length > 1) {
				let items = subMenus[m].split(mItemsMarker),
					menu = document.createElementNS(xulns, "menu"),
					menuLabel = subMenus[m].split("\n", 1);
				menu.setAttribute("label", menuLabel);
				items.splice(0, 1); // Removes what would be the Menu Label
				var subMenupopup = document.createElementNS(xulns, "menupopup");
				for (let i = 0; i < items.length; i++) {
					if (items[i] !== "") {
						let label = items[i].split("\n", 1);
						let insertText = items[i].replace(label + "\n", "");
						let menuitem = createMItems(aDoc, label, insertText);
						subMenupopup.appendChild(menuitem);
						menu.appendChild(subMenupopup);
					}
				}
				mainMenupopup.appendChild(menu);
			} else {
				let items = subMenus[m].split(mItemsMarker);
				for (let i = 0; i < items.length; i++) {
					if (items[i] !== "") {
						let label = items[i].split("\n", 1);
						let insertText = items[i].replace(label + "\n", "");
						let menuitem = createMItems(aDoc, label, insertText);
						mainMenupopup.appendChild(menuitem);
					}
				}
			}
		}
	}
	return button;
}

function createMItems(aDoc, aLabel, aInsText, aSelf) {
	let menuitem = document.createElementNS(xulns, "menuitem");
	menuitem.setAttribute("label", aLabel);
	menuitem.insertText = aInsText;
	menuitem.inserter = function inserter(aText) {
		var firstPart = aText.split(bP("CursorAnchor"))[0];
		var cursorPosition = place.selectionStart + firstPart.length;
		var cursorAnchorPresent = aText.length !== firstPart.length;
		aText = aText.replace(bP("CursorAnchor"), "");
		if (aText === bP("CursorAnchor"))
			cursorPosition = place.selectionStart + bP("CursorAnchor").length;
		var controller = aDoc.commandDispatcher.getControllerForCommand("cmd_insertText");
		if (controller && controller.isCommandEnabled("cmd_insertText")) {
			controller = controller.QueryInterface(Ci.nsICommandController);
			var params = Cc["@mozilla.org/embedcomp/command-params;1"]
				.createInstance(Ci.nsICommandParams);
			params.setStringValue("state_data", aText);
			controller.doCommandWithParams("cmd_insertText", params);
		}
		if (bP("AllowSelection") && !cursorAnchorPresent)
			place.setSelectionRange(place.selectionStart - aText.length, place.selectionStart); // selects the pasted
		else
			place.selectionStart = place.selectionEnd = cursorPosition;
	};
	aSelf && menuitem.setAttribute("style", "font-weight: bold; color: rgb(250,53,47) !important;");
	let commandString = "inserter(event.target.insertText)";
	menuitem.setAttribute("oncommand", "event.preventDefault();event.stopPropagation();");
	menuitem.setAttribute("onclick", commandString);
	return menuitem;
}

function isButtonAlreadyPresent(aDoc) {
	return !!aDoc.getElementById(_UID + "-toolbarbutton");
}

var observer = {
	observe: function(subject, topic, data) {
		subject.addEventListener("load", this, false);
	},
	handleEvent: function(aEvt) {
		var doc = aEvt.target;
		var win = doc.defaultView;
		win.removeEventListener("load", this, false);
		if (doc.location.href.substring(0, 41) !== editorURL ||
			Services.prefs.getPrefType(PREF_BRANCH + "Off") === 0)
			return;
		if (!isButtonAlreadyPresent(doc)) {
			var tabs = doc.getElementsByTagName("tabs");
			tabs[0].appendChild(createButton(doc));
			setButtonDesign(doc);
		}
	}
};

var activeWin = null;

this.onmouseover = function() {
	activeWin = Services.ww.activeWindow;
};

function alsoForTab(aEvt) {
	var doc = aEvt.target;
	if (doc.location.href.substring(0, 41) !== editorURL ||
		Services.prefs.getPrefType(PREF_BRANCH + "Off") === 0)
		return;
	if (!isButtonAlreadyPresent(doc)) {
		var tabs = doc.getElementsByTagName("tabs");
		tabs[0].appendChild(createButton(doc));
		setButtonDesign(doc);
	}
}

this.initSnippets = function(aDestroyer) {
	if (!bP("Off") && !aDestroyer) {
		Services.obs.addObserver(observer, "domwindowopened", false);
		(typeof gBrowser === "object") && window.addEventListener("DOMContentLoaded", alsoForTab, false);
		Services.prefs.setBoolPref(PREF_BRANCH + "Off", false);
	}
	if (bP("Off") || aDestroyer) {
		Services.obs.removeObserver(observer, "domwindowopened");
		(typeof gBrowser === "object") && window.removeEventListener("DOMContentLoaded", alsoForTab, false);
		aDestroyer || Services.prefs.setBoolPref(PREF_BRANCH + "Off", true);
	}
	if (typeof gBrowser === "object") {
		var tabContainer = gBrowser.mTabContainer;
		var tabs = tabContainer.childNodes;
		for (let t = 0; t < tabContainer.itemCount; t++) {
			var pageDoc = tabs[t].linkedBrowser.contentDocument;
			if (pageDoc.location.href.substring(0, 41) !== editorURL)
				continue;
			if (!bP("Off") && !aDestroyer) {
				if (isButtonAlreadyPresent(pageDoc))
					continue;
				let tbs = pageDoc.getElementsByTagName("tabs");
				tbs[0].appendChild(createButton(pageDoc));
				setButtonDesign(pageDoc);
			}
			if (bP("Off") || aDestroyer) {
				var b = pageDoc.getElementById(_UID + "-toolbarbutton");
				while (b) {
					b = pageDoc.getElementById(_UID + "-toolbarbutton");
					b && b.parentNode.removeChild(b);
				}
			}
		}
	}
	var em = Services.ww.getWindowEnumerator();
	var win = true;
	while (win) {
		win = em.getNext();
		if (!win)
			return;
		var doc = win.document;
		if (doc.location.href.substring(0, 41) !== editorURL)
			continue;
		if (!bP("Off") && !aDestroyer) {
			if (isButtonAlreadyPresent(doc))
				continue;
			let tbs = doc.getElementsByTagName("tabs");
			tbs[0].appendChild(createButton(doc));
			setButtonDesign(doc);
			if (win === activeWin)
				win.focus();
		}
		if (bP("Off") || aDestroyer) {
			var insertBtn = doc.getElementById(_UID + "-toolbarbutton");
			while (insertBtn) {
				insertBtn = doc.getElementById(_UID + "-toolbarbutton");
				insertBtn && insertBtn.parentNode.removeChild(insertBtn);
				if (win === activeWin)
					win.focus();
			}
		}
	}
};

if ("CustomizableUI" in window) {
	let _cui = _UID + "customizable_ui_";
	if (!window[_cui]) {
		window[_cui] = true;
		CustomizableUI.addListener({
			onCustomizeEnd: function(aWindow) {
				var thisBtn = aWindow.document.getElementById(self.id);
				setTimeout(function() {
					if (window[_cui]) {
						thisBtn.destroy("update");
						setTimeout(function() {
							thisBtn.init();
						}, 100);
					}
				}, Math.floor(Math.random() * (1 + 2000 - 200)) + 200);
			}
		});
	}
}

function promptme(aMsg, aVal) {
	let retVal = {
		value: aVal
	};
	if (Services.prompt.prompt(null, (self.label || self.name), aMsg, retVal, null, {}))
		return retVal.value;
	else
		return false;
	return false;
}

function $XML(aXML) { // Return parsed XML
	aXML = aXML.replace(/>\s+</g, "><"); // Linearize XML
	return (new DOMParser()).parseFromString(aXML, "application/xml").documentElement;
}

this.onclick = function(aEvt) {
	if (!aEvt.shiftKey && !aEvt.ctrlKey && !aEvt.altKey && aEvt.button === 0) { // Left Click
		aEvt.preventDefault();
		self.gSwitch("switchSnippets");
		aEvt.stopPropagation();
	} else if (!aEvt.shiftKey && !aEvt.ctrlKey && !aEvt.altKey && aEvt.button === 1) { // Middle Click
		aEvt.preventDefault();
		var opt_tt = {
			allowSel: "If checked/enabled, the recently pasted text will be auto-selected, except" +
				" when the pasted text contains a &quot;cursor anchor&quot;.",
			allowCheck: "If checked/enabled, " + self.name + " will also reflect its enabled " +
				"state by its pressed/checked state.",
			openMouseOver: "If checked/enabled, the Code Snippets button will open on mouse over.",
			openCloseDelay: "Sets the open/close delay for &quot;Open menu on mouseover&quot;" +
				" (In milliseconds).",
			btnBgColor: "Sets the background color of the Code Snippets button inside CB Editor.",
			cursorAnchor: "Here you can change the &quot;cursor anchor&quot; used to create" +
				" &quot;cursor's insertion points&quot;.",
			onSelfItems: "If checked/enabled, the Code Snippets button for this button will show " +
				"some additional menu items to facilitate menus and menuitems creation.",
			showBtnLabel: "If checked/enabled, the Code Snippets button will display its label.",
			btnLabel: "It allows you to customize the button label."
		};
		while (self.hasChildNodes())
			self.removeChild(self.lastChild);
		self.appendChild($XML("<menupopup xmlns=\"" + xulns + "\"" +
			" id=\"" + _UID + "-options-mpop\"" +
			" onclick=\"event.preventDefault();event.stopPropagation();\"" +
			" onpopuphiding=\"this.parentNode.gSwitch(\'init\');\">" +
			"<dialogheader><label value=\"Button settings\"/></dialogheader>" +
			"<menuitem label=\"Allow checked\" tooltiptext=\"" + opt_tt.allowCheck + "\"" +
			" oncommand=\"this.parentNode.parentNode.gSwitch(\'allowChecked\');" +
			"event.stopPropagation();\"" +
			" closemenu=\"none\" type=\"checkbox\"" +
			" checked=\"" + bP("AllowChecked") + "\"/>" +
			"<dialogheader><label value=\"CD Editor button settings\"/></dialogheader>" +
			"<menuitem label=\"Allow selection\" tooltiptext=\"" + opt_tt.allowSel + "\"" +
			" oncommand=\"this.parentNode.parentNode.gSwitch(\'allowSelection\');" +
			"event.stopPropagation();\"" +
			" closemenu=\"none\" type=\"checkbox\"" +
			" checked=\"" + bP("AllowSelection") + "\"/>" +
			"<menuitem label=\"Button background color\" tooltiptext=\"" + opt_tt.btnBgColor + "\"" +
			" oncommand=\"this.parentNode.parentNode.gSwitch(\'buttonBgColor\');" +
			"event.stopPropagation();\"/>" +
			"<menuitem label=\"Cursor anchor\" tooltiptext=\"" + opt_tt.cursorAnchor + "\"" +
			" oncommand=\"this.parentNode.parentNode.gSwitch(\'cursorAnchor\');" +
			"event.stopPropagation();\"/>" +
			"<menuitem label=\"Change label\" tooltiptext=\"" + opt_tt.btnLabel + "\"" +
			" oncommand=\"this.parentNode.parentNode.gSwitch(\'customLabel\');" +
			"event.stopPropagation();\"/>" +
			"<menuitem label=\"Open menu on mouseover\" tooltiptext=\"" + opt_tt.openMouseOver + "\"" +
			" oncommand=\"this.parentNode.parentNode.gSwitch(\'openOnMouseOver\');" +
			"event.stopPropagation();\"" +
			" closemenu=\"none\" type=\"checkbox\"" +
			" checked=\"" + bP("OpenOnMouseOver") + "\"/>" +
			"<menuitem label=\"Open/Close delay\" tooltiptext=\"" + opt_tt.openCloseDelay + "\"" +
			" oncommand=\"this.parentNode.parentNode.gSwitch(\'openCloseDelay\');" +
			"event.stopPropagation();\"/>" +
			"<menuitem label=\"Show &quot;on-self&quot; items\" tooltiptext=\"" + opt_tt.onSelfItems + "\"" +
			" oncommand=\"this.parentNode.parentNode.gSwitch(\'showOnSelfItems\');" +
			"event.stopPropagation();\"" +
			" closemenu=\"none\" type=\"checkbox\"" +
			" checked=\"" + bP("ShowOnSelfItems") + "\"/>" +
			"<menuitem label=\"Show button label\" tooltiptext=\"" + opt_tt.showBtnLabel + "\"" +
			" oncommand=\"this.parentNode.parentNode.gSwitch(\'customLabelShow\');" +
			"event.stopPropagation();\"" +
			" closemenu=\"none\" type=\"checkbox\"" +
			" checked=\"" + bP("CustomLabelShow") + "\"/>" +
			"</menupopup>"));
		let optPopup = document.getElementById(_UID + "-options-mpop");
		let optPopupHeader = optPopup.getElementsByTagName("dialogheader");
		Array.prototype.slice.call(optPopupHeader).forEach(function(aHeader) {
			aHeader.style.fontWeight = "bold";
			aHeader.style.margin = "0px 0px 5px 0px";
			aHeader.style.padding = "2px 0px 2px 10px";
			aHeader.style.border = "none";
		});
		optPopup.openPopup(aEvt.target, "after_start", 0, 0, false, false);
		aEvt.stopPropagation();
	}
};

this.gSwitch = function(aSwitch) {
	var value;
	switch (aSwitch) {
		case "init":
			setTimeout(function() {
				self.init();
			}, 100);
			break;
		case "allowSelection":
			Services.prefs.setBoolPref(PREF_BRANCH + "AllowSelection", !bP("AllowSelection"));
			break;
		case "allowChecked":
			Services.prefs.setBoolPref(PREF_BRANCH + "AllowChecked", !bP("AllowChecked"));
			break;
		case "openOnMouseOver":
			Services.prefs.setBoolPref(PREF_BRANCH + "OpenOnMouseOver", !bP("OpenOnMouseOver"));
			break;
		case "openCloseDelay":
			value = promptme("Set open delay for \"Open menu on mouseover\"\nIn milliseconds:",
				bP("OpenCloseDelay"));
			if (!value)
				return;
			let delay = parseInt(value, 10);
			if (delay <= 0 || !delay)
				delay = 200;
			Services.prefs.setIntPref(PREF_BRANCH + "OpenCloseDelay", delay);
			break;
		case "buttonBgColor":
			value = promptme("Change Code Snippets background color.\nCan be:\n" +
				"An RGB color: rgb(24,188,156)\n" +
				"An HEX color: #18bc9c\n" +
				"An HSL color: hsl(168, 87%, 60%)\n" +
				"A valid color keyword: green", bP("ButtonBgColor"));
			if (!value)
				value = "rgb(24,188,156)";
			Services.prefs.setCharPref(PREF_BRANCH + "ButtonBgColor", value);
			break;
		case "cursorAnchor":
			value = promptme("Set a unique \"anchor\" to mark the cursor insertion point.", bP("CursorAnchor"));
			if (!value)
				value = "here=><=here";
			Services.prefs.setCharPref(PREF_BRANCH + "CursorAnchor", value);
			break;
		case "showOnSelfItems":
			Services.prefs.setBoolPref(PREF_BRANCH + "ShowOnSelfItems", !bP("ShowOnSelfItems"));
			break;
		case "customLabelShow":
			Services.prefs.setBoolPref(PREF_BRANCH + "CustomLabelShow", !bP("CustomLabelShow"));
			break;
		case "customLabel":
			value = promptme("Set a custom label for the button.",
				Services.prefs.getComplexValue(PREF_BRANCH + "CustomLabel", Ci.nsISupportsString).data);
			if (!value)
				value = "Code Snippets";
			let str = Cc["@mozilla.org/supports-string;1"].createInstance(Ci.nsISupportsString);
			str.data = value;
			Services.prefs.setComplexValue((PREF_BRANCH + "CustomLabel"), Ci.nsISupportsString, str);
			break;
		case "switchSnippets":
			Services.prefs.setBoolPref(PREF_BRANCH + "Off", !bP("Off"));
			if (bP("Off")) {
				self.style.opacity = "0.65";
				self.checked = false;
			} else {
				self.style.opacity = "1";
				if (bP("AllowChecked"))
					self.checked = true;
			}
			self.initSnippets();
			break;
		default:
			return;
	}
};

this.onDestroy = function(aReason) {
	if (aReason === "update") {
		var on = !bP("Off");
		if (on)
			Services.prefs.setBoolPref(PREF_BRANCH + "Off", true);
		self.initSnippets();
		if (on)
			Services.prefs.setBoolPref(PREF_BRANCH + "Off", false);
	} else if (aReason === "delete") {
		self.initSnippets(true);
		setTimeout(function() {
			(Services.prefs.getBranch(PREF_BRANCH)).deleteBranch("");
		}, 500);
	}
};

if (bP("Off")) {
	this.style.opacity = "0.65";
	this.checked = false;
	return;
}

this.initSnippets();]]></initcode>
  <code><![CDATA[if(!event.target && !this.disabled)
	this.gSwitch("switchSnippets");
]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help><![CDATA[//●●● = Menu marker

//►►► = Menu item marker

/*=>|<=*/ = Cursor insertion point marker

WARNING!!!
Do not use any of this markers as part of your code snippets.
Do not change under any circumstances the "comma inside square brackets" that can be found inside the Help tab of this button neither use such separator in your code snippets.
[,]
//●●●Open Pages in ...
//►►►Current tab - FX and SM

loadURI("https://duckduckgo.com/");

//►►►New tab background - FX and SM

gBrowser.addTab("https://duckduckgo.com/");

//►►►New tab foreground - FX and SM

gBrowser.selectedTab = gBrowser.addTab("https://duckduckgo.com/");

//►►►New window - FX and SM

window.open("https://duckduckgo.com/");

//►►►Thunderbird

openContentTab("https://duckduckgo.com/");

//●●●JavaScript Basics
//►►►function

function functionName() {
	/*=>|<=*/
}

//►►►"Global" function

this.functionName = function () {
	/*=>|<=*/
};

//►►►Constructor

var varName = {
	key1 : value,
	key2 : value
};

//►►►"Global" Constructor

this.varName = {
	key1 : value,
	key2 : value
};

//►►►for... loop

for (var index = 0; index < myArray.length; index++) {
	/*=>|<=*/
}

//►►►for...in loop

for (var key in object) {
	if (object.hasOwnProperty(key)) {
		let value = object[key];
		/*=>|<=*/
	}
}

//►►►setTimeout

setTimeout(function () {
	/*=>|<=*/
}, 100);

//►►►setInterval

setInterval(function () {
	/*=>|<=*/
}, 100);

//►►►switch

switch (expression) {
case value1:
	statement;
	break;
case value2:
	statement;
	break;
case value3:
	statement;
	break;
default:
	statement;
}

//►►►try-catch-finally

try {
	/*=>|<=*/
} catch (aEr) {
	
}
finally {
	
}
]]></help>
  <attributes/>
</custombutton>