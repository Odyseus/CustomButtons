<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/"
              xmlns:html="http://www.w3.org/1999/xhtml">
  <html:head>
    <html:title><![CDATA[Open Application Folders]]></html:title>
    <html:link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACnElEQVR4Xm2RzYtbZRSHn/fr3pvJzTB3qiNM2k2pMBUGhEHaqsUqdeFGQalCobgREaFu/B/cqCtxVSjoQhBEQRBmIfWDKgNGJUPt0Nhah9JJ4iSd5E6+bu5972tAO4SS5/DjXZ1znsMrNiq1eikMQqYYJCmjxNH5+zdW777L0J5KKl9VPmnf+ut9KWkwhbheuzNcOVYOmGKc5iRO0r1ykeXCx0h7kt4fC3z5wfqbQnAJwQHa5S7jAZSRuJ0mkf81cheobhBXZa+ri1uptQjHAZoZCEC1PiPgDuwxCfwerBU7b73zXn//3usCcdt4HkZ7SGZg431U51NUCgwlO3cV/bVXhR/6p9ut+nP9QYeNn7/n8qUPZxvQ/Q6VVWHk4ZqWRvlJjpx9hcGfW2wO95N2q8m3618A2WwDt/0RplSAXsBed57eyossHl5GYdHacG3zGpADM06wjQ1UUIN+CLHPvfAxojPnKLiE+bDE1R9+5GatAmgPeGCAteQ7l5GBhGSyuROyd/gFouUyWkqEErR2mwXAAA8BRS0AgMQBjSra30ZkEeDzz9Dn4ZcvMO51SMcJcTdGChmA0ABA6cAgzyG3I8jLEBylV4fWoaeIc0V7t0Uv7pFbC+CA+28mp/8+SwXKnMVmz1O9HpE+eobMZdjcoY1GIHD/NwIdoH1fBaNguzlg88pVyoUi4vTbFI8eJxsNAIfSkrliESllH/L0v0jktNNomFGv1TFrL3Fo9QSMR3jaEEXzLC09gjaKp595No0WjyCEB4zRclICUMDxtRMce/wJ1MIi2SglXShhfI/cOjxPoZRmbq4gXzt/gVrtBrdvbiG+Wf+p/mvll1BpiVAGhCDPxuAUDotz4HKHlIJON6bRbL4hhPjcMx5mkn8BBLEUrsVZbq0AAAAASUVORK5CYII="/>
    <html:style type="text/css"><![CDATA[
body { font-size: medium; margin: 0; }
body, code:before, help:before, initcode:before {
  font-family: "Verdana", sans-serif;
}
#wrapper { position: fixed; top: 1em; right: 1em; text-align: center; }
p { font-size: small; text-align: center; }
#button {
  background-color: rgb(85, 168, 2);
  background-image: linear-gradient(to bottom, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -moz-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -o-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -webkit-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  border: 1px solid rgb(58, 116, 4);
  border-radius: .5em;
  -moz-border-radius: .5em;
  -webkit-border-radius: .5em;
  padding: 0;
  margin-bottom: 1em;
  box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -moz-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -o-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -webkit-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
}
#button a {
  color: #000;
  text-shadow: -1pt -1px 0pt rgba(255, 255, 255, .5);
  padding: 1em;
  text-decoration: none;
}
:-moz-any-link:focus {
  color: white;
  outline-color: transparent;
  text-decoration: none;
}
#button a, code, code:before, initcode, initcode:before, help, help:before {
  display: block;
}
#credits { position: fixed; bottom: 1em; right: 1em; font-size: small; }
custombutton { background-color: rgb(171, 171, 171); margin: 1em; }
date, image, mode, accelkey { display: none; }
name { font-weight: bold; font-size: x-large; }
code:before, help:before, initcode:before {
  font-weight: bold;
  font-size: large;
  margin: 0 0 1em;
  padding: .5em;
}
code:before { content: "CODE"; }
help:before { content: "Help"; }
initcode:before { content: "Initialization Code"; }
code, initcode, help {
  background-color: rgb(255, 255, 255);
  border: 1px inset rgb(170, 170, 170);
  font: medium monospace;
  margin: 1em 1em 2em 0;
  padding: 1em;
  text-align: left;
  width: 840px;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.clear { clear: both; }
]]></html:style>
  </html:head>
  <html:body>
    <html:div id="wrapper">
      <html:div id="button">
        <html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3EOpen%20Application%20Folders%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACnElEQVR4Xm2RzYtbZRSHn/fr3pvJzTB3qiNM2k2pMBUGhEHaqsUqdeFGQalCobgREaFu/B/cqCtxVSjoQhBEQRBmIfWDKgNGJUPt0Nhah9JJ4iSd5E6+bu5972tAO4SS5/DjXZ1znsMrNiq1eikMQqYYJCmjxNH5+zdW777L0J5KKl9VPmnf+ut9KWkwhbheuzNcOVYOmGKc5iRO0r1ykeXCx0h7kt4fC3z5wfqbQnAJwQHa5S7jAZSRuJ0mkf81cheobhBXZa+ri1uptQjHAZoZCEC1PiPgDuwxCfwerBU7b73zXn//3usCcdt4HkZ7SGZg431U51NUCgwlO3cV/bVXhR/6p9ut+nP9QYeNn7/n8qUPZxvQ/Q6VVWHk4ZqWRvlJjpx9hcGfW2wO95N2q8m3618A2WwDt/0RplSAXsBed57eyossHl5GYdHacG3zGpADM06wjQ1UUIN+CLHPvfAxojPnKLiE+bDE1R9+5GatAmgPeGCAteQ7l5GBhGSyuROyd/gFouUyWkqEErR2mwXAAA8BRS0AgMQBjSra30ZkEeDzz9Dn4ZcvMO51SMcJcTdGChmA0ABA6cAgzyG3I8jLEBylV4fWoaeIc0V7t0Uv7pFbC+CA+28mp/8+SwXKnMVmz1O9HpE+eobMZdjcoY1GIHD/NwIdoH1fBaNguzlg88pVyoUi4vTbFI8eJxsNAIfSkrliESllH/L0v0jktNNomFGv1TFrL3Fo9QSMR3jaEEXzLC09gjaKp595No0WjyCEB4zRclICUMDxtRMce/wJ1MIi2SglXShhfI/cOjxPoZRmbq4gXzt/gVrtBrdvbiG+Wf+p/mvll1BpiVAGhCDPxuAUDotz4HKHlIJON6bRbL4hhPjcMx5mkn8BBLEUrsVZbq0AAAAASUVORK5CYII%3D%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5Bfunction%20makeXML%28aXMLString%29%20%7B%0A%20%20return%20%28new%20DOMParser%29.parseFromString%28aXMLString%2C%20%22application/xml%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.documentElement%3B%0A%7D%0A%0Athis.setAttribute%28%22tabindex%22%2C%201%29%3B%0A%0Athis.label%20%3D%20this.tooltipText%20%3D%20%22Open%20%22%20+%20Application.name%20+%20%22%20Folders%22%3B%0A%0Athis.getDownloadDir%20%3D%20function%20getDownloadDir%28%29%20%7B%0A%20%20var%20prefs%20%3D%20cbu.ps.getBranch%28%22browser.download.%22%29%3B%0A%20%20let%20folderList%20%3D%20prefs.getIntPref%28%22folderList%22%29%3B%0A%20%20let%20dlPref%20%3D%20%22%22%3B%0A%20%20switch%20%28folderList%29%20%7B%0A%20%20%20%20case%200%3A%20%20this.getSpecialDir%28%22Desk%22%2C%20this.openDir%29%3B%20return%3B%20//%20Desktop%0A%20%20%20%20case%201%3A%20%20dlPref%20%3D%20%22lastDir%22%3B%20break%3B%0A%20%20%20%20default%3A%20dlPref%20%3D%20%22dir%22%3B%0A%20%20%7D%0A%20%20this.openDir%28prefs.getCharPref%28dlPref%29%29%3B%0A%7D%0A%0Athis.getSpecialDir%20%3D%20function%20getSpecialDir%28aDir%2C%20aCallback%29%20%7B%0A%20%20if%20%28%21aDir%29%20return%3B%0A%20%20let%20dirsvc%20%3D%20Components.classes%5B%22@mozilla.org/file/directory_service%3B1%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.getService%28Components.interfaces.nsIProperties%29%3B%0A%20%20let%20dirArray%20%3D%20aDir.split%28%22%2C%22%29%3B%0A%20%20let%20dir%20%3D%20dirsvc.get%28dirArray%5B0%5D%2C%20Components.interfaces.nsIFile%29%3B%0A%20%20if%20%28dirArray.length%20%3E%201%29%20%7B%0A%20%20%20%20for%20%28let%20i%20%3D%201%3B%20i%20%3C%20dirArray.length%3B%20i++%29%20%7B%0A%20%20%20%20%20%20dir.append%28dirArray%5Bi%5D%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20//LOG%28dir.path%29%3B%0A%20%20aCallback%28dir.path%29%3B%0A%7D%0A%0Athis.printDir%20%3D%20function%20printDir%28aFolder%29%20%7B%0A%20%20XULBrowserWindow.setOverLink%28aFolder%29%3B%0A%20%20//LOG%28aFolder%29%3B%0A%7D%0A%0Athis.openDir%20%3D%20function%20openDir%28aFolder%29%20%7B%0A%20%20let%20nsLocalFile%20%3D%20Components.Constructor%28%22@mozilla.org/file/local%3B1%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22nsILocalFile%22%2C%20%22initWithPath%22%29%3B%0A%20%20%28new%20nsLocalFile%28aFolder%29%29.reveal%28%29%3B%0A%7D%0A%0Athis.popupShowing%20%3D%20function%20popupShowing%28aNode%29%20%7B%0A%20%20aNode.querySelector%28%22%5Bvalue%3D%27ProfD%2CMail%27%5D%22%29%0A%20%20%20%20%20%20%20.hidden%20%3D%20%21%28%22toMessengerWindow%22%20in%20window%29%3B%0A%20%20aNode.querySelector%28%22%5Bvalue%3D%27UsrSrchPlugns%27%5D%22%29%0A%20%20%20%20%20%20%20.hidden%20%3D%20%21%28%22BrowserSearch%22%20in%20window%29%3B%0A%20%20aNode.querySelector%28%22%5Blabel%3D%27ChatZilla%27%5D%22%29%0A%20%20%20%20%20%20%20.hidden%20%3D%20%21%28%22toIRC%22%20in%20window%29%3B%0A%20%20aNode.querySelector%28%22%5Blabel%3D%27ColorZilla%27%5D%22%29%0A%20%20%20%20%20%20%20.hidden%20%20%3D%20%21%28%22ColorZilla%22%20in%20window%29%3B%0A%20%20aNode.querySelector%28%22%5Blabel%5E%3D%27Greasemonkey%27%5D%22%29%0A%20%20%20%20%20%20%20.hidden%20%3D%20%21%28%22GM_BrowserUI%22%20in%20window%29%3B%0A%20%20aNode.querySelector%28%22%5Blabel%5E%3D%27User%20Agent%27%5D%22%29%0A%20%20%20%20%20%20%20.hidden%20%3D%20%21%28%22UserAgentSwitcher%22%20in%20window%29%3B%0A%7D%0A%0Alet%20menu%20%3D%20%27%3Cmenupopup%20xmlns%3D%22%27%20+%20xulns%20+%20%27%22%20context%3D%22toolbar-context-menu%22%27%0A%20%20%20%20%20%20%20%20%20+%20%27%20onpopupshowing%3D%22this.parentNode.popupShowing%28this%29%3B%22%27%0A%20%20%20%20%20%20%20%20%20+%20%27%20onmouseout%3D%22this.parentNode.printDir%28%5C%27%5C%27%29%22%27%0A%20%20%20%20%20%20%20%20%20+%20%27%20onmouseover%3D%22var%20btn%3Dthis.parentNode%3B%27%0A%20%20%20%20%20%20%20%20%20+%20%27%20btn.getSpecialDir%28event.target.value%2C%20btn.printDir%29%3B%22%27%0A%20%20%20%20%20%20%20%20%20+%20%27%20oncommand%3D%22var%20btn%3Dthis.parentNode%3B%27%0A%20%20%20%20%20%20%20%20%20+%20%27%20btn.getSpecialDir%28event.target.value%2C%20btn.openDir%29%3B%22%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22%27%20+%20Application.name%20+%20%27%20Program%20Folder%22%27%0A%20%20%20%20%20%20%20%20%20+%20%27%20value%3D%22CurProcD%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22Profile%20Folder%22%20value%3D%22ProfD%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22Download%20Folder%22%20value%3D%22%22%27%0A%20%20%20%20%20%20%20%20%20+%20%27%20oncommand%3D%22event.stopPropagation%28%29%3B%20this.parentNode.parentNode.getDownloadDir%28%29%3B%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuseparator/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22Bookmark%20Backups%22%20value%3D%22ProfD%2Cbookmarkbackups%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22Chrome%22%20value%3D%22UChrm%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22Extensions%22%20value%3D%22ProfD%2Cextensions%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22Mail%22%20value%3D%22ProfD%2CMail%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22Search%20Plugins%22%20value%3D%22UsrSrchPlugns%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuseparator/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22ChatZilla%22%20value%3D%22ProfD%2Cchatzilla%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22Custom%20Buttons%22%20value%3D%22ProfD%2Ccustombuttons%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22ColorZilla%22%20value%3D%22ProfD%2Ccolorzilla%2Cpalettes%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22Greasemonkey%20Scripts%22%20value%3D%22ProfD%2Cgm_scripts%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3Cmenuitem%20label%3D%22User%20Agent%20Switcher%22%27%0A%20%20%20%20%20%20%20%20%20+%20%27%20value%3D%22ProfD%2Cuseragentswitcher%22/%3E%27%0A%20%20%20%20%20%20%20%20%20+%20%27%3C/menupopup%3E%27%3B%0A%0Athis.appendChild%28makeXML%28menu%29%29%3B%0Athis.type%20%3D%20%22menu%22%0A%0Alet%20items%20%3D%20%5B%27%3Cmenuseparator%20xmlns%3D%22%27%20+%20xulns%20+%20%27%22/%3E%27%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%27%3Cmenuitem%20xmlns%3D%22%27%20+%20xulns%20+%20%27%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20label%3D%22Check%20for%20updates%20for%20this%20button%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20onmouseout%3D%22this.parentNode.parentNode.printDir%28%5C%27%5C%27%29%3B%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20onmouseover%3D%22var%20btn%20%3D%20this.parentNode.parentNode%3B%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20btn.printDir%28btn.updater.updateURL%29%3B%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20oncommand%3D%22var%20btn%20%3D%20this.parentNode.parentNode%3B%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20btn.updater.checkForUpdate%28btn.updater.getUpdate%29%3B%22%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20onclick%3D%22if%20%28event.button%20%3D%3D%201%29%20%27%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%27%20this.parentNode.parentNode.updater.openUpdateURL%28%29%3B%22/%3E%27%5D%0A%0Afor%20%28var%20i%20%3D%200%3B%20i%20%3C%20items.length%3B%20i++%29%20%7B%0A%20%20this.firstChild.appendChild%28makeXML%28items%5Bi%5D%29%29%3B%0A%7D%0A%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5B/*%0A%20%20References%3A%0A%20%20%20%20-%20http%3A//mxr.mozilla.org/mozilla-central/source/toolkit/content/aboutSupport.js%23510%0A%20%20%20%20-%20http%3A//mxr.mozilla.org/mozilla-central/source/xpcom/io/nsDirectoryServiceDefs.h%0A%20%20%20%20-%20http%3A//mxr.mozilla.org/mozilla-central/source/xpcom/io/nsAppDirectoryServiceDefs.h%0A*/%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" rel="nofollow" title="Install Open Application Folders">
        <![CDATA[Install this button]]>
        </html:a>
      </html:div>
      <html:a href="https://addons.mozilla.org/addon/custom-buttons/?src=external-custombuttons-xml">
        <![CDATA[What's this?]]>
      </html:a>
      <html:div id="credits">
        <html:a href="http://custombuttons.sourceforge.net/forum/viewtopic.php?t=78#p197">
          <![CDATA[Custom Buttons XML]]><html:br/><![CDATA[Exporter/Importer]]>
        </html:a>
      </html:div>
    </html:div>
  </html:body>
  <name>Open Application Folders</name>
  <image><![CDATA[data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACnElEQVR4Xm2RzYtbZRSHn/fr3pvJzTB3qiNM2k2pMBUGhEHaqsUqdeFGQalCobgREaFu/B/cqCtxVSjoQhBEQRBmIfWDKgNGJUPt0Nhah9JJ4iSd5E6+bu5972tAO4SS5/DjXZ1znsMrNiq1eikMQqYYJCmjxNH5+zdW777L0J5KKl9VPmnf+ut9KWkwhbheuzNcOVYOmGKc5iRO0r1ykeXCx0h7kt4fC3z5wfqbQnAJwQHa5S7jAZSRuJ0mkf81cheobhBXZa+ri1uptQjHAZoZCEC1PiPgDuwxCfwerBU7b73zXn//3usCcdt4HkZ7SGZg431U51NUCgwlO3cV/bVXhR/6p9ut+nP9QYeNn7/n8qUPZxvQ/Q6VVWHk4ZqWRvlJjpx9hcGfW2wO95N2q8m3618A2WwDt/0RplSAXsBed57eyossHl5GYdHacG3zGpADM06wjQ1UUIN+CLHPvfAxojPnKLiE+bDE1R9+5GatAmgPeGCAteQ7l5GBhGSyuROyd/gFouUyWkqEErR2mwXAAA8BRS0AgMQBjSra30ZkEeDzz9Dn4ZcvMO51SMcJcTdGChmA0ABA6cAgzyG3I8jLEBylV4fWoaeIc0V7t0Uv7pFbC+CA+28mp/8+SwXKnMVmz1O9HpE+eobMZdjcoY1GIHD/NwIdoH1fBaNguzlg88pVyoUi4vTbFI8eJxsNAIfSkrliESllH/L0v0jktNNomFGv1TFrL3Fo9QSMR3jaEEXzLC09gjaKp595No0WjyCEB4zRclICUMDxtRMce/wJ1MIi2SglXShhfI/cOjxPoZRmbq4gXzt/gVrtBrdvbiG+Wf+p/mvll1BpiVAGhCDPxuAUDotz4HKHlIJON6bRbL4hhPjcMx5mkn8BBLEUrsVZbq0AAAAASUVORK5CYII=]]></image>
  <mode>0</mode>
  <initcode><![CDATA[function makeXML(aXMLString) {
  return (new DOMParser).parseFromString(aXMLString, "application/xml")
                        .documentElement;
}

this.setAttribute("tabindex", 1);

this.label = this.tooltipText = "Open " + Application.name + " Folders";

this.getDownloadDir = function getDownloadDir() {
  var prefs = cbu.ps.getBranch("browser.download.");
  let folderList = prefs.getIntPref("folderList");
  let dlPref = "";
  switch (folderList) {
    case 0:  this.getSpecialDir("Desk", this.openDir); return; // Desktop
    case 1:  dlPref = "lastDir"; break;
    default: dlPref = "dir";
  }
  this.openDir(prefs.getCharPref(dlPref));
}

this.getSpecialDir = function getSpecialDir(aDir, aCallback) {
  if (!aDir) return;
  let dirsvc = Components.classes["@mozilla.org/file/directory_service;1"]
                         .getService(Components.interfaces.nsIProperties);
  let dirArray = aDir.split(",");
  let dir = dirsvc.get(dirArray[0], Components.interfaces.nsIFile);
  if (dirArray.length > 1) {
    for (let i = 1; i < dirArray.length; i++) {
      dir.append(dirArray[i]);
    }
  }
  //LOG(dir.path);
  aCallback(dir.path);
}

this.printDir = function printDir(aFolder) {
  XULBrowserWindow.setOverLink(aFolder);
  //LOG(aFolder);
}

this.openDir = function openDir(aFolder) {
  let nsLocalFile = Components.Constructor("@mozilla.org/file/local;1",
                                           "nsILocalFile", "initWithPath");
  (new nsLocalFile(aFolder)).reveal();
}

this.popupShowing = function popupShowing(aNode) {
  aNode.querySelector("[value='ProfD,Mail']")
       .hidden = !("toMessengerWindow" in window);
  aNode.querySelector("[value='UsrSrchPlugns']")
       .hidden = !("BrowserSearch" in window);
  aNode.querySelector("[label='ChatZilla']")
       .hidden = !("toIRC" in window);
  aNode.querySelector("[label='ColorZilla']")
       .hidden  = !("ColorZilla" in window);
  aNode.querySelector("[label^='Greasemonkey']")
       .hidden = !("GM_BrowserUI" in window);
  aNode.querySelector("[label^='User Agent']")
       .hidden = !("UserAgentSwitcher" in window);
}

let menu = '<menupopup xmlns="' + xulns + '" context="toolbar-context-menu"'
         + ' onpopupshowing="this.parentNode.popupShowing(this);"'
         + ' onmouseout="this.parentNode.printDir(\'\')"'
         + ' onmouseover="var btn=this.parentNode;'
         + ' btn.getSpecialDir(event.target.value, btn.printDir);"'
         + ' oncommand="var btn=this.parentNode;'
         + ' btn.getSpecialDir(event.target.value, btn.openDir);">'
         + '<menuitem label="' + Application.name + ' Program Folder"'
         + ' value="CurProcD"/>'
         + '<menuitem label="Profile Folder" value="ProfD"/>'
         + '<menuitem label="Download Folder" value=""'
         + ' oncommand="event.stopPropagation(); this.parentNode.parentNode.getDownloadDir();"/>'
         + '<menuseparator/>'
         + '<menuitem label="Bookmark Backups" value="ProfD,bookmarkbackups"/>'
         + '<menuitem label="Chrome" value="UChrm"/>'
         + '<menuitem label="Extensions" value="ProfD,extensions"/>'
         + '<menuitem label="Mail" value="ProfD,Mail"/>'
         + '<menuitem label="Search Plugins" value="UsrSrchPlugns"/>'
         + '<menuseparator/>'
         + '<menuitem label="ChatZilla" value="ProfD,chatzilla"/>'
         + '<menuitem label="Custom Buttons" value="ProfD,custombuttons"/>'
         + '<menuitem label="ColorZilla" value="ProfD,colorzilla,palettes"/>'
         + '<menuitem label="Greasemonkey Scripts" value="ProfD,gm_scripts"/>'
         + '<menuitem label="User Agent Switcher"'
         + ' value="ProfD,useragentswitcher"/>'
         + '</menupopup>';

this.appendChild(makeXML(menu));
this.type = "menu"

let items = ['<menuseparator xmlns="' + xulns + '"/>',
             '<menuitem xmlns="' + xulns + '"' +
             ' label="Check for updates for this button"' +
             ' onmouseout="this.parentNode.parentNode.printDir(\'\');"' +
             ' onmouseover="var btn = this.parentNode.parentNode; ' +
             ' btn.printDir(btn.updater.updateURL);"' +
             ' oncommand="var btn = this.parentNode.parentNode; ' +
             ' btn.updater.checkForUpdate(btn.updater.getUpdate);"' +
             ' onclick="if (event.button == 1) ' +
             ' this.parentNode.parentNode.updater.openUpdateURL();"/>']

for (var i = 0; i < items.length; i++) {
  this.firstChild.appendChild(makeXML(items[i]));
}
]]></initcode>
  <code><![CDATA[/*
  References:
    - http://mxr.mozilla.org/mozilla-central/source/toolkit/content/aboutSupport.js#510
    - http://mxr.mozilla.org/mozilla-central/source/xpcom/io/nsDirectoryServiceDefs.h
    - http://mxr.mozilla.org/mozilla-central/source/xpcom/io/nsAppDirectoryServiceDefs.h
*/]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help><![CDATA[]]></help>
  <attributes/>
</custombutton>