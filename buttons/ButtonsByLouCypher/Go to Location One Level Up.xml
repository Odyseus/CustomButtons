<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/"
              xmlns:html="http://www.w3.org/1999/xhtml">
  <html:head>
    <html:title><![CDATA[Go to Location One Level Up]]></html:title>
    <html:link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACGElEQVR4Xo2Sz2vUUBDH5yXPJJt0Wy1u0RaWsNZaRd21td2tUhSkiD9AKHopPRSk9edB8C8QqwcF/wPBg6d6ES960II/QdqLJ+1uD3rwosW27OblZd9L4mxYdlG3NRMG3iPz/cxM8iVhGMJGkR3K5wkhz7Bm9NPCx2KrGmUTcSbZZr0YP3c2pShkHu/bYgNQ3Emp+vra5emOgVyWjB4pdCmK8hwh9L8AFOvY8eXU5MTO9mQbeff+Lezt79vSm7EPIuThpgAUExTPnTo5tq9/T59aKpXA4x4sLi5AYWgw0bm143xuuHBzQ4BCyINcNjt24vgxfWnpC/i+D0AAyuUyFEtFODoybOq6dhsbnf4HgOSrPT3dMxMXxhPLy9jZ8yIowacWq6u/YGXlBxw+dCChKsocQvY3AHg5Y1nm/UsXp0xKKdi2Del0+o9dU9tTkEy2g6HrsLvXNrnrvkpndqUoigeR8YQ5TLt1956HHwos06A3rl9R6yOApmlgWhbMv/ngc+ZKzl1wHKfL4/wpRfFnzO4ADRUIEWmkED+llI0V8BVwzmF9bT3kLtuBQogSQRQdxlCD2YyB/AhI6UOdgIAAqtUqOJUyfP/2dS2WE4UUjTNaGQEesEolppVR4DdXqANENEEsgMMYCCHrKzQnkELEBGAngcWGYUR/gBAS3VsFbQVwHefR7OydycAPfDRUyBiruZKqqvr4b8Bv35jkcjWWER8AAAAASUVORK5CYII="/>
    <html:style type="text/css"><![CDATA[
body { font-size: medium; margin: 0; }
body, code:before, help:before, initcode:before {
  font-family: "Verdana", sans-serif;
}
#wrapper { position: fixed; top: 1em; right: 1em; text-align: center; }
p { font-size: small; text-align: center; }
#button {
  background-color: rgb(85, 168, 2);
  background-image: linear-gradient(to bottom, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -moz-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -o-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -webkit-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  border: 1px solid rgb(58, 116, 4);
  border-radius: .5em;
  -moz-border-radius: .5em;
  -webkit-border-radius: .5em;
  padding: 0;
  margin-bottom: 1em;
  box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -moz-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -o-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -webkit-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
}
#button a {
  color: #000;
  text-shadow: -1pt -1px 0pt rgba(255, 255, 255, .5);
  padding: 1em;
  text-decoration: none;
}
:-moz-any-link:focus {
  color: white;
  outline-color: transparent;
  text-decoration: none;
}
#button a, code, code:before, initcode, initcode:before, help, help:before {
  display: block;
}
#credits { position: fixed; bottom: 1em; right: 1em; font-size: small; }
custombutton { background-color: rgb(171, 171, 171); margin: 1em; }
date, image, mode, accelkey { display: none; }
name { font-weight: bold; font-size: x-large; }
code:before, help:before, initcode:before {
  font-weight: bold;
  font-size: large;
  margin: 0 0 1em;
  padding: .5em;
}
code:before { content: "CODE"; }
help:before { content: "Help"; }
initcode:before { content: "Initialization Code"; }
code, initcode, help {
  background-color: rgb(255, 255, 255);
  border: 1px inset rgb(170, 170, 170);
  font: medium monospace;
  margin: 1em 1em 2em 0;
  padding: 1em;
  text-align: left;
  width: 840px;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.clear { clear: both; }
]]></html:style>
  </html:head>
  <html:body>
    <html:div id="wrapper">
      <html:div id="button">
        <html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3EGo%20to%20Location%20One%20Level%20Up%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACGElEQVR4Xo2Sz2vUUBDH5yXPJJt0Wy1u0RaWsNZaRd21td2tUhSkiD9AKHopPRSk9edB8C8QqwcF/wPBg6d6ES960II/QdqLJ+1uD3rwosW27OblZd9L4mxYdlG3NRMG3iPz/cxM8iVhGMJGkR3K5wkhz7Bm9NPCx2KrGmUTcSbZZr0YP3c2pShkHu/bYgNQ3Emp+vra5emOgVyWjB4pdCmK8hwh9L8AFOvY8eXU5MTO9mQbeff+Lezt79vSm7EPIuThpgAUExTPnTo5tq9/T59aKpXA4x4sLi5AYWgw0bm143xuuHBzQ4BCyINcNjt24vgxfWnpC/i+D0AAyuUyFEtFODoybOq6dhsbnf4HgOSrPT3dMxMXxhPLy9jZ8yIowacWq6u/YGXlBxw+dCChKsocQvY3AHg5Y1nm/UsXp0xKKdi2Del0+o9dU9tTkEy2g6HrsLvXNrnrvkpndqUoigeR8YQ5TLt1956HHwos06A3rl9R6yOApmlgWhbMv/ngc+ZKzl1wHKfL4/wpRfFnzO4ADRUIEWmkED+llI0V8BVwzmF9bT3kLtuBQogSQRQdxlCD2YyB/AhI6UOdgIAAqtUqOJUyfP/2dS2WE4UUjTNaGQEesEolppVR4DdXqANENEEsgMMYCCHrKzQnkELEBGAngcWGYUR/gBAS3VsFbQVwHefR7OydycAPfDRUyBiruZKqqvr4b8Bv35jkcjWWER8AAAAASUVORK5CYII%3D%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5Bthis.goUp_getUpUrl%20%3D%20function%20goUp_getUpUrl%28url%29%20%7B%0A%20%20/*%0A%20%20%20*%20Courtesy%20of%20onemen%0A%20%20%20*%20http%3A//forums.mozillazine.org/viewtopic.php%3Fp%3D13179935%23p13179935%0A%20%20%20*/%0A%20%20var%20matches%2C%20origUrl%20%3D%20url%3B%0A%0A%20%20//%20phpBB%20forums%0A%20%20matches%20%3D%20url.match%28/%5C/viewtopic.php%28.*%29f%5C%3D%5Cd+/%29%3B%0A%20%20if%20%28matches%29%0A%20%20%20%20return%20url.replace%28/viewtopic.php.*/%2C%20%22viewforum.php%3Ff%3D%22%20+%20matches%5B0%5D.toString%28%29.match%28/%5Cd+/%29%29%3B%0A%0A%20%20//%20trim%20filename%20%28this%20makes%20subdriectory%20digging%20easier%29%0A%20%20matches%20%3D%20url.match%28/%28%5E.*%5C/%29%28.*%29/%29%3B%0A%20%20if%20%28%21matches%29%0A%20%20%20%20return%20null%3B%20//only%20fails%20if%20%22url%22%20has%20no%20/%27s%0A%0A%20%20url%20%3D%20matches%5B1%5D%3B%0A%20%20if%20%28url%20%21%3D%20origUrl%20%26%26%20%21/%28index%7Cmain%29%5C.%28php3%3F%7Chtml%3F%29/i.test%28url%29%29%0A%20%20%20%20return%20url%3B%0A%0A%20%20//%20dig%20through%20subdirs%0A%20%20matches%20%3D%20url.match%28/%5E%28%5B%5E%5C/%5D*%3F%3A%5C/%5C/.*%5C/%29%5B%5E%5C/%5D+%3F%5C//%29%3B%0A%20%20if%20%28matches%29%0A%20%20%20%20return%20matches%5B1%5D%3B%0A%0A%20%20//%20we%27ve%20reach%20%28ht%7Cf%29tp%3A//foo.com/%2C%20climb%20up%20through%20subdomains%0A%20%20//%20split%20into%20protocol%20and%20domain%0A%20%20matches%20%3D%20url.match%28/%28%5B%5E%3A%5D*%3A%5C/%5C/%29%3F%28.*%29/%29%3B%0A%20%20var%20protocol%20%3D%20matches%5B1%5D%2C%20domain%20%3D%20matches%5B2%5D%3B%0A%20%20matches%20%3D%20domain.match%28/%5E%5B%5E%5C.%5D*%5C.%28.*%29/%29%3B%0A%20%20if%20%28matches%29%0A%20%20%20%20return%20%28protocol%20+%20matches%5B1%5D%29%3B%0A%20%20return%20null%3B%0A%7D%0A%0Athis.onmouseenter%20%3D%20function%20onmouseenter%28%29%20%7B%0A%20%20var%20upURL%20%3D%20this.goUp_getUpUrl%28content.document.location.href%29%3B%0A%20%20this.tooltipText%20%3D%20this.name%20+%20%28upURL%20%3F%20%28%22%5Cn%22%20+%20upURL%29%20%3A%20%22%22%29%3B%0A%7D%0A%0Athis.onmouseleave%20%3D%20function%20onmouseleave%28%29%20%7B%0A%20%20this.tooltipText%20%3D%20this.name%3B%0A%7D%0A%0Athis.onclick%20%3D%20function%20onclick%28aEvent%29%20%7B%0A%20%20if%20%28aEvent.button%20%3D%3D%3D%201%29%20%7B%0A%20%20%20%20var%20node%20%3D%20aEvent.target%3B%0A%20%20%20%20if%20%28node.getAttribute%28%22disabled%22%29%20%3D%3D%20%22true%22%29%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20var%20fn%20%3D%20new%20Function%28%22event%22%2C%20this.cbCommand%29%3B%0A%20%20%20%20fn.call%28this%2C%20aEvent%29%3B%0A%20%20%7D%0A%7D%0A%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5Bvar%20loc%20%3D%20content.document.location%2C%20pro%20%3D%20loc.protocol%3B%0Aif%20%28/%5E%28ftp%7Chttps%3F%7Cresource%29%3A%24/.test%28pro%29%29%7B%0A%20%20var%20up%20%3D%20this.goUp_getUpUrl%28loc.href%29%3B%0A%20%20if%20%28up%29%0A%20%20%20%20openUILink%28up%2C%20event%2C%20false%2C%20true%29%3B%0A%7D%0A%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5BLeft-click%3A%20load%20in%20current%20tab%0AMiddle-click%20or%20Ctrl+Left-click%3A%20load%20in%20a%20new%20tab%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" rel="nofollow" title="Install Go to Location One Level Up">
        <![CDATA[Install this button]]>
        </html:a>
      </html:div>
      <html:a href="https://addons.mozilla.org/addon/custom-buttons/?src=external-custombuttons-xml">
        <![CDATA[What's this?]]>
      </html:a>
      <html:div id="credits">
        <html:a href="http://custombuttons.sourceforge.net/forum/viewtopic.php?t=78#p197">
          <![CDATA[Custom Buttons XML]]><html:br/><![CDATA[Exporter/Importer]]>
        </html:a>
      </html:div>
    </html:div>
  </html:body>
  <name>Go to Location One Level Up</name>
  <image><![CDATA[data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACGElEQVR4Xo2Sz2vUUBDH5yXPJJt0Wy1u0RaWsNZaRd21td2tUhSkiD9AKHopPRSk9edB8C8QqwcF/wPBg6d6ES960II/QdqLJ+1uD3rwosW27OblZd9L4mxYdlG3NRMG3iPz/cxM8iVhGMJGkR3K5wkhz7Bm9NPCx2KrGmUTcSbZZr0YP3c2pShkHu/bYgNQ3Emp+vra5emOgVyWjB4pdCmK8hwh9L8AFOvY8eXU5MTO9mQbeff+Lezt79vSm7EPIuThpgAUExTPnTo5tq9/T59aKpXA4x4sLi5AYWgw0bm143xuuHBzQ4BCyINcNjt24vgxfWnpC/i+D0AAyuUyFEtFODoybOq6dhsbnf4HgOSrPT3dMxMXxhPLy9jZ8yIowacWq6u/YGXlBxw+dCChKsocQvY3AHg5Y1nm/UsXp0xKKdi2Del0+o9dU9tTkEy2g6HrsLvXNrnrvkpndqUoigeR8YQ5TLt1956HHwos06A3rl9R6yOApmlgWhbMv/ngc+ZKzl1wHKfL4/wpRfFnzO4ADRUIEWmkED+llI0V8BVwzmF9bT3kLtuBQogSQRQdxlCD2YyB/AhI6UOdgIAAqtUqOJUyfP/2dS2WE4UUjTNaGQEesEolppVR4DdXqANENEEsgMMYCCHrKzQnkELEBGAngcWGYUR/gBAS3VsFbQVwHefR7OydycAPfDRUyBiruZKqqvr4b8Bv35jkcjWWER8AAAAASUVORK5CYII=]]></image>
  <mode>0</mode>
  <initcode><![CDATA[this.goUp_getUpUrl = function goUp_getUpUrl(url) {
  /*
   * Courtesy of onemen
   * http://forums.mozillazine.org/viewtopic.php?p=13179935#p13179935
   */
  var matches, origUrl = url;

  // phpBB forums
  matches = url.match(/\/viewtopic.php(.*)f\=\d+/);
  if (matches)
    return url.replace(/viewtopic.php.*/, "viewforum.php?f=" + matches[0].toString().match(/\d+/));

  // trim filename (this makes subdriectory digging easier)
  matches = url.match(/(^.*\/)(.*)/);
  if (!matches)
    return null; //only fails if "url" has no /'s

  url = matches[1];
  if (url != origUrl && !/(index|main)\.(php3?|html?)/i.test(url))
    return url;

  // dig through subdirs
  matches = url.match(/^([^\/]*?:\/\/.*\/)[^\/]+?\//);
  if (matches)
    return matches[1];

  // we've reach (ht|f)tp://foo.com/, climb up through subdomains
  // split into protocol and domain
  matches = url.match(/([^:]*:\/\/)?(.*)/);
  var protocol = matches[1], domain = matches[2];
  matches = domain.match(/^[^\.]*\.(.*)/);
  if (matches)
    return (protocol + matches[1]);
  return null;
}

this.onmouseenter = function onmouseenter() {
  var upURL = this.goUp_getUpUrl(content.document.location.href);
  this.tooltipText = this.name + (upURL ? ("\n" + upURL) : "");
}

this.onmouseleave = function onmouseleave() {
  this.tooltipText = this.name;
}

this.onclick = function onclick(aEvent) {
  if (aEvent.button === 1) {
    var node = aEvent.target;
    if (node.getAttribute("disabled") == "true")
      return;
    var fn = new Function("event", this.cbCommand);
    fn.call(this, aEvent);
  }
}
]]></initcode>
  <code><![CDATA[var loc = content.document.location, pro = loc.protocol;
if (/^(ftp|https?|resource):$/.test(pro)){
  var up = this.goUp_getUpUrl(loc.href);
  if (up)
    openUILink(up, event, false, true);
}
]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help><![CDATA[Left-click: load in current tab
Middle-click or Ctrl+Left-click: load in a new tab]]></help>
  <attributes/>
</custombutton>