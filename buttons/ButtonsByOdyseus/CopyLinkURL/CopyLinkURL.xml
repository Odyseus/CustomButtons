<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/" xmlns:html="http://www.w3.org/1999/xhtml">
<html:head>
	<html:title><![CDATA[Copy Link URL]]></html:title>
	<html:link rel="shortcut icon" href="data:image/icon;base64,EBAAAAAAAAAAAAAAAAAAAAAAAAAABgAAACQAAAA7AAAAPgAAAD4AAAA+AAAAPgAAAD4AAAA7AAAAJAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACSRkZGx8PDw+/b29v/29vb/9vb2//b29v/29vb/8PDw+5GRkbEAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA74+Pj+OXl5f/k5OT/5OTk/+Tk5P/k5OT/5OTk/+Xl5f/j4+P4AAAAOwAAAAAAAAAAAAAABgAAACQAAAA7AAAAQODg4P/f39//EBAQmgAAAJUAAACVAAAAlRAQEJrf39//4ODg/wAAAD4AAAAAAAAAAAAAACSMjIyx6+vr+wAAAEDb29v/29vb/wAAAEkAAAAAAAAAAAAAAAAAAABJ29vb/9vb2/8AAAA+AAAAAAAAAAAAAAA72tra+NfX1/8AAABA1tbW/9bW1v8AAAA+AAAAAAAAAAAAAAAAAAAAPtbW1v/W1tb/AAAAPgAAAAAAAAAAAAAAPtLS0v/R0dH/AAAAQNHR0f/R0dH/AAAAPgAAAAAAAAAAAAAAAAAAAD7R0dH/0dHR/wAAAD4AAAAAAAAAAAAAAD7Nzc3/zc3N/wAAAEDNzc3/zc3N/wAAAD4AAAAAAAAAAAAAAAAAAAA+zc3N/83Nzf8AAAA+AAAAAAAAAAAAAAA+yMjI/8jIyP8AAABAyMjI/8jIyP8AAAA+AAAAAAAAAAAAAAAAAAAAPsjIyP/IyMj/AAAAPgAAAAAAAAAAAAAAPsPDw//Dw8P/AAAAQMPDw//Dw8P/KSkpZQAAAD4AAAA+AAAAPikpKWXDw8P/w8PD/wAAAD4AAAAAAAAAAAAAAD6/v7//v7+//wAAAECwsLD1v7+//+Hh4f/l5eX/5eXl/+Xl5f/h4eH/v7+//7CwsPUAAAA7AAAAAAAAAAAAAAA+urq6/7q6uv8AAABAPz8/raysrPW6urr/urq6/7q6uv+6urr/urq6/6ysrPU/Pz+tAAAAJAAAAAAAAAAAAAAAPra2tv+2trb/KCgoZQAAAGcAAACSAAAAlgAAAJYAAACWAAAAlgAAAJYAAACPAAAAUAAAAAYAAAAAAAAAAAAAADukpKT1sbGx/9ra2v/g4OD/4ODg/+Dg4P/g4OD/4ODg/9ra2vsAAAA7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkOzs7rZ6envWsrKz/rKys/6ysrP+srKz/rKys/6CgoPU9PT2rAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAFAAAACPAAAAlQAAAJUAAACVAAAAlQAAAJUAAACPAAAAUAAAAAYAAAAAAAAAAAAAAAAAAAAA"/>
	<html:style type="text/css"><![CDATA[body{font-size:medium;margin:0}body,code:before,help:before,initcode:before{font-family:"Verdana",sans-serif}#wrapper{position:fixed;top:1em;right:1em;max-width:15%;text-align:center}#button{background-color:#299a0b;border:1px solid #3a7404;border-radius:.5em;padding:0;margin-bottom:1em;box-shadow:1px 2px 3px rgba(0,0,0,.25)}#button a{color:#f0f0f0;font-weight:700;text-shadow:-.5pt -.5px .5pt rgba(0,0,0,1);padding:.8em;text-decoration:none}:-moz-any-link:focus{color:grey;outline-color:transparent;text-decoration:none}#button a,code,code:before,initcode,initcode:before,help,help:before{display:block}#credits{position:fixed;bottom:1em;right:1em;font-size:small}#about{font-size:small}custombutton{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABAElEQVQ4jW2TQXLFMAhDff+b2vEHYw5AF38eVTNdZAIxCEkmw31VptU5T7mvOuepc56K2B2f85TZrEwr99VxptUwm2U2695PZVrH937KfZX76txsVsTus0yrEbEr0/4F4AyQc56eDMiI2F0IbYoj9h9ZSCV2XzXUA1BVL8BvBvSMiN20zWY38VZ5gDEkYtfAYTRToA3qiQJk2hcA7W8gpaxG0nPvp4aiQ5UCzOV2GKAgLUEfpsGCfaBR92TonapmdCoAjHTIgLa6/14gbgow8oj9uwe6SMQ0qTz9P9oDZOgCkfMNJnqWaV8P3ouDRorUXEA4H1wbtMmVjcrQ7TSb9QMtXcwa4wpbXgAAAABJRU5ErkJggg==) fixed #f6f6f1;margin:1em}date,image,mode,accelkey{display:none}name{font-weight:700;font-size:x-large}code:before,help:before,initcode:before{font-weight:700;font-size:large;margin:0 0 1em;padding:.5em}code:before{content:"Code Tab"}help:before{content:"Help Tab"}initcode:before{content:"Initialization Code Tab"}code,initcode,help{background-color:#fcfcfc;font-size:.875em;font-family:Consolas,"Bitstream Vera Sans Mono","Courier New",Courier,monospace!important;margin:1em 2em 1em 0 !important;padding:1em;text-align:left;box-shadow:2px 2px 0 rgba(170,160,130,0.5),4px 4px 0 rgba(200,190,165,0.5);max-width:80%;min-width:80%;white-space:pre-wrap;word-wrap:break-word}]]></html:style>
</html:head>
<html:body>
	<html:div id="wrapper">
		<html:div id="button">
			<html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3ECopy%20Link%20URL%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/icon%3Bbase64%2CEBAAAAAAAAAAAAAAAAAAAAAAAAAABgAAACQAAAA7AAAAPgAAAD4AAAA+AAAAPgAAAD4AAAA7AAAAJAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACSRkZGx8PDw+/b29v/29vb/9vb2//b29v/29vb/8PDw+5GRkbEAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA74+Pj+OXl5f/k5OT/5OTk/+Tk5P/k5OT/5OTk/+Xl5f/j4+P4AAAAOwAAAAAAAAAAAAAABgAAACQAAAA7AAAAQODg4P/f39//EBAQmgAAAJUAAACVAAAAlRAQEJrf39//4ODg/wAAAD4AAAAAAAAAAAAAACSMjIyx6+vr+wAAAEDb29v/29vb/wAAAEkAAAAAAAAAAAAAAAAAAABJ29vb/9vb2/8AAAA+AAAAAAAAAAAAAAA72tra+NfX1/8AAABA1tbW/9bW1v8AAAA+AAAAAAAAAAAAAAAAAAAAPtbW1v/W1tb/AAAAPgAAAAAAAAAAAAAAPtLS0v/R0dH/AAAAQNHR0f/R0dH/AAAAPgAAAAAAAAAAAAAAAAAAAD7R0dH/0dHR/wAAAD4AAAAAAAAAAAAAAD7Nzc3/zc3N/wAAAEDNzc3/zc3N/wAAAD4AAAAAAAAAAAAAAAAAAAA+zc3N/83Nzf8AAAA+AAAAAAAAAAAAAAA+yMjI/8jIyP8AAABAyMjI/8jIyP8AAAA+AAAAAAAAAAAAAAAAAAAAPsjIyP/IyMj/AAAAPgAAAAAAAAAAAAAAPsPDw//Dw8P/AAAAQMPDw//Dw8P/KSkpZQAAAD4AAAA+AAAAPikpKWXDw8P/w8PD/wAAAD4AAAAAAAAAAAAAAD6/v7//v7+//wAAAECwsLD1v7+//+Hh4f/l5eX/5eXl/+Xl5f/h4eH/v7+//7CwsPUAAAA7AAAAAAAAAAAAAAA+urq6/7q6uv8AAABAPz8/raysrPW6urr/urq6/7q6uv+6urr/urq6/6ysrPU/Pz+tAAAAJAAAAAAAAAAAAAAAPra2tv+2trb/KCgoZQAAAGcAAACSAAAAlgAAAJYAAACWAAAAlgAAAJYAAACPAAAAUAAAAAYAAAAAAAAAAAAAADukpKT1sbGx/9ra2v/g4OD/4ODg/+Dg4P/g4OD/4ODg/9ra2vsAAAA7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkOzs7rZ6envWsrKz/rKys/6ysrP+srKz/rKys/6CgoPU9PT2rAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAFAAAACPAAAAlQAAAJUAAACVAAAAlQAAAJUAAACPAAAAUAAAAAYAAAAAAAAAAAAAAAAAAAAA%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5Bvar%20%24%20%3D%20this.CopyLinkURL%20%3D%20%7B%0A%09init%3A%20function%28%29%20%7B%0A%09%09if%20%28%21%28%22Services%22%20in%20window%29%29%0A%09%09%09Cu.import%28%22resource%3A//gre/modules/Services.jsm%22%29%3B%0A%0A%09%09%24.initPrefs%28%29%3B%0A%0A%09%09if%20%28%21%28%24._UID%20in%20window%29%29%20%7B%0A%09%09%09window%5B%24._UID%5D%20%3D%20%7B%0A%09%09%09%09CustomizableUI%3A%20false%2C%0A%09%09%09%09DealWithLinks%3A%20null%2C%0A%09%09%09%09RandomID%3A%20false%2C%0A%09%09%09%09FrameScriptLoaded%3A%20false%2C%0A%09%09%09%7D%3B%0A%09%09%7D%0A%0A%09%09window%5B%24._UID%5D%5B%22DealWithLinks%22%5D%20%3D%20%24.dealWithLinks%3B%0A%0A%09%09if%20%28%21window%5B%24._UID%5D%5B%22RandomID%22%5D%29%20%7B%0A%09%09%09window%5B%24._UID%5D%5B%22RandomID%22%5D%20%3D%20parseInt%28Math.random%28%29%20*%2010000%2C%2010%29%3B%0A%09%09%7D%0A%09%09%24._randomID%20%3D%20window%5B%24._UID%5D%5B%22RandomID%22%5D%3B%0A%0A%09%09if%20%28%21window%5B%24._UID%5D%5B%22FrameScriptLoaded%22%5D%29%20%7B%0A%09%09%09window%5B%24._UID%5D%5B%22FrameScriptLoaded%22%5D%20%3D%20true%3B%0A%09%09%09%24._frameScript%20%3D%20%22data%3Aapplication/javascript%2C%22%20+%20encodeURIComponent%28%24.getHelp%28%22%25FrameScript%25%22%29%0A%09%09%09%09.replace%28/%25Get_links_ID%25/g%2C%20%24._getLinksMsgID%29%0A%09%09%09%09.replace%28/%25Cleanup_ID%25/g%2C%20%24._cleanupMsgID%29%0A%09%09%09%09.replace%28/%25Response_ID%25/g%2C%20%24._responseMsgID%29%29%3B%0A%09%09%09%24._globalMM.loadFrameScript%28%24._frameScript%2C%20true%29%3B%0A%09%09%09%24._globalMM.addMessageListener%28%24._responseMsgID%2C%20%24._messageResponse%29%3B%0A%09%09%7D%0A%0A%09%09self.tooltipText%20%3D%20self.name%20+%20%22%20-%20ID%23%3A%20%22%20+%20self.id.slice%2820%29%20+%0A%09%09%09%22%5Cn%5Cn%uD835%uDDDF%uD835%uDDF2%uD835%uDDF3%uD835%uDE01%20%uD835%uDDF0%uD835%uDDF9%uD835%uDDF6%uD835%uDDF0%uD835%uDDF8%3A%20Open%20options%5Ct%5Cn%5Cn%22%20+%0A%09%09%09%22%uD835%uDDE5%uD835%uDDF2%uD835%uDDEE%uD835%uDDF1%20%uD835%uDE01%uD835%uDDF5%uD835%uDDF6%uD835%uDE00%20%uD835%uDDEF%uD835%uDE02%uD835%uDE01%uD835%uDE01%uD835%uDDFC%uD835%uDDFB%20%uD835%uDDF5%uD835%uDDF2%uD835%uDDF9%uD835%uDDFD%20%uD835%uDDF3%uD835%uDDFC%uD835%uDDFF%20%uD835%uDE03%uD835%uDDF2%uD835%uDDFF%uD835%uDE06%20%uD835%uDDF6%uD835%uDDFA%uD835%uDDFD%uD835%uDDFC%uD835%uDDFF%uD835%uDE01%uD835%uDDEE%uD835%uDDFB%uD835%uDE01%20%uD835%uDE02%uD835%uDE00%uD835%uDDEE%uD835%uDDF4%uD835%uDDF2%20%uD835%uDDFB%uD835%uDDFC%uD835%uDE01%uD835%uDDF2%uD835%uDE00.%5Cn%22%20+%0A%09%09%09%22%uD835%uDDE5%uD835%uDDF6%uD835%uDDF4%uD835%uDDF5%uD835%uDE01%20%uD835%uDDF0%uD835%uDDF9%uD835%uDDF6%uD835%uDDF0%uD835%uDDF8%20%uD835%uDDFC%uD835%uDDFB%20%uD835%uDDEF%uD835%uDE02%uD835%uDE01%uD835%uDE01%uD835%uDDFC%uD835%uDDFB%2C%20%5C%22%uD835%uDDD5%uD835%uDE02%uD835%uDE01%uD835%uDE01%uD835%uDDFC%uD835%uDDFB%20%uD835%uDDDB%uD835%uDDF2%uD835%uDDF9%uD835%uDDFD%5C%22%20%uD835%uDDF6%uD835%uDE01%uD835%uDDF2%uD835%uDDFA.%22%3B%0A%0A%09%09self.onclick%20%3D%20function%28aE%29%20%7B%0A%09%09%09if%20%28aE.button%20%3D%3D%3D%200%20%26%26%20%21aE.shiftKey%20%26%26%20%21aE.ctrlKey%20%26%26%20%21aE.metaKey%20%26%26%20%21aE.altKey%29%0A%09%09%09%09%24.openOptions%28%29%3B%0A%09%09%09aE.stopPropagation%28%29%3B%0A%09%09%7D%3B%0A%0A%09%09var%20ctx%20%3D%20document.getElementById%28%22mailContext%22%29%20%7C%7C%0A%09%09%09document.getElementById%28%22contentAreaContextMenu%22%29%3B%0A%09%09var%20insertPoint%20%3D%20document.getElementById%28%22mailContext-copy%22%29%20%7C%7C%0A%09%09%09document.getElementById%28%22context-copy%22%29%3B%0A%09%09let%20ctxListener%20%3D%20function%28%29%20%7B%0A%09%09%09%24.copySelCtx.hidden%20%3D%20%21%28gContextMenu.isContentSelected%29%3B%0A%09%09%7D%3B%0A%09%09if%20%28ctx%20%26%26%20%21%24.copySelCtx%29%20%7B%0A%09%09%09let%20mItem1%20%3D%20%24.%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09id%3A%20%24._UID%20+%20%22-copySelectedLinks%22%2C%0A%09%09%09%09cb_id%3A%20%24._UID%2C%0A%09%09%09%09class%3A%20%22menuitem-iconic%22%2C%0A%09%09%09%09image%3A%20self.image%2C%0A%09%09%09%09label%3A%20%22Copy%20Selected%20Links%22%2C%0A%09%09%09%09oncommand%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%20%22%27%29.CopyLinkURL.onCommand%28true%29%22%2C%0A%09%09%09%7D%29%3B%0A%09%09%09ctx.insertBefore%28mItem1%2C%20insertPoint.nextSibling%29%3B%0A%09%09%09ctx.addEventListener%28%22popupshowing%22%2C%20ctxListener%2C%20false%29%3B%0A%09%09%7D%0A%09%09if%20%28ctx%20%26%26%20%24.gPref%28%22pShowCopyAllLinksOnContext%22%29%20%26%26%20%21%24.copyAllCtx%29%20%7B%0A%09%09%09let%20mItem2%20%3D%20%24.%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09id%3A%20%24._UID%20+%20%22-copyAllLinks%22%2C%0A%09%09%09%09cb_id%3A%20%24._UID%2C%0A%09%09%09%09class%3A%20%22menuitem-iconic%22%2C%0A%09%09%09%09image%3A%20self.image%2C%0A%09%09%09%09label%3A%20%22Copy%20All%20Links%22%2C%0A%09%09%09%09oncommand%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%20%22%27%29.CopyLinkURL.onCommand%28false%29%22%2C%0A%09%09%09%7D%29%3B%0A%09%09%09ctx.insertBefore%28mItem2%2C%20insertPoint.nextSibling%29%3B%0A%09%09%7D%0A%0A%09%09if%20%28%22CustomizableUI%22%20in%20window%29%20%7B%0A%09%09%09if%20%28%21window%5B%24._UID%5D%5B%22CustomizableUI%22%5D%29%20%7B%0A%09%09%09%09window%5B%24._UID%5D%5B%22CustomizableUI%22%5D%20%3D%20true%3B%0A%09%09%09%09CustomizableUI.addListener%28%7B%0A%09%09%09%09%09onCustomizeEnd%3A%20function%28aWindow%29%20%7B%0A%09%09%09%09%09%09var%20thisBtn%20%3D%20aWindow.document.getElementById%28self.id%29%3B%0A%09%09%09%09%09%09setTimeout%28function%28%29%20%7B%0A%09%09%09%09%09%09%09aWindow%5B%24._UID%5D%5B%22CustomizableUI%22%5D%20%26%26%20thisBtn.CopyLinkURL.selfDestroy%28%29%3B%0A%09%09%09%09%09%09%7D%2C%20Math.floor%28Math.random%28%29%20*%20%281%20+%202000%20-%20200%29%29%20+%20200%29%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%7D%29%3B%0A%09%09%09%7D%0A%09%09%7D%0A%0A%09%09addDestructor%28function%28aReason%29%20%7B%0A%09%09%09if%20%28aReason%20%3D%3D%3D%20%22delete%22%20%7C%7C%20aReason%20%3D%3D%3D%20%22destructor%22%29%20%7B%0A%09%09%09%09%24._mm.sendAsyncMessage%28%24._cleanUpMsgID%29%3B%0A%09%09%09%09%24._globalMM.removeDelayedFrameScript%28%24._frameScript%29%3B%0A%09%09%09%09%24._globalMM.removeMessageListener%28%24._responseMsgID%2C%20%24._messageResponse%29%3B%0A%09%09%09%7D%0A%09%09%09if%20%28aReason%20%3D%3D%3D%20%22delete%22%20%7C%7C%20aReason%20%3D%3D%3D%20%22update%22%29%20%7B%0A%09%09%09%09let%20selfEls%20%3D%20document.getElementsByAttribute%28%22cb_id%22%2C%20%24._UID%29%3B%0A%09%09%09%09Array.prototype.slice.call%28selfEls%29.forEach%28function%28aEl%29%20%7B%20//%20Delete%20all%20elements%20created%20by%20this%20button.%0A%09%09%09%09%09aEl%20%26%26%20aEl.parentNode.removeChild%28aEl%29%3B%0A%09%09%09%09%7D%29%3B%0A%09%09%09%09ctx.removeEventListener%28%22popupshowing%22%2C%20ctxListener%2C%20false%29%3B%0A%09%09%09%7D%0A%09%09%7D%29%3B%0A%09%7D%2C%0A%0A%09_messageResponse%3A%20%7B%0A%09%09receiveMessage%3A%20function%28aMsg%29%20%7B%0A%09%09%09if%20%28aMsg.name%20%21%3D%3D%20%24._responseMsgID%29%0A%09%09%09%09return%3B%0A%09%09%09switch%20%28aMsg.data.id%29%20%7B%0A%09%09%09%09case%201%3A%0A%09%09%09%09%09window%5B%24._UID%5D%5B%22DealWithLinks%22%5D%28aMsg.data.links%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%7D%0A%09%09%7D%2C%0A%09%7D%2C%0A%0A%09dealWithLinks%3A%20function%28aLinks%29%20%7B%0A%09%09if%20%28aLinks.length%20%3D%3D%3D%200%29%20%7B%0A%09%09%09Services.prompt.alert%28null%2C%20self.name%2C%20%22No%20links%20found%20in%20the%20selected%20text%20or%20page.%22%29%3B%0A%09%09%09return%3B%0A%09%09%7D%0A%09%09var%20copytext%20%3D%20%22%22%3B%0A%09%09let%20i%20%3D%200%2C%0A%09%09%09iLen%20%3D%20aLinks.length%3B%0A%09%09try%20%7B%0A%09%09%09for%20%28%3B%20i%20%3C%20iLen%3B%20i++%29%0A%09%09%09%09copytext%20+%3D%20aLinks%5Bi%5D%20+%20%24.EOL%28%29%3B%0A%09%09%7D%20finally%20%7B%0A%09%09%09gClipboard.write%28copytext%29%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09onCommand%3A%20function%28aSelectedLinks%29%20%7B%0A%09%09%24._mm.sendAsyncMessage%28%24._getLinksMsgID%2C%20%7B%0A%09%09%09selected%3A%20aSelectedLinks%2C%0A%09%09%09removeDuplicates%3A%20%24.gPref%28%22pDoNotCopyDuplicatedLinks%22%29%2C%0A%09%09%7D%29%3B%0A%09%7D%2C%0A%0A%09%24CNS%3A%20function%28aElName%2C%20aAttrs%2C%20aNameSpace%29%20%7B%20//%20Creates%20elements%0A%09%09var%20el%20%3D%20aNameSpace%20%3F%0A%09%09%09document.createElementNS%28aNameSpace%2C%20aElName%29%20%3A%0A%09%09%09document.createElement%28aElName%29%3B%0A%09%09if%20%28aAttrs%29%0A%09%09%09Object.keys%28aAttrs%29.forEach%28function%28n%29%20%7B%0A%09%09%09%09if%20%28aAttrs%5Bn%5D%20%21%3D%3D%20%22%22%29%0A%09%09%09%09%09el.setAttribute%28n%2C%20aAttrs%5Bn%5D%29%3B%0A%09%09%09%7D%29%3B%0A%09%09return%20el%3B%0A%09%7D%2C%0A%0A%09EOL%3A%20function%28%29%20%7B%0A%09%09let%20platform%20%3D%20Services.appinfo.OS.toLowerCase%28%29%3B%0A%09%09if%20%28platform.indexOf%28%22win%22%29%20%21%3D%3D%20-1%29%0A%09%09%09return%20%22%5Cr%5Cn%22%3B%0A%09%09else%20if%20%28platform.indexOf%28%22mac%22%29%20%21%3D%3D%20-1%29%0A%09%09%09return%20%22%5Cr%22%3B%0A%09%09else%20if%20%28platform.indexOf%28%22unix%22%29%20%21%3D%3D%20-1%20%7C%7C%20platform.indexOf%28%27linux%27%29%20%21%3D%3D%20-1%20%7C%7C%20platform.indexOf%28%27sun%27%29%20%21%3D%3D%20-1%29%0A%09%09%09return%20%22%5Cn%22%3B%0A%09%7D%2C%0A%0A%09openOptions%3A%20function%28%29%20%7B%0A%09%09var%20url%20%3D%20%22about%3Aconfig%3Ffilter%3D%22%20+%20%24.Branch%3B%0A%09%09if%20%28%24.gPref%28%22pOpenOptionsOnNewTab%22%29%20%26%26%20%28%22gBrowser%22%20in%20window%29%29%20%7B%0A%09%09%09let%20tab%20%3D%20gBrowser.visibleTabs.find%28tab%20%3D%3E%20tab.linkedBrowser.currentURI.spec%20%3D%3D%3D%20url%29%3B%0A%09%09%09gBrowser.selectedTab%20%3D%20tab%20%7C%7C%20gBrowser.addTab%28url%29%3B%0A%09%09%7D%20else%0A%09%09%09toOpenWindowByType%28%22Preferences%3AConfigManager%22%2C%20url%29%3B%0A%09%7D%2C%0A%0A%09getHelp%3A%20function%28aPlaceholder%29%20%7B%20//%20Get%20specific%20data%2C%20surrounded%20by%20%22placeholders%22%2C%20from%20the%20Help%20tab.%0A%09%09return%20document.getElementById%28self.id%29.getAttribute%28%22Help%22%29.split%28%22%3C%21--%22%20+%20aPlaceholder%20+%20%22--%3E%22%29%5B1%5D%3B%0A%09%7D%2C%0A%0A%09_randomID%3A%20null%2C%0A%09_UID%3A%20%22__copy_links_url_%22%20+%20self.id.slice%2820%29%2C%0A%09_globalMM%3A%20Cc%5B%22@mozilla.org/globalmessagemanager%3B1%22%5D.getService%28Ci.nsIMessageListenerManager%29%2C%0A%09get%20copySelCtx%28%29%20%7B%0A%09%09return%20document.getElementById%28%24._UID%20+%20%22-copySelectedLinks%22%29%3B%0A%09%7D%2C%0A%09get%20copyAllCtx%28%29%20%7B%0A%09%09return%20document.getElementById%28%24._UID%20+%20%22-copyAllLinks%22%29%3B%0A%09%7D%2C%0A%09get%20_responseMsgID%28%29%20%7B%0A%09%09return%20%22CB%3ACopyLinkURL%3AResponse%3A%22%20+%20self.id.slice%2814%29%20+%20%22-%22%20+%20%24._randomID%3B%0A%09%7D%2C%0A%09get%20_getLinksMsgID%28%29%20%7B%0A%09%09return%20%22CB%3ACopyLinkURL%3AGetLinks%3A%22%20+%20self.id.slice%2814%29%20+%20%22-%22%20+%20%24._randomID%3B%0A%09%7D%2C%0A%09get%20_cleanupMsgID%28%29%20%7B%0A%09%09return%20%22CB%3ACopyLinkURL%3ACleanup%3A%22%20+%20self.id.slice%2814%29%20+%20%22-%22%20+%20%24._randomID%3B%0A%09%7D%2C%0A%09get%20_mm%28%29%20%7B%0A%09%09let%20mm%20%3D%20null%3B%0A%09%09try%20%7B%0A%09%09%09mm%20%3D%20typeof%20gBrowser%20%3D%3D%3D%20%22object%22%20%3F%0A%09%09%09%09gBrowser.selectedTab.linkedBrowser.messageManager%20%3A%20//%20Everything%20else.%0A%09%09%09%09getBrowser%28%29.messageManager%3B%20//%20Thunderbird.%20%25%24/%26%24%25%20you%21%21%21%21%0A%09%09%7D%20catch%20%28aErr%29%20%7B%7D%0A%09%09return%20mm%3B%0A%09%7D%2C%0A%7D%3B%0A%0Athis.CopyLinkURL.Branch%20%3D%20%22CB.CopyLinkURL.Id%22%20+%20self.id.slice%2820%29%20+%20%22.%22%3B%0A%0Athis.CopyLinkURL.gPref%20%3D%20function%28aKey%29%20%7B%0A%09let%20branch%20%3D%20Services.prefs.getBranch%28%24.Branch%29%3B%0A%09switch%20%28typeof%20%24.DefPrefs%5BaKey%5D%29%20%7B%0A%09%09case%20%22boolean%22%3A%0A%09%09%09return%20branch.getBoolPref%28aKey%29%3B%0A%09%09case%20%22number%22%3A%0A%09%09%09return%20branch.getIntPref%28aKey%29%3B%0A%09%09case%20%22string%22%3A%0A%09%09%09return%20branch.getComplexValue%28aKey%2C%20Ci.nsISupportsString%29.data%3B%0A%09%7D%0A%09return%20null%3B%0A%7D%3B%0A%0Athis.CopyLinkURL.sPref%20%3D%20function%28aKey%2C%20aVal%29%20%7B%0A%09let%20branch%20%3D%20Services.prefs.getBranch%28%24.Branch%29%3B%0A%09switch%20%28typeof%20aVal%29%20%7B%0A%09%09case%20%22boolean%22%3A%0A%09%09%09branch.setBoolPref%28aKey%2C%20aVal%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22number%22%3A%0A%09%09%09branch.setIntPref%28aKey%2C%20aVal%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22string%22%3A%0A%09%09%09let%20str%20%3D%20Cc%5B%22@mozilla.org/supports-string%3B1%22%5D.createInstance%28Ci.nsISupportsString%29%3B%0A%09%09%09str.data%20%3D%20aVal%3B%0A%09%09%09branch.setComplexValue%28%28aKey%29%2C%20Ci.nsISupportsString%2C%20str%29%3B%0A%09%09%09break%3B%0A%09%7D%0A%7D%3B%0A%0Athis.CopyLinkURL.initPrefs%20%3D%20function%28%29%20%7B%0A%09let%20branch%20%3D%20Services.prefs.getDefaultBranch%28%24.Branch%29%2C%0A%09%09defaults%20%3D%20%24.DefPrefs%3B%0A%09for%20%28let%20key%20in%20defaults%29%20%7B%0A%09%09if%20%28defaults.hasOwnProperty%28key%29%29%20%7B%0A%09%09%09let%20val%20%3D%20defaults%5Bkey%5D%3B%0A%09%09%09switch%20%28typeof%20val%29%20%7B%0A%09%09%09%09case%20%22boolean%22%3A%0A%09%09%09%09%09branch.setBoolPref%28key%2C%20val%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%09case%20%22number%22%3A%0A%09%09%09%09%09branch.setIntPref%28key%2C%20val%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%09case%20%22string%22%3A%0A%09%09%09%09%09let%20str%20%3D%20Cc%5B%22@mozilla.org/supports-string%3B1%22%5D.createInstance%28Ci.nsISupportsString%29%3B%0A%09%09%09%09%09str.data%20%3D%20val%3B%0A%09%09%09%09%09branch.setComplexValue%28%28key%29%2C%20Ci.nsISupportsString%2C%20str%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%0A%7D%3B%0A%0Athis.CopyLinkURL.DefPrefs%20%3D%20%7B%0A%09pShowCopyAllLinksOnContext%3A%20true%2C%0A%09pDoNotCopyDuplicatedLinks%3A%20true%2C%0A%09pOpenOptionsOnNewTab%3A%20false%2C%0A%7D%3B%0A%0Athis.CopyLinkURL.init%28%29%3B%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5B/*CODE*/%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B%uD835%uDDDC%uD835%uDDFA%uD835%uDDFD%uD835%uDDFC%uD835%uDDFF%uD835%uDE01%uD835%uDDEE%uD835%uDDFB%uD835%uDE01%20%uD835%uDDFB%uD835%uDDFC%uD835%uDE01%uD835%uDDF2%uD835%uDE00%0A%u26AB%20%uD835%uDDD7%uD835%uDDE2%20%uD835%uDDE1%uD835%uDDE2%uD835%uDDE7%20%uD835%uDDF6%uD835%uDDFB%uD835%uDE00%uD835%uDE01%uD835%uDDEE%uD835%uDDF9%uD835%uDDF9%20%uD835%uDDFA%uD835%uDDFC%uD835%uDDFF%uD835%uDDF2%20%uD835%uDE01%uD835%uDDF5%uD835%uDDEE%uD835%uDDFB%20%uD835%uDDFC%uD835%uDDFB%uD835%uDDF2%20%uD835%uDE03%uD835%uDDF2%uD835%uDDFF%uD835%uDE00%uD835%uDDF6%uD835%uDDFC%uD835%uDDFB%20%uD835%uDDFC%uD835%uDDF3%20%uD835%uDE01%uD835%uDDF5%uD835%uDDF6%uD835%uDE00%20%uD835%uDDEF%uD835%uDE02%uD835%uDE01%uD835%uDE01%uD835%uDDFC%uD835%uDDFB%20%uD835%uDDEE%uD835%uDE01%20%uD835%uDE01%uD835%uDDF5%uD835%uDDF2%20%uD835%uDE00%uD835%uDDEE%uD835%uDDFA%uD835%uDDF2%20%uD835%uDE01%uD835%uDDF6%uD835%uDDFA%uD835%uDDF2%u2757%u2757%u2757%0A%u26AB%20%uD835%uDDD7%uD835%uDDE2%20%uD835%uDDE1%uD835%uDDE2%uD835%uDDE7%20%uD835%uDDF0%uD835%uDDF9%uD835%uDDFC%uD835%uDDFB%uD835%uDDF2%20%uD835%uDE01%uD835%uDDF5%uD835%uDDF6%uD835%uDE00%20%uD835%uDDEF%uD835%uDE02%uD835%uDE01%uD835%uDE01%uD835%uDDFC%uD835%uDDFB%u2757%u2757%u2757%0A%u26AB%20If%20you%20did%20any%20of%20the%20previous%20actions%2C%20delete%20all%20extra%20buttons%20leaving%20only%20one%20version%20of%20%uD835%uDDD6%uD835%uDDFC%uD835%uDDFD%uD835%uDE06%20%uD835%uDDE6%uD835%uDDF2%uD835%uDDF9%uD835%uDDF2%uD835%uDDF0%uD835%uDE01%uD835%uDDF2%uD835%uDDF1%20%uD835%uDDDF%uD835%uDDF6%uD835%uDDFB%uD835%uDDF8%uD835%uDE00%20and%20restart%20your%20application.%0A%0A%5B%2C%5D%0A%0A/**%0A%20*%20%uD835%uDDD9%uD835%uDDE5%uD835%uDDE2%uD835%uDDE0%20%uD835%uDDDB%uD835%uDDD8%uD835%uDDE5%uD835%uDDD8%20%uD835%uDDD7%uD835%uDDE2%uD835%uDDEA%uD835%uDDE1%20%uD835%uDDD7%uD835%uDDE2%20%uD835%uDDE1%uD835%uDDE2%uD835%uDDE7%20%uD835%uDDE7%uD835%uDDE2%uD835%uDDE8%uD835%uDDD6%uD835%uDDDB%20%uD835%uDDD4%uD835%uDDE1%uD835%uDDEC%uD835%uDDE7%uD835%uDDDB%uD835%uDDDC%uD835%uDDE1%uD835%uDDDA%0A%20*/%0A%20%0A%3C%21--%25FrameScript%25--%3E%0A%28function%28aContext%29%20%7B%0A%09var%20Ci%20%3D%20Components.interfaces%3B%0A%09var%20Cu%20%3D%20Components.utils%3B%0A%0A%09let%20gCopyLinkURL%20%3D%20%7B%0A%09%09init%3A%20function%28%29%20%7B%0A%09%09%09aContext.addMessageListener%28%22%25Get_links_ID%25%22%2C%20this%29%3B%0A%09%09%09aContext.addMessageListener%28%22%25Cleanup_ID%25%22%2C%20this%29%3B%0A%09%09%7D%2C%0A%0A%09%09unInit%3A%20function%28%29%20%7B%0A%09%09%09aContext.removeMessageListener%28%22%25Get_links_ID%25%22%2C%20this%29%3B%0A%09%09%09aContext.removeMessageListener%28%22%25Cleanup_ID%25%22%2C%20this%29%3B%0A%09%09%7D%2C%0A%0A%09%09receiveMessage%3A%20function%28aMsg%29%20%7B%0A%09%09%09switch%20%28aMsg.name%29%20%7B%0A%09%09%09%09case%20%22%25Get_links_ID%25%22%3A%0A%09%09%09%09%09this.getLinks%28aMsg.data%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%09case%20%22%25Cleanup_ID%25%22%3A%0A%09%09%09%09%09this.unInit%28%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%7D%0A%09%09%7D%2C%0A%0A%09%09getLinks%3A%20function%28aData%29%20%7B%0A%09%09%09var%20focusedWindow%20%3D%20content.window%3B%0A%09%09%09var%20focusedDoc%20%3D%20content.document%3B%0A%09%09%09var%20argc%20%3D%20this.getLinks.arguments.length%3B%0A%09%09%09var%20argv%20%3D%20this.getLinks.arguments%3B%0A%09%09%09var%20reMask%3B%0A%09%09%09var%20selLinks%20%3D%20%5B%5D%3B%0A%09%09%09var%20i%20%3D%200%2C%0A%09%09%09%09iLen%20%3D%20focusedDoc.links.length%2C%0A%09%09%09%09j%20%3D%200%3B%0A%09%09%09if%20%28argc%20%3E%201%29%0A%09%09%09%09reMask%20%3D%20new%20RegExp%28argv%5B1%5D%2C%20%22i%22%29%3B%0A%09%09%09for%20%28%3B%20i%20%3C%20iLen%3B%20i++%29%20%7B%0A%09%09%09%09if%20%28%28%21aData.selected%20%7C%7C%20focusedWindow.getSelection%28%29.containsNode%28focusedDoc.links%5Bi%5D%2C%20true%29%29%20%26%26%0A%09%09%09%09%09%28argc%20%3C%3D%201%20%7C%7C%20focusedDoc.links%5Bi%5D.href.match%28reMask%29%29%29%20%7B%0A%09%09%09%09%09selLinks%5Bj%5D%20%3D%20focusedDoc.links%5Bi%5D.href%3B%0A%09%09%09%09%09j++%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%09try%20%7B%0A%09%09%09%09if%20%28aData.removeDuplicates%20%26%26%20selLinks.length%20%3E%200%29%20%7B%0A%09%09%09%09%09let%20seen%20%3D%20%7B%7D%3B%0A%09%09%09%09%09selLinks%20%3D%20selLinks.filter%28function%28aItem%29%20%7B%0A%09%09%09%09%09%09return%20seen.hasOwnProperty%28aItem%29%20%3F%20false%20%3A%20%28seen%5BaItem%5D%20%3D%20true%29%3B%0A%09%09%09%09%09%7D%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%20finally%20%7B%0A%09%09%09%09sendAsyncMessage%28%22%25Response_ID%25%22%2C%20%7B%0A%09%09%09%09%09id%3A%201%2C%0A%09%09%09%09%09links%3A%20selLinks%2C%0A%09%09%09%09%7D%29%3B%0A%09%09%09%7D%0A%09%09%7D%2C%0A%09%7D%3B%0A%09gCopyLinkURL.init%28%29%3B%0A%7D%29%28this%29%3B%0A%3C%21--%25FrameScript%25--%3E%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" rel="nofollow" title="Install Copy Link URL">
				<![CDATA[Install this button]]>
			</html:a>
		</html:div>
		<html:a id="about" href="https://addons.mozilla.org/addon/custom-buttons/">
			<![CDATA[About CustomButtons]]>
		</html:a>
		<html:div id="credits">
			<html:a href="http://custombuttons.sourceforge.net/forum/viewtopic.php?t=3599">
				<![CDATA[XML created with]]>
				<html:br/>
				<![CDATA[CB Context Menu Extended]]>
			</html:a>
		</html:div>
	</html:div>
</html:body>
  <name>Copy Link URL</name>
  <image><![CDATA[data:image/icon;base64,EBAAAAAAAAAAAAAAAAAAAAAAAAAABgAAACQAAAA7AAAAPgAAAD4AAAA+AAAAPgAAAD4AAAA7AAAAJAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACSRkZGx8PDw+/b29v/29vb/9vb2//b29v/29vb/8PDw+5GRkbEAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA74+Pj+OXl5f/k5OT/5OTk/+Tk5P/k5OT/5OTk/+Xl5f/j4+P4AAAAOwAAAAAAAAAAAAAABgAAACQAAAA7AAAAQODg4P/f39//EBAQmgAAAJUAAACVAAAAlRAQEJrf39//4ODg/wAAAD4AAAAAAAAAAAAAACSMjIyx6+vr+wAAAEDb29v/29vb/wAAAEkAAAAAAAAAAAAAAAAAAABJ29vb/9vb2/8AAAA+AAAAAAAAAAAAAAA72tra+NfX1/8AAABA1tbW/9bW1v8AAAA+AAAAAAAAAAAAAAAAAAAAPtbW1v/W1tb/AAAAPgAAAAAAAAAAAAAAPtLS0v/R0dH/AAAAQNHR0f/R0dH/AAAAPgAAAAAAAAAAAAAAAAAAAD7R0dH/0dHR/wAAAD4AAAAAAAAAAAAAAD7Nzc3/zc3N/wAAAEDNzc3/zc3N/wAAAD4AAAAAAAAAAAAAAAAAAAA+zc3N/83Nzf8AAAA+AAAAAAAAAAAAAAA+yMjI/8jIyP8AAABAyMjI/8jIyP8AAAA+AAAAAAAAAAAAAAAAAAAAPsjIyP/IyMj/AAAAPgAAAAAAAAAAAAAAPsPDw//Dw8P/AAAAQMPDw//Dw8P/KSkpZQAAAD4AAAA+AAAAPikpKWXDw8P/w8PD/wAAAD4AAAAAAAAAAAAAAD6/v7//v7+//wAAAECwsLD1v7+//+Hh4f/l5eX/5eXl/+Xl5f/h4eH/v7+//7CwsPUAAAA7AAAAAAAAAAAAAAA+urq6/7q6uv8AAABAPz8/raysrPW6urr/urq6/7q6uv+6urr/urq6/6ysrPU/Pz+tAAAAJAAAAAAAAAAAAAAAPra2tv+2trb/KCgoZQAAAGcAAACSAAAAlgAAAJYAAACWAAAAlgAAAJYAAACPAAAAUAAAAAYAAAAAAAAAAAAAADukpKT1sbGx/9ra2v/g4OD/4ODg/+Dg4P/g4OD/4ODg/9ra2vsAAAA7AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkOzs7rZ6envWsrKz/rKys/6ysrP+srKz/rKys/6CgoPU9PT2rAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAFAAAACPAAAAlQAAAJUAAACVAAAAlQAAAJUAAACPAAAAUAAAAAYAAAAAAAAAAAAAAAAAAAAA]]></image>
  <mode>0</mode>
  <initcode><![CDATA[var $ = this.CopyLinkURL = {
	init: function() {
		if (!("Services" in window))
			Cu.import("resource://gre/modules/Services.jsm");

		$.initPrefs();

		if (!($._UID in window)) {
			window[$._UID] = {
				CustomizableUI: false,
				DealWithLinks: null,
				RandomID: false,
				FrameScriptLoaded: false,
			};
		}

		window[$._UID]["DealWithLinks"] = $.dealWithLinks;

		if (!window[$._UID]["RandomID"]) {
			window[$._UID]["RandomID"] = parseInt(Math.random() * 10000, 10);
		}
		$._randomID = window[$._UID]["RandomID"];

		if (!window[$._UID]["FrameScriptLoaded"]) {
			window[$._UID]["FrameScriptLoaded"] = true;
			$._frameScript = "data:application/javascript," + encodeURIComponent($.getHelp("%FrameScript%")
				.replace(/%Get_links_ID%/g, $._getLinksMsgID)
				.replace(/%Cleanup_ID%/g, $._cleanupMsgID)
				.replace(/%Response_ID%/g, $._responseMsgID));
			$._globalMM.loadFrameScript($._frameScript, true);
			$._globalMM.addMessageListener($._responseMsgID, $._messageResponse);
		}

		self.tooltipText = self.name + " - ID#: " + self.id.slice(20) +
			"\n\n𝗟𝗲𝗳𝘁 𝗰𝗹𝗶𝗰𝗸: Open options\t\n\n" +
			"𝗥𝗲𝗮𝗱 𝘁𝗵𝗶𝘀 𝗯𝘂𝘁𝘁𝗼𝗻 𝗵𝗲𝗹𝗽 𝗳𝗼𝗿 𝘃𝗲𝗿𝘆 𝗶𝗺𝗽𝗼𝗿𝘁𝗮𝗻𝘁 𝘂𝘀𝗮𝗴𝗲 𝗻𝗼𝘁𝗲𝘀.\n" +
			"𝗥𝗶𝗴𝗵𝘁 𝗰𝗹𝗶𝗰𝗸 𝗼𝗻 𝗯𝘂𝘁𝘁𝗼𝗻, \"𝗕𝘂𝘁𝘁𝗼𝗻 𝗛𝗲𝗹𝗽\" 𝗶𝘁𝗲𝗺.";

		self.onclick = function(aE) {
			if (aE.button === 0 && !aE.shiftKey && !aE.ctrlKey && !aE.metaKey && !aE.altKey)
				$.openOptions();
			aE.stopPropagation();
		};

		var ctx = document.getElementById("mailContext") ||
			document.getElementById("contentAreaContextMenu");
		var insertPoint = document.getElementById("mailContext-copy") ||
			document.getElementById("context-copy");
		let ctxListener = function() {
			$.copySelCtx.hidden = !(gContextMenu.isContentSelected);
		};
		if (ctx && !$.copySelCtx) {
			let mItem1 = $.$CNS("menuitem", {
				id: $._UID + "-copySelectedLinks",
				cb_id: $._UID,
				class: "menuitem-iconic",
				image: self.image,
				label: "Copy Selected Links",
				oncommand: "document.getElementById('" + self.id + "').CopyLinkURL.onCommand(true)",
			});
			ctx.insertBefore(mItem1, insertPoint.nextSibling);
			ctx.addEventListener("popupshowing", ctxListener, false);
		}
		if (ctx && $.gPref("pShowCopyAllLinksOnContext") && !$.copyAllCtx) {
			let mItem2 = $.$CNS("menuitem", {
				id: $._UID + "-copyAllLinks",
				cb_id: $._UID,
				class: "menuitem-iconic",
				image: self.image,
				label: "Copy All Links",
				oncommand: "document.getElementById('" + self.id + "').CopyLinkURL.onCommand(false)",
			});
			ctx.insertBefore(mItem2, insertPoint.nextSibling);
		}

		if ("CustomizableUI" in window) {
			if (!window[$._UID]["CustomizableUI"]) {
				window[$._UID]["CustomizableUI"] = true;
				CustomizableUI.addListener({
					onCustomizeEnd: function(aWindow) {
						var thisBtn = aWindow.document.getElementById(self.id);
						setTimeout(function() {
							aWindow[$._UID]["CustomizableUI"] && thisBtn.CopyLinkURL.selfDestroy();
						}, Math.floor(Math.random() * (1 + 2000 - 200)) + 200);
					}
				});
			}
		}

		addDestructor(function(aReason) {
			if (aReason === "delete" || aReason === "destructor") {
				$._mm.sendAsyncMessage($._cleanUpMsgID);
				$._globalMM.removeDelayedFrameScript($._frameScript);
				$._globalMM.removeMessageListener($._responseMsgID, $._messageResponse);
			}
			if (aReason === "delete" || aReason === "update") {
				let selfEls = document.getElementsByAttribute("cb_id", $._UID);
				Array.prototype.slice.call(selfEls).forEach(function(aEl) { // Delete all elements created by this button.
					aEl && aEl.parentNode.removeChild(aEl);
				});
				ctx.removeEventListener("popupshowing", ctxListener, false);
			}
		});
	},

	_messageResponse: {
		receiveMessage: function(aMsg) {
			if (aMsg.name !== $._responseMsgID)
				return;
			switch (aMsg.data.id) {
				case 1:
					window[$._UID]["DealWithLinks"](aMsg.data.links);
					break;
			}
		},
	},

	dealWithLinks: function(aLinks) {
		if (aLinks.length === 0) {
			Services.prompt.alert(null, self.name, "No links found in the selected text or page.");
			return;
		}
		var copytext = "";
		let i = 0,
			iLen = aLinks.length;
		try {
			for (; i < iLen; i++)
				copytext += aLinks[i] + $.EOL();
		} finally {
			gClipboard.write(copytext);
		}
	},

	onCommand: function(aSelectedLinks) {
		$._mm.sendAsyncMessage($._getLinksMsgID, {
			selected: aSelectedLinks,
			removeDuplicates: $.gPref("pDoNotCopyDuplicatedLinks"),
		});
	},

	$CNS: function(aElName, aAttrs, aNameSpace) { // Creates elements
		var el = aNameSpace ?
			document.createElementNS(aNameSpace, aElName) :
			document.createElement(aElName);
		if (aAttrs)
			Object.keys(aAttrs).forEach(function(n) {
				if (aAttrs[n] !== "")
					el.setAttribute(n, aAttrs[n]);
			});
		return el;
	},

	EOL: function() {
		let platform = Services.appinfo.OS.toLowerCase();
		if (platform.indexOf("win") !== -1)
			return "\r\n";
		else if (platform.indexOf("mac") !== -1)
			return "\r";
		else if (platform.indexOf("unix") !== -1 || platform.indexOf('linux') !== -1 || platform.indexOf('sun') !== -1)
			return "\n";
	},

	openOptions: function() {
		var url = "about:config?filter=" + $.Branch;
		if ($.gPref("pOpenOptionsOnNewTab") && ("gBrowser" in window)) {
			let tab = gBrowser.visibleTabs.find(tab => tab.linkedBrowser.currentURI.spec === url);
			gBrowser.selectedTab = tab || gBrowser.addTab(url);
		} else
			toOpenWindowByType("Preferences:ConfigManager", url);
	},

	getHelp: function(aPlaceholder) { // Get specific data, surrounded by "placeholders", from the Help tab.
		return document.getElementById(self.id).getAttribute("Help").split("<!--" + aPlaceholder + "-->")[1];
	},

	_randomID: null,
	_UID: "__copy_links_url_" + self.id.slice(20),
	_globalMM: Cc["@mozilla.org/globalmessagemanager;1"].getService(Ci.nsIMessageListenerManager),
	get copySelCtx() {
		return document.getElementById($._UID + "-copySelectedLinks");
	},
	get copyAllCtx() {
		return document.getElementById($._UID + "-copyAllLinks");
	},
	get _responseMsgID() {
		return "CB:CopyLinkURL:Response:" + self.id.slice(14) + "-" + $._randomID;
	},
	get _getLinksMsgID() {
		return "CB:CopyLinkURL:GetLinks:" + self.id.slice(14) + "-" + $._randomID;
	},
	get _cleanupMsgID() {
		return "CB:CopyLinkURL:Cleanup:" + self.id.slice(14) + "-" + $._randomID;
	},
	get _mm() {
		let mm = null;
		try {
			mm = typeof gBrowser === "object" ?
				gBrowser.selectedTab.linkedBrowser.messageManager : // Everything else.
				getBrowser().messageManager; // Thunderbird. %$/&$% you!!!!
		} catch (aErr) {}
		return mm;
	},
};

this.CopyLinkURL.Branch = "CB.CopyLinkURL.Id" + self.id.slice(20) + ".";

this.CopyLinkURL.gPref = function(aKey) {
	let branch = Services.prefs.getBranch($.Branch);
	switch (typeof $.DefPrefs[aKey]) {
		case "boolean":
			return branch.getBoolPref(aKey);
		case "number":
			return branch.getIntPref(aKey);
		case "string":
			return branch.getComplexValue(aKey, Ci.nsISupportsString).data;
	}
	return null;
};

this.CopyLinkURL.sPref = function(aKey, aVal) {
	let branch = Services.prefs.getBranch($.Branch);
	switch (typeof aVal) {
		case "boolean":
			branch.setBoolPref(aKey, aVal);
			break;
		case "number":
			branch.setIntPref(aKey, aVal);
			break;
		case "string":
			let str = Cc["@mozilla.org/supports-string;1"].createInstance(Ci.nsISupportsString);
			str.data = aVal;
			branch.setComplexValue((aKey), Ci.nsISupportsString, str);
			break;
	}
};

this.CopyLinkURL.initPrefs = function() {
	let branch = Services.prefs.getDefaultBranch($.Branch),
		defaults = $.DefPrefs;
	for (let key in defaults) {
		if (defaults.hasOwnProperty(key)) {
			let val = defaults[key];
			switch (typeof val) {
				case "boolean":
					branch.setBoolPref(key, val);
					break;
				case "number":
					branch.setIntPref(key, val);
					break;
				case "string":
					let str = Cc["@mozilla.org/supports-string;1"].createInstance(Ci.nsISupportsString);
					str.data = val;
					branch.setComplexValue((key), Ci.nsISupportsString, str);
					break;
			}
		}
	}
};

this.CopyLinkURL.DefPrefs = {
	pShowCopyAllLinksOnContext: true,
	pDoNotCopyDuplicatedLinks: true,
	pOpenOptionsOnNewTab: false,
};

this.CopyLinkURL.init();]]></initcode>
  <code><![CDATA[/*CODE*/]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help><![CDATA[𝗜𝗺𝗽𝗼𝗿𝘁𝗮𝗻𝘁 𝗻𝗼𝘁𝗲𝘀
⚫ 𝗗𝗢 𝗡𝗢𝗧 𝗶𝗻𝘀𝘁𝗮𝗹𝗹 𝗺𝗼𝗿𝗲 𝘁𝗵𝗮𝗻 𝗼𝗻𝗲 𝘃𝗲𝗿𝘀𝗶𝗼𝗻 𝗼𝗳 𝘁𝗵𝗶𝘀 𝗯𝘂𝘁𝘁𝗼𝗻 𝗮𝘁 𝘁𝗵𝗲 𝘀𝗮𝗺𝗲 𝘁𝗶𝗺𝗲❗❗❗
⚫ 𝗗𝗢 𝗡𝗢𝗧 𝗰𝗹𝗼𝗻𝗲 𝘁𝗵𝗶𝘀 𝗯𝘂𝘁𝘁𝗼𝗻❗❗❗
⚫ If you did any of the previous actions, delete all extra buttons leaving only one version of 𝗖𝗼𝗽𝘆 𝗦𝗲𝗹𝗲𝗰𝘁𝗲𝗱 𝗟𝗶𝗻𝗸𝘀 and restart your application.

[,]

/**
 * 𝗙𝗥𝗢𝗠 𝗛𝗘𝗥𝗘 𝗗𝗢𝗪𝗡 𝗗𝗢 𝗡𝗢𝗧 𝗧𝗢𝗨𝗖𝗛 𝗔𝗡𝗬𝗧𝗛𝗜𝗡𝗚
 */
 
<!--%FrameScript%-->
(function(aContext) {
	var Ci = Components.interfaces;
	var Cu = Components.utils;

	let gCopyLinkURL = {
		init: function() {
			aContext.addMessageListener("%Get_links_ID%", this);
			aContext.addMessageListener("%Cleanup_ID%", this);
		},

		unInit: function() {
			aContext.removeMessageListener("%Get_links_ID%", this);
			aContext.removeMessageListener("%Cleanup_ID%", this);
		},

		receiveMessage: function(aMsg) {
			switch (aMsg.name) {
				case "%Get_links_ID%":
					this.getLinks(aMsg.data);
					break;
				case "%Cleanup_ID%":
					this.unInit();
					break;
			}
		},

		getLinks: function(aData) {
			var focusedWindow = content.window;
			var focusedDoc = content.document;
			var argc = this.getLinks.arguments.length;
			var argv = this.getLinks.arguments;
			var reMask;
			var selLinks = [];
			var i = 0,
				iLen = focusedDoc.links.length,
				j = 0;
			if (argc > 1)
				reMask = new RegExp(argv[1], "i");
			for (; i < iLen; i++) {
				if ((!aData.selected || focusedWindow.getSelection().containsNode(focusedDoc.links[i], true)) &&
					(argc <= 1 || focusedDoc.links[i].href.match(reMask))) {
					selLinks[j] = focusedDoc.links[i].href;
					j++;
				}
			}
			try {
				if (aData.removeDuplicates && selLinks.length > 0) {
					let seen = {};
					selLinks = selLinks.filter(function(aItem) {
						return seen.hasOwnProperty(aItem) ? false : (seen[aItem] = true);
					});
				}
			} finally {
				sendAsyncMessage("%Response_ID%", {
					id: 1,
					links: selLinks,
				});
			}
		},
	};
	gCopyLinkURL.init();
})(this);
<!--%FrameScript%-->]]></help>
  <attributes/>
</custombutton>