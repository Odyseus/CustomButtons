<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/" xmlns:html="http://www.w3.org/1999/xhtml">
<html:head>
	<html:title><![CDATA[Multi Translator]]></html:title>
	<html:link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABEElEQVQ4jaXSSUtDUQyG4afWCbFQwRERkW5EBX+AFUHQlbgQRV2oG1EodtWFOOA82x/t4qTQSWnxg8CFc5O8ST4alcEKXvxDRVS7SRhHCeWI6yhQrovzvwpM4Qb3TfGNDzzgshsi6MM7TuK7Yx1iD+tBsNFt52IkViX88W6Sh7GEpyhQwYwOR5jHGR5xi9MocoUjZJHHdlC2aBVf2MUkeqJoCW/oxWKM9YyB30iGMBEFmnUsLfg+GrZoMHArmGt6G5W8UIgxLqJZgzKBfyAtLl/3ti85dANb0q4W2lHkJPPMSteYxRg+g6Bm7TvsaHOhfqxJRnrFMjYlb0zX/VcMopF2FDUVpPPlJEPVL3YgyLI/5FwmASoiChQAAAAASUVORK5CYII="/>
	<html:style type="text/css"><![CDATA[body{font-size:medium;margin:0}body,code:before,help:before,initcode:before{font-family:"Verdana",sans-serif}#wrapper{position:fixed;top:1em;right:1em;max-width:15%;text-align:center}#button{background-color:#299a0b;border:1px solid #3a7404;border-radius:.5em;padding:0;margin-bottom:1em;box-shadow:1px 2px 3px rgba(0,0,0,.25)}#button a{color:#f0f0f0;font-weight:700;text-shadow:-.5pt -.5px .5pt rgba(0,0,0,1);padding:.8em;text-decoration:none}:-moz-any-link:focus{color:grey;outline-color:transparent;text-decoration:none}#button a,code,code:before,initcode,initcode:before,help,help:before{display:block}#credits{position:fixed;bottom:1em;right:1em;font-size:small}#about{font-size:small}custombutton{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABAElEQVQ4jW2TQXLFMAhDff+b2vEHYw5AF38eVTNdZAIxCEkmw31VptU5T7mvOuepc56K2B2f85TZrEwr99VxptUwm2U2695PZVrH937KfZX76txsVsTus0yrEbEr0/4F4AyQc56eDMiI2F0IbYoj9h9ZSCV2XzXUA1BVL8BvBvSMiN20zWY38VZ5gDEkYtfAYTRToA3qiQJk2hcA7W8gpaxG0nPvp4aiQ5UCzOV2GKAgLUEfpsGCfaBR92TonapmdCoAjHTIgLa6/14gbgow8oj9uwe6SMQ0qTz9P9oDZOgCkfMNJnqWaV8P3ouDRorUXEA4H1wbtMmVjcrQ7TSb9QMtXcwa4wpbXgAAAABJRU5ErkJggg==) fixed #f6f6f1;margin:1em}date,image,mode,accelkey{display:none}name{font-weight:700;font-size:x-large}code:before,help:before,initcode:before{font-weight:700;font-size:large;margin:0 0 1em;padding:.5em}code:before{content:"Code Tab"}help:before{content:"Help Tab"}initcode:before{content:"Initialization Code Tab"}code,initcode,help{background-color:#fcfcfc;font-size:.875em;font-family:Consolas,"Bitstream Vera Sans Mono","Courier New",Courier,monospace!important;margin:1em 2em 1em 0 !important;padding:1em;text-align:left;box-shadow:2px 2px 0 rgba(170,160,130,0.5),4px 4px 0 rgba(200,190,165,0.5);max-width:80%;min-width:80%;white-space:pre-wrap;word-wrap:break-word}]]></html:style>
</html:head>
<html:body>
	<html:div id="wrapper">
		<html:div id="button">
			<html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3EMulti%20Translator%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABEElEQVQ4jaXSSUtDUQyG4afWCbFQwRERkW5EBX+AFUHQlbgQRV2oG1EodtWFOOA82x/t4qTQSWnxg8CFc5O8ST4alcEKXvxDRVS7SRhHCeWI6yhQrovzvwpM4Qb3TfGNDzzgshsi6MM7TuK7Yx1iD+tBsNFt52IkViX88W6Sh7GEpyhQwYwOR5jHGR5xi9MocoUjZJHHdlC2aBVf2MUkeqJoCW/oxWKM9YyB30iGMBEFmnUsLfg+GrZoMHArmGt6G5W8UIgxLqJZgzKBfyAtLl/3ti85dANb0q4W2lHkJPPMSteYxRg+g6Bm7TvsaHOhfqxJRnrFMjYlb0zX/VcMopF2FDUVpPPlJEPVL3YgyLI/5FwmASoiChQAAAAASUVORK5CYII%3D%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5Bvar%20that%20%3D%20this.MultiTranslator%20%3D%20%7B%0A%09URLBarEngines%3A%20%7B%0A%09%091%3A%20%7B%20//%20DO%20NOT%20EDIT%20THIS%20OBJECT%21%21%21%0A%09%09%09Label%3A%20%22Bing%20Translator%22%2C%0A%09%09%09Command%3A%20%22javascript%3A%28function%28%29%7Bvar%2520s%2520%3D%2520document.createElement%28%27scr%27+%27ipt%27%29%3B%22%20+%0A%09%09%09%09%22%2520s.type%2520%3D%2520%27text/javascript%27%3B%2520s.src%2520%3D%2520%27http%3A//labs.microsofttranslator%22%20+%0A%09%09%09%09%22.com/bookmarklet/default.aspx%3Ff%3Djs%26to%3D%25%25LNGTO%25%25%27%3B%2520document.body.%22%20+%0A%09%09%09%09%22insertBefore%28s%2C%2520document.body.firstChild%29%3B%7D%29%28%29%22%2C%0A%09%09%09Image%3A%201%2C%0A%09%09%09Tooltip%3A%20%22Translate%20page%20with%20Bing%20Translator.%5Cn%5CnThe%20source%20language%20is%20auto%20detected.%22%20+%0A%09%09%09%09%22%20The%20destination%20language%20is%20set%20from%20the%20Page%20translator%20options%20menu.%22%2C%0A%09%09%7D%2C%0A%0A%09%092%3A%20%7B%20//%20DO%20NOT%20EDIT%20THIS%20OBJECT%21%21%21%0A%09%09%09Label%3A%20%22Google%20Translator%22%2C%0A%09%09%09Command%3A%20%22https%3A//translate.google.com/translate%3Fu%3D%25%25URL%25%25%26hl%3D%25%25LNGTO%25%25%26langpair%3D%25%25LNGFROM%25%25%7C%25%25LNGTO%25%25%26tbb%3D1%26ie%3DUTF-8%22%2C%0A%09%09%09Image%3A%202%2C%0A%09%09%09Tooltip%3A%20%22Translate%20page%20with%20Google%20Translator.%5Cn%5CnThe%20source/destination%20languages%20%22%20+%0A%09%09%09%09%22are%20set%20from%20the%20Page%20translator%20options%20menu.%22%2C%0A%09%09%7D%2C%0A%0A%09%09/**%0A%09%09%20*%20How%20to%20create%20a%20custom%20bookmarklet%20to%20be%20used%20as%20a%20page%20translator.%0A%09%09%20*%0A%09%09%20*%20Just%20un-comment%20one%20of%20the%20objects%20bellow%20and%20edit%20as%20needed.%0A%09%09%20*%20Objects%20must%20be%20named%20with%20a%20number.%20NEVER%20REPEAT%20A%20NUMBER%20AND%20NEVER%20USE%201%20%28one%29%20nor%202%20%28two%29%21%21%21%21%0A%09%09%20*%20Label%20%28Mandatory%29%3A%20It%20will%20be%20displayed%20on%20the%20engine%20selection%20menus%20for%20the%20page%20translation.%0A%09%09%20*%20Command%20%28Mandatory%29%3A%20The%20bookmarklet/code%20to%20be%20executed%20by%20the%20page%20translation%20options.%0A%09%09%20*%20Tooltip%20%28Optional%29%3A%20Some%20descriptive%20text%20that%20will%20be%20displayed%20as%20tooltip%20on%20the%20engine%20selection%20menus.%0A%09%09%20*%20Image%20%28Mandatory%29%3A%20It%20will%20set%20the%20image%20to%20be%20displayed%20inside%20the%20URL%20bar.%20It%20can%20be%20an%20URL%20to%20an%20image%2C%0A%09%09%20*%20a%20data%3A%20image%20or%20a%20number%20between%200%20to%203.%0A%09%09%20*%200%20%3D%20Generic%20image.%0A%09%09%20*%201%20%3D%20Bing%20translator%20image.%0A%09%09%20*%202%20%3D%20Google%20translator%20image.%0A%09%09%20*%203%20%3D%20Yandex%20trnaslator%20image.%0A%09%09%20*%0A%09%09%20*%20Note%3A%20Some%20%28optionals%29%20placeholders%20can%20be%20used%20inside%20Command%20%28No%20quotes%29%3A%0A%09%09%20*%20%22%25%25URL%25%25%22%3A%20Used%20to%20%22inject%22%20the%20current%20page%20URL%20into%20the%20bookmarklet/code.%20See%20example%20in%20the%20Google%20Translator%20Command.%0A%09%09%20*%20%22%25%25LNGTO%25%25%22%20and/or%20%22%25%25LNGFROM%25%25%22%3A%20Used%20to%20%22inject%22%20the%20language%20code%20to%20translate%20to/from.%0A%09%09%20*%20These%20language%20codes%20are%20configured%20from%20the%20language%20selection%20lists%20inside%20the%20options%20menu.%0A%09%09%20*%0A%09%09%20*%20%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%20Where%20to%20get%20bookmarklets%20to%20translate%20pages%3F%20%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%0A%09%09%20*%0A%09%09%20*%20Bing/Microsoft%20Translator%20Bookmarklets%3A%20http%3A//labs.microsofttranslator.com/bookmarklet/%0A%09%09%20*%20Google%20Translator%20Bookmarklets%3A%20http%3A//translate.google.com/translate_buttons%0A%09%09%20*/%0A%0A%09%093%3A%20%7B%20//%20%23%23%23%20Example%20%23%23%23%0A%09%09%09Label%3A%20%22Bing%20Translator%20Auto%20To%20English%22%2C%0A%09%09%09Command%3A%20%22javascript%3A%28function%28%29%7Bvar%2520s%2520%3D%2520document.createElement%28%27scr%27+%27ipt%27%29%3B%22%20+%0A%09%09%09%09%22%2520s.type%2520%3D%2520%27text/javascript%27%3B%2520s.src%2520%3D%2520%27http%3A//labs.microsofttranslator%22%20+%0A%09%09%09%09%22.com/bookmarklet/default.aspx%3Ff%3Djs%26to%3Den%27%3B%2520document.body.%22%20+%0A%09%09%09%09%22insertBefore%28s%2C%2520document.body.firstChild%29%3B%7D%29%28%29%22%2C%0A%09%09%09Image%3A%201%2C%0A%09%09%7D%2C%0A%0A%09%094%3A%20%7B%20//%20%23%23%23%20Example%20%23%23%23%0A%09%09%09Label%3A%20%22Google%20Translator%20Auto%20To%20English%22%2C%0A%09%09%09Command%3A%20%22https%3A//translate.google.com/translate%3Fu%3D%25%25URL%25%25%26hl%3Dauto%26langpair%3Dauto%7Cen%26tbb%3D1%26ie%3DUTF-8%22%2C%0A%09%09%09Image%3A%202%2C%0A%09%09%7D%2C%0A%0A%0A%09%09/*%0A%09%095%3A%20%7B%20//%20%23%23%23%20Example%20%23%23%23%0A%09%09%09Label%3A%20%22Google%20Translator%20En-Ru%22%2C%0A%09%09%09Command%3A%20%22https%3A//translate.google.com/translate%3Fu%3D%25%25URL%25%25%26hl%3Dru%26langpair%3Den%7Cru%26tbb%3D1%26ie%3DUTF-8%22%2C%0A%09%09%09Image%3A%202%2C%0A%09%09%7D%2C%0A%09%09*/%0A%0A%09%09/*%0A%09%096%3A%20%7B%20//%20%23%23%23%20Example%20%23%23%23%0A%09%09%09Label%3A%20%22Google%20Translator%20Ru-En%22%2C%0A%09%09%09Command%3A%20%22https%3A//translate.google.com/translate%3Fu%3D%25%25URL%25%25%26hl%3Dru%26langpair%3Dru%7Cen%26tbb%3D1%26ie%3DUTF-8%22%2C%0A%09%09%09Image%3A%202%2C%0A%09%09%7D%2C%0A%09%09*/%0A%0A%09%09/*%0A%09%097%3A%20%7B%20//%20%23%23%23%20Example%20%23%23%23%0A%09%09%09Label%3A%20%22Bing%20Translator%20Auto%20To%20Russian%22%2C%0A%09%09%09Command%3A%20%22javascript%3A%28function%28%29%7Bvar%2520s%2520%3D%2520document.createElement%28%27scr%27+%27ipt%27%29%3B%22%20+%0A%09%09%09%09%22%2520s.type%2520%3D%2520%27text/javascript%27%3B%2520s.src%2520%3D%2520%27http%3A//labs.microsofttranslator%22%20+%0A%09%09%09%09%22.com/bookmarklet/default.aspx%3Ff%3Djs%26to%3Dru%27%3B%2520document.body.%22%20+%0A%09%09%09%09%22insertBefore%28s%2C%2520document.body.firstChild%29%3B%7D%29%28%29%22%2C%0A%09%09%09Image%3A%201%2C%0A%09%09%7D%2C%0A%09%09*/%0A%09%7D%2C%0A%0A%09PopupEngines%3A%20%7B%0A%0A%09%091%3A%20%7B%20//%20DO%20NOT%20EDIT%20THIS%20OBJECT%21%21%21%0A%09%09%09Label%3A%20%22Bing%20Translator%22%2C%0A%09%09%09Image%3A%201%2C%0A%09%09%09method%3A%20%22GET%22%2C%0A%09%09%09Referer%3A%20%22http%3A//www.microsofttranslator.com/%22%2C%0A%09%09%09action%3A%20%22http%3A//api.microsofttranslator.com/V2/Ajax.svc/Translate%3Ffrom%3D%2522%25%25LNGFROM%25%25%2522%22%20+%0A%09%09%09%09%22%26to%3D%2522%25%25LNGTO%25%25%2522%26loc%3Den%26ctr%3D%26text%3D%25%25SEL%25%25%22%2C%0A%09%09%09code%3A%20%22UTF-8%22%2C%0A%09%09%7D%2C%0A%0A%09%092%3A%20%7B%20//%20DO%20NOT%20EDIT%20THIS%20OBJECT%21%21%21%0A%09%09%09Label%3A%20%22Google%20Translator%22%2C%0A%09%09%09Image%3A%202%2C%0A%09%09%09method%3A%20%22POST%22%2C%0A%09%09%09Referer%3A%20%22https%3A//translate.google.com/%22%2C%0A%09%09%09action%3A%20%22https%3A//translate.google.com/%22%2C%0A%09%09%09post%3A%20%22client%3Dt%26hl%3Dauto%26sl%3D%25%25LNGFROM%25%25%26tl%3D%25%25LNGTO%25%25%26multires%3D1%26prev%3Dbtn%26ssel%3D0%26tsel%3D0%26sc%3D1%26text%3D%25%25SEL%25%25%22%2C%0A%09%09%09code%3A%20%22UTF-8%22%2C%0A%09%09%09xpath%3A%20%22.//span%5B@id%3D%5C%22result_box%5C%22%5D%7C.//div%5B@id%3D%5C%22result_box%5C%22%5D%22%2C%0A%09%09%7D%2C%0A%0A%09%093%3A%20%7B%20//%20DO%20NOT%20EDIT%20THIS%20OBJECT%21%21%21%0A%09%09%09Label%3A%20%22Yandex%20Translator%22%2C%0A%09%09%09Image%3A%203%2C%0A%09%09%09method%3A%20%22GET%22%2C%0A%09%09%09Referer%3A%20%22https%3A//translate.yandex.net/%22%2C%0A%09%09%09action%3A%20%22https%3A//translate.yandex.net/api/v1.5/tr.json/translate%3Fkey%3D%25%25API_KEY%25%25%26lang%3D%25%25LNGTO%25%25%26text%3D%25%25SEL%25%25%26options%3D1%22%2C%0A%09%09%09code%3A%20%22UTF-8%22%2C%0A%09%09%7D%2C%0A%0A%09%09/**%0A%09%09%20*%20%23%23%23%20How%20to%20create%20new%20engines%20for%20the%20popup%20translator.%20%23%23%23%0A%09%09%20*%0A%09%09%20*%20Objects%20must%20be%20named%20with%20a%20number.%20NEVER%20REPEAT%20A%20NUMBER%20AND%20NEVER%20USE%201%20%28one%29%2C%202%20%28two%29%20nor%203%20%28three%29%21%21%21%21%0A%09%09%20*%0A%09%09%20*%20Label%3A%20Menu%20item%20label.%0A%09%09%20*%20Image%3A%20It%20sets%20the%20image%20to%20be%20used%20by%20the%20menu%20button%20inside%20the%20popup%20translator%20and%20%2C%0A%09%09%20*%20%20%20%20%20%20%20%20if%20the%20option%20%22Tanslate%20on%20release%20-%20Show%20icon%22%20is%20enabled%2C%20it%20will%20show%20the%20image%20specified%20here.%0A%09%09%20*%20%20%20%20%20%20%20%20If%20no%20image%20is%20specified%2C%20it%20will%20set%20by%20default%20a%20%22generic%20image%22.%0A%09%09%20*%20%20%20%20%20%20%20%20It%20can%20be%20an%20URL%20to%20an%20image%2C%20a%20data%3A%20image%20or%20a%20number%20between%200%20to%203.%0A%09%09%20*%20%20%20%20%20%20%20%200%20%3D%20Generic%20image.%0A%09%09%20*%20%20%20%20%20%20%20%201%20%3D%20Bing%20translator%20image.%0A%09%09%20*%20%20%20%20%20%20%20%202%20%3D%20Google%20translator%20image.%0A%09%09%20*%20%20%20%20%20%20%20%203%20%3D%20Yandex%20trnaslator%20image.%0A%09%09%20*%20method%3A%20POST%20or%20GET.%0A%09%09%20*%20Referer%3A%20URL%20referrer.%0A%09%09%20*%20action%3A%20Destination%20URL%20%28Read%20note%20bellow%29.%0A%09%09%20*%20post%3A%20In%20the%20case%20of%20a%20POST%20postdata%20%28Read%20note%20bellow%29.%0A%09%09%20*%20code%3A%20Encoding%20method.%20Example%3A%20%22UTF-8%22%0A%09%09%20*%20xpath%3A%20Xpath%20expression%20entered%20to%20have%20HTML%20elements%20of%20the%20translation%20results.%0A%09%09%20*%20start%3A%20If%20you%20do%20not%20want%20to%20use%20xpath%2C%20a%20string%20of%20HTML%20document%20that%20immediately%0A%09%09%20*%20%20%20%20%20%20%20%20precedes%20the%20translation%20results%20%28regular%20expression%29%22.%0A%09%09%20*%20end%3A%20If%20you%20do%20not%20want%20to%20use%20the%20xpath%2C%20a%20string%20of%20HTML%20document%20that%20is%20immediately%0A%09%09%20*%20%20%20%20%20%20after%20the%20translation%20results%20%28regular%20expression%29.%0A%09%09%20*%0A%09%09%20*%20Note%3A%20Some%20placeholders%20can%20be%20used%20inside%20%22action%22%20and%20%22post%22%20%28No%20quotes%29%3A%0A%09%09%20*%20%22%25%25SEL%25%25%22%20%28Mandatory%29%3A%20Used%20to%20%22inject%22%20the%20current%20page%20selection%20into%20%22action%22%20and%20%22post%22%20setions.%0A%09%09%20*%20%22%25%25LNGTO%25%25%22%20and/or%20%22%25%25LNGFROM%25%25%22%20%28Optionals%29%3A%20Used%20to%20%22inject%22%20the%20language%20code%20to%20translate%20to/from.%0A%09%09%20*%20These%20language%20codes%20are%20configured%20from%20the%20language%20selection%20lists%20inside%20the%20popup%20translator.%0A%09%09%20*/%0A%0A%0A%09%09//%20%23%23%23%20Un-comment%20one%20or%20more%20of%20the%20elements%20bellow%20to%20display%20more%20translation%20engines.%20%23%23%23%0A%0A%09%09/*%0A%09%094%3A%7B%20//%20%23%23%23%20Example%20%23%23%23%0A%09%09%09Label%3A%20%22Google%20En%20To%20Ru%22%2C%0A%09%09%09Image%3A%20%22https%3A//translate.google.com/favicon.ico%22%2C%0A%09%09%09method%3A%20%22POST%22%2C%0A%09%09%09Referer%3A%20%22https%3A//translate.google.com/%3Ftab%3DyT%23en%22%2C%0A%09%09%09action%3A%20%22https%3A//translate.google.com/%22%2C%0A%09%09%09post%3A%20%22client%3Dt%26hl%3Den%26sl%3Den%26tl%3Dru%26multires%3D1%26prev%3Dbtn%26ssel%3D0%26tsel%3D0%26sc%3D1%26text%3D%25%25SEL%25%25%22%2C%0A%09%09%09code%3A%20%22UTF-8%22%2C%0A%09%09%09xpath%3A%20%22.//span%5B@id%3D%5C%22result_box%5C%22%5D%7C.//div%5B@id%3D%5C%22result_box%5C%22%5D%22%2C%0A%09%09%7D%2C%0A%09%09*/%0A%0A%09%09/*%0A%09%095%3A%20%7B%20//%20%23%23%23%20Example%20%23%23%23%0A%09%09%09Label%3A%20%22Google%20Ru%20To%20En%22%2C%0A%09%09%09Image%3A%20%22https%3A//translate.google.com/favicon.ico%22%2C%0A%09%09%09method%3A%20%22POST%22%2C%0A%09%09%09Referer%3A%20%22https%3A//translate.google.com/%3Ftab%3DyT%23ru%22%2C%0A%09%09%09action%3A%20%22https%3A//translate.google.com/%22%2C%0A%09%09%09post%3A%20%22client%3Dt%26hl%3Dru%26sl%3Dru%26tl%3Den%26multires%3D1%26prev%3Dbtn%26ssel%3D0%26tsel%3D0%26sc%3D1%26text%3D%25%25SEL%25%25%22%2C%0A%09%09%09code%3A%20%22UTF-8%22%2C%0A%09%09%09xpath%3A%20%22.//span%5B@id%3D%5C%22result_box%5C%22%5D%7C.//div%5B@id%3D%5C%22result_box%5C%22%5D%22%2C%0A%09%09%7D%2C%0A%09%09*/%0A%0A%09%09/*%0A%09%096%3A%20%7B%20//%20%23%23%23%20Example%20%23%23%23%0A%09%09%09Label%3A%20%22Weblio%20Translation%20English-Japanese%22%2C%0A%09%09%09Image%3A%20%22http%3A//www.westatic.com/img/favicon/ejje.ico%22%2C%0A%09%09%09method%3A%20%22POST%22%2C%0A%09%09%09Referer%3A%20%22http%3A//translate.weblio.jp/%22%2C%0A%09%09%09action%3A%20%22http%3A//translate.weblio.jp/%22%2C%0A%09%09%09post%3A%20%22lp%3DEJ%26lpf%3D%26rt%3D%26translatedText%3D%26tlt%3Denglish%26prtRt%3D%26originalText%3D%25%25SEL%25%25%26sentenceStyle%3Dspoken%22%2C%0A%09%09%09code%3A%20%22UTF-8%22%2C%0A%09%09%09xpath%3A%20id%28%5C%22translatedText%5C%22%29%2C%0A%09%09%7D%2C%0A%09%09*/%0A%0A%09%09/*%0A%09%097%3A%20%7B%20//%20%23%23%23%20Example%20%23%23%23%0A%09%09%09Label%3A%20%22Weblio%20Translation%20Japanese-English%22%2C%0A%09%09%09Image%3A%20%22http%3A//www.westatic.com/img/favicon/ejje.ico%22%2C%0A%09%09%09method%3A%20%22POST%22%2C%0A%09%09%09Referer%3A%20%22http%3A//translate.weblio.jp/%22%2C%0A%09%09%09action%3A%20%22http%3A//translate.weblio.jp/%22%2C%0A%09%09%09post%3A%20%22lp%3DJE%26lpf%3D%26rt%3D%26translatedText%3D%26tlt%3Denglish%26prtRt%3D%26originalText%3D%25%25SEL%25%25%26sentenceStyle%3Dspoken%22%2C%0A%09%09%09code%3A%20%22UTF-8%22%2C%0A%09%09%09xpath%3A%20%22id%28%22translatedText%22%29%22%2C%0A%09%09%7D%2C%0A%09%09*/%0A%0A%09%09/*%0A%09%098%3A%20%7B%20//%20%23%23%23%20Example%20%23%23%23%0A%09%09%09Label%3A%20%22@niftyTranslation%20English-Japanese%22%2C%0A%09%09%09Image%3A%20%22http%3A//honyaku.nifty.com/favicon.ico%22%2C%0A%09%09%09method%3A%20%22POST%22%2C%0A%09%09%09Referer%3A%20%22http%3A//honyaku.nifty.com/%22%2C%0A%09%09%09action%3A%20%22http%3A//honyaku-result.nifty.com/LUCNIFTY/text/text.php%22%2C%0A%09%09%09post%3A%20%22SLANG%3Den%26TLANG%3Dja%26XMODE%3D0%26SSRC%3D%25%25SEL%25%25%26txtDirection%3Denja%22%2C%0A%09%09%09code%3A%20%22UTF-8%22%2C%0A%09%09%09xpath%3A%20%22.//textarea%5B@id%3D%5C%22txtTransArea2%5C%22%5D%22%2C%0A%09%09%7D%2C%0A%09%09*/%0A%0A%09%09/*%0A%09%099%3A%20%7B%20//%20%23%23%23%20Example%20%23%23%23%0A%09%09%09Label%3A%20%22@niftyTranslation%20Japanese-English%22%2C%0A%09%09%09Image%3A%20%22http%3A//honyaku.nifty.com/favicon.ico%22%2C%0A%09%09%09method%3A%20%22POST%22%2C%0A%09%09%09Referer%3A%20%22http%3A//honyaku.nifty.com/%22%2C%0A%09%09%09action%3A%20%22http%3A//honyaku-result.nifty.com/LUCNIFTY/text/text.php%22%2C%0A%09%09%09post%3A%20%22SLANG%3Dja%26TLANG%3Den%26XMODE%3D0%26SSRC%3D%25%25SEL%25%25%26txtDirection%3Djaen%22%2C%0A%09%09%09code%3A%20%22UTF-8%22%2C%0A%09%09%09xpath%3A%20%22.//textarea%5B@id%3D%5C%22txtTransArea2%5C%22%5D%22%2C%0A%09%09%7D%2C%0A%09%09*/%0A%0A%09%7D%2C%0A%0A%09Init%3A%20function%28%29%20%7B%0A%09%09if%20%28%21%28%22Services%22%20in%20window%29%29%0A%09%09%09Cu.import%28%22resource%3A//gre/modules/Services.jsm%22%29%3B%0A%0A%09%09that.InitPrefs%28%29%3B%0A%0A%09%09if%20%28%21%28that._UID%20in%20window%29%29%20%7B%0A%09%09%09window%5Bthat._UID%5D%20%3D%20%7B%0A%09%09%09%09Listeners%3A%20false%2C%0A%09%09%09%09LastSelection%3A%20%22%22%2C%0A%09%09%09%09FrameScriptLoaded%3A%20false%2C%0A%09%09%09%09XULStyleSheet%3A%20false%2C%0A%09%09%09%09HTMLStyleSheet%3A%20false%2C%0A%09%09%09%7D%3B%0A%09%09%7D%0A%0A%09%09self.tooltipText%20%3D%20%22%22%3B%0A%09%09self.setAttribute%28%22tooltip%22%2C%20that._UID%20+%20%22_self_tooltip%22%29%3B%0A%09%09self.onclick%20%3D%20function%28aE%29%20%7B%0A%09%09%09switch%20%28aE.button%29%20%7B%0A%09%09%09%09case%200%3A%0A%09%09%09%09%09aE.preventDefault%28%29%3B%0A%09%09%09%09%09if%20%28that._zButtonClickActionLeft%20%21%3D%3D%200%20%26%26%20%21aE.shiftKey%20%26%26%20%21aE.ctrlKey%20%26%26%20%21aE.altKey%29%0A%09%09%09%09%09%09that._buttonClickActions%28that._zButtonClickActionLeft%2C%20aE%29%3B%0A%09%09%09%09%09else%20if%20%28that._zButtonClickActionLeftCtrl%20%21%3D%3D%200%20%26%26%20%21aE.shiftKey%20%26%26%20aE.ctrlKey%20%26%26%20%21aE.altKey%29%0A%09%09%09%09%09%09that._buttonClickActions%28that._zButtonClickActionLeftCtrl%2C%20aE%29%3B%0A%09%09%09%09%09else%20if%20%28that._zButtonClickActionLeftShift%20%21%3D%3D%200%20%26%26%20aE.shiftKey%20%26%26%20%21aE.ctrlKey%20%26%26%20%21aE.altKey%29%0A%09%09%09%09%09%09that._buttonClickActions%28that._zButtonClickActionLeftShift%2C%20aE%29%3B%0A%09%09%09%09%09else%20if%20%28that._zButtonClickActionLeftCtrlShift%20%21%3D%3D%200%20%26%26%20aE.shiftKey%20%26%26%20aE.ctrlKey%20%26%26%20%21aE.altKey%29%0A%09%09%09%09%09%09that._buttonClickActions%28that._zButtonClickActionLeftCtrlShift%2C%20aE%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%09case%201%3A%0A%09%09%09%09%09aE.preventDefault%28%29%3B%0A%09%09%09%09%09if%20%28that._zButtonClickActionMiddle%20%21%3D%3D%200%20%26%26%20%21aE.shiftKey%20%26%26%20%21aE.ctrlKey%20%26%26%20%21aE.altKey%29%0A%09%09%09%09%09%09that._buttonClickActions%28that._zButtonClickActionMiddle%2C%20aE%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%7D%0A%09%09%09aE.stopPropagation%28%29%3B%0A%09%09%7D%3B%0A%0A%09%09that._randomID%20%3D%20parseInt%28Math.random%28%29%20*%2010000%2C%2010%29%3B%0A%09%09window%5Bthat._UID%5D%5B%22RandomID%22%5D%20%3D%20that._randomID%3B%0A%0A%09%09if%20%28%21%28window%5Bthat._UID%5D%5B%22FrameScriptLoaded%22%5D%29%20%26%26%20that._isMultiProcess%29%20%7B%0A%09%09%09window%5Bthat._UID%5D%5B%22FrameScriptLoaded%22%5D%20%3D%20true%3B%0A%09%09%09that._frameScript%20%3D%20%22data%3Aapplication/javascript%2C%22%20+%20encodeURIComponent%28getHelp%28%22FrameScript%22%29%0A%09%09%09%09.replace%28/_Translate_Sel_ID_/g%2C%20that._translateSelMsgID%29%0A%09%09%09%09.replace%28/_On_Release_Icon_ID_/g%2C%20that._onReleaseIconMsgID%29%0A%09%09%09%09.replace%28/_Move_Popup_ID_/g%2C%20that._movePopupMsgID%29%0A%09%09%09%09.replace%28/_Middle_Click_ID_/g%2C%20that._middleClickMsgID%29%0A%09%09%09%09.replace%28/_Response_ID_/g%2C%20that._responseMsgID%20+%20that._randomID%29%29%3B%0A%09%09%09that._globalMM.loadFrameScript%28that._frameScript%2C%20true%29%3B%0A%09%09%09that._globalMM.addMessageListener%28that._responseMsgID%20+%20that._randomID%2C%20that._messageResponse%29%3B%0A%09%09%7D%0A%0A%09%09for%20%28let%20p%20in%20that.DefPrefs%29%20%7B%0A%09%09%09if%20%28that.DefPrefs.hasOwnProperty%28p%29%29%0A%09%09%09%09that%5B%22_%22%20+%20p%5D%20%3D%20that.gPref%28p%29%3B%0A%09%09%7D%0A%0A%09%09that.XULCSSLoader%28%29%3B%0A%09%09that.HTMLCSSLoader%28%29%3B%0A%09%09that.CreateElements%28true%29%3B%0A%09%09that.HandlePrefListener%28%29%3B%0A%09%09that.AddListeners%28%29%3B%0A%0A%09%09addDestructor%28function%28aReason%29%20%7B%0A%09%09%09if%20%28aReason%20%3D%3D%3D%20%22delete%22%20%7C%7C%20aReason%20%3D%3D%3D%20%22update%22%29%20%7B%0A%09%09%09%09that.UnInit%28%29%3B%0A%09%09%09%7D%0A%09%09%09if%20%28aReason%20%3D%3D%3D%20%22delete%22%29%20%7B%0A%09%09%09%09%28Services.prefs.getBranch%28that.Branch%29%29.deleteBranch%28%22%22%29%3B%0A%09%09%09%09Services.prefs.savePrefFile%28null%29%3B%0A%09%09%09%7D%0A%09%09%7D%29%3B%0A%0A%09%7D%2C%0A%0A%09PopulateSelfTooltip%3A%20function%28aNode%29%20%7B%0A%09%09aNode.textContent%20%3D%20%22%22%3B%0A%0A%09%09var%20grid%20%3D%20aNode.appendChild%28%24CNS%28%22grid%22%29%29%3B%0A%09%09var%20cols%20%3D%20grid.appendChild%28%24CNS%28%22columns%22%29%29%3B%0A%09%09cols.appendChild%28%24CNS%28%22column%22%2C%20%7B%0A%09%09%09flex%3A%202%0A%09%09%7D%29%29%3B%0A%09%09cols.appendChild%28%24CNS%28%22column%22%2C%20%7B%0A%09%09%09flex%3A%203%0A%09%09%7D%29%29%3B%0A%09%09cols.appendChild%28%24CNS%28%22column%22%2C%20%7B%0A%09%09%09flex%3A%201%0A%09%09%7D%29%29%3B%0A%09%09var%20rows%20%3D%20grid.appendChild%28%24CNS%28%22rows%22%29%29%3B%0A%09%09let%20AppendRow%20%3D%20function%28aRowsNode%2C%20aLabel1%2C%20aLabel2%2C%20aLabel3%2C%20aEmpty%29%20%7B%0A%09%09%09let%20row%20%3D%20%24CNS%28%22row%22%29%3B%0A%09%09%09if%20%28aEmpty%29%20%7B%0A%09%09%09%09row.appendChild%28%24CNS%28%22label%22%2C%20%7B%0A%09%09%09%09%09value%3A%20%22%20%22%2C%0A%09%09%09%09%09width%3A%200%2C%0A%09%09%09%09%7D%29%29%3B%0A%09%09%09%7D%20else%20%7B%0A%09%09%09%09row.appendChild%28%24CNS%28%22label%22%2C%20%7B%0A%09%09%09%09%09value%3A%20aLabel1%2C%0A%09%09%09%09%09style%3A%20%22font-weight%3A%20bold%3B%22%2C%0A%09%09%09%09%7D%29%29%3B%0A%09%09%09%09row.appendChild%28%24CNS%28%22label%22%2C%20%7B%0A%09%09%09%09%09value%3A%20aLabel2%2C%0A%09%09%09%09%09style%3A%20%22font-weight%3A%20bold%3B%22%2C%0A%09%09%09%09%7D%29%29%3B%0A%09%09%09%09let%20desc%20%3D%20%24CNS%28%22description%22%2C%20%7B%0A%09%09%09%09%09width%3A%20250%2C%0A%09%09%09%09%7D%29%3B%0A%09%09%09%09desc.textContent%20%3D%20aLabel3%3B%20//%20Use%20of%20%22textContent%22%20to%20achieve%20word%20wrap.%20%AC%AC%0A%09%09%09%09row.appendChild%28desc%29%3B%0A%09%09%09%7D%0A%09%09%09aRowsNode.appendChild%28row%29%3B%0A%09%09%7D%3B%0A%09%09let%20clickAction%20%3D%20function%28aAction%29%20%7B%0A%09%09%09switch%20%28aAction%29%20%7B%0A%09%09%09%09case%201%3A%0A%09%09%09%09%09return%20%22Open%20main%20menu%22%3B%0A%09%09%09%09case%202%3A%0A%09%09%09%09%09return%20%22Translate%20selection%22%3B%0A%09%09%09%09case%203%3A%0A%09%09%09%09%09return%20%22Translate%20current%20page%22%3B%0A%09%09%09%09case%204%3A%0A%09%09%09%09%09return%20%22Translate%20clipboard%20content%22%3B%0A%09%09%09%09case%205%3A%0A%09%09%09%09%09return%20%22Open%20page%20translation%20menu%22%3B%0A%09%09%09%7D%0A%09%09%7D%3B%0A%09%09AppendRow%28rows%2C%20self.name%2C%20%22%u2192%22%2C%20%22ID%20%3D%20%22%20+%20self.id.slice%2820%29%29%3B%0A%09%09AppendRow%28rows%2C%20null%2C%20null%2C%20null%2C%20true%29%3B%0A%09%09if%20%28that._zButtonClickActionLeft%20%21%3D%3D%200%29%0A%09%09%09AppendRow%28rows%2C%20%22Left%20click%22%2C%20%22%u2192%22%2C%20clickAction%28that._zButtonClickActionLeft%29%29%3B%0A%09%09if%20%28that._zButtonClickActionMiddle%20%21%3D%3D%200%29%0A%09%09%09AppendRow%28rows%2C%20%22Middle%20click%22%2C%20%22%u2192%22%2C%20clickAction%28that._zButtonClickActionMiddle%29%29%3B%0A%09%09if%20%28that._zButtonClickActionLeftCtrl%20%21%3D%3D%200%29%0A%09%09%09AppendRow%28rows%2C%20%22Ctrl%20+%20Left%20click%22%2C%20%22%u2192%22%2C%20clickAction%28that._zButtonClickActionLeftCtrl%29%29%3B%0A%09%09if%20%28that._zButtonClickActionLeftShift%20%21%3D%3D%200%29%0A%09%09%09AppendRow%28rows%2C%20%22Shift%20+%20Left%20click%22%2C%20%22%u2192%22%2C%20clickAction%28that._zButtonClickActionLeftShift%29%29%3B%0A%09%09if%20%28that._zButtonClickActionLeftCtrlShift%20%21%3D%3D%200%29%0A%09%09%09AppendRow%28rows%2C%20%22Ctrl%20+%20Shift%20+%20Left%20click%22%2C%20%22%u2192%22%2C%20clickAction%28that._zButtonClickActionLeftCtrlShift%29%29%3B%0A%09%09AppendRow%28rows%2C%20null%2C%20null%2C%20null%2C%20true%29%3B%0A%09%09let%20trigger%20%3D%20function%28%29%20%7B%0A%09%09%09if%20%28%21that._zTransOnRelease%29%0A%09%09%09%09return%20%22Middle%20click%20on%20page%20content%22%3B%0A%09%09%09else%20%7B%0A%09%09%09%09return%20%22Automatic%20after%20release%22%3B%0A%09%09%09%7D%0A%09%09%7D%3B%0A%09%09AppendRow%28rows%2C%20%22Trans.%20selection%20trigger%22%2C%20%22%u2192%22%2C%20trigger%28%29%29%3B%0A%09%09if%20%28that._zTransOnReleaseControlKey%20%26%26%20that._zTransOnRelease%29%0A%09%09%09AppendRow%28rows%2C%20%22%22%2C%20%22%22%2C%20%22Control%20key%20is%20required%22%29%3B%0A%09%09if%20%28that._zTransOnReleaseAltKey%20%26%26%20that._zTransOnRelease%29%0A%09%09%09AppendRow%28rows%2C%20%22%22%2C%20%22%22%2C%20%22Alt%20key%20is%20required%22%29%3B%0A%09%7D%2C%0A%0A%09_buttonClickActions%3A%20function%28aAction%2C%20aE%29%20%7B%0A%09%09switch%20%28aAction%29%20%7B%0A%09%09%09case%201%3A%20//%20Open%20Main%20Menu%0A%09%09%09%09let%20p%20%3D%20%24%28that._UID%20+%20%22_self_popup%22%29%3B%0A%09%09%09%09p%20%26%26%20p.openPopup%28self%2C%20%22after_start%22%2C%200%2C%200%2C%20false%2C%20null%2C%20null%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%202%3A%20//%20Translate%20selection%0A%09%09%09%09that.TranslateSelection%28%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%203%3A%20//%20Translate%20current%20page%0A%09%09%09%09that.TranslatePage%28aE%2C%20gBrowser.selectedTab.linkedBrowser.currentURI%2C%20false%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%204%3A%20//%20Translate%20clipboard%20content%0A%09%09%09%09that.TranslateClipboardContent%28%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%205%3A%20//%20Open%20Page%20translation%20menu%0A%09%09%09%09let%20m%20%3D%20%24%28that._UID%20+%20%22_translationIconOnURLBarMenu%22%29%3B%0A%09%09%09%09m%20%26%26%20m.openPopup%28self%2C%20%22after_start%22%2C%200%2C%200%2C%20false%2C%20null%2C%20null%29%3B%0A%09%09%09%09break%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09_messageResponse%3A%20%7B%0A%09%09receiveMessage%3A%20function%28aMsg%29%20%7B%0A%09%09%09if%20%28aMsg.name%20%21%3D%3D%20that._responseMsgID%20+%20that._randomID%29%0A%09%09%09%09return%3B%0A%09%09%09switch%20%28aMsg.data.id%29%20%7B%0A%09%09%09%09case%201%3A%20//%20Translate%20selection%20directly%0A%09%09%09%09case%202%3A%20//%20Translate%20selection%20from%20mouseover%20icon%0A%09%09%09%09%09//%20case%204%3A%20//%20Translate%20selection%20on%20middle%20click%20//%20Not%20in%20use%20for%20now.%20%AC%AC%0A%09%09%09%09%09that.doTranslation%28aMsg.data.sel%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%09case%203%3A%20//%20Move%20the%20popup%20to%20selection%0A%09%09%09%09%09let%20p%20%3D%20that.transPop%3B%0A%09%09%09%09%09%28p.state%20%3D%3D%3D%20%22open%22%29%20%26%26%20p.moveTo%28aMsg.data.posX%2C%20aMsg.data.posY%29%3B%0A%09%09%09%09%09p.openPopupAtScreen%28aMsg.data.posX%2C%20aMsg.data.posY%2C%20false%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%09%09//%20case%205%3A%20//%20Handle%20KeepItOpen%20//%20Not%20in%20use%20for%20now.%20%AC%AC%0A%09%09%09%09%09//%20%09if%20%28%21that._zPopTransKeepItOpen%29%0A%09%09%09%09%09//%20%09%09that.HidePanel%28%29%3B%0A%09%09%09%09%09//%20%09break%3B%0A%09%09%09%7D%0A%09%09%7D%2C%0A%09%7D%2C%0A%0A%09UnInit%3A%20function%28%29%20%7B%0A%09%09that.HandlePrefListener%28true%29%3B%0A%09%09//%20A%20half-working%20nightmare%21%21%21%20%AC%AC%0A%09%09//%20Frame%20scripts%20are%20not%20unloaded.%0A%09%09if%20%28that._isMultiProcess%29%20%7B%0A%09%09%09window%5Bthat._UID%5D%5B%22FrameScriptLoaded%22%5D%20%3D%20false%3B%0A%09%09%09that._globalMM.removeDelayedFrameScript%28that._frameScript%29%3B%0A%09%09%09that._globalMM.removeMessageListener%28that._responseMsgID%20+%20window%5Bthat._UID%5D%5B%22RandomID%22%5D%2C%20that._messageResponse%29%3B%0A%09%09%7D%0A%09%09if%20%28that.timer%29%0A%09%09%09clearTimeout%28that.timer%29%3B%0A%09%09that.RemoveListeners%28%29%3B%0A%09%09let%20selfEls%20%3D%20document.getElementsByAttribute%28%22cb_id%22%2C%20that._UID%29%3B%0A%09%09Array.prototype.slice.call%28selfEls%29.forEach%28function%28aEl%29%20%7B%20//%20Delete%20all%20elements%20created%20by%20this%20button.%0A%09%09%09aEl%20%26%26%20aEl.parentNode.removeChild%28aEl%29%3B%0A%09%09%7D%29%3B%0A%09%7D%2C%0A%0A%09AddListeners%3A%20function%28%29%20%7B%0A%09%09let%20tOnRel%20%3D%20that.gPref%28%22zTransOnRelease%22%29%3B%0A%09%09if%20%28%21window%5Bthat._UID%5D%5B%22Listeners%22%5D%29%20%7B%0A%09%09%09let%20onRelease%20%3D%20tOnRel%3B%0A%09%09%09let%20ltns%20%3D%20onRelease%20%3F%20%22OnReleaseListener%22%20%3A%20%22MiddleClickListener%22%3B%0A%09%09%09//%20window.addEventListener%28%22unload%22%2C%20that%5Bltns%5D%2C%20false%29%3B%0A%09%09%09%5B%22click%22%2C%20%22mousedown%22%2C%20%22mouseup%22%5D.forEach%28function%28aLi%29%20%7B%0A%09%09%09%09if%20%28%22gBrowser%22%20in%20window%29%20%7B%0A%09%09%09%09%09gBrowser.addEventListener%28aLi%2C%20that%5Bltns%5D%2C%20true%29%3B%0A%09%09%09%09%7D%20else%20if%20%28%24%28%22tabpanelcontainer%22%29%29%20%7B%20//%20Thunderbird%20main%20window%0A%09%09%09%09%09%24%28%22tabpanelcontainer%22%29.addEventListener%28aLi%2C%20that%5Bltns%5D%2C%20true%29%3B%0A%09%09%09%09%7D%20else%20if%20%28%24%28%22messagepane%22%29%29%20%7B%20//%20Message%20window%0A%09%09%09%09%09%24%28%22messagepanebox%22%29.addEventListener%28aLi%2C%20that%5Bltns%5D%2C%20true%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%29%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09//%20aInverse%20argument%20is%20for%20when%20RemoveListeners%20is%20called%20from%20PrefListener%20%28After%20the%20zTransOnRelease%20pref.%20is%20changed.%29.%0A%09RemoveListeners%3A%20function%28aInverse%29%20%7B%0A%09%09let%20tOnRel%20%3D%20that.gPref%28%22zTransOnRelease%22%29%3B%0A%09%09let%20onRelease%20%3D%20aInverse%20%3F%20%21tOnRel%20%3A%20tOnRel%3B%0A%09%09let%20ltns%20%3D%20onRelease%20%3F%20%22OnReleaseListener%22%20%3A%20%22MiddleClickListener%22%3B%0A%09%09//%20window.removeEventListener%28%22unload%22%2C%20that%5Bltns%5D%2C%20false%29%3B%0A%09%09%5B%22click%22%2C%20%22mousedown%22%2C%20%22mouseup%22%5D.forEach%28function%28aLi%29%20%7B%0A%09%09%09if%20%28%22gBrowser%22%20in%20window%29%20%7B%0A%09%09%09%09gBrowser.removeEventListener%28aLi%2C%20that%5Bltns%5D%2C%20true%29%3B%0A%09%09%09%7D%20else%20if%20%28%24%28%22tabpanelcontainer%22%29%29%20%7B%20//%20Thunderbird%20main%20window%0A%09%09%09%09%24%28%22tabpanelcontainer%22%29.removeEventListener%28aLi%2C%20that%5Bltns%5D%2C%20true%29%3B%0A%09%09%09%7D%20else%20if%20%28%24%28%22messagepane%22%29%29%20%7B%20//%20Message%20window%0A%09%09%09%09%24%28%22messagepanebox%22%29.removeEventListener%28aLi%2C%20that%5Bltns%5D%2C%20true%29%3B%0A%09%09%09%7D%0A%09%09%7D%29%3B%0A%09%09let%20ctxM%20%3D%20%24%28%22contentAreaContextMenu%22%29%20%7C%7C%20%24%28%22mailContext%22%29%3B%0A%09%09ctxM.removeEventListener%28%22popupshowing%22%2C%20that.ContextMenuListener%2C%20false%29%3B%0A%09%09window%5Bthat._UID%5D%5B%22Listeners%22%5D%20%3D%20false%3B%0A%09%7D%2C%0A%0A%09AssignImages%3A%20function%28aNode%29%20%7B%0A%09%09Array.prototype.slice.call%28aNode.getElementsByAttribute%28%22_pop_eng%22%2C%20%22*%22%29%29.forEach%28function%28aMI%29%20%7B%0A%09%09%09aMI%20%26%26%20aMI.setAttribute%28%22image%22%2C%20that.getEng%28%22image%22%2C%20aMI.getAttribute%28%22_pop_eng%22%29%20%3D%3D%20%22true%22%29%29%3B%0A%09%09%7D%29%3B%0A%09%7D%2C%0A%0A%09CreateElements%3A%20function%28aInit%29%20%7B%0A%09%09var%20mPop%20%3D%20%24%28%22mainPopupSet%22%29%3B%0A%09%09let%20selfPop%20%3D%20%24%28that._UID%20+%20%22_self_popup%22%29%3B%0A%09%09if%20%28mPop%20%26%26%20%21selfPop%29%20%7B%0A%09%09%09selfPop%20%3D%20mPop.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09%09id%3A%20that._UID%20+%20%22_self_popup%22%2C%0A%09%09%09%09cb_id%3A%20that._UID%2C%0A%09%09%09%09orient%3A%20%22vertical%22%2C%0A%09%09%09%09onpopupshowing%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%20%22%27%29%22%20+%20%22.MultiTranslator.AssignImages%28this%29%3Bevent.stopPropagation%28%29%3B%22%2C%0A%09%09%09%09onpopuphidden%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%09onclick%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%09selfPop.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09label%3A%20%22Translate%20selection%22%2C%0A%09%09%09%09class%3A%20%22menuitem-iconic%22%2C%0A%09%09%09%09_pop_eng%3A%20true%2C%0A%09%09%09%09key%3A%20that._zUseTransSelHotkey%20%3F%20%22key%22%20+%20that._UID%20+%20%22_translate_selection%22%20%3A%20%22%22%2C%0A%09%09%09%09onclick%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%20%22%27%29%22%20+%20%22.MultiTranslator.TranslateSelection%28%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%09selfPop.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09label%3A%20%22Translate%20current%20page%22%2C%0A%09%09%09%09class%3A%20%22menuitem-iconic%22%2C%0A%09%09%09%09_pop_eng%3A%20false%2C%0A%09%09%09%09key%3A%20that._zUseTransPageHotkey%20%3F%20%22key%22%20+%20that._UID%20+%20%22_translate_page%22%20%3A%20%22%22%2C%0A%09%09%09%09onclick%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%20%22%27%29%22%20+%20%22.MultiTranslator.TranslatePage%28event%2C%20gBrowser.selectedTab.linkedBrowser.currentURI%2C%20true%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%09selfPop.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09label%3A%20%22Translate%20clipboard%20content%22%2C%0A%09%09%09%09class%3A%20%22menuitem-iconic%22%2C%0A%09%09%09%09_pop_eng%3A%20true%2C%0A%09%09%09%09key%3A%20that._zUseTransClipHotkey%20%3F%20%22key%22%20+%20that._UID%20+%20%22_translate_clipboard%22%20%3A%20%22%22%2C%0A%09%09%09%09onclick%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%20%22%27%29%22%20+%20%22.MultiTranslator.TranslateClipboardContent%28%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%09selfPop.appendChild%28%24CNS%28%22menuseparator%22%29%29%3B%0A%09%09%09selfPop.appendChild%28%24CNS%28%22menu%22%2C%20%7B%0A%09%09%09%09label%3A%20%22Options%22%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%22%27%29.MultiTranslator.PopulateOptionsPopup%28this%29%22%2C%0A%09%09%09%09menugenerated%3A%20true%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%7D%0A%0A%09%09let%20selfTT%20%3D%20%24%28that._UID%20+%20%22_self_tooltip%22%29%3B%0A%09%09if%20%28mPop%20%26%26%20%21selfTT%29%20%7B%0A%09%09%09mPop.appendChild%28%24CNS%28%22tooltip%22%2C%20%7B%0A%09%09%09%09id%3A%20that._UID%20+%20%22_self_tooltip%22%2C%0A%09%09%09%09cb_id%3A%20that._UID%2C%0A%09%09%09%09orient%3A%20%22vertical%22%2C%0A%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%22%27%29.MultiTranslator.PopulateSelfTooltip%28this%29%22%2C%0A%09%09%09%09onpopuphidden%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%7D%0A%0A%09%09if%20%28that._zShowContextMenuItems%29%20%7B%0A%09%09%09let%20ctxM%20%3D%20%24%28%22contentAreaContextMenu%22%29%20%7C%7C%20%24%28%22mailContext%22%29%3B%0A%09%09%09let%20ctxTSelMI%20%3D%20%24%28that._UID%20+%20%22_translate_selection_context%22%29%3B%0A%09%09%09let%20ctxTPageMI%20%3D%20%24%28that._UID%20+%20%22_translate_page_context%22%29%3B%0A%09%09%09let%20ctxTPageM%20%3D%20%24%28that._UID%20+%20%22_translate_page_menu_context%22%29%3B%0A%09%09%09let%20ctxTClipMI%20%3D%20%24%28that._UID%20+%20%22_translate_clipboard_context%22%29%3B%0A%09%09%09let%20insertPoint%20%3D%20%24%28%22mailContext-spell-suggestions-separator%22%29%20%7C%7C%20%24%28%22spell-suggestions-separator%22%29%3B%0A%09%09%09if%20%28ctxM%20%26%26%20%21ctxTSelMI%29%20%7B%0A%09%09%09%09ctxTSelMI%20%3D%20%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09label%3A%20%22Translate%20selection%22%2C%0A%09%09%09%09%09cb_id%3A%20that._UID%2C%0A%09%09%09%09%09id%3A%20that._UID%20+%20%22_translate_selection_context%22%2C%0A%09%09%09%09%09class%3A%20%22menuitem-iconic%22%2C%0A%09%09%09%09%09image%3A%20that.getEng%28%22image%22%2C%20true%29%2C%0A%09%09%09%09%09key%3A%20that._zUseTransSelHotkey%20%3F%20%22key%22%20+%20that._UID%20+%20%22_translate_selection%22%20%3A%20%22%22%2C%0A%09%09%09%09%09onclick%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%20%22%27%29%22%20+%20%22.MultiTranslator.TranslateSelection%28%29%3B%22%2C%0A%09%09%09%09%7D%29%3B%0A%09%09%09%09ctxM.insertBefore%28ctxTSelMI%2C%20insertPoint.nextSibling%29%3B%0A%09%09%09%09ctxM.addEventListener%28%22popupshowing%22%2C%20that.ContextMenuListener%2C%20false%29%3B%0A%09%09%09%7D%0A%0A%09%09%09if%20%28%21that._zPageTransURLBarIconMenuMode%20%26%26%20ctxM%20%26%26%20%21ctxTPageMI%29%20%7B%0A%09%09%09%09ctxTPageMI%20%3D%20%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09label%3A%20%22Translate%20current%20page%22%2C%0A%09%09%09%09%09cb_id%3A%20that._UID%2C%0A%09%09%09%09%09id%3A%20that._UID%20+%20%22_translate_page_context%22%2C%0A%09%09%09%09%09class%3A%20%22menuitem-iconic%22%2C%0A%09%09%09%09%09image%3A%20that.getEng%28%22image%22%2C%20false%29%2C%0A%09%09%09%09%09key%3A%20that._zUseTransPageHotkey%20%3F%20%22key%22%20+%20that._UID%20+%20%22_translate_page%22%20%3A%20%22%22%2C%0A%09%09%09%09%09onclick%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%20%22%27%29%22%20+%20%22.MultiTranslator.TranslatePage%28event%2C%20gBrowser.selectedTab.linkedBrowser.currentURI%2C%20true%29%3B%22%2C%0A%09%09%09%09%7D%29%3B%0A%09%09%09%09ctxM.insertBefore%28ctxTPageMI%2C%20insertPoint.nextSibling%29%3B%0A%09%09%09%7D%20else%20if%20%28that._zPageTransURLBarIconMenuMode%20%26%26%20ctxM%20%26%26%20%21ctxTPageM%29%20%7B%0A%09%09%09%09ctxTPageM%20%3D%20%24CNS%28%22menu%22%2C%20%7B%0A%09%09%09%09%09label%3A%20%22Translate%20current%20page%22%2C%0A%09%09%09%09%09cb_id%3A%20that._UID%2C%0A%09%09%09%09%09id%3A%20that._UID%20+%20%22_translate_page_menu_context%22%2C%0A%09%09%09%09%09class%3A%20%22menu-iconic%22%2C%0A%09%09%09%09%09image%3A%20that.Images%5B0%5D%2C%0A%09%09%09%09%7D%29%3B%0A%09%09%09%09ctxTPageM.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%22%27%29.MultiTranslator.PopulateTranslatePageMenu%28this%29%3B%22%2C%0A%09%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%09%09onclick%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%22%27%29.MultiTranslator.TranslatePage%28event%2C%20gBrowser.selectedTab.linkedBrowser.currentURI%2C%20null%2C%20true%29%3B%22%2C%0A%09%09%09%09%09menugenerated%3A%20true%2C%0A%09%09%09%09%7D%29%29%3B%0A%09%09%09%09ctxM.insertBefore%28ctxTPageM%2C%20insertPoint.nextSibling%29%3B%0A%09%09%09%7D%0A%0A%09%09%09if%20%28ctxM%20%26%26%20%21ctxTClipMI%29%20%7B%0A%09%09%09%09ctxTClipMI%20%3D%20%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09label%3A%20%22Translate%20clipboard%20content%22%2C%0A%09%09%09%09%09cb_id%3A%20that._UID%2C%0A%09%09%09%09%09id%3A%20that._UID%20+%20%22_translate_clipboard_context%22%2C%0A%09%09%09%09%09class%3A%20%22menuitem-iconic%22%2C%0A%09%09%09%09%09image%3A%20that.getEng%28%22image%22%2C%20true%29%2C%0A%09%09%09%09%09key%3A%20that._zUseTransClipHotkey%20%3F%20%22key%22%20+%20that._UID%20+%20%22_translate_clipboard%22%20%3A%20%22%22%2C%0A%09%09%09%09%09onclick%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%20%22%27%29%22%20+%20%22.MultiTranslator.TranslateClipboardContent%28%29%3B%22%2C%0A%09%09%09%09%7D%29%3B%0A%09%09%09%09ctxM.insertBefore%28ctxTClipMI%2C%20insertPoint.nextSibling%29%3B%0A%09%09%09%7D%0A%09%09%7D%0A%0A%09%09let%20transPop%20%3D%20that.transPop%3B%0A%09%09if%20%28%21transPop%29%20%7B%0A%09%09%09transPop%20%3D%20getHelp%28%22MainPanel%22%29%3B%0A%09%09%09transPop%20%3D%20transPop.replace%28/_U_I_D_/g%2C%20that._UID%29%0A%09%09%09%09.replace%28/_L_A_B_E_L_/g%2C%20that.getEng%28%22label%22%2C%20true%29%29%0A%09%09%09%09.replace%28/_I_M_A_G_E_/g%2C%20that.getEng%28%22image%22%2C%20true%29%29%0A%09%09%09%09.replace%28/_S_E_L_F_I_D_/g%2C%20self.id%29%3B%0A%09%09%09transPop%20%3D%20parseXML%28transPop%29%3B%0A%09%09%09transPop.setAttribute%28%22close%22%2C%20that._zPopTransShowTitleBar%29%3B%0A%09%09%09that._zPopTransShowTitleBar%20%26%26%20transPop.setAttribute%28%22titlebar%22%2C%20%22normal%22%29%3B%0A%09%09%09mPop.appendChild%28transPop%29%3B%0A%09%09%7D%0A%0A%09%09let%20m%20%3D%20%24%28that._UID%20+%20%22_translationOptionsMenu%22%29%3B%0A%09%09if%20%28mPop%20%26%26%20%21m%29%20%7B%0A%09%09%09mPop.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09%09id%3A%20that._UID%20+%20%22_translation_options%22%2C%0A%09%09%09%09cb_id%3A%20that._UID%2C%0A%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%22%27%29.MultiTranslator.PopulateOptionsPopup%28this%29%22%2C%0A%09%09%09%09menugenerated%3A%20true%2C%0A%09%09%09%09position%3A%20%22after_start%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%7D%0A%09%09if%20%28that._zPageTransURLBarIconShow%29%20%7B%0A%09%09%09let%20URLBar%20%3D%20%24%28%22urlbar-icons%22%29%3B%0A%09%09%09if%20%28URLBar%20%26%26%20%21%24%28that._UID%20+%20%22_translationIconOnURLBar%22%29%29%20%7B%0A%09%09%09%09URLBar.appendChild%28%24CNS%28%22image%22%2C%20%7B%0A%09%09%09%09%09id%3A%20that._UID%20+%20%22_translationIconOnURLBar%22%2C%0A%09%09%09%09%09tooltip%3A%20that._UID%20+%20%22_translationIconOnURLBarTooltip%22%2C%0A%09%09%09%09%09cb_id%3A%20that._UID%2C%0A%09%09%09%09%09class%3A%20%22urlbar-icon%22%2C%0A%09%09%09%09%09context%3A%20that._UID%20+%20%22_translation_options%22%2C%0A%09%09%09%09%09src%3A%20that.getEng%28%22image%22%29%2C%0A%09%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%09%09onclick%3A%20that._zPageTransURLBarIconMenuMode%20%3F%20%22if%20%28event.button%20%3D%3D%3D%200%29%20document.getElementById%28%27%22%20+%20that._UID%20+%0A%09%09%09%09%09%09%22_translationIconOnURLBarMenu%27%29.openPopup%28this%2C%20%27%27%2C%200%2C%200%2C%20false%2C%20null%2C%20null%29%3B%22%20%3A%20%22document.getElementById%28%27%22%20+%0A%09%09%09%09%09%09self.id%20+%20%22%27%29.MultiTranslator.TranslatePage%28event%2C%20gBrowser.selectedTab.linkedBrowser.currentURI%29%3B%22%2C%0A%09%09%09%09%7D%29%29%3B%0A%09%09%09%09if%20%28%21%24%28that._UID%20+%20%22_translationIconOnURLBarTooltip%22%29%29%0A%09%09%09%09%09mPop.appendChild%28%24CNS%28%22tooltip%22%2C%20%7B%0A%09%09%09%09%09%09id%3A%20that._UID%20+%20%22_translationIconOnURLBarTooltip%22%2C%0A%09%09%09%09%09%09cb_id%3A%20that._UID%2C%0A%09%09%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%09%22%27%29.MultiTranslator.updateIconOnURLBarTooltip%28this%29%22%2C%0A%09%09%09%09%09%09menugenerated%3A%20true%2C%0A%09%09%09%09%09%7D%29%29%3B%0A%09%09%09%7D%0A%0A%09%09%09if%20%28that._zPageTransURLBarIconMenuMode%29%20%7B%0A%09%09%09%09if%20%28mPop%20%26%26%20%21%24%28that._UID%20+%20%22_translationIconOnURLBarMenu%22%29%29%20%7B%0A%09%09%09%09%09let%20urlMenu%20%3D%20mPop.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09%09%09%09id%3A%20that._UID%20+%20%22_translationIconOnURLBarMenu%22%2C%0A%09%09%09%09%09%09orient%3A%20%22vertical%22%2C%0A%09%09%09%09%09%09menugenerated%3A%20true%2C%0A%09%09%09%09%09%09cb_id%3A%20that._UID%2C%0A%09%09%09%09%09%09position%3A%20%22after_start%22%2C%0A%09%09%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%09%22%27%29.MultiTranslator.PopulateTranslatePageMenu%28this%29%3B%22%2C%0A%09%09%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%09%09%09onclick%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%09%22%27%29.MultiTranslator.TranslatePage%28event%2C%20gBrowser.selectedTab.linkedBrowser.currentURI%2C%20null%2C%20true%29%3B%22%2C%0A%09%09%09%09%09%7D%29%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%7D%0A%0A%09%09if%20%28aInit%29%20%7B%0A%09%09%09that.PopulateLangLists%28%29%3B%0A%09%09%09that.HandleHotkey%28%29%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09ContextMenuListener%3A%20function%28%29%20%7B%0A%09%09let%20mI%20%3D%20%24%28that._UID%20+%20%22_translate_selection_context%22%29%3B%0A%09%09mI.hidden%20%3D%20%21%28gContextMenu.isTextSelected%29%3B%0A%09%09mI.image%20%3D%20that.getEng%28%22image%22%2C%20true%29%3B%0A%09%09that._zPageTransURLBarIconMenuMode%20%7C%7C%20%28%24%28that._UID%20+%20%22_translate_page_context%22%29.image%20%3D%20that.getEng%28%22image%22%2C%20false%29%29%3B%0A%09%09%24%28that._UID%20+%20%22_translate_clipboard_context%22%29.image%20%3D%20that.getEng%28%22image%22%2C%20true%29%3B%0A%09%7D%2C%0A%0A%09PopulateTranslatePageMenu%3A%20function%28aNode%29%20%7B%0A%09%09aNode.textContent%20%3D%20%22%22%3B%0A%0A%09%09let%20URLBEng%20%3D%20that.URLBarEngines%3B%0A%09%09for%20%28let%20book%20in%20URLBEng%29%20%7B%0A%09%09%09if%20%28URLBEng.hasOwnProperty%28book%29%29%20%7B%0A%09%09%09%09if%20%28%21%21URLBEng%5Bbook%5D.Label%20%26%26%20%21%21URLBEng%5Bbook%5D.Command%29%20%7B%0A%09%09%09%09%09let%20img%20%3D%20function%28aKey%29%20%7B%0A%09%09%09%09%09%09if%20%28typeof%20URLBEng%5BaKey%5D.Image%20%3D%3D%3D%20%22number%22%29%0A%09%09%09%09%09%09%09return%20that.Images%5BURLBEng%5BaKey%5D.Image%5D%3B%0A%09%09%09%09%09%09return%20URLBEng%5BaKey%5D.Image%3B%0A%09%09%09%09%09%7D%3B%0A%09%09%09%09%09aNode.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09%09label%3A%20URLBEng%5Bbook%5D.Label%2C%0A%09%09%09%09%09%09class%3A%20%22menuitem-iconic%22%2C%0A%09%09%09%09%09%09tooltiptext%3A%20%21%21URLBEng%5Bbook%5D.Tooltip%20%3F%20URLBEng%5Bbook%5D.Tooltip%20%3A%20%22%22%2C%0A%09%09%09%09%09%09image%3A%20img%28parseInt%28book%2C%2010%29%29%20%7C%7C%20%22%22%2C%0A%09%09%09%09%09%09value%3A%20parseInt%28book%2C%2010%29%2C%0A%09%09%09%09%09%7D%29%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%2C%0A%0A%09HandleHotkey%3A%20function%28%29%20%7B%0A%09%09let%20key1%20%3D%20%22key%22%20+%20that._UID%20+%20%22_translate_selection%22%2C%0A%09%09%09key2%20%3D%20%22key%22%20+%20that._UID%20+%20%22_translate_page%22%2C%0A%09%09%09key3%20%3D%20%22key%22%20+%20that._UID%20+%20%22_translate_clipboard%22%2C%0A%09%09%09keySet%20%3D%20%24%28%22mailKeys%22%29%20%7C%7C%20%24%28%22mainKeyset%22%29%2C%0A%09%09%09usekey1%20%3D%20that._zUseTransSelHotkey%2C%0A%09%09%09usekey2%20%3D%20that._zUseTransPageHotkey%2C%0A%09%09%09usekey3%20%3D%20that._zUseTransClipHotkey%3B%0A%09%09let%20key1el%20%3D%20%24%28key1%29%2C%0A%09%09%09key2el%20%3D%20%24%28key2%29%2C%0A%09%09%09key3el%20%3D%20%24%28key3%29%3B%0A%0A%09%09if%20%28%21key1el%29%20%7B%0A%09%09%09keySet.appendChild%28%24CNS%28%22key%22%2C%20%7B%0A%09%09%09%09id%3A%20key1%2C%0A%09%09%09%09key%3A%20that._HotkeyTransSelKey%2C%0A%09%09%09%09modifiers%3A%20that._HotkeyTransSelModifiers%2C%0A%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%20%22%27%29%22%20+%20%22.MultiTranslator.TranslateSelection%28%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%7D%0A%09%09if%20%28%22gBrowser%22%20in%20window%20%26%26%20%21key2el%29%20%7B%0A%09%09%09keySet.appendChild%28%24CNS%28%22key%22%2C%20%7B%0A%09%09%09%09id%3A%20key2%2C%0A%09%09%09%09key%3A%20that._HotkeyTransPageKey%2C%0A%09%09%09%09modifiers%3A%20that._HotkeyTransPageModifiers%2C%0A%09%09%09%09oncommand%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%20%22%27%29%22%20+%0A%09%09%09%09%09%22.MultiTranslator.TranslatePage%28event%2C%20gBrowser.selectedTab.linkedBrowser.currentURI%2C%20true%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%7D%0A%09%09if%20%28%21key3el%29%20%7B%0A%09%09%09keySet.appendChild%28%24CNS%28%22key%22%2C%20%7B%0A%09%09%09%09id%3A%20key3%2C%0A%09%09%09%09key%3A%20that._HotkeyTransClipKey%2C%0A%09%09%09%09modifiers%3A%20that._HotkeyTransClipModifiers%2C%0A%09%09%09%09oncommand%3A%20%22document.getElementById%28%27%22%20+%20self.id%20+%20%22%27%29%22%20+%0A%09%09%09%09%09%22.MultiTranslator.TranslateClipboardContent%28%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%7D%0A%09%09key1el%20%26%26%20key1el.setAttribute%28%22disabled%22%2C%20%21usekey1%29%3B%0A%09%09key2el%20%26%26%20key2el.setAttribute%28%22disabled%22%2C%20%21usekey2%29%3B%0A%09%09key3el%20%26%26%20key3el.setAttribute%28%22disabled%22%2C%20%21usekey3%29%3B%0A%09%7D%2C%0A%0A%09TranslatePage%3A%20function%28aE%2C%20aURI%2C%20aHotKey%2C%20aFromURLMenu%29%20%7B%0A%09%09aE.preventDefault%28%29%3B%0A%09%09if%20%28%21aURI.schemeIs%28%22http%22%29%20%26%26%20%21aURI.schemeIs%28%22https%22%29%29%0A%09%09%09return%20false%3B%0A%0A%09%09let%20btn%20%3D%20aE.button%3B%0A%09%09if%20%28btn%20%3D%3D%3D%202%29%0A%09%09%09return%3B%0A%09%09if%20%28btn%20%3D%3D%3D%200%20%7C%7C%20aHotKey%29%20//%20Left%20click%20and%20Hotkey%20triggers%20the%20same%20action.%0A%09%09%09that.OpenURLIn%28that._zPageTransURLBarIconLeftClick%2C%20aURI.spec%2C%20aE.target.value%29%3B%0A%09%09else%20if%20%28btn%20%3D%3D%3D%201%29%0A%09%09%09that.OpenURLIn%28that._zPageTransURLBarIconMiddleClick%2C%20aURI.spec%29%3B%0A%09%09aE.stopPropagation%28%29%3B%0A%09%7D%2C%0A%0A%09OpenURLIn%3A%20function%28aWhere%2C%20aURL%2C%20aFromURLMenu%29%20%7B%0A%09%09var%20engine%20%3D%20aFromURLMenu%20%3F%20aFromURLMenu%20%3A%20that._zPageTransEngine%3B%0A%09%09var%20urlForNewTab%20%3D%20%28/%5Ejavascript%3A/.test%28that.URLBarEngines%5Bengine%5D.Command%29%29%20%3F%20aURL%20%3A%20%22about%3Ablank%22%3B%0A%09%09if%20%28aWhere%20%21%3D%3D%201%29%20%7B%0A%09%09%09window.addEventListener%28%22DOMContentLoaded%22%2C%20function%20_%28aE%29%20%7B%0A%09%09%09%09window.removeEventListener%28%22DOMContentLoaded%22%2C%20_%2C%20true%29%3B%0A%09%09%09%09that.DoPageTranslation%28engine%2C%20aURL%2C%20aE.target%29%3B%0A%09%09%09%7D%2C%20true%29%3B%0A%09%09%7D%0A%09%09switch%20%28aWhere%29%20%7B%0A%09%09%09case%201%3A%20//%20Current%0A%09%09%09%09that.DoPageTranslation%28engine%2C%20aURL%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%202%3A%20//%20Next%20to%20current%0A%09%09%09%09let%20pos%20%3D%20gBrowser.selectedTab._tPos%20%7C%7C%20gBrowser.tabContainer.selectedIndex%3B%20//%20Firefox%20%7C%7C%20SeaMonkey%0A%09%09%09%09gBrowser.moveTabTo%28gBrowser.selectedTab%20%3D%20gBrowser.addTab%28urlForNewTab%29%2C%20pos%20+%201%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%203%3A%20//%20New%20tab%20in%20background%0A%09%09%09%09gBrowser.addTab%28urlForNewTab%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%204%3A%20//%20New%20tab%20in%20foreground%0A%09%09%09%09gBrowser.selectedTab%20%3D%20gBrowser.addTab%28urlForNewTab%29%3B%0A%09%09%09%09break%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09DoPageTranslation%3A%20function%28aEngine%2C%20aURL%2C%20aETarget%29%20%7B%0A%09%09var%20lFrom%20%3D%20that._zPageTransFromLang%2C%0A%09%09%09lTo%20%3D%20that._zPageTransToLang%2C%0A%09%09%09cLoc%20%3D%20%21%21aETarget%20%3F%20aETarget%20%3A%20content.document%3B%0A%09%09var%20bookCmd%20%3D%20that.URLBarEngines%5BaEngine%5D.Command%3B%0A%09%09bookCmd%20%3D%20bookCmd.replace%28/%25%25LNGTO%25%25/g%2C%20lTo.toString%28%29%29%0A%09%09%09.replace%28/%25%25LNGFROM%25%25/g%2C%20%28%28lFrom%20%3D%3D%3D%20%22%22%20%26%26%20aEngine%20%3D%3D%3D%202%29%20%3F%20%22auto%22%20%3A%20lFrom.toString%28%29%29%29%0A%09%09%09.replace%28/%25%25URL%25%25/g%2C%20encodeURIComponent%28aURL%29%29%3B%0A%09%09setTimeout%28function%28%29%20%7B%0A%09%09%09loadURI%28bookCmd%29%3B%0A%09%09%7D%2C%20100%29%3B%0A%09%7D%2C%0A%0A%09PopulateLangLists%3A%20function%28aE%29%20%7B%0A%09%09let%20mLPops%20%3D%20%7B%0A%09%09%09to%3A%20that._UID%20+%20%22_languageSelectionPopupTo%22%2C%0A%09%09%09from%3A%20that._UID%20+%20%22_languageSelectionPopupFrom%22%0A%09%09%7D%3B%0A%09%09for%20%28let%20dir%20in%20mLPops%29%20%7B%0A%09%09%09if%20%28mLPops.hasOwnProperty%28dir%29%29%20%7B%0A%09%09%09%09let%20langs%20%3D%20that.langs%3B%0A%09%09%09%09for%20%28let%20lng%20in%20langs%29%20%7B%0A%09%09%09%09%09if%20%28langs.hasOwnProperty%28lng%29%29%20%7B%0A%09%09%09%09%09%09if%20%28lng%20%3D%3D%3D%20%22%22%20%26%26%20dir%20%3D%3D%3D%20%22to%22%29%0A%09%09%09%09%09%09%09continue%3B%0A%09%09%09%09%09%09%24%28mLPops%5Bdir%5D%29.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09%09%09label%3A%20langs%5Blng%5D%2C%0A%09%09%09%09%09%09%09value%3A%20lng%2C%0A%09%09%09%09%09%09%09seleted%3A%20%28lng%20%3D%3D%3D%20that._zPopTransToLang%29%2C%0A%09%09%09%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%09%09%22%27%29.MultiTranslator.sPref%28this.parentNode.parentNode.getAttribute%28%27_pref%27%29%2C%20this.value%29%3B%22%2C%0A%09%09%09%09%09%09%7D%29%29%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%2C%0A%0A%09updateIconOnURLBarTooltip%3A%20function%28aNode%29%20%7B%0A%09%09aNode.textContent%20%3D%20%22%22%3B%0A%0A%09%09var%20eng%20%3D%20that._zPageTransEngine%2C%0A%09%09%09lC%20%3D%20that._zPageTransURLBarIconLeftClick%2C%0A%09%09%09mC%20%3D%20that._zPageTransURLBarIconMiddleClick%3B%0A%09%09let%20rows%20%3D%20aNode.appendChild%28%24CNS%28%22grid%22%29%29.appendChild%28%24CNS%28%22rows%22%29%29%3B%0A%09%09let%20getWhere%20%3D%20function%28aWhere%29%20%7B%0A%09%09%09switch%20%28aWhere%29%20%7B%0A%09%09%09%09case%201%3A%0A%09%09%09%09%09return%20%22in%20current%20tab.%22%3B%0A%09%09%09%09case%202%3A%0A%09%09%09%09%09return%20%22in%20new%20tab%20next%20to%20current%20one.%22%3B%0A%09%09%09%09case%203%3A%0A%09%09%09%09%09return%20%22in%20a%20new%20tab%20in%20the%20background.%22%3B%0A%09%09%09%09case%204%3A%0A%09%09%09%09%09return%20%22in%20a%20new%20tab%20in%20the%20foreground.%22%3B%0A%09%09%09%7D%0A%09%09%7D%3B%0A%09%09let%20appendRow%20%3D%20function%28aLbl1%2C%20aLbl2%29%20%7B%0A%09%09%09let%20lbl1%20%3D%20rows.appendChild%28%24CNS%28%22row%22%29%29%3B%0A%09%09%09lbl1.appendChild%28%24CNS%28%22label%22%2C%20%7B%0A%09%09%09%09value%3A%20aLbl1%2C%0A%09%09%09%09style%3A%20%22font-weight%3A%20bold%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%09lbl1.appendChild%28%24CNS%28%22label%22%2C%20%7B%0A%09%09%09%09value%3A%20aLbl2%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%7D%3B%0A%09%09appendRow%28%22Current%20engine%20%3A%20%22%2C%20that.URLBarEngines%5Beng%5D.Label%29%3B%0A%09%09rows.appendChild%28%24CNS%28%22row%22%29%29.appendChild%28%24CNS%28%22label%22%2C%20%7B%0A%09%09%09value%3A%20%22%20%22%2C%0A%09%09%7D%29%29%3B%0A%09%09appendRow%28%22Left%20click%20%3A%20%22%2C%20%28that._zPageTransURLBarIconMenuMode%20%3F%20%22Open%20menu%20-%20Translate%20page%20%22%20%3A%20%22Translate%20page%20%22%29%20+%20getWhere%28lC%29%29%3B%0A%09%09appendRow%28%22Middle%20click%20%3A%20%22%2C%20%22Translate%20page%20%22%20+%20getWhere%28mC%29%29%3B%0A%09%09rows.appendChild%28%24CNS%28%22row%22%29%29.appendChild%28%24CNS%28%22label%22%2C%20%7B%0A%09%09%09value%3A%20%22%20%22%2C%0A%09%09%7D%29%29%3B%0A%09%09appendRow%28%22Right%20click%20%3A%20%22%2C%20%22Open%20options%20menu.%22%29%3B%0A%09%7D%2C%0A%0A%09setMenulistsCheckedState%3A%20function%28%29%20%7B%0A%09%09let%20mLs%20%3D%20%5Bthat._UID%20+%20%22_languageSelectionMenulistTo%22%2C%20that._UID%20+%20%22_languageSelectionMenulistFrom%22%5D%3B%0A%09%09Array.prototype.slice.call%28mLs%29.forEach%28function%28aMLID%29%20%7B%0A%09%09%09let%20mL%20%3D%20%24%28aMLID%29%3B%0A%09%09%09let%20mIs%20%3D%20%24%24%28%22menuitem%22%2C%20mL%29%2C%0A%09%09%09%09mLPref%20%3D%20that%5B%22_%22%20+%20mL.getAttribute%28%22_pref%22%29%5D%3B%0A%09%09%09Array.prototype.slice.call%28mIs%29.forEach%28function%28aMI%29%20%7B%0A%09%09%09%09if%20%28aMI.value%20%3D%3D%3D%20mLPref%29%0A%09%09%09%09%09mL.selectedIndex%20%3D%20mL.getIndexOfItem%28aMI%29%3B%0A%09%09%09%7D%29%3B%0A%09%09%7D%29%3B%0A%09%7D%2C%0A%0A%09MiddleClickListener%3A%20function%28aE%29%20%7B%0A%09%09switch%20%28aE.type%29%20%7B%0A%09%09%09case%20%22click%22%3A%0A%09%09%09%09if%20%28aE.button%20%21%3D%3D%201%29%0A%09%09%09%09%09return%3B%0A%09%09%09%09if%20%28that._getSelection%28%29%20%21%3D%3D%20%22%22%29%20%7B%0A%09%09%09%09%09aE.preventDefault%28%29%3B%0A%09%09%09%09%09aE.stopPropagation%28%29%3B%0A%09%09%09%09%7D%0A%09%09%09%09that.TranslateSelection%28%29%3B%0A%09%09%09%09var%20target%20%3D%20aE.target%3B%0A%09%09%09%09if%20%28target%20instanceof%20HTMLAnchorElement%20%7C%7C%0A%09%09%09%09%09target%20instanceof%20HTMLAreaElement%20%7C%7C%0A%09%09%09%09%09target%20instanceof%20HTMLLinkElement%29%0A%09%09%09%09%09return%3B%0A%09%09%09%09break%3B%0A%09%09%09case%20%22mouseup%22%3A%0A%09%09%09case%20%22mousedown%22%3A%0A%09%09%09%09if%20%28aE.button%20%21%3D%3D%201%29%0A%09%09%09%09%09return%3B%0A%09%09%09%09if%20%28that._getSelection%28%29%20%21%3D%3D%20%22%22%29%20%7B%0A%09%09%09%09%09aE.preventDefault%28%29%3B%0A%09%09%09%09%09aE.stopPropagation%28%29%3B%0A%09%09%09%09%7D%0A%0A%09%09%09%09if%20%28%21that._zPopTransKeepItOpen%29%0A%09%09%09%09%09that.HidePanel%28%29%3B%0A%09%09%09%09break%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09OnReleaseListener%3A%20function%28aE%29%20%7B%0A%09%09switch%20%28aE.type%29%20%7B%0A%09%09%09case%20%22mouseup%22%3A%0A%09%09%09%09if%20%28aE.button%20%21%3D%3D%200%20%7C%7C%20%21that.OnReleaseModifiers%28aE%29%29%0A%09%09%09%09%09return%3B%0A%0A%09%09%09%09if%20%28that._zTransOnReleaseShowIcon%20%26%26%0A%09%09%09%09%09%28that.place%20%26%26%0A%09%09%09%09%09%09%28that.place.namespaceURI%20%21%3D%3D%20xulns%20%26%26%20%21%28/%5Ehtml%3A/.test%28that.place.tagName%29%29%29%29%29%20%7B%0A%09%09%09%09%09if%20%28that.transPop.state%20%3D%3D%3D%20%22open%22%29%0A%09%09%09%09%09%09that.TranslateSelection%28%29%3B%0A%09%09%09%09%09else%0A%09%09%09%09%09%09that.OnReleaseIcon%28aE%29%3B%0A%09%09%09%09%7D%20else%0A%09%09%09%09%09that.TranslateSelection%28%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%20%22click%22%3A%0A%09%09%09case%20%22mousedown%22%3A%0A%09%09%09%09if%20%28aE.button%20%21%3D%3D%200%20%26%26%20%21that.OnReleaseModifiers%28aE%29%29%0A%09%09%09%09%09return%3B%0A%0A%09%09%09%09that.place%20%3D%20that.contentDoc%28%29.activeElement%3B%0A%0A%09%09%09%09if%20%28%21that._zPopTransKeepItOpen%29%0A%09%09%09%09%09that.HidePanel%28%29%3B%0A%09%09%09%09break%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09OnReleaseModifiers%3A%20function%28aE%29%20%7B%0A%09%09let%20useCtrlKey%20%3D%20that._zTransOnReleaseControlKey%2C%0A%09%09%09useAltKey%20%3D%20that._zTransOnReleaseAltKey%3B%0A%09%09if%20%28aE.ctrlKey%20%26%26%20aE.altKey%20%26%26%20%28%21useCtrlKey%20%7C%7C%20%21useAltKey%29%29%0A%09%09%09return%20false%3B%0A%09%09//%20XOR%20http%3A//www.howtocreate.co.uk/xor.html%0A%09%09if%20%28aE.ctrlKey%20%3F%20%21useCtrlKey%20%3A%20useCtrlKey%29%0A%09%09%09return%20false%3B%0A%09%09if%20%28aE.altKey%20%3F%20%21useAltKey%20%3A%20useAltKey%29%0A%09%09%09return%20false%3B%0A%09%09return%20true%3B%0A%09%7D%2C%0A%0A%09HidePanel%3A%20function%28%29%20%7B%0A%09%09let%20p%20%3D%20that.transPop%3B%0A%09%09%28p%20%26%26%20p.state%20%3D%3D%3D%20%22open%22%29%20%26%26%20p.hidePopup%28%29%3B%0A%09%7D%2C%0A%0A%09OnReleaseIcon%3A%20function%28aE%29%20%7B%0A%09%09if%20%28that._isMultiProcess%29%20%7B%0A%09%09%09gBrowser.selectedTab.linkedBrowser.messageManager.sendAsyncMessage%28that._onReleaseIconMsgID%2C%20%7B%0A%09%09%09%09iconOffsetY%3A%20that._TransOnReleaseIconOffsetY%2C%0A%09%09%09%09iconOffsetX%3A%20that._TransOnReleaseIconOffsetX%2C%0A%09%09%09%09_UID%3A%20that._UID%2C%0A%09%09%09%09btnID%3A%20self.id%2C%0A%09%09%09%09clientY%3A%20aE.clientY%2C%0A%09%09%09%09clientX%3A%20aE.clientX%2C%0A%09%09%09%09image%3A%20that.getEng%28%22image%22%2C%20true%29%2C%0A%09%09%09%7D%29%3B%0A%09%09%09return%20true%3B%0A%09%09%7D%0A%09%09var%20doc%20%3D%20content.document%3B%0A%09%09var%20body%20%3D%20%24%24%28%22body%22%2C%20doc%29%5B0%5D%3B%0A%09%09var%20div%20%3D%20%24%28that._UID%20+%20%22onReleaseDiv%22%2C%20doc%29%3B%0A%09%09if%20%28div%29%0A%09%09%09div.parentNode.removeChild%28div%29%3B%0A%0A%09%09var%20sel%20%3D%20that._getSelection%28%29%3B%0A%09%09if%20%28%21sel%20%7C%7C%20sel%20%3D%3D%3D%20%22%22%20%7C%7C%20%21body%29%0A%09%09%09return%3B%0A%0A%09%09var%20imgLookup%20%3D%20%24C%28%22img%22%2C%20%7B%0A%09%09%09border%3A%200%2C%0A%09%09%09src%3A%20that.getEng%28%22image%22%2C%20true%29%2C%0A%09%09%7D%2C%20doc%29%3B%0A%09%09console.info%28aE.clientY%29%3B%0A%09%09console.info%28window.pageYOffset%29%3B%0A%09%09console.info%28aE.clientX%29%3B%0A%09%09console.info%28window.pageXOffset%29%3B%0A%09%09div%20%3D%20%24C%28%22div%22%2C%20%7B%0A%09%09%09id%3A%20that._UID%20+%20%22onReleaseDiv%22%2C%0A%09%09%09style%3A%20%22background-color%3Atransparent%3B%20color%3A%23000000%3B%20position%3Aabsolute%3B%20top%3A%22%20+%0A%09%09%09%09%28aE.clientY%20+%20window.pageYOffset%20+%20that._TransOnReleaseIconOffsetY%29%20+%20%22px%3B%20left%3A%22%20+%0A%09%09%09%09%28aE.clientX%20+%20window.pageXOffset%20+%20that._TransOnReleaseIconOffsetX%29%20+%0A%09%09%09%09%22px%3B%20padding%3A0px%3B%20z-index%3A10000%3B%20border-radius%3A2px%3B%22%2C%0A%09%09%7D%2C%20doc%29%3B%0A%09%09div.appendChild%28imgLookup.cloneNode%28false%29%29%3B%0A%09%09let%20listener%20%3D%20function%28aE%29%20%7B%0A%09%09%09aE.preventDefault%28%29%3B%0A%09%09%09that.TranslateSelection%28%29%3B%0A%09%09%09try%20%7B%0A%09%09%09%09this.parentNode.removeChild%28this%29%3B%0A%09%09%09%7D%20catch%20%28aErr%29%20%7B%7D%0A%09%09%09aE.stopPropagation%28%29%3B%0A%09%09%7D%3B%0A%09%09div.addEventListener%28%22mouseover%22%2C%20listener%2C%20false%29%3B%0A%09%09body.appendChild%28div%29%3B%0A%09%7D%2C%0A%0A%09TranslateSelection%3A%20function%28%29%20%7B%0A%09%09if%20%28that._isMultiProcess%29%20%7B%0A%09%09%09gBrowser.selectedTab.linkedBrowser.messageManager.sendAsyncMessage%28that._translateSelMsgID%29%3B%0A%09%09%09return%20true%3B%0A%09%09%7D%0A%09%09that.place%20%3D%20that.contentDoc%28%29.activeElement%3B%0A%0A%09%09let%20sel%20%3D%20that._getSelection%28%29%3B%0A%0A%09%09if%20%28%21sel%20%7C%7C%20sel%20%3D%3D%3D%20%22%22%29%0A%09%09%09return%3B%0A%0A%09%09that.doTranslation%28sel%29%3B%0A%09%7D%2C%0A%0A%09TranslateClipboardContent%3A%20function%28%29%20%7B%0A%09%09that.doTranslation%28gClipboard.read%28%29%29%3B%0A%09%7D%2C%0A%0A%09doTranslation%3A%20function%28aStr%29%20%7B%0A%09%09let%20engine%20%3D%20that.getEng%28null%2C%20true%29%3B%0A%09%09engine%20%26%26%20that.getTranslateResult%28aStr%2C%20engine%29%3B%0A%09%7D%2C%0A%0A%09contentDoc%3A%20function%28%29%20%7B%0A%09%09var%20contentWindow%20%3D%20window.content%20%3F%20window.content%20%3A%20window.getBrowser%28%29.selectedBrowser.contentWindowAsCPOW%3B%0A%09%09return%20contentWindow.document%3B%0A%09%7D%2C%0A%0A%09//%20Get%20the%20current%20window%0A%09_getFocusedWindow%3A%20function%28%29%20%7B%0A%09%09fWin%20%3D%20document.commandDispatcher.focusedWindow%3B%0A%09%09if%20%28%21fWin%20%7C%7C%20fWin%20%3D%3D%20window%29%0A%09%09%09return%20window.gBrowser.selectedBrowser.contentWindowAsCPOW%3B%0A%09%09else%0A%09%09%09return%20fWin%3B%0A%09%7D%2C%0A%0A%09//%20_getSelection%3A%20function%28%29%20%7B%0A%09//%20%09let%20fWin%20%3D%20%7B%7D%3B%0A%09//%20%09let%20fEl%20%3D%20Services.focus.getFocusedElementForWindow%28window%2C%20true%2C%20fWin%29%3B%0A%09//%20%09fWin%20%3D%20fWin.value%3B%0A%09//%20%09let%20selStr%20%3D%20fWin.getSelection%28%29.toString%28%29%3B%0A%09//%20%09if%20%28%21selStr%20%26%26%20fEl%20instanceof%20Ci.nsIDOMNSEditableElement%29%20%7B%0A%09//%20%09%09if%20%28fEl%20instanceof%20Ci.nsIDOMHTMLTextAreaElement%20%7C%7C%0A%09//%20%09%09%09%28fEl%20instanceof%20Ci.nsIDOMHTMLInputElement%20%26%26%0A%09//%20%09%09%09%09fEl.mozIsTextField%28true%29%29%29%20%7B%0A%09//%20%09%09%09selStr%20%3D%20fEl.editor.selection.toString%28%29%3B%0A%09//%20%09%09%7D%0A%09//%20%09%7D%0A%09//%20%09return%20selStr%3B%0A%09//%20%7D%2C%0A%0A%09_getSelection%3A%20function%28%29%20%7B%0A%09%09if%20%28%22BrowserUtils%22%20in%20window%29%0A%09%09%09return%20BrowserUtils.getSelectionDetails%28window%2C%2010000%29.text%3B%0A%0A%09%09if%20%28content.getSelection%29%20%7B%0A%09%09%09var%20sel%3B%0A%09%09%09var%20activeEl%20%3D%20content.document.activeElement%3B%0A%09%09%09try%20%7B%0A%09%09%09%09sel%20%3D%20activeEl.value.substring%28activeEl.selectionStart%2C%20activeEl.selectionEnd%29%3B%0A%09%09%09%7D%20catch%20%28e%29%20%7B%0A%09%09%09%09sel%20%3D%20content.getSelection%28%29.toString%28%29%3B%0A%09%09%09%7D%20finally%20%7B%0A%09%09%09%09return%20sel%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%09return%20false%3B%0A%09%7D%2C%0A%0A%09getEng%3A%20function%28aProp%2C%20aForPopup%29%20%7B%0A%09%09var%20engs%20%3D%20aForPopup%20%3F%20that.PopupEngines%20%3A%20that.URLBarEngines%3B%0A%09%09let%20selProp%20%3D%20function%28aProp%2C%20aKey%29%20%7B%0A%09%09%09switch%20%28aProp%29%20%7B%0A%09%09%09%09case%20%22image%22%3A%0A%09%09%09%09%09if%20%28typeof%20engs%5BaKey%5D.Image%20%3D%3D%3D%20%22number%22%29%0A%09%09%09%09%09%09return%20that.Images%5Bengs%5BaKey%5D.Image%5D%3B%0A%09%09%09%09%09return%20engs%5BaKey%5D.Image%3B%0A%09%09%09%09case%20%22label%22%3A%0A%09%09%09%09%09return%20engs%5BaKey%5D.Label%3B%0A%09%09%09%09default%3A%0A%09%09%09%09%09return%20aKey%3B%0A%09%09%09%7D%0A%09%09%7D%3B%0A%0A%09%09for%20%28var%20book%20in%20engs%29%20%7B%0A%09%09%09if%20%28engs.hasOwnProperty%28book%29%29%20%7B%0A%09%09%09%09if%20%28parseInt%28book%2C%2010%29%20%3D%3D%3D%20parseInt%28%28aForPopup%20%3F%20that._zPopTransEngine%20%3A%20that._zPageTransEngine%29%2C%2010%29%29%0A%09%09%09%09%09return%20selProp%28aProp%2C%20parseInt%28book%2C%2010%29%29%3B%0A%09%09%09%7D%0A%09%09%7D%0A%0A%09%09that.sPref%28aForPopup%20%3F%20%22zPopTransEngine%22%20%3A%20%22zPageTransEngine%22%2C%202%29%3B%20//%20Defaults%20to%20Google%20translator%0A%09%09return%20selProp%28aProp%2C%202%29%3B%0A%09%7D%2C%0A%0A%09getMaxLengthForEng%3A%20function%28aEngine%29%20%7B%0A%09%09switch%20%28aEngine%29%20%7B%0A%09%09%09case%201%3A%20//%20Bing%0A%09%09%09%09return%20150%3B%0A%09%09%09case%203%3A%20//%20Yandex%0A%09%09%09%09return%20500%3B%0A%09%09%09default%3A%20//%20Everything%20else%0A%09%09%09%09return%20parseInt%28that._PopupMaxStringLength%2C%2010%29%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09openFailSafeURL%3A%20function%28aURL%29%20%7B%0A%09%09if%20%28%21%28%22gBrowser%22%20in%20window%29%29%20%7B%0A%09%09%09try%20%7B%0A%09%09%09%09openContentTab%28aURL%29%3B%0A%09%09%09%7D%20catch%20%28aError%29%20%7B%0A%09%09%09%09loadURI%28aURL%29%3B%0A%09%09%09%7D%0A%09%09%09return%3B%0A%09%09%7D%0A%09%09switch%20%28that._zPopTransFailSafeOpenURLWhere%29%20%7B%0A%09%09%09case%201%3A%20//%20Current%0A%09%09%09%09loadURI%28aURL%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%202%3A%20//%20Next%20to%20current%0A%09%09%09%09let%20pos%20%3D%20gBrowser.selectedTab._tPos%20%7C%7C%20gBrowser.tabContainer.selectedIndex%3B%20//%20Firefox%20%7C%7C%20SeaMonkey%0A%09%09%09%09gBrowser.moveTabTo%28gBrowser.selectedTab%20%3D%20gBrowser.addTab%28aURL%29%2C%20pos%20+%201%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%203%3A%20//%20New%20tab%20in%20background%0A%09%09%09%09gBrowser.addTab%28aURL%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%204%3A%20//%20New%20tab%20in%20foreground%0A%09%09%09%09gBrowser.selectedTab%20%3D%20gBrowser.addTab%28aURL%29%3B%0A%09%09%09%09break%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09getTranslateResult%3A%20function%28aStr%2C%20aEngine%29%20%7B%0A%09%09var%20Exp%2C%20xpath%2C%0A%09%09%09popEng%20%3D%20that.PopupEngines%5BaEngine%5D%2C%0A%09%09%09maxLength%20%3D%20that.getMaxLengthForEng%28aEngine%29%3B%0A%09%09var%20SUC%20%3D%20Cc%5B%22@mozilla.org/intl/scriptableunicodeconverter%22%5D%0A%09%09%09.createInstance%28Ci.nsIScriptableUnicodeConverter%29%3B%0A%09%09SUC.charset%20%3D%20popEng.code%3B%0A%09%09var%20str%20%3D%20SUC.ConvertFromUnicode%28aStr%29%2C%0A%09%09%09lgFrom%20%3D%20that._zPopTransFromLang%2C%0A%09%09%09lgTo%20%3D%20that._zPopTransToLang%3B%0A%09%09str%20%3D%20str.replace%28/%5Cs+/g%2C%20%22%20%22%29%3B%0A%09%09if%20%28that._zPopTransFailSafe%20%26%26%20str.length%20%3E%20maxLength%20%26%26%20aEngine%20%3C%3D%203%29%20%7B%0A%09%09%09str%20%3D%20%24escape%28str%29%3B%0A%09%09%09switch%20%28aEngine%29%20%7B%0A%09%09%09%09case%201%3A%0A%09%09%09%09%09that.openFailSafeURL%28%22https%3A//www.bing.com/translator/%3Ffrom%3D%22%20+%20lgFrom%20+%20%22%26to%3D%22%20+%20lgTo%20+%20%22%26text%3D%22%20+%20str%29%3B%0A%09%09%09%09%09return%3B%0A%09%09%09%09case%202%3A%0A%09%09%09%09%09//%20that.openFailSafeURL%28%22https%3A//translate.google.com/%23%22%20+%20lgFrom%20+%20%22/%22%20+%20lgTo%20+%20%22/%22%20+%20str%29%3B%0A%09%09%09%09%09that.openFailSafeURL%28%22https%3A//translate.google.com/%3Fhl%3D%22%20+%20lgTo%20+%20%22%26eotf%3D0%26sl%3D%22%20+%20lgFrom%20+%20%22%26tl%3D%22%20+%20lgTo%20+%20%22%26text%3D%22%20+%20str%29%3B%0A%09%09%09%09%09return%3B%0A%09%09%09%09case%203%3A%0A%09%09%09%09%09that.openFailSafeURL%28%22https%3A//translate.yandex.ru/%3Ffrom%3D%22%20+%20lgFrom%20+%20%22%26to%3D%22%20+%20lgTo%20+%20%22%26text%3D%22%20+%20str%29%3B%0A%09%09%09%09%09return%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%09str%20%3D%20str.substring%280%2C%20maxLength%29%3B%0A%09%09if%20%28popEng.method%20%3D%3D%3D%20%22POST%22%29%20%7B%0A%09%09%09var%20url%20%3D%20popEng.action%3B%0A%09%09%09var%20data%20%3D%20popEng.post.replace%28/%25%25LNGTO%25%25/g%2C%20lgTo%29.replace%28/%25%25LNGFROM%25%25/g%2C%20lgFrom%29%3B%0A%09%09%09data%20%3D%20data.replace%28/%25%25SEL%25%25/g%2C%20%24escape%28str%29.replace%28/%5C+/g%2C%20%22%252B%22%29%29%3B%0A%09%09%7D%20else%20%7B%0A%09%09%09var%20url%20%3D%20%28aEngine%20%3D%3D%3D%203%29%20%3F%0A%09%09%09%09popEng.action%20%3A%0A%09%09%09%09popEng.action.replace%28/%25%25LNGTO%25%25/g%2C%20lgTo%29.replace%28/%25%25LNGFROM%25%25/g%2C%20lgFrom%29%3B%0A%09%09%09url%20%3D%20url.replace%28/%25%25SEL%25%25/g%2C%20%24escape%28str%29.replace%28/%5C+/g%2C%20%22%252B%22%29%29%3B%0A%09%09%09var%20data%20%3D%20null%3B%0A%09%09%7D%0A%09%09if%20%28%21popEng.xpath%20%7C%7C%20popEng.xpath%20%3D%3D%3D%20%22%22%29%0A%09%09%09Exp%20%3D%20new%20RegExp%28popEng.start%20+%20%22%28%28.%7C%5C%5Cr%7C%5C%5Cn%29*%29%22%20+%20popEng.end%2C%20%22i%22%29%3B%0A%09%09else%0A%09%09%09xpath%20%3D%20popEng.xpath%3B%0A%09%09that.show%28%22Translating...%22%29%3B%0A%09%09if%20%28aEngine%20%3D%3D%3D%201%29%20%7B%0A%09%09%09that.BingAPI%28popEng%2C%20url%29%3B%0A%09%09%7D%20else%20if%20%28aEngine%20%3D%3D%3D%203%29%20%7B%0A%09%09%09that.YandexAPI%28popEng%2C%20url%29%3B%0A%09%09%7D%20else%20%7B%0A%09%09%09that.GM_xmlhttpRequest%28%7B%0A%09%09%09%09method%3A%20popEng.method%2C%0A%09%09%09%09overrideMimeType%3A%20%22text/html%3B%20charset%3D%22%20+%20popEng.code%2C%0A%09%09%09%09url%3A%20url%2C%0A%09%09%09%09data%3A%20data%2C%0A%09%09%09%09headers%3A%20%7B%0A%09%09%09%09%09%22Referer%22%3A%20popEng.Referer%2C%0A%09%09%09%09%09%22Content-Type%22%3A%20%22application/x-www-form-urlencoded%22%0A%09%09%09%09%7D%2C%0A%09%09%09%09onload%3A%20function%28aDetails%29%20%7B%0A%09%09%09%09%09var%20txt%20%3D%20aDetails.responseText.toString%28%29%3B%0A%09%09%09%09%09var%20res%20%3D%20null%3B%0A%09%09%09%09%09try%20%7B%0A%09%09%09%09%09%09if%20%28%21xpath%29%20%7B%0A%09%09%09%09%09%09%09res%20%3D%20txt.match%28new%20RegExp%28Exp.source%2C%20%22i%22%29%29%3B%0A%09%09%09%09%09%09%09res%20%3D%20RegExp.%241%3B%0A%09%09%09%09%09%09%7D%20else%20%7B%0A%09%09%09%09%09%09%09var%20hdoc%20%3D%20that.str2dom%28txt%29%3B%0A%09%09%09%09%09%09%09var%20result%20%3D%20hdoc.evaluate%28xpath%2C%20hdoc%2C%20null%2C%20XPathResult.ORDERED_NODE_SNAPSHOT_TYPE%2C%20null%29%3B%0A%09%09%09%09%09%09%09var%20node%20%3D%20result.snapshotLength%20%3E%200%20%3F%20result.snapshotItem%280%29%20%3A%20null%3B%0A%09%09%09%09%09%09%09res%20%3D%20node.textContent%20%7C%7C%20node.value%3B%0A%09%09%09%09%09%09%09node%20%3D%20hdoc%20%3D%20result%20%3D%20null%3B%0A%09%09%09%09%09%09%7D%0A%09%09%09%09%09%7D%20catch%20%28e%29%20%7B%0A%09%09%09%09%09%09that.show%28%22Failure%20to%20obtain.%22%29%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%09//res%20%3D%20res.trim%28%29%3B%0A%09%09%09%09%09res%20%3D%20res.replace%28/%5Cn/g%2C%20%22%3Chtml%3Abr%20/%3E%22%29%3B%0A%09%09%09%09%09if%20%28%21%21res%29%20%7B%0A%09%09%09%09%09%09that.show%28res%29%3B%0A%09%09%09%09%09%7D%20else%20%7B%0A%09%09%09%09%09%09that.show%28%22Failure%20to%20obtain.%22%29%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%7D%2C%0A%09%09%09%09onerror%3A%20function%28aErr%29%20%7B%0A%09%09%09%09%09that.show%28%22Error%20%22%20+%20aErr.status%20+%20%22%20occurred%20while%20receiving%20the%20document.%22%29%3B%0A%09%09%09%09%7D%2C%0A%09%09%09%09ontimeout%3A%20function%28%29%20%7B%0A%09%09%09%09%09that.show%28%22Timeout.%20Couldn%27t%20obtain%20translation%20result.%22%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%29%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09YandexAPI%3A%20function%28aEngine%2C%20aURL%29%20%7B%0A%09%09var%20random%20%3D%20Math.floor%28Math.random%28%29%20*%20that.APIKeysYandex.length%20-%201%29%20+%201%2C%0A%09%09%09lgFrom%20%3D%20that._zPopTransFromLang%2C%0A%09%09%09lgTo%20%3D%20that._zPopTransToLang%3B%0A%09%09var%20url%20%3D%20aURL.replace%28%22%25%25API_KEY%25%25%22%2C%20that.APIKeysYandex%5Brandom%5D%29%0A%09%09%09.replace%28%22%25%25LNGTO%25%25%22%2C%20%28%28lgFrom%20%3D%3D%3D%20%22%22%29%20%3F%20lgTo%20%3A%20lgFrom%20+%20%22-%22%20+%20lgTo%29%29%3B%0A%09%09that.GM_xmlhttpRequest%28%7B%0A%09%09%09method%3A%20aEngine.method%2C%0A%09%09%09overrideMimeType%3A%20%22text/html%3B%20charset%3D%22%20+%20aEngine.code%2C%0A%09%09%09url%3A%20url%2C%0A%09%09%09data%3A%20null%2C%0A%09%09%09headers%3A%20%7B%0A%09%09%09%09%22Content-Type%22%3A%20%22application/x-www-form-urlencoded%22%0A%09%09%09%7D%2C%0A%09%09%09onload%3A%20function%28aRes%29%20%7B%0A%09%09%09%09if%20%28aRes.readyState%20%3D%3D%3D%204%20%26%26%20aRes.status%20%3D%3D%3D%20200%29%20%7B%0A%09%09%09%09%09let%20txt%20%3D%20JSON.parse%28aRes.responseText%29.text.toString%28%29%3B%0A%09%09%09%09%09txt%20%3D%20txt.replace%28/%5Cn/g%2C%20%22%3Chtml%3Abr%20/%3E%22%29%3B%0A%09%09%09%09%09if%20%28txt%20%21%3D%3D%20%22%22%29%0A%09%09%09%09%09%09that.show%28txt%29%3B%0A%09%09%09%09%09else%0A%09%09%09%09%09%09that.show%28%22Failure%20to%20obtain.%22%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%2C%0A%09%09%09onerror%3A%20function%28aErr%29%20%7B%0A%09%09%09%09that.show%28%22Error%20%22%20+%20aErr.status%20+%20%22%20occurred%20while%20trying%20to%20obtain%20translation%20result.%22%29%3B%0A%09%09%09%7D%2C%0A%09%09%09ontimeout%3A%20function%28%29%20%7B%0A%09%09%09%09that.show%28%22Timeout.%20Couldn%27t%20obtain%20translation%20result.%22%29%3B%0A%09%09%09%7D%0A%09%09%7D%29%3B%0A%09%7D%2C%0A%0A%09BingAPI%3A%20function%28aEngine%2C%20aURL%29%20%7B%0A%09%09var%20random%20%3D%20Math.floor%28Math.random%28%29%20*%20that.APIKeysBing.length%20-%201%29%20+%201%3B%0A%09%09that.GM_xmlhttpRequest%28%7B%0A%09%09%09method%3A%20%22POST%22%2C%0A%09%09%09overrideMimeType%3A%20%22text/html%3B%20charset%3D%22%20+%20aEngine.code%2C%0A%09%09%09url%3A%20%22https%3A//datamarket.accesscontrol.windows.net/v2/OAuth2-13%22%2C%0A%09%09%09data%3A%20%22grant_type%3Dclient_credentials%26client_id%3D%22%20+%20encodeURIComponent%28that.APIKeysBing%5Brandom%5D%5B0%5D%29%20+%0A%09%09%09%09%22%26client_secret%3D%22%20+%20encodeURIComponent%28that.APIKeysBing%5Brandom%5D%5B1%5D%29%20+%20%22%26scope%3Dhttp%3A//api.microsofttranslator.com%22%2C%0A%09%09%09headers%3A%20%7B%0A%09%09%09%09%22Content-Type%22%3A%20%22application/x-www-form-urlencoded%22%0A%09%09%09%7D%2C%0A%09%09%09onload%3A%20function%28aRes%29%20%7B%0A%09%09%09%09if%20%28aRes.readyState%20%3D%3D%3D%204%20%26%26%20aRes.status%20%3D%3D%3D%20200%29%20%7B%0A%09%09%09%09%09that.GM_xmlhttpRequest%28%7B%0A%09%09%09%09%09%09method%3A%20aEngine.method%2C%0A%09%09%09%09%09%09overrideMimeType%3A%20%22text/html%3B%20charset%3D%22%20+%20aEngine.code%2C%0A%09%09%09%09%09%09url%3A%20aURL%2C%0A%09%09%09%09%09%09data%3A%20null%2C%0A%09%09%09%09%09%09headers%3A%20%7B%0A%09%09%09%09%09%09%09%22Authorization%22%3A%20%22bearer%20%22%20+%20JSON.parse%28aRes.responseText%29.access_token%2C%0A%09%09%09%09%09%09%09%22Content-Type%22%3A%20%22application/x-www-form-urlencoded%22%0A%09%09%09%09%09%09%7D%2C%0A%09%09%09%09%09%09onload%3A%20function%28aRes2%29%20%7B%0A%09%09%09%09%09%09%09if%20%28aRes2.readyState%20%3D%3D%3D%204%20%26%26%20aRes2.status%20%3D%3D%3D%20200%29%20%7B%0A%09%09%09%09%09%09%09%09let%20txt%20%3D%20aRes2.responseText.toString%28%29.replace%28/%5E%5C%22/g%2C%20%22%22%29.replace%28/%5C%22%24/g%2C%20%22%22%29%3B%0A%09%09%09%09%09%09%09%09txt%20%3D%20txt.replace%28/%5Cn/g%2C%20%22%3Chtml%3Abr%20/%3E%22%29%3B%0A%09%09%09%09%09%09%09%09if%20%28txt%20%21%3D%3D%20%22%22%29%0A%09%09%09%09%09%09%09%09%09that.show%28txt%29%3B%0A%09%09%09%09%09%09%09%09else%0A%09%09%09%09%09%09%09%09%09that.show%28%22Failure%20to%20obtain.%22%29%3B%0A%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%7D%2C%0A%09%09%09%09%09%09onerror%3A%20function%28aErr%29%20%7B%0A%09%09%09%09%09%09%09that.show%28%22Error%20%22%20+%20aErr.status%20+%20%22%20occurred%20while%20trying%20to%20obtain%20translation%20result.%22%29%3B%0A%09%09%09%09%09%09%7D%2C%0A%09%09%09%09%09%09ontimeout%3A%20function%28%29%20%7B%0A%09%09%09%09%09%09%09that.show%28%22Timeout.%20Couldn%27t%20obtain%20translation%20result.%22%29%3B%0A%09%09%09%09%09%09%7D%0A%09%09%09%09%09%7D%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%2C%0A%09%09%09onerror%3A%20function%28aErr%29%20%7B%0A%09%09%09%09that.show%28%22Error%20%22%20+%20aErr.status%20+%20%22%20occurred%20while%20trying%20to%20obtain%20Bing%20API%20credentials.%22%29%3B%0A%09%09%09%7D%2C%0A%09%09%09ontimeout%3A%20function%28%29%20%7B%0A%09%09%09%09that.show%28%22Timeout.%20Couldn%27t%20obtain%20Bing%20API%20credentials.%22%29%3B%0A%09%09%09%7D%0A%09%09%7D%29%3B%0A%09%7D%2C%0A%0A%0A%09str2dom%3A%20function%28aStr%29%20%7B%0A%09%09var%20xsl%20%3D%20%28new%20DOMParser%28%29%29.parseFromString%28%5B%0A%09%09%09%22%3C%3Fxml%20version%3D%5C%221.0%5C%22%3F%3E%22%2C%0A%09%09%09%22%3Cstylesheet%20version%3D%5C%221.0%5C%22%20xmlns%3D%5C%22http%3A//www.w3.org/1999/XSL/Transform%5C%22%3E%22%2C%0A%09%09%09%22%3Coutput%20method%3D%5C%22html%5C%22/%3E%22%2C%0A%09%09%09%22%3C/stylesheet%3E%22%0A%09%09%5D.join%28%22%5Cn%22%29%2C%20%22text/xml%22%29%3B%0A%0A%09%09var%20xsltp%20%3D%20new%20XSLTProcessor%28%29%3B%0A%09%09xsltp.importStylesheet%28xsl%29%3B%0A%09%09var%20htmldoc%20%3D%20xsltp.transformToDocument%28document.implementation.createDocument%28%22%22%2C%20%22%22%2C%20null%29%29%3B%0A%0A%09%09var%20range%20%3D%20htmldoc.createRange%28%29%3B%0A%09%09htmldoc.appendChild%28htmldoc.createElement%28%22html%22%29%29%3B%0A%09%09range.selectNodeContents%28htmldoc.documentElement%29%3B%0A%0A%09%09htmldoc.documentElement.appendChild%28range.createContextualFragment%28aStr%29%29%3B%0A%09%09return%20htmldoc%3B%0A%09%7D%2C%0A%0A%09req%3A%20null%2C%0A%09GM_xmlhttpRequest%3A%20function%28aObj%29%20%7B%0A%09%09if%20%28typeof%28aObj%29%20%21%3D%3D%20%22object%22%20%7C%7C%20%28typeof%28aObj.url%29%20%21%3D%3D%20%22string%22%20%26%26%20%21%28aObj.url%20instanceof%20String%29%29%29%0A%09%09%09return%3B%0A%09%09if%20%28%21that.req%29%0A%09%09%09that.req%20%3D%20new%20XMLHttpRequest%28%29%3B%0A%09%09var%20req%20%3D%20that.req%3B%0A%09%09req.abort%28%29%3B%0A%09%09req.timeout%20%3D%20that.TIMEOUT%3B%0A%0A%09%09req.reqestUrl%20%3D%20aObj.url%3B%0A%09%09req.open%28aObj.method%20%7C%7C%20%22GET%22%2C%20aObj.url%2C%20true%29%3B%0A%0A%09%09if%20%28typeof%28aObj.headers%29%20%3D%3D%3D%20%22object%22%29%20%7B%0A%09%09%09for%20%28var%20i%20in%20aObj.headers%29%0A%09%09%09%09req.setRequestHeader%28i%2C%20aObj.headers%5Bi%5D%2C%20false%29%3B%0A%09%09%7D%0A%0A%09%09%5B%22onload%22%2C%20%22onerror%22%2C%20%22onreadystatechange%22%2C%20%22ontimeout%22%5D.forEach%28function%28k%29%20%7B%0A%09%09%09if%20%28aObj%5Bk%5D%20%26%26%20%28typeof%28aObj%5Bk%5D%29%20%3D%3D%3D%20%22function%22%20%7C%7C%20aObj%5Bk%5D%20instanceof%20Function%29%29%0A%09%09%09%09req%5Bk%5D%20%3D%20function%28%29%20%7B%0A%09%09%09%09%09aObj%5Bk%5D%28%7B%0A%09%09%09%09%09%09status%3A%20%28req.readyState%20%3D%3D%3D%204%29%20%3F%20req.status%20%3A%200%2C%0A%09%09%09%09%09%09statusText%3A%20%28req.readyState%20%3D%3D%3D%204%29%20%3F%20req.statusText%20%3A%20%22%22%2C%0A%09%09%09%09%09%09responseHeaders%3A%20%28req.readyState%20%3D%3D%3D%204%29%20%3F%20req.getAllResponseHeaders%28%29%20%3A%20%22%22%2C%0A%09%09%09%09%09%09responseText%3A%20req.responseText%2C%0A%09%09%09%09%09%09readyState%3A%20req.readyState%2C%0A%09%09%09%09%09%09finalUrl%3A%20%28req.readyState%20%3D%3D%3D%204%29%20%3F%20req.channel.URI.spec%20%3A%20%22%22%0A%09%09%09%09%09%7D%29%3B%0A%09%09%09%09%7D%3B%0A%09%09%7D%29%3B%0A%0A%09%09if%20%28aObj.overrideMimeType%29%0A%09%09%09req.overrideMimeType%28aObj.overrideMimeType%29%3B%0A%09%09if%20%28typeof%20aObj.data%20%3D%3D%3D%20%22string%22%29%0A%09%09%09req.send%28aObj.data%29%3B%20//%20For%20POST%0A%09%09else%0A%09%09%09req.send%28null%29%3B%20//%20For%20GET%0A%09%7D%2C%0A%0A%09openPage%3A%20function%28aURL%2C%20aE%29%20%7B%0A%09%09try%20%7B%0A%09%09%09gBrowser.selectedTab%20%3D%20gBrowser.addTab%28aURL%29%3B%0A%09%09%7D%20catch%20%28aEr%29%20%7B%0A%09%09%09try%20%7B%0A%09%09%09%09openContentTab%28aURL%29%3B%0A%09%09%09%7D%20catch%20%28aError%29%20%7B%0A%09%09%09%09openUILink%28aURL%2C%20aE%29%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%2C%0A%0A%09setFooter%3A%20function%28%29%20%7B%0A%09%09let%20eng%20%3D%20that._zPopTransEngine%3B%0A%09%09let%20data%20%3D%20%5B%0A%09%09%09%5B%22Bing%22%2C%20%22http%3A//www.bing.com/translator/%22%5D%2C%0A%09%09%09%5B%22Google%22%2C%20%22https%3A//translate.google.com/%22%5D%2C%0A%09%09%09%5B%22Yandex%22%2C%20%22http%3A//translate.yandex.ru/%22%5D%2C%0A%09%09%5D%3B%0A%09%09let%20footer%20%3D%20%22%3Chtml%3Abr%20/%3E%3Chtml%3Aspan%20style%3D%5C%22font-size%3Ax-small%3Bfloat%3Aright%3B%5C%22%3EService%20provided%20by%20%22%20+%0A%09%09%09%22%3Chtml%3Aspan%20onclick%3D%5C%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%0A%09%09%09self.id%20+%20%22%27%29.MultiTranslator.openPage%28%27%22%20+%20data%5Beng%20-%201%5D%5B1%5D%20+%20%22%27%2C%20%22%20+%0A%09%09%09%22event%29%3B%5C%22%20style%3D%5C%22font-weight%3Abold%3Bcursor%3Apointer%3B%5C%22%3E%AB%22%20+%20data%5Beng%20-%201%5D%5B0%5D%20+%20%22%20Translator%BB%22%20+%0A%09%09%09%22%3C/html%3Aspan%3E%3C/html%3Aspan%3E%22%3B%0A%09%09try%20%7B%0A%09%09%09%24%28that._UID%20+%20%22_translationResultContentFooter%22%29.innerHTML%20%3D%20that._PopupShowFooter%20%3F%20footer%20%3A%20%22%22%3B%0A%09%09%7D%20catch%20%28aErr%29%20%7B%7D%0A%09%7D%2C%0A%0A%09show%3A%20function%28aRes%29%20%7B%0A%09%09var%20popup%20%3D%20that.transPop%3B%0A%09%09%24%28that._UID%20+%20%22_translationResultContent%22%29.innerHTML%20%3D%20escHTML%28aRes%29%3B%0A%09%09that.setFooter%28%29%3B%0A%09%09that.sizeChange%28%29%3B%0A%09%09if%20%28that.timer%29%0A%09%09%09clearTimeout%28that.timer%29%3B%0A%09%09if%20%28that._zPopTransAnchorToSelection%29%20%7B%0A%09%09%09if%20%28that._isMultiProcess%29%20%7B%0A%09%09%09%09gBrowser.selectedTab.linkedBrowser.messageManager.sendAsyncMessage%28that._movePopupMsgID%2C%20%7B%0A%09%09%09%09%09_UID%3A%20that._UID%2C%0A%09%09%09%09%09width%3A%20%28fullScreen%20%3F%20screen.width%20%3A%20screen.availWidth%29%2C%0A%09%09%09%09%09height%3A%20%28fullScreen%20%3F%20screen.height%20%3A%20screen.availHeight%29%2C%0A%09%09%09%09%7D%29%3B%0A%09%09%09%7D%20else%20%7B%0A%09%09%09%09let%20fWin%20%3D%20that._getFocusedWindow%28%29%3B%0A%09%09%09%09let%20rect%3B%0A%09%09%09%09try%20%7B%0A%09%09%09%09%09rect%20%3D%20fWin.getSelection%28%29.getRangeAt%280%29.getBoundingClientRect%28%29%3B%0A%09%09%09%09%7D%20catch%20%28aErr%29%20%7B%0A%09%09%09%09%09rect%20%3D%20false%3B%0A%09%09%09%09%7D%0A%09%09%09%09let%20posX%20%3D%20fWin.mozInnerScreenX%20+%20%28rect%20%3F%20rect.left%20%3A%20fWin.innerWidth%20/%202%29%3B%0A%09%09%09%09let%20posY%20%3D%20fWin.mozInnerScreenY%20+%20%28rect%20%3F%20rect.bottom%20%3A%20fWin.innerHeight%20/%202%29%20+%203%3B%0A%09%09%09%09let%20deltaX%20%3D%20posX%20-%20%28fullScreen%20%3F%20screen.width%20%3A%20screen.availWidth%29%3B%0A%09%09%09%09if%20%28deltaX%20%3E%200%29%0A%09%09%09%09%09posX%20-%3D%20deltaX%3B%0A%09%09%09%09let%20deltaY%20%3D%20posY%20-%20%28fullScreen%20%3F%20screen.height%20%3A%20screen.availHeight%29%3B%0A%09%09%09%09if%20%28deltaY%20%3E%200%29%0A%09%09%09%09%09posY%20-%3D%20deltaY%3B%0A%09%09%09%09let%20div%20%3D%20%24%28that._UID%20+%20%22onReleaseDiv%22%2C%20content.document%29%3B%0A%09%09%09%09try%20%7B%0A%09%09%09%09%09%28popup.state%20%3D%3D%3D%20%22open%22%29%20%26%26%20popup.moveTo%28posX%2C%20posY%29%3B%0A%09%09%09%09%09popup.openPopupAtScreen%28posX%2C%20posY%2C%20false%29%3B%0A%09%09%09%09%7D%20finally%20%7B%0A%09%09%09%09%09div%20%26%26%20div.parentNode.removeChild%28div%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%7D%20else%0A%09%09%09that.openTransPop%28%29%3B%0A%09%09setTimeout%28function%28%29%20%7B%0A%09%09%09that.sizeChange%28%29%3B%0A%09%09%7D%2C%200%29%3B%0A%09%7D%2C%0A%0A%09openTransPop%3A%20function%28%29%20%7B%0A%09%09let%20node%20%3D%20%24%28%22content%22%29%3B%0A%09%09if%20%28%21node%29%0A%09%09%09node%20%3D%20%24%28%22messagepane%22%29%3B%0A%09%09that.transPop.openPopup%28node%2C%20%22overlap%22%2C%200%2C%200%2C%20false%2C%20null%2C%20null%29%3B%0A%09%7D%2C%0A%0A%09sizeChange%3A%20function%28%29%20%7B%0A%09%09let%20p%20%3D%20that.transPop%3B%0A%09%09let%20b%20%3D%20%24%28that._UID%20+%20%22_translationResultBox%22%29%3B%0A%09%09p.sizeTo%28that._PopupMaxWidth%2C%20Math.max%28b.boxObject.height%20*%201.0%20+%205%2C%2023%29%29%3B%0A%09%7D%2C%0A%0A%09PopulateOptionsPopup%3A%20function%28aNode%29%20%7B%0A%09%09let%20engine%20%3D%20that.getEng%28%29%3B%0A%09%09engine%20%3D%20that.getEng%28null%2C%20true%29%3B%0A%09%09delete%20engine%3B%0A%09%09let%20tNode%20%3D%20aNode.triggerNode%3B%0A%09%09aNode.textContent%20%3D%20%22%22%3B%0A%0A%09%09aNode.onclick%20%3D%20function%28aE%29%20%7B%0A%09%09%09aE.stopPropagation%28%29%3B%0A%09%09%7D%3B%0A%09%09if%20%28%21tNode%20%7C%7C%20%28tNode%20%26%26%20tNode.id%20%21%3D%3D%20that._UID%20+%20%22_translationIconOnURLBar%22%29%29%20%7B%0A%09%09%09aNode.appendChild%28%24CNS%28%22dialogheader%22%2C%20%7B%0A%09%09%09%09title%3A%20%22Engine%20for%20popup%22%2C%0A%09%09%09%09tooltiptext%3A%20%22Choose%20default%20engine%20for%20the%20popup%20translator.%22%2C%0A%09%09%09%09style%3A%20%22margin%3A%200%200%207px%200%3Bpadding%3A%202px%200%202px%205px%3Bborder%3Anone%3Bfont-size%3Asmaller%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%09let%20rGPop%20%3D%20aNode.appendChild%28%24CNS%28%22radiogroup%22%29%29%3B%0A%09%09%09var%20pEngs%20%3D%20that.PopupEngines%3B%0A%09%09%09for%20%28eng%20in%20pEngs%29%20%7B%0A%09%09%09%09if%20%28pEngs.hasOwnProperty%28eng%29%29%20%7B%0A%09%09%09%09%09rGPop.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09%09label%3A%20pEngs%5Beng%5D.Label%2C%0A%09%09%09%09%09%09type%3A%20%22radio%22%2C%0A%09%09%09%09%09%09closemenu%3A%20%22none%22%2C%0A%09%09%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%09%22%27%29.MultiTranslator.sPref%28%27zPopTransEngine%27%2C%20%22%20+%20parseInt%28eng%2C%2010%29%20+%20%22%29%3B%22%2C%0A%09%09%09%09%09%09checked%3A%20%28that._zPopTransEngine%20%3D%3D%3D%20parseInt%28eng%2C%2010%29%29%2C%0A%09%09%09%09%09%7D%29%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%0A%09%09%09aNode.appendChild%28%24CNS%28%22separator%22%29%29%3B%0A%09%09%7D%0A%0A%09%09if%20%28%22gBrowser%22%20in%20window%20%26%26%20%28%21tNode%20%7C%7C%20%28tNode%20%26%26%20tNode.id%20%21%3D%3D%20that._UID%20+%20%22_translationOptionsButton%22%29%29%29%20%7B%0A%09%09%09aNode.appendChild%28%24CNS%28%22dialogheader%22%2C%20%7B%0A%09%09%09%09title%3A%20%22Engine%20for%20page%20translator%22%2C%0A%09%09%09%09tooltiptext%3A%20%22Choose%20default%20engine%20for%20the%20page%20translator.%22%2C%0A%09%09%09%09style%3A%20%22margin%3A%200%200%207px%200%3Bpadding%3A%202px%200%202px%205px%3Bborder%3Anone%3Bfont-size%3Asmaller%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%09let%20rGURL%20%3D%20aNode.appendChild%28%24CNS%28%22radiogroup%22%29%29%3B%0A%09%09%09let%20URLBEng%20%3D%20that.URLBarEngines%3B%0A%09%09%09for%20%28var%20book%20in%20URLBEng%29%20%7B%0A%09%09%09%09if%20%28URLBEng.hasOwnProperty%28book%29%29%20%7B%0A%09%09%09%09%09if%20%28%21%21URLBEng%5Bbook%5D.Label%20%26%26%20%21%21URLBEng%5Bbook%5D.Command%29%20%7B%0A%09%09%09%09%09%09rGURL.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09%09%09label%3A%20URLBEng%5Bbook%5D.Label%2C%0A%09%09%09%09%09%09%09type%3A%20%22radio%22%2C%0A%09%09%09%09%09%09%09closemenu%3A%20%22none%22%2C%0A%09%09%09%09%09%09%09tooltiptext%3A%20%21%21URLBEng%5Bbook%5D.Tooltip%20%3F%20URLBEng%5Bbook%5D.Tooltip%20%3A%20%22%22%2C%0A%09%09%09%09%09%09%09checked%3A%20%28that._zPageTransEngine%20%3D%3D%3D%20parseInt%28book%2C%2010%29%29%2C%0A%09%09%09%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%09%09%22%27%29.MultiTranslator.sPref%28%27zPageTransEngine%27%2C%20%22%20+%20parseInt%28book%2C%2010%29%20+%20%22%29%3B%22%2C%0A%09%09%09%09%09%09%7D%29%29%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%0A%09%09%09aNode.appendChild%28%24CNS%28%22separator%22%29%29%3B%0A%09%09%7D%0A%0A%09%09var%20genOpts%20%3D%20aNode.appendChild%28%24CNS%28%22menu%22%2C%20%7B%0A%09%09%09label%3A%20%22General%20options%22%2C%0A%09%09%7D%29%29.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09menugenerated%3A%20true%2C%0A%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%7D%29%29%3B%0A%09%09%5B%0A%09%09%09%5B%22zOpenOptionsInTab%22%2C%0A%09%09%09%09%22Open%20options%20in%20tab%22%0A%09%09%09%5D%2C%0A%09%09%09%5B%22zShowContextMenuItems%22%2C%0A%09%09%09%09%22Show%20in%20context%20menu%22%0A%09%09%09%5D%2C%0A%09%09%09%5B%22zUseTransPageHotkey%22%2C%0A%09%09%09%09%22Use%20Translate%20Page%20hotkey%22%0A%09%09%09%5D%2C%0A%09%09%09%5B%22zUseTransSelHotkey%22%2C%0A%09%09%09%09%22Use%20Translate%20Selection%20hotkey%22%0A%09%09%09%5D%2C%0A%09%09%09%5B%22zUseTransClipHotkey%22%2C%0A%09%09%09%09%22Use%20Trasnlate%20Clipboard%20hotkey%22%0A%09%09%09%5D%0A%09%09%5D.forEach%28function%28aP%29%20%7B%0A%09%09%09genOpts.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09label%3A%20aP%5B1%5D%2C%0A%09%09%09%09type%3A%20%22checkbox%22%2C%0A%09%09%09%09closemenu%3A%20%22none%22%2C%0A%09%09%09%09tooltiptext%3A%20that.optionsDesc%5BaP%5B0%5D%5D%2C%0A%09%09%09%09checked%3A%20that%5B%22_%22%20+%20aP%5B0%5D%5D%2C%0A%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%22%27%29.MultiTranslator.sPref%28%27%22%20+%20aP%5B0%5D%20+%20%22%27%2C%20%21document.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%22%27%29.MultiTranslator.gPref%28%27%22%20+%20aP%5B0%5D%20+%20%22%27%29%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%7D%29%3B%0A%0A%09%09genOpts.appendChild%28%24CNS%28%22dialogheader%22%2C%20%7B%0A%09%09%09title%3A%20%22Click%20actions%22%2C%0A%09%09%09tooltiptext%3A%20%22Click%20actions%20on%20Multi%20Translator%20button.%22%2C%0A%09%09%09style%3A%20%22margin%3A%200%200%207px%200%3Bpadding%3A%202px%200%202px%205px%3Bborder%3Anone%3Bfont-size%3Asmaller%3B%22%2C%0A%09%09%7D%29%29%3B%0A%09%09let%20what%20%3D%20%5B%0A%09%09%09%5B0%2C%20%22...disabled.%22%5D%2C%0A%09%09%09%5B1%2C%20%22...opens%20main%20menu.%22%5D%2C%0A%09%09%09%5B2%2C%20%22...translates%20selection.%22%5D%2C%0A%09%09%09%5B3%2C%20%22...translates%20current%20page.%22%5D%2C%0A%09%09%09%5B4%2C%20%22...translates%20clipboard%20content.%22%5D%2C%0A%09%09%09%5B5%2C%20%22...opens%20page%20translation%20menu.%22%5D%2C%0A%09%09%5D%3B%0A%09%09%5B%0A%09%09%09%5B%22zButtonClickActionLeft%22%2C%20%22Left%20click...%22%5D%2C%0A%09%09%09%5B%22zButtonClickActionMiddle%22%2C%20%22Middle%20click...%22%5D%2C%0A%09%09%09%5B%22zButtonClickActionLeftCtrl%22%2C%20%22Ctrl%20+%20Left%20click...%22%5D%2C%0A%09%09%09%5B%22zButtonClickActionLeftShift%22%2C%20%22Shift%20+%20Left%20click...%22%5D%2C%0A%09%09%09%5B%22zButtonClickActionLeftCtrlShift%22%2C%20%22Ctrl%20+%20Shift%20+%20Left%20click...%22%5D%0A%09%09%5D.forEach%28function%28aP%29%20%7B%0A%09%09%09let%20actClick%20%3D%20genOpts.appendChild%28%24CNS%28%22menu%22%2C%20%7B%0A%09%09%09%09label%3A%20aP%5B1%5D%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09%09menugenerated%3A%20true%2C%0A%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22radiogroup%22%2C%20%7B%0A%09%09%09%09_pref%3A%20aP%5B0%5D%2C%0A%09%09%09%09oncommand%3A%20%22console.info%28event.target.value%29%3Bevent.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%22%27%29.MultiTranslator.sPref%28this.getAttribute%28%27_pref%27%29%2C%20parseInt%28event.target.value%2C%2010%29%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%09what.forEach%28function%28aAct%29%20%7B%0A%09%09%09%09actClick.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09label%3A%20aAct%5B1%5D%2C%0A%09%09%09%09%09type%3A%20%22radio%22%2C%0A%09%09%09%09%09closemenu%3A%20%22none%22%2C%0A%09%09%09%09%09value%3A%20aAct%5B0%5D%2C%0A%09%09%09%09%09checked%3A%20%28aAct%5B0%5D%20%3D%3D%3D%20that%5B%22_%22%20+%20aP%5B0%5D%5D%29%2C%0A%09%09%09%09%7D%29%29%3B%0A%09%09%09%7D%29%3B%0A%09%09%7D%29%3B%0A%0A%0A%0A%09%09if%20%28%21tNode%20%7C%7C%20%28tNode%20%26%26%20tNode.id%20%21%3D%3D%20that._UID%20+%20%22_translationIconOnURLBar%22%29%29%20%7B%0A%09%09%09var%20popOpts%20%3D%20aNode.appendChild%28%24CNS%28%22menu%22%2C%20%7B%0A%09%09%09%09label%3A%20%22Popup%20options%22%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09%09menugenerated%3A%20true%2C%0A%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%09%5B%0A%09%09%09%09%5B%22zPopTransAnchorToSelection%22%2C%0A%09%09%09%09%09%22Anchor%20to%20selection%22%0A%09%09%09%09%5D%2C%0A%09%09%09%09%5B%22zPopTransAutoCloseOnClick%22%2C%0A%09%09%09%09%09%22Auto%20close%20on%20click%22%0A%09%09%09%09%5D%2C%0A%09%09%09%09%5B%22zPopTransAutoCopyOnClick%22%2C%0A%09%09%09%09%09%22Auto%20copy%20on%20click%22%0A%09%09%09%09%5D%2C%0A%09%09%09%09%5B%22zPopTransFailSafe%22%2C%0A%09%09%09%09%09%22Fail%20safe%20translation%22%0A%09%09%09%09%5D%2C%0A%09%09%09%09%5B%22zPopTransKeepItOpen%22%2C%0A%09%09%09%09%09%22Keep%20it%20open%22%0A%09%09%09%09%5D%2C%0A%09%09%09%09%5B%22zPopTransShowTitleBar%22%2C%0A%09%09%09%09%09%22Show%20titlebar%22%0A%09%09%09%09%5D%2C%0A%09%09%09%09%5B%22zTransOnRelease%22%2C%0A%09%09%09%09%09%22Translate%20on%20release%22%0A%09%09%09%09%5D%2C%0A%09%09%09%09%5B%22zTransOnReleaseControlKey%22%2C%0A%09%09%09%09%09%22Translate%20on%20release%20-%20Require%20Ctrl%20key%22%0A%09%09%09%09%5D%2C%0A%09%09%09%09%5B%22zTransOnReleaseAltKey%22%2C%0A%09%09%09%09%09%22Translate%20on%20release%20-%20Require%20Alt%20key%22%0A%09%09%09%09%5D%2C%0A%09%09%09%09%5B%22zTransOnReleaseShowIcon%22%2C%0A%09%09%09%09%09%22Translate%20on%20release%20-%20Show%20icon%22%0A%09%09%09%09%5D%0A%09%09%09%5D.forEach%28function%28aP%29%20%7B%0A%09%09%09%09popOpts.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09label%3A%20aP%5B1%5D%2C%0A%09%09%09%09%09type%3A%20%22checkbox%22%2C%0A%09%09%09%09%09closemenu%3A%20%22none%22%2C%0A%09%09%09%09%09tooltiptext%3A%20that.optionsDesc%5BaP%5B0%5D%5D%2C%0A%09%09%09%09%09checked%3A%20that%5B%22_%22%20+%20aP%5B0%5D%5D%2C%0A%09%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%22%27%29.MultiTranslator.sPref%28%27%22%20+%20aP%5B0%5D%20+%20%22%27%2C%20%21document.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%22%27%29.MultiTranslator.gPref%28%27%22%20+%20aP%5B0%5D%20+%20%22%27%29%29%3B%22%2C%0A%09%09%09%09%7D%29%29%3B%0A%09%09%09%7D%29%3B%0A%09%09%7D%0A%0A%09%09if%20%28%22gBrowser%22%20in%20window%20%26%26%20%28%21tNode%20%7C%7C%20%28tNode%20%26%26%20tNode.id%20%21%3D%3D%20that._UID%20+%20%22_translationOptionsButton%22%29%29%29%20%7B%0A%09%09%09var%20urlBarOpts%20%3D%20aNode.appendChild%28%24CNS%28%22menu%22%2C%20%7B%0A%09%09%09%09label%3A%20%22Page%20translator%20options%22%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09%09menugenerated%3A%20true%2C%0A%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%09%5B%0A%09%09%09%09%5B%22zPageTransURLBarIconShow%22%2C%0A%09%09%09%09%09%22Show%20icon%20inside%20URL%20bar%22%0A%09%09%09%09%5D%2C%0A%09%09%09%09%5B%22zPageTransURLBarIconMenuMode%22%2C%0A%09%09%09%09%09%22Menu%20mode%22%0A%09%09%09%09%5D%0A%09%09%09%5D.forEach%28function%28aP%29%20%7B%0A%09%09%09%09urlBarOpts.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09label%3A%20aP%5B1%5D%2C%0A%09%09%09%09%09type%3A%20%22checkbox%22%2C%0A%09%09%09%09%09closemenu%3A%20%22none%22%2C%0A%09%09%09%09%09tooltiptext%3A%20that.optionsDesc%5BaP%5B0%5D%5D%2C%0A%09%09%09%09%09checked%3A%20that%5B%22_%22%20+%20aP%5B0%5D%5D%2C%0A%09%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%22%27%29.MultiTranslator.sPref%28%27%22%20+%20aP%5B0%5D%20+%20%22%27%2C%20%21document.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%22%27%29.MultiTranslator.gPref%28%27%22%20+%20aP%5B0%5D%20+%20%22%27%29%29%3B%22%2C%0A%09%09%09%09%7D%29%29%3B%0A%09%09%09%7D%29%3B%0A%09%09%09let%20where%20%3D%20%5B%0A%09%09%09%09%5B1%2C%20%22...opens%20page%20in%20current%20tab.%22%5D%2C%0A%09%09%09%09%5B2%2C%20%22...opens%20page%20in%20new%20tab%20next%20to%20current%20one.%22%5D%2C%0A%09%09%09%09%5B3%2C%20%22...opens%20page%20in%20new%20tab%20in%20background.%22%5D%2C%0A%09%09%09%09%5B4%2C%20%22...opens%20page%20in%20new%20tab%20in%20foreground.%22%5D%2C%0A%09%09%09%5D%3B%0A%0A%09%09%09let%20lClick%20%3D%20urlBarOpts.appendChild%28%24CNS%28%22menu%22%2C%20%7B%0A%09%09%09%09label%3A%20%22Left%20click...%22%2C%0A%09%09%09%09tooltiptext%3A%20%22Left%20click%20action%20on%20URL%20bar%20icon.%22%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09%09menugenerated%3A%20true%2C%0A%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22radiogroup%22%29%29%3B%0A%09%09%09where.forEach%28function%28aP%29%20%7B%0A%09%09%09%09lClick.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09label%3A%20aP%5B1%5D%2C%0A%09%09%09%09%09type%3A%20%22radio%22%2C%0A%09%09%09%09%09closemenu%3A%20%22none%22%2C%0A%09%09%09%09%09checked%3A%20%28that._zPageTransURLBarIconLeftClick%20%3D%3D%3D%20aP%5B0%5D%29%2C%0A%09%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%22%27%29.MultiTranslator.sPref%28%27zPageTransURLBarIconLeftClick%27%2C%20%22%20+%20parseInt%28aP%5B0%5D%2C%2010%29%20+%20%22%29%3B%22%2C%0A%09%09%09%09%7D%29%29%3B%0A%09%09%09%7D%29%3B%0A%0A%09%09%09let%20mClick%20%3D%20urlBarOpts.appendChild%28%24CNS%28%22menu%22%2C%20%7B%0A%09%09%09%09label%3A%20%22Middle%20click...%22%2C%0A%09%09%09%09tooltiptext%3A%20%22Middle%20click%20action%20on%20URL%20bar%20icon.%22%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09%09menugenerated%3A%20true%2C%0A%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22radiogroup%22%29%29%3B%0A%09%09%09where.forEach%28function%28aP%29%20%7B%0A%09%09%09%09mClick.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09label%3A%20aP%5B1%5D%2C%0A%09%09%09%09%09type%3A%20%22radio%22%2C%0A%09%09%09%09%09closemenu%3A%20%22none%22%2C%0A%09%09%09%09%09checked%3A%20%28that._zPageTransURLBarIconMiddleClick%20%3D%3D%3D%20aP%5B0%5D%29%2C%0A%09%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%09%22%27%29.MultiTranslator.sPref%28%27zPageTransURLBarIconMiddleClick%27%2C%20%22%20+%20parseInt%28aP%5B0%5D%2C%2010%29%20+%20%22%29%3B%22%2C%0A%09%09%09%09%7D%29%29%3B%0A%09%09%09%7D%29%3B%0A%0A%09%09%09let%20toLang%20%3D%20urlBarOpts.appendChild%28%24CNS%28%22menu%22%2C%20%7B%0A%09%09%09%09label%3A%20%22Source%20language%22%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09%09menugenerated%3A%20true%2C%0A%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22radiogroup%22%2C%20%7B%0A%09%09%09%09_pref%3A%20%22zPageTransFromLang%22%2C%0A%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%22%27%29.MultiTranslator.sPref%28this.getAttribute%28%27_pref%27%29%2C%20event.target.value%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%09let%20langs%20%3D%20that.langs%3B%0A%09%09%09for%20%28let%20lngF%20in%20langs%29%20%7B%0A%09%09%09%09if%20%28langs.hasOwnProperty%28lngF%29%29%20%7B%0A%09%09%09%09%09toLang.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09%09label%3A%20langs%5BlngF%5D%2C%0A%09%09%09%09%09%09type%3A%20%22radio%22%2C%0A%09%09%09%09%09%09closemenu%3A%20%22none%22%2C%0A%09%09%09%09%09%09group%3A%20that._UID%20+%20%22_pageFromLng%22%2C%0A%09%09%09%09%09%09value%3A%20lngF%2C%0A%09%09%09%09%09%09checked%3A%20%28lngF%20%3D%3D%3D%20that._zPageTransFromLang%29%2C%0A%09%09%09%09%09%7D%29%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%0A%09%09%09let%20fromLang%20%3D%20urlBarOpts.appendChild%28%24CNS%28%22menu%22%2C%20%7B%0A%09%09%09%09label%3A%20%22Destination%20language%22%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22menupopup%22%2C%20%7B%0A%09%09%09%09menugenerated%3A%20true%2C%0A%09%09%09%09onpopupshowing%3A%20%22event.stopPropagation%28%29%3B%22%2C%0A%09%09%09%7D%29%29.appendChild%28%24CNS%28%22radiogroup%22%2C%20%7B%0A%09%09%09%09_pref%3A%20%22zPageTransToLang%22%2C%0A%09%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%09%22%27%29.MultiTranslator.sPref%28this.getAttribute%28%27_pref%27%29%2C%20event.target.value%29%3B%22%2C%0A%09%09%09%7D%29%29%3B%0A%09%09%09for%20%28let%20lngT%20in%20langs%29%20%7B%0A%09%09%09%09if%20%28langs.hasOwnProperty%28lngT%29%29%20%7B%0A%09%09%09%09%09if%20%28lngT%20%3D%3D%3D%20%22%22%29%0A%09%09%09%09%09%09continue%3B%0A%09%09%09%09%09fromLang.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09%09%09%09label%3A%20langs%5BlngT%5D%2C%0A%09%09%09%09%09%09type%3A%20%22radio%22%2C%0A%09%09%09%09%09%09closemenu%3A%20%22none%22%2C%0A%09%09%09%09%09%09group%3A%20that._UID%20+%20%22_pageToLng%22%2C%0A%09%09%09%09%09%09value%3A%20lngT%2C%0A%09%09%09%09%09%09checked%3A%20%28lngT%20%3D%3D%3D%20that._zPageTransToLang%29%2C%0A%09%09%09%09%09%7D%29%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%7D%0A%0A%09%09aNode.appendChild%28%24CNS%28%22separator%22%29%29%3B%0A%09%09aNode.appendChild%28%24CNS%28%22menuitem%22%2C%20%7B%0A%09%09%09label%3A%20%22More%20options%22%2C%0A%09%09%09tooltiptext%3A%20%22Open%20Multi%20Translator%20options%20page.%5Cn%5CnNote%3A%20Preferences%20prefixed%20with%20%22%20+%0A%09%09%09%09%22%5C%22z%5C%22%20%28the%20letter%20ZED%29%20can%20already%20be%20changed%20from%20this%20popup%20and%20some%20are%20used%20internally.%20%22%20+%0A%09%09%09%09%22So%20there%20is%20no%20need%20to%20change%20them%20manually.%22%2C%0A%09%09%09oncommand%3A%20%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27%22%20+%20self.id%20+%0A%09%09%09%09%22%27%29.MultiTranslator._options.Init%28%29%3B%22%2C%0A%09%09%7D%29%29%3B%0A%09%7D%2C%0A%0A%09_options%3A%20%7B%0A%09%09Init%3A%20function%28%29%20%7B%0A%09%09%09var%20url%20%3D%20%22about%3Aconfig%3Ffilter%3D%22%20+%20that.Branch%3B%0A%09%09%09var%20onDocLoad%20%3D%20function%20onDocLoad%28aE%29%20%7B%0A%09%09%09%09window.removeEventListener%28%22DOMContentLoaded%22%2C%20onDocLoad%2C%20true%29%3B%0A%09%09%09%09that._options.loadDesc%28aE%29%3B%0A%09%09%09%7D%3B%0A%09%09%09if%20%28that.gPref%28%22zOpenOptionsInTab%22%29%20%26%26%20%28%22gBrowser%22%20in%20window%29%29%20%7B%0A%09%09%09%09let%20tab%20%3D%20gBrowser.visibleTabs.find%28tab%20%3D%3E%20tab.linkedBrowser.currentURI.spec%20%3D%3D%3D%20url%29%3B%0A%09%09%09%09%21%21tab%20%7C%7C%20window.addEventListener%28%22DOMContentLoaded%22%2C%20onDocLoad%2C%20true%29%3B%0A%09%09%09%09gBrowser.selectedTab%20%3D%20tab%20%7C%7C%20gBrowser.addTab%28url%29%3B%0A%09%09%09%7D%20else%20%7B%0A%09%09%09%09let%20observer%20%3D%20%7B%0A%09%09%09%09%09observe%3A%20function%28aSubject%2C%20aTopic%2C%20aData%29%20%7B%0A%09%09%09%09%09%09aSubject.addEventListener%28%22load%22%2C%20function%20_%28aE%29%20%7B%0A%09%09%09%09%09%09%09Services.obs.removeObserver%28observer%2C%20%22domwindowopened%22%29%3B%0A%09%09%09%09%09%09%09aE.target.removeEventListener%28%22load%22%2C%20_%2C%20false%29%3B%0A%09%09%09%09%09%09%09that._options.loadDesc%28aE%29%3B%0A%09%09%09%09%09%09%7D%2C%20true%29%3B%0A%09%09%09%09%09%7D%2C%0A%09%09%09%09%7D%3B%0A%09%09%09%09let%20win%20%3D%20Services.wm.getMostRecentWindow%28%22Preferences%3AConfigManager%22%29%3B%0A%09%09%09%09if%20%28win%29%20%7B%0A%09%09%09%09%09win.focus%28%29%3B%0A%09%09%09%09%09return%3B%0A%09%09%09%09%7D%0A%09%09%09%09Services.obs.addObserver%28observer%2C%20%22domwindowopened%22%2C%20false%29%3B%0A%09%09%09%09setTimeout%28function%28%29%20%7B%0A%09%09%09%09%09toOpenWindowByType%28%22Preferences%3AConfigManager%22%2C%20url%29%3B%0A%09%09%09%09%7D%2C%2010%29%3B%0A%09%09%09%7D%0A%09%09%7D%2C%0A%0A%09%09loadDesc%3A%20function%28aE%29%20%7B%0A%09%09%09const%20ROOT%20%3D%20that.Branch%3B%0A%0A%09%09%09var%20doc%20%3D%20aE.target%2C%0A%09%09%09%09win%3B%0A%09%09%09if%20%28%21doc%20%26%26%20%21%28doc.location.href.startsWith%28%22chrome%3A//global/content/config.xul%22%29%20%7C%7C%0A%09%09%09%09%09doc.location.href.startsWith%28%22about%3Aconfig%22%29%29%29%0A%09%09%09%09return%3B%0A%09%09%09if%20%28%21doc.getElementById%28%22configTree%22%29%29%0A%09%09%09%09return%3B%0A%09%09%09win%20%3D%20doc.defaultView%3B%0A%0A%09%09%09var%20curTab%20%3D%20document.getElementsByTagName%28%22tab%22%29%3B%0A%09%09%09for%20%28let%20i%20%3D%20curTab.length%20-%201%3B%20i%20%3E%3D%200%3B%20i--%29%20%7B%0A%09%09%09%09if%20%28curTab%5Bi%5D.selected%29%20%7B%0A%09%09%09%09%09let%20newLabel%20%3D%20self.name%20+%20%22%20preference%20window.%22%3B%0A%09%09%09%09%09curTab%5Bi%5D.setAttribute%28%22visibleLabel%22%2C%20newLabel%29%3B%0A%09%09%09%09%09curTab%5Bi%5D.setAttribute%28%22label%22%2C%20newLabel%29%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%09var%20tB%20%3D%20win.document.getElementById%28%22textbox%22%29%3B%0A%09%09%09tB.value%20%3D%20ROOT%3B%0A%09%09%09tB.doCommand%28%29%3B%0A%09%09%09tB.setAttribute%28%22readonly%22%2C%20true%29%3B%0A%09%09%09setTimeout%28function%28%29%20%7B%0A%09%09%09%09var%20tree%20%3D%20win.document.getElementById%28%22configTree%22%29%3B%0A%09%09%09%09var%20treecols%20%3D%20tree.firstChild%3B%0A%09%09%09%09var%20newSplit%20%3D%20win.document.createElement%28%22splitter%22%29%3B%0A%09%09%09%09newSplit.setAttribute%28%22class%22%2C%20%22tree-splitter%22%29%3B%0A%09%09%09%09var%20newCol%20%3D%20win.document.createElement%28%22treecol%22%29%3B%0A%09%09%09%09newCol.setAttribute%28%22id%22%2C%20%22descCol%22%29%3B%0A%09%09%09%09newCol.setAttribute%28%22label%22%2C%20%22Description%22%29%3B%0A%09%09%09%09newCol.setAttribute%28%22flex%22%2C%2012%29%3B%0A%09%09%09%09treecols.appendChild%28newSplit%29%3B%0A%09%09%09%09treecols.appendChild%28newCol%29%3B%0A%09%09%09%09var%20prefsArr%20%3D%20win.gPrefArray%3B%0A%09%09%09%09for%20%28let%20i%20%3D%20prefsArr.length%20-%201%3B%20i%20%3E%3D%200%3B%20i--%29%20%7B%0A%09%09%09%09%09if%20%28prefsArr%5Bi%5D.prefCol.match%28ROOT%29%29%20%7B%0A%09%09%09%09%09%09var%20prefName%20%3D%20prefsArr%5Bi%5D.prefCol%3B%0A%09%09%09%09%09%09let%20prefDesc%20%3D%20that.optionsDesc%5BprefName.slice%28ROOT.length%29%5D%3B%0A%09%09%09%09%09%09prefsArr%5Bi%5D.descCol%20%3D%20prefDesc%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%7D%0A%09%09%09%09let%20branch%20%3D%20Services.prefs.getBranch%28ROOT%29%3B%0A%09%09%09%09var%20prefListener%20%3D%20%7B%0A%09%09%09%09%09observe%3A%20function%28subject%2C%20topic%2C%20prefName%29%20%7B%0A%09%09%09%09%09%09if%20%28topic%20%21%3D%3D%20%22nsPref%3Achanged%22%29%0A%09%09%09%09%09%09%09return%3B%0A%09%09%09%09%09%09win.setTimeout%28function%28%29%20%7B%0A%09%09%09%09%09%09%09var%20prefObj%20%3D%20win.gPrefHash%5BROOT%20+%20prefName%5D%3B%0A%09%09%09%09%09%09%09if%20%28%21prefObj%29%0A%09%09%09%09%09%09%09%09return%3B%0A%09%09%09%09%09%09%09var%20viewIndex%20%3D%20win.getViewIndexOfPref%28prefObj%29%3B%0A%09%09%09%09%09%09%09var%20arrayIndex%20%3D%20win.getIndexOfPref%28prefObj%29%3B%0A%09%09%09%09%09%09%09let%20prefDesc%20%3D%20that.optionsDesc%5BprefName%5D%3B%0A%09%09%09%09%09%09%09win.gPrefArray%5BarrayIndex%5D.descCol%20%3D%20prefDesc%3B%0A%09%09%09%09%09%09%09if%20%28viewIndex%20%3E%3D%200%29%20%7B%0A%09%09%09%09%09%09%09%09win.gPrefView%5BviewIndex%5D%20%3D%20win.gPrefArray%5BarrayIndex%5D%3B%0A%09%09%09%09%09%09%09%09tree.treeBoxObject.invalidateRow%28viewIndex%29%3B%0A%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%7D%2C%20100%29%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%7D%3B%0A%09%09%09%09branch.addObserver%28%22%22%2C%20prefListener%2C%20false%29%3B%0A%09%09%09%09let%20unLoad%20%3D%20function%20unLoad%28%29%20%7B%0A%09%09%09%09%09win.removeEventListener%28%22unload%22%2C%20unLoad%2C%20false%29%3B%0A%09%09%09%09%09branch.removeObserver%28%22%22%2C%20prefListener%29%3B%0A%09%09%09%09%7D%3B%0A%09%09%09%09win.addEventListener%28%22unload%22%2C%20unLoad%2C%20false%29%3B%0A%09%09%09%7D%2C%20250%29%3B%0A%09%09%7D%2C%0A%09%7D%2C%0A%0A%09clickOnTransResult%3A%20function%28aValue%29%20%7B%0A%09%09if%20%28that._zPopTransAutoCopyOnClick%29%0A%09%09%09gClipboard.write%28aValue%29%3B%0A%09%09if%20%28that._zPopTransAutoCloseOnClick%29%0A%09%09%09that.HidePanel%28%29%3B%0A%09%7D%2C%0A%0A%09HTMLCSSLoader%3A%20function%28%29%20%7B%0A%09%09let%20css%3B%0A%09%09try%20%7B%0A%09%09%09css%20%3D%20%22@namespace%20url%28%22%20+%20xhtmlns%20+%20%22%29%3B%5Cn%22%20+%20getHelp%28%22HTMLStyleSheet%22%29.replace%28/_U_I_D_/g%2C%20that._UID%29%3B%0A%09%09%7D%20catch%20%28aErr%29%20%7B%0A%09%09%09css%20%3D%20false%3B%0A%09%09%7D%0A%09%09if%20%28%21css%29%0A%09%09%09return%3B%0A%0A%09%09if%20%28%21window%5Bthat._UID%5D%5B%22HTMLStyleSheet%22%5D%29%20%7B%0A%09%09%09window%5Bthat._UID%5D%5B%22HTMLStyleSheet%22%5D%20%3D%20css%3B%0A%09%09%09styleSheet%28css%29%3B%0A%09%09%7D%20else%20if%20%28window%5Bthat._UID%5D%5B%22HTMLStyleSheet%22%5D%20%26%26%20window%5Bthat._UID%5D%5B%22HTMLStyleSheet%22%5D%20%21%3D%3D%20css%29%20%7B%0A%09%09%09styleSheet%28window%5Bthat._UID%5D%5B%22HTMLStyleSheet%22%5D%2C%20true%29%3B%0A%09%09%09window%5Bthat._UID%5D%5B%22HTMLStyleSheet%22%5D%20%3D%20css%3B%0A%09%09%09styleSheet%28css%29%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09XULCSSLoader%3A%20function%28%29%20%7B%0A%09%09let%20css%3B%0A%09%09try%20%7B%0A%09%09%09css%20%3D%20%22@namespace%20url%28%22%20+%20xulns%20+%20%22%29%3B%5Cn%22%20+%20getHelp%28%22XULStyleSheet%22%29%0A%09%09%09%09.replace%28/_B_I_N_D_I_N_G_/g%2C%20that._isSM%20%3F%20%22%22%20%3A%20%22%22%29%0A%09%09%09%09.replace%28/_U_I_D_/g%2C%20that._UID%29%3B%0A%09%09%7D%20catch%20%28aErr%29%20%7B%0A%09%09%09css%20%3D%20false%3B%0A%09%09%7D%0A%09%09if%20%28%21css%29%0A%09%09%09return%3B%0A%0A%09%09if%20%28%21window%5Bthat._UID%5D%5B%22XULStyleSheet%22%5D%29%20%7B%0A%09%09%09window%5Bthat._UID%5D%5B%22XULStyleSheet%22%5D%20%3D%20css%3B%0A%09%09%09styleSheet%28css%29%3B%0A%09%09%7D%20else%20if%20%28window%5Bthat._UID%5D%5B%22XULStyleSheet%22%5D%20%26%26%20window%5Bthat._UID%5D%5B%22XULStyleSheet%22%5D%20%21%3D%3D%20css%29%20%7B%0A%09%09%09styleSheet%28window%5Bthat._UID%5D%5B%22XULStyleSheet%22%5D%2C%20true%29%3B%0A%09%09%09window%5Bthat._UID%5D%5B%22XULStyleSheet%22%5D%20%3D%20css%3B%0A%09%09%09styleSheet%28css%29%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09HandlePrefListener%3A%20function%28aRem%29%20%7B%0A%09%09var%20prefs%20%3D%20that.DefPrefs%3B%0A%09%09for%20%28let%20key%20in%20prefs%29%20%7B%0A%09%09%09let%20pref%20%3D%20that.Branch%20+%20key%3B%0A%09%09%09if%20%28prefs.hasOwnProperty%28key%29%29%20%7B%0A%09%09%09%09if%20%28aRem%29%0A%09%09%09%09%09Services.prefs.removeObserver%28pref%2C%20that.PrefListener%2C%20false%29%3B%0A%09%09%09%09else%0A%09%09%09%09%09Services.prefs.addObserver%28pref%2C%20that.PrefListener%2C%20false%29%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%2C%0A%0A%09PrefListener%3A%20%7B%0A%09%09observe%3A%20function%28aSubject%2C%20aTopic%2C%20aPStr%29%20%7B%0A%09%09%09if%20%28aTopic%20%3D%3D%3D%20%22nsPref%3Achanged%22%29%20%7B%0A%09%09%09%09let%20prefName%20%3D%20aPStr.slice%28that.Branch.length%29%3B%0A%09%09%09%09that%5B%22_%22%20+%20prefName%5D%20%3D%20that.gPref%28prefName%29%3B%0A%09%09%09%09switch%20%28prefName%29%20%7B%0A%09%09%09%09%09case%20%22zPopTransFromLang%22%3A%0A%09%09%09%09%09case%20%22zPopTransToLang%22%3A%0A%09%09%09%09%09%09that.TranslateSelection%28%29%3B%0A%09%09%09%09%09%09break%3B%0A%09%09%09%09%09case%20%22PopupShowFooter%22%3A%0A%09%09%09%09%09%09that.setFooter%28%29%3B%0A%09%09%09%09%09%09break%3B%0A%09%09%09%09%09case%20%22zPopTransEngine%22%3A%0A%09%09%09%09%09%09if%20%28that.transPop.state%20%3D%3D%3D%20%22open%22%29%0A%09%09%09%09%09%09%09that.TranslateSelection%28%29%3B%0A%09%09%09%09%09%09that.transPop.label%20%3D%20that.getEng%28%22label%22%2C%20true%29%3B%0A%09%09%09%09%09%09%24%28that._UID%20+%20%22_translationOptionsButton%22%29.image%20%3D%20that.getEng%28%22image%22%2C%20true%29%3B%0A%09%09%09%09%09%09that.setFooter%28%29%3B%0A%09%09%09%09%09%09break%3B%0A%09%09%09%09%09case%20%22zUseTransPageHotkey%22%3A%0A%09%09%09%09%09case%20%22zUseTransSelHotkey%22%3A%0A%09%09%09%09%09case%20%22zUseTransClipHotkey%22%3A%0A%09%09%09%09%09%09that.HandleHotkey%28%29%3B%0A%09%09%09%09%09%09break%3B%0A%09%09%09%09%09case%20%22zShowContextMenuItems%22%3A%0A%09%09%09%09%09case%20%22zPopTransShowTitleBar%22%3A%0A%09%09%09%09%09%09that._cleanSlate%28%29%3B%0A%09%09%09%09%09%09break%3B%0A%09%09%09%09%09case%20%22zTransOnRelease%22%3A%0A%09%09%09%09%09%09try%20%7B%0A%09%09%09%09%09%09%09that.RemoveListeners%28true%29%3B%0A%09%09%09%09%09%09%7D%20finally%20%7B%0A%09%09%09%09%09%09%09if%20%28that._isMultiProcess%29%20%7B%0A%09%09%09%09%09%09%09%09if%20%28%21that._zTransOnRelease%29%20%7B%0A%09%09%09%09%09%09%09%09%09notifyme%28self.name%2C%20%22You%20are%20using%20Firefox%20multi-process.%20%22%20+%0A%09%09%09%09%09%09%09%09%09%09%22Is%20not%20possible%20to%20disable%20this%20option%20for%20now.%22%2C%20that.Images%5B2%5D%29%3B%0A%09%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%09%09that._zTransOnRelease%20%3D%20true%3B%0A%09%09%09%09%09%09%09%09that.sPref%28%22zTransOnRelease%22%2C%20true%29%3B%0A%09%09%09%09%09%09%09%09//%20Services.prompt.alert%28null%2C%20self.name%2C%20%22You%20are%20using%20Firefox%20multi-process.%5Cn%22%20+%0A%09%09%09%09%09%09%09%09//%20%22Is%20not%20possible%20to%20disable%20this%20option%20for%20now.%22%29%3B%0A%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%09that.AddListeners%28%29%3B%0A%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09break%3B%0A%09%09%09%09%09case%20%22HotkeyTransSelKey%22%3A%0A%09%09%09%09%09case%20%22HotkeyTransSelModifiers%22%3A%0A%09%09%09%09%09case%20%22HotkeyTransPageKey%22%3A%0A%09%09%09%09%09case%20%22HotkeyTransPageModifiers%22%3A%0A%09%09%09%09%09case%20%22HotkeyTransClipKey%22%3A%0A%09%09%09%09%09case%20%22HotkeyTransClipModifiers%22%3A%0A%09%09%09%09%09%09notifyme%28self.name%2C%20%22The%20application%20needs%20to%20be%20restarted%20%22%20+%0A%09%09%09%09%09%09%09%22for%20the%20new%20hotkey%20to%20take%20effect.%22%2C%20that.Images%5B2%5D%29%3B%0A%09%09%09%09%09%09break%3B%0A%09%09%09%09%09case%20%22zPageTransEngine%22%3A%0A%09%09%09%09%09%09let%20icon%20%3D%20%24%28that._UID%20+%20%22_translationIconOnURLBar%22%29%3B%0A%09%09%09%09%09%09icon%20%26%26%20%28icon.hidden%20%3D%20%28that._zPageTransEngine%20%3D%3D%3D%200%29%29%3B%0A%09%09%09%09%09%09icon%20%26%26%20icon.setAttribute%28%22src%22%2C%20that.getEng%28%22image%22%29%29%3B%0A%09%09%09%09%09%09that.AssignImages%28document.getElementById%28that._UID%20+%20%22_self_popup%22%29%29%3B%0A%09%09%09%09%09%09break%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%2C%0A%0A%09_cleanSlateTimer%3A%200%2C%0A%09_cleanSlate%3A%20function%28%29%20%7B%0A%09%09clearTimeout%28that._cleanSlateTimer%29%3B%0A%09%09that._cleanSlateTimer%20%3D%20setTimeout%28function%28%29%20%7B%0A%09%09%09self.destroy%28%22update%22%29%3B%0A%09%09%09setTimeout%28function%28%29%20%7B%0A%09%09%09%09self.init%28%29%3B%0A%09%09%09%7D%2C%20100%29%3B%0A%09%09%7D%2C%20100%29%3B%0A%09%7D%2C%0A%0A%09Images%3A%20%7B%0A%09%09//%20%22Generic%22%20image.%0A%09%090%3A%20%22data%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAlUlEQVQ4jZ2SsQ3%22%20+%0A%09%09%09%22AIAwEPQZ1RmUHFshAjMAEKB10EamQHvMmJJbcIPv8bywiIsd5NZayE9gQYvkO6Y253kMiYAnE6bneLcQyKGH%22%20+%0A%09%09%09%221FKAVdIilerKgFTAA3Q9aQNDKgmnj1zfuxNYA51NzPk1T+7uVtIgB8FZCLHMtm67huGyqeGVB34llWbQVBKA%22%20+%0A%09%09%09%22NE2AB8bhMC28QtuwH60eZmq06S4kAAAAASUVORK5CYII%3D%22%2C%0A%09%09//%20Bing%20translator%20image.%0A%09%091%3A%20%22data%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAG1BMVEX///9TrE0%22%20+%0A%09%09%09%229h7JGm8pYosyQwImytLKpw9Itmkc183vaAAAAAXRSTlMAQObYZgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAGB%22%20+%0A%09%09%09%22JREFUeF4tisEJw0AMBCcCE5VwTyEM+buEVGB34BKuBPl3ZUcLmceiGYQgDEFmQLxzErLvxDLhs0M07AdGhJG%22%20+%0A%09%09%09%22pwRDZDVaBAjh/vFjK6yn8Kl7n1iO5+xhDxcsf9FMF8AODfBEY/ip2BgAAAABJRU5ErkJggg%3D%3D%22%2C%0A%09%09//%20Google%20translator%20image.%0A%09%092%3A%20%22data%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAG1BMVEUAAAB3eHh%22%20+%0A%09%09%09%22NjPR9kp9SjvGwvc7W2dzl5eZJVpIrrSH9AAAAAXRSTlMAQObYZgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAGF%22%20+%0A%09%09%09%22JREFUeF5dyUEOQDAQheE5y4u6gLBXo/ZEHUBML0B6Aoljm1Ib/2y+zCNmtqQl4A+LJcaoOOAe9B4mKFA6a1Y%22%20+%0A%09%09%09%22fCIOMqKqFMBc76lon1usanVJtIy/M9GETSl2nZPgMfcgN6PAcsIoF//oAAAAASUVORK5CYII%3D%22%2C%0A%09%09//%20Yandex%20image.%0A%09%093%3A%20%22data%3Aimage/gif%3Bbase64%2CR0lGODlhEAAQAHMAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCgAPACwAAAAAEAA%22%20+%0A%09%09%09%22QAIMAAAD/EQ0iIiIzMzNERERVVVVmZmZ3d3eJiYn2c3Grq6vxtrXd0tLp6Ojy+fkAAAAEUvBJ2Zx1beq37m1%22%20+%0A%09%09%09%22LsgWdtwRoMKUVlqSplCZNA6PJIr34nTC1B+iW6tSOjtPNeEQqUaVmpsULVKSUSpWBaWYdVeZ1op1hLpsGw4z%22%20+%0A%09%09%09%22eCMMYtwbmjgAAOw%3D%3D%22%2C%0A%09%7D%2C%0A%09_UID%3A%20%22__multi_translator_%22%20+%20self.id.slice%2820%29%2C%0A%09globalMM%3A%20Cc%5B%22@mozilla.org/globalmessagemanager%3B1%22%5D.getService%28Ci.nsIMessageListenerManager%29%2C%0A%09place%3A%20null%2C%0A%09timer%3A%20null%2C%0A%09TIMEOUT%3A%2015000%2C%0A%09_globalMM%3A%20Cc%5B%22@mozilla.org/globalmessagemanager%3B1%22%5D.getService%28Ci.nsIMessageListenerManager%29%2C%0A%09_randomID%3A%20null%2C%0A%0A%09get%20transPop%28%29%20%7B%0A%09%09return%20document.getElementById%28that._UID%20+%20%22_translationPopup%22%29%3B%0A%09%7D%2C%0A%0A%09get%20_responseMsgID%28%29%20%7B%0A%09%09return%20%22CB%3AMultiTranslator%3AResponse%3A%22%20+%20self.id.slice%2814%29%20+%20%22-%22%3B%0A%09%7D%2C%0A%0A%09get%20_onReleaseIconMsgID%28%29%20%7B%0A%09%09return%20%22CB%3AMultiTranslator%3ATranslateOnReleaseIcon%3A%22%20+%20self.id.slice%2814%29%20+%20%22-%22%20+%20that._randomID%3B%0A%09%7D%2C%0A%0A%09get%20_middleClickMsgID%28%29%20%7B%0A%09%09return%20%22CB%3AMultiTranslator%3ATranslateOnReleaseIcon%3A%22%20+%20self.id.slice%2814%29%20+%20%22-%22%20+%20that._randomID%3B%0A%09%7D%2C%0A%0A%09get%20_translateSelMsgID%28%29%20%7B%0A%09%09return%20%22CB%3AMultiTranslator%3ATranslateSelection%3A%22%20+%20self.id.slice%2814%29%20+%20%22-%22%20+%20that._randomID%3B%0A%09%7D%2C%0A%0A%09get%20_movePopupMsgID%28%29%20%7B%0A%09%09return%20%22CB%3AMultiTranslator%3AMovePopup%3A%22%20+%20self.id.slice%2814%29%20+%20%22-%22%20+%20that._randomID%3B%0A%09%7D%2C%0A%0A%09get%20_isMultiProcess%28%29%20%7B%0A%09%09let%20a%20%3D%20%22gMultiProcessBrowser%22%20in%20window%3B%0A%09%09return%20a%20%3F%20gMultiProcessBrowser%20%3A%20false%3B%0A%09%7D%2C%0A%0A%09get%20_isSM%28%29%20%7B%0A%09%09return%20Services.appinfo.ID%20%3D%3D%3D%20%22%7B92650c4d-4b8e-4d2a-b7eb-24ecf4f6b63a%7D%22%3B%0A%09%7D%2C%0A%7D%3B%0A%0Athis.MultiTranslator.optionsDesc%20%3D%20%7B%7D%3B%0A%0Athis.MultiTranslator.optionsDesc.where%20%3D%20%221%20%3D%20Current%20tab.%5Cn2%20%3D%20In%20a%20new%20tab%20next%20to%20current%20one.%5Cn3%22%20+%0A%09%22%20%3D%20In%20a%20new%20tab%20in%20the%20background.%5Cn4%20%3D%20In%20a%20new%20tab%20in%20the%20foreground.%22%3B%0A%0Athis.MultiTranslator.optionsDesc.what%20%3D%20%22%5CnPossible%20actions%20are%3A%5Cn0%20%3D%20Disable.%20It%20disables%20the%20cli%22%20+%0A%09%22ck%20combination%20on%20Multi%20Translator%20button.%5Cn%22%20+%0A%09%221%20%3D%20Open%20main%20menu.%5Cn%22%20+%0A%09%222%20%3D%20Translate%20selection.%5Cn%22%20+%0A%09%223%20%3D%20Translate%20current%20page.%5Cn%22%20+%0A%09%224%20%3D%20Translate%20clipboard%20content.%5Cn%22%20+%0A%09%225%20%3D%20Open%20page%20translation%20menu.%22%3B%0A%0Athis.MultiTranslator.optionsDesc%20%3D%20%7B%0A%09zButtonClickActionLeft%3A%20%22Left%20click%20on%20button%20action.%22%20+%20that.optionsDesc.what%2C%0A%09zButtonClickActionMiddle%3A%20%22Middle%20click%20on%20button%20action.%22%20+%20that.optionsDesc.what%2C%0A%09zButtonClickActionLeftCtrl%3A%20%22Ctrl%20+%20left%20click%20on%20button%20action.%22%20+%20that.optionsDesc.what%2C%0A%09zButtonClickActionLeftShift%3A%20%22Shift%20+%20left%20click%20on%20button%20action.%22%20+%20that.optionsDesc.what%2C%0A%09zButtonClickActionLeftCtrlShift%3A%20%22Ctrl%20+%20Shift%20+%20left%20click%20on%20button%20action.%22%20+%20that.optionsDesc.what%2C%0A%09zOpenOptionsInTab%3A%20%22If%20enabled/checked%2C%20it%20will%20open%20the%20Multi%20Translator%20options%20page%20in%20a%20ne%22%20+%0A%09%09%22w%20tab.%20If%20disabled/unchecked%2C%20the%20Multi%20Translator%20options%20page%20will%20be%20openend%20in%20a%20new%20%22%20+%0A%09%09%22window.%22%2C%0A%09zShowContextMenuItems%3A%20%22If%20enabled/checked%2C%20all%20the%20translate%20options%20will%20be%20added%20to%20the%20pag%22%20+%0A%09%09%22e%20context%20menu.%22%2C%0A%09zUseTransPageHotkey%3A%20%22Enable/Disable%20the%20use%20of%20%5C%22Translate%20Page%5C%22%20hotkey.%22%2C%0A%09zUseTransSelHotkey%3A%20%22Enable/Disable%20the%20use%20of%20%5C%22Translate%20Selection%5C%22%20hotkey.%22%2C%0A%09zUseTransClipHotkey%3A%20%22Enable/Disable%20the%20use%20of%20%5C%22Translate%20Clipboard%20Content%5C%22%20hotkey.%22%2C%0A%09zPageTransURLBarIconMenuMode%3A%20%22With%20this%20mode%20enabled%2C%20a%20left%20click%20on%20the%20URL%20bar%20icon%20will%20d%22%20+%0A%09%09%22isplay%20a%20menu%20with%20all%20avaiable%20engines.%20Clicking%20on%20any%20menu%20item%20will%20directly%20translat%22%20+%0A%09%09%22e%20the%20current%20page%20without%20the%20need%20to%20change%20the%20default%20engine.%5CnThe%20translated%20page%20wi%22%20+%0A%09%09%22ll%20be%20opened%20obeying%20the%20preference%20%5C%22Left%20click...%5C%22%22%2C%0A%09zPopTransAnchorToSelection%3A%20%22If%20enabled/checked%2C%20the%20popup%20with%20the%20translation%20will%20be%20displa%22%20+%0A%09%09%22yed%20anchored%20to%20the%20selected%20text.%20If%20disabled/unchecked%2C%20the%20popup%20will%20be%20displayed%20anc%22%20+%0A%09%09%22hored%20to%20the%20top-left%20corner%20of%20the%20page%20content.%22%2C%0A%09zPopTransAutoCloseOnClick%3A%20%22If%20enabled/checked%2C%20the%20popup%20will%20be%20closed%20when%20the%20translation%20%22%20+%0A%09%09%22result%20is%20clicked.%22%2C%0A%09zPopTransAutoCopyOnClick%3A%20%22If%20enabled/checked%2C%20the%20translation%20result%20inside%20the%20popup%20will%20be%22%20+%0A%09%09%22%20copied%20to%20the%20clipboard%20when%20the%20text%20is%20clicked.%22%2C%0A%09zPopTransFailSafe%3A%20%22If%20enabled/checked%2C%20and%20the%20selected%20text%20exceeds%20the%20max.%20length%20of%20chara%22%20+%0A%09%09%22cters%20allowed%20for%20the%20current%20translation%20engine%2C%20instead%20of%20showing%20the%20popup%20with%20the%20c%22%20+%0A%09%09%22ut%20down%20text%20translated%2C%20it%20will%20translate%20the%20full%20length%20of%20the%20selection%20on%20a%20new%20tab.%22%2C%0A%09zPopTransKeepItOpen%3A%20%22If%20enabled/checked%2C%20the%20popup%20with%20the%20translation%20will%20only%20be%20closed%20w%22%20+%0A%09%09%22hen%20%5C%22Popup%20auto%20close%20on%20click%5C%22%20is%20enabled%20or%20when%20clicking%20the%20close%20button%20on%20the%20tit%22%20+%0A%09%09%22lebar%20%28if%20%5C%22Popup%20show%20titlebar%5C%22%20is%20enabled%29.%20If%20disabled/unchecked%2C%20the%20popup%20will%20clos%22%20+%0A%09%09%22e%20every%20time%20you%20click%20outside%20of%20it.%22%2C%0A%09zPopTransShowTitleBar%3A%20%22If%20enabled/checked%2C%20the%20popup%20with%20the%20translation%20will%20dispay%20a%20title%22%20+%0A%09%09%22bar.%22%2C%0A%09zTransOnRelease%3A%20%22If%20enabled/checked%2C%20the%20popup%20with%20the%20translation%20will%20show%20up%20when%20you%20fin%22%20+%0A%09%09%22ish%20to%20select%20text%20and%20the%20mouse%20button%20is%20released.%20If%20disabled/unchecked%2C%20the%20translati%22%20+%0A%09%09%22opup%20will%20show%20up%20only%20when%20pressing%20the%20Middle%20mouse%20button%20%28on%20the%20selection%20oron%20p%20any%22%20+%0A%09%09%22where%20on%20the%20page%29.%22%2C%0A%09zTransOnReleaseControlKey%3A%20%22If%20enabled/checked%2C%20the%20popup%20with%20the%20translation%20will%20ONLY%20show%20%22%20+%0A%09%09%22up%20if%20the%20Control%20key%20is%20pressed%20when%20the%20mouse%20button%20is%20released.%5Cn%5CnCan%20be%20combined%20wi%22%20+%0A%09%09%22th%20%5C%22Require%20Alt%20key%5C%22%20option.%22%2C%0A%09zTransOnReleaseAltKey%3A%20%22If%20enabled/checked%2C%20the%20popup%20with%20the%20translation%20will%20ONLY%20show%20up%20i%22%20+%0A%09%09%22f%20the%20Alt%20key%20is%20pressed%20when%20the%20mouse%20button%20is%20released.%5Cn%5CnCan%20be%20combined%20with%20%5C%22Req%22%20+%0A%09%09%22uire%20Ctrl%20key%5C%22%20option.%22%2C%0A%09zTransOnReleaseShowIcon%3A%20%22If%20enabled/checked%2C%20and%20%5C%22Translate%20on%20release%5C%22%20is%20enabled%2C%20instead%22%20+%0A%09%09%22%20of%20directly%20displaying%20the%20popup%20with%20the%20translation%20%5C%22on%20release%5C%22%2C%20it%20will%20show%20an%20ic%22%20+%0A%09%09%22on.%20The%20popup%20with%20the%20translation%20will%20show%20up%20only%20when%20hovering%20over%20this%20icon.%22%2C%0A%09HotkeyTransPageKey%3A%20%22Key%20for%20the%20page%20translation%20hotkey.%22%2C%0A%09HotkeyTransPageModifiers%3A%20%22Modifier/s%20for%20the%20page%20translation%20hotkey.%22%2C%0A%09HotkeyTransSelKey%3A%20%22Key%20for%20the%20translate%20selection%20hotkey.%22%2C%0A%09HotkeyTransSelModifiers%3A%20%22Modifier/s%20for%20the%20translate%20selection%20hotkey%22%2C%0A%09HotkeyTransClipKey%3A%20%22Key%20for%20the%20translate%20clipboard%20content%20hotkey%22%2C%0A%09HotkeyTransClipModifiers%3A%20%22Modifier/s%20for%20the%20translate%20clipboard%20content%20hotkey%22%2C%0A%09PopupMaxStringLength%3A%20%22Maximum%20amount%20of%20characters%20to%20translate%20from%20the%20selected%20text.%5CnDefa%22%20+%0A%09%09%22ult%201024%5CnBing%20translator%20is%20cut%20down%20automatically%20to%20150%20characters%20and%20Yandex%20translat%22%20+%0A%09%09%22or%20is%20cut%20down%20automatically%20to%20500%20characters.%22%2C%0A%09PopupMaxWidth%3A%20%22Max.%20width%20for%20the%20translation%20popup.%22%2C%0A%09PopTransFailSafeOpenURLWhere%3A%20%22Where%20to%20open%20the%20page%20if%20the%20option%20%5C%22Fail%20safe%20translation%5C%22%20%22%20+%0A%09%09%22is%20enabled.%5Cn%22%20+%20that.optionsDesc.where%2C%0A%09PopupShowFooter%3A%20%22Show%20%5C%22Service%20provided%20by...%5C%22%20footer%20inside%20the%20popup%20translatipn.%5CnClicki%22%20+%0A%09%09%22ng%20on%20it%20will%20open%20the%20translation%20service%20provider%20page.%22%2C%0A%09TransOnReleaseIconOffsetX%3A%20%22Horizontal%20offset%20with%20respect%20to%20the%20cursor%20in%20which%20the%20%5C%22Transl%22%20+%0A%09%09%22ate%20in%20release%5C%22%20icon%20should%20appear.%22%2C%0A%09TransOnReleaseIconOffsetY%3A%20%22Vertical%20offset%20with%20respect%20to%20the%20cursor%20in%20which%20the%20%5C%22Translat%22%20+%0A%09%09%22e%20in%20release%5C%22%20icon%20should%20appear.%22%2C%0A%09zPageTransURLBarIconLeftClick%3A%20%22Where%20to%20open%20the%20translated%20page%20when%20left-clicking%20the%20URL%20b%22%20+%0A%09%09%22ar%20icon.%5Cn%22%20+%20that.optionsDesc.where%2C%0A%09zPageTransURLBarIconMiddleClick%3A%20%22Where%20to%20open%20the%20translated%20page%20when%20middle-clicking%20the%20U%22%20+%0A%09%09%22RL%20bar%20icon.%5Cn%22%20+%20that.optionsDesc.where%2C%0A%09zPageTransURLBarIconShow%3A%20%22Show%20%5C%22Page%20translator%5C%22%20icon%20inside%20the%20URL%20bar.%22%2C%0A%09zPageTransEngine%3A%20%22Engine%20for%20the%20Page%20translator.%22%2C%0A%09zPageTransFromLang%3A%20%22Source%20language%20for%20the%20URL%20bar%20icon%20engine.%22%2C%0A%09zPageTransToLang%3A%20%22Destination%20language%20for%20the%20URL%20bar%20icon%20engine.%22%2C%0A%09zPopTransEngine%3A%20%22Engine%20for%20the%20popup%20translator.%22%2C%0A%09zPopTransFromLang%3A%20%22Source%20language%20for%20the%20popup%20translator%20engine.%22%2C%0A%09zPopTransToLang%3A%20%22Destination%20language%20for%20the%20popup%20translator%20engine.%22%2C%0A%7D%3B%0A%0Athis.MultiTranslator.Branch%20%3D%20%22CB.MultiTranslator.Id%22%20+%20self.id.slice%2820%29%20+%20%22.%22%3B%0A%0Athis.MultiTranslator.gPref%20%3D%20function%28aKey%29%20%7B%0A%09let%20branch%20%3D%20Services.prefs.getBranch%28that.Branch%29%3B%0A%09switch%20%28typeof%20that.DefPrefs%5BaKey%5D%29%20%7B%0A%09%09case%20%22boolean%22%3A%0A%09%09%09return%20branch.getBoolPref%28aKey%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22number%22%3A%0A%09%09%09return%20branch.getIntPref%28aKey%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22string%22%3A%0A%09%09%09return%20branch.getComplexValue%28aKey%2C%20Ci.nsISupportsString%29.data%3B%0A%09%09%09break%3B%0A%09%7D%0A%09return%20null%3B%0A%7D%3B%0A%0Athis.MultiTranslator.sPref%20%3D%20function%28aKey%2C%20aVal%29%20%7B%0A%09let%20branch%20%3D%20Services.prefs.getBranch%28that.Branch%29%3B%0A%09switch%20%28typeof%20aVal%29%20%7B%0A%09%09case%20%22boolean%22%3A%0A%09%09%09branch.setBoolPref%28aKey%2C%20aVal%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22number%22%3A%0A%09%09%09branch.setIntPref%28aKey%2C%20aVal%29%3B%0A%09%09%09break%3B%0A%09%09case%20%22string%22%3A%0A%09%09%09let%20str%20%3D%20Cc%5B%22@mozilla.org/supports-string%3B1%22%5D.createInstance%28Ci.nsISupportsString%29%3B%0A%09%09%09str.data%20%3D%20aVal%3B%0A%09%09%09branch.setComplexValue%28%28aKey%29%2C%20Ci.nsISupportsString%2C%20str%29%3B%0A%09%09%09break%3B%0A%09%7D%0A%7D%3B%0A%0Athis.MultiTranslator.InitPrefs%20%3D%20function%28%29%20%7B%0A%09let%20branch%20%3D%20Services.prefs.getDefaultBranch%28that.Branch%29%2C%0A%09%09defaults%20%3D%20that.DefPrefs%3B%0A%09for%20%28let%20key%20in%20defaults%29%20%7B%0A%09%09if%20%28defaults.hasOwnProperty%28key%29%29%20%7B%0A%09%09%09let%20val%20%3D%20defaults%5Bkey%5D%3B%0A%09%09%09switch%20%28typeof%20val%29%20%7B%0A%09%09%09%09case%20%22boolean%22%3A%0A%09%09%09%09%09branch.setBoolPref%28key%2C%20val%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%09case%20%22number%22%3A%0A%09%09%09%09%09branch.setIntPref%28key%2C%20val%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%09case%20%22string%22%3A%0A%09%09%09%09%09let%20str%20%3D%20Cc%5B%22@mozilla.org/supports-string%3B1%22%5D.createInstance%28Ci.nsISupportsString%29%3B%0A%09%09%09%09%09str.data%20%3D%20val%3B%0A%09%09%09%09%09branch.setComplexValue%28%28key%29%2C%0A%09%09%09%09%09%09Ci.nsISupportsString%2C%20str%29%3B%0A%09%09%09%09%09break%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%0A%7D%3B%0A%0A//%20You%20can%20comment%20the%20languages%20that%20you%20don%27t%20want%20to%20be%20displayed%20in%20the%20language%20selection%20menu%20lists.%0A//%20Languages%20with%20%28B%29%20in%20their%20names%20are%20ONLY%20supported%20by%20Bing%20translator.%0A//%20Languages%20with%20%28G%29%20in%20their%20names%20are%20ONLY%20supported%20by%20Google%20translator.%0A//%20Languages%20with%20%28Y%29%20in%20their%20names%20are%20ONLY%20supported%20by%20Yandex%20translator.%0A//%20All%20the%20other%20languages%20are%20supported%20by%20Bing/Google/Yandex%20translators.%0A//%20Beware%20that%20commented%20languages%20will%20be%20hidden%20from%20ALL%20language%20selection%20lists%20%28From%20the%20popup%20and%20the%20URL%20bar%20icon%29.%0Athis.MultiTranslator.langs%20%3D%20%7B%0A%09%22%22%3A%20%22Auto%22%2C%20//%20NEVER%20COMMENT/DELETE%20%22Auto%22%21%21%21%21%21%0A%09%22af%22%3A%20%22Afrikaans%20%28G%29%22%2C%0A%09%22sq%22%3A%20%22Albanian%20%28G%29%28Y%29%22%2C%0A%09%22ar%22%3A%20%22Arabic%22%2C%0A%09%22hy%22%3A%20%22Armenian%20%28Y%29%22%2C%0A%09%22az%22%3A%20%22Azerbaijani%20%28G%29%28Y%29%22%2C%0A%09%22eu%22%3A%20%22Basque%20%28G%29%22%2C%0A%09%22be%22%3A%20%22Belarusian%20%28G%29%28Y%29%22%2C%0A%09%22bn%22%3A%20%22Bengali%20%28G%29%22%2C%0A%09%22bs%22%3A%20%22Bosnian%20%28Y%29%22%2C%0A%09%22bs-Latn%22%3A%20%22Bosnian%20%28Latin%29%20%28B%29%22%2C%0A%09%22bg%22%3A%20%22Bulgarian%22%2C%0A%09%22ca%22%3A%20%22Catalan%22%2C%0A%09%22zh%22%3A%20%22Chinese%20%28Y%29%22%2C%0A%09%22zh-CHS%22%3A%20%22Chinese%20Simplified%20%28B%29%22%2C%0A%09%22zh-CN%22%3A%20%22Chinese%20Simplified%20%28G%29%22%2C%0A%09%22zh-CHT%22%3A%20%22Chinese%20Traditional%20%28B%29%22%2C%0A%09%22zh-TW%22%3A%20%22Chinese%20Traditional%20%28G%29%22%2C%0A%09%22hr%22%3A%20%22Croatian%22%2C%0A%09%22cs%22%3A%20%22Czech%22%2C%0A%09%22da%22%3A%20%22Danish%22%2C%0A%09%22nl%22%3A%20%22Dutch%22%2C%0A%09%22en%22%3A%20%22English%22%2C%20//%20NEVER%20COMMENT/DELETE%20%22English%22%21%21%21%21%21%0A%09//%20%22eo%22%3A%20%22Esperanto%20%28G%29%22%2C%0A%09%22et%22%3A%20%22Estonian%22%2C%0A%09%22tl%22%3A%20%22Filipino%20%28G%29%22%2C%0A%09%22fi%22%3A%20%22Finnish%22%2C%0A%09%22fr%22%3A%20%22French%22%2C%0A%09%22gl%22%3A%20%22Galician%20%28G%29%22%2C%0A%09%22de%22%3A%20%22German%22%2C%0A%09%22ka%22%3A%20%22Georgian%20%28G%29%28Y%29%22%2C%0A%09%22el%22%3A%20%22Greek%22%2C%0A%09%22gu%22%3A%20%22Gujarati%20%28G%29%22%2C%0A%09%22ht%22%3A%20%22Haitian%20Creole%22%2C%0A%09%22he%22%3A%20%22Hebrew%20%28B%29%28Y%29%22%2C%0A%09%22iw%22%3A%20%22Hebrew%20%28G%29%22%2C%0A%09%22hi%22%3A%20%22Hindi%22%2C%0A%09%22mww%22%3A%20%22Hmong%20Daw%20%28B%29%22%2C%0A%09%22hu%22%3A%20%22Hungarian%22%2C%0A%09%22is%22%3A%20%22Icelandic%20%28G%29%28Y%29%22%2C%0A%09%22id%22%3A%20%22Indonesian%22%2C%0A%09%22ga%22%3A%20%22Irish%20%28G%29%22%2C%0A%09%22it%22%3A%20%22Italian%22%2C%0A%09%22ja%22%3A%20%22Japanese%22%2C%0A%09%22kn%22%3A%20%22Kannada%20%28G%29%22%2C%0A%09//%20%22tlh%22%3A%20%22Klingon%20%28B%29%22%2C%0A%09//%20%22tlh-Qaak%22%3A%20%22Klingon%20%28pIqaD%29%20%28B%29%22%2C%0A%09%22ko%22%3A%20%22Korean%22%2C%0A%09%22la%22%3A%20%22Latin%20%28G%29%22%2C%0A%09%22lv%22%3A%20%22Latvian%22%2C%0A%09%22lt%22%3A%20%22Lithuanian%22%2C%0A%09%22mk%22%3A%20%22Macedonian%20%28G%29%28Y%29%22%2C%0A%09%22ms%22%3A%20%22Malay%22%2C%0A%09%22mt%22%3A%20%22Maltese%22%2C%0A%09%22no%22%3A%20%22Norwegian%22%2C%0A%09%22fa%22%3A%20%22Persian%22%2C%0A%09%22pl%22%3A%20%22Polish%22%2C%0A%09%22pt%22%3A%20%22Portuguese%22%2C%0A%09%22otq%22%3A%20%22Quer%E9taro%20Otomi%20%28B%29%22%2C%0A%09%22ro%22%3A%20%22Romanian%22%2C%0A%09%22ru%22%3A%20%22Russian%22%2C%0A%09%22sr-Cyrl%22%3A%20%22Serbian%20%28Cyrillic%29%20%28B%29%22%2C%0A%09%22sr-Latn%22%3A%20%22Serbian%20%28Latin%29%20%28B%29%22%2C%0A%09%22sr%22%3A%20%22Serbian%20%28G%29%28Y%29%22%2C%0A%09%22sk%22%3A%20%22Slovak%22%2C%0A%09%22sl%22%3A%20%22Slovenian%22%2C%0A%09%22es%22%3A%20%22Spanish%22%2C%0A%09%22sw%22%3A%20%22Swahili%20%28G%29%22%2C%0A%09%22sv%22%3A%20%22Swedish%22%2C%0A%09%22ta%22%3A%20%22Tamil%20%28G%29%22%2C%0A%09%22te%22%3A%20%22Telugu%20%28G%29%22%2C%0A%09%22th%22%3A%20%22Thai%22%2C%0A%09%22tr%22%3A%20%22Turkish%22%2C%0A%09%22uk%22%3A%20%22Ukrainian%22%2C%0A%09%22ur%22%3A%20%22Urdu%22%2C%0A%09%22vi%22%3A%20%22Vietnamese%22%2C%0A%09%22cy%22%3A%20%22Welsh%22%2C%0A%09%22yi%22%3A%20%22Yiddish%20%28G%29%22%2C%0A%09%22yua%22%3A%20%22Yucatec%20Maya%20%28B%29%22%2C%0A%7D%3B%0A%0A%0A/**%0A%20*%20To%20get%20more%20Bing%20API%20keys%2C%20follow%20this%20instructions%3A%20http%3A//blogs.msdn.com/b/translation/p/gettingstarted1.aspx%0A%20*%0A%20*%20%23%23%23%20In%20a%20nutshell%20%23%23%23%0A%20*%201-%20Register%20for%20an%20account%20on%20Windows%20Azure%20Marketplace%20with%20a%20Microsoft%20account.%0A%20*%20%20%20%20https%3A//datamarket.azure.com/home/%0A%20*%202-%20Sign%20up%20for%20the%20Microsoft%20Translator%20API%20using%20your%20registered%20account.%20Sign%20up%20for%20the%20free%20one%20%28%240.00%29.%0A%20*%20%20%20%20https%3A//datamarket.azure.com/dataset/bing/microsofttranslator%0A%20*%203-%20Register%20your%20application%20on%20Windows%20Azure%20Marketplace.%0A%20*%20%20%20%20https%3A//datamarket.azure.com/developer/applications/register%0A%20*%204-%20Get%20the%20Client%20ID%20and%20Client%20Secret%20for%20your%20registered%20application.%0A%20*%20%20-%20Fill%20out%20the%20Client%20ID%2C%20and%20Name%20fields.%0A%20*%20%20-%20The%20Client%20Secret%20field%20is%20already%20completed%20for%20you.%20DO%20NOT%20CHANGE%20IT.%0A%20*%20%20-%20Fill%20out%20the%20%u2018Redirect%20URI%u2019%20field%20with%20any%20valid%20URL%20that%20uses%20https%2C%20for%20example%20https%3A//microsoft.com.%0A%20*%20%20%20%20This%20field%20is%20not%20used%20by%20the%20Microsoft%20Translator%20API.%0A%20*%20%20-%20You%20can%20also%20leave%20the%20%u2018Enable%20subdomain%20access%u2019%20checkbox%20unchecked%2C%20as%20Translator%20doesn%u2019t%20use%20it.%0A%20*%20%20-%20Remember%20and%20note%20the%20Client%20ID%20and%20Client%20Secret%20fields%20and%20replace%20those%20found%20inside%20the%20APIKeysBing%0A%20*%20%20%20%20object%20bellow%20with%20these%20newlly%20generated.%20NEVER%20MAKE%20THESE%20KEYS%20PUBLIC%21%21%21%0A%20*%0A%20*%20Note%3A%20Step%203%20can%20be%20repeated%20several%20times%20to%20get%20several%20Client%20IDs%20and%20Client%20Secrets.%20DO%20NOT%20ABUSE%21%21%21%0A%20*/%0Athis.MultiTranslator.APIKeysBing%20%3D%20%5B%0A%09//%20%23%23%23%20Example%20%23%23%23%0A%09//%20%5B%22Client_ID%22%2C%20%22Client_Secret%22%5D%2C%0A%09%5B%22TradutorInstantaneo%22%2C%20%22D36qcBNDopLmUz2cYpAgPZ0ZPezQEs79QeTp88gZ4hc%3D%22%5D%2C%0A%09%5B%22ngochuong-bing-translator%22%2C%20%22vIOFDe2FdSy4c0BTdYoPvHhwWIPoRFBo5ryuhOjxo84%3D%22%5D%2C%0A%09%5B%22webtranslator8601%22%2C%20%2238tnkL0LkSI5DjHq3mhFU0f7DKsm1/rizwEmMylZxtc%3D%22%5D%2C%0A%09%5B%22SublimeBingTranslator%22%2C%20%220fjvxMgcSZreEk9xPN8Vse+KDz3XlI+W11XJxC8peEA%3D%22%5D%2C%0A%09%5B%22bing_translator_test_xuemind%22%2C%20%22taiwTXXvLKe/UzpXXK6X6gxkpac5GpOdKOb69gYWMgk%3D%22%5D%2C%0A%09%5B%22Subtitles%22%2C%20%22Xv2Oae6Vki4CnYcSF1SxSSBtO1x4rX47zhLUE/OqVds%3D%22%5D%2C%0A%09%5B%223a7a26d9254FFC08%22%2C%20%22SuNwPHKH6UbvhyZ34FlqOWJ9z2zN6KS8djzHpf8NvOI%3D%22%5D%2C%0A%5D%3B%0A%0A/**%0A%20*%20Get%20more%20Yandex%20API%20keys%20here%3A%20https%3A//tech.yandex.ru/key/form.xml%3Fservice%3Dtrnsl%0A%20*%0A%20*%20%23%23%23%20In%20a%20nutshell%20%23%23%23%0A%20*%201-%20Visit%20the%20provided%20link%20and%20register%20a%20Yandex%20account.%20It%27s%20the%20right%20button%20inside%20the%20middle%20box.%0A%20*%202-%20You%20will%20need%20to%20resolve%20a%20captcha%20with%20cyrillic%20letters.%20DO%20NOT%20PANIC%21%21%21%20LOL%0A%20*%20%20%20%20You%20can%20just%20go%20to%20https%3A//translate.google.com%2C%20select%20Russian%20as%20source%20language%20and%20open%0A%20*%20%20%20%20the%20cyrilic%20on-screen%20keyboard%20to%20type%20the%20needed%20characters.%0A%20*%203-%20Once%20you%20successfully%20finish%20creating%20the%20Yandex%20account%2C%20you%20can%20visit%20the%20link%20provided%0A%20*%20%20%20%20at%20the%20beginning%20several%20times%20to%20create%20several%20API%20keys.%20DO%20NOT%20ABUSE%21%21%21%0A%20*%204-%20Once%20you%20have%20several%20API%20keys%2C%20just%20replace%20the%20ones%20found%20inside%20the%20APIKeysYandex%20object%20bellow%0A%20*%20%20%20%20for%20the%20ones%20you%20generated.%20NEVER%20MAKE%20THESE%20KEYS%20PUBLIC%21%21%21%0A%20*/%0Athis.MultiTranslator.APIKeysYandex%20%3D%20%5B%0A%09%22trnsl.1.1.20130818T214524Z.9983e6055ae94787.74d98f42e84f8abac4a19cb1333dfecb7427165d%22%2C%0A%09%22trnsl.1.1.20130806T140102Z.d80a7ce00b1a3c38.30de98386f6f6d594993fa93c0907aac5996aab9%22%2C%0A%09%22trnsl.1.1.20140602T085017Z.ea6ecac642816084.4df3b3711b35ed773720c92acdcebb11e793b8ab%22%2C%0A%09%22trnsl.1.1.20140911T223045Z.34ca44edca3e6ebd.f6807b1158e50190a2ae10c40d8a31a426647e98%22%2C%0A%09%22trnsl.1.1.20140731T144606Z.639639bc480e82b7.7cb97a33d3b2e88fa363e789fe03e2426478c53a%22%2C%0A%09%22trnsl.1.1.20141206T164332Z.8497d97d7ca05dc2.411e9116711b1860da655ffba56840469a3b2af1%22%2C%0A%09%22trnsl.1.1.20140218T130206Z.7923fc89a1c1bd16.aba4c3d98792c68c157c59f5a385339a03f0d736%22%2C%0A%09%22trnsl.1.1.20140213T084832Z.2e599cd43e74002d.d935bc98da1909103ec212bc9ce71adeaac9de4a%22%2C%0A%5D%3B%0A%0Athis.MultiTranslator.DefPrefs%20%3D%20%7B%0A%09HotkeyTransPageKey%3A%20%22p%22%2C%0A%09HotkeyTransPageModifiers%3A%20%22accel%2Calt%22%2C%0A%09HotkeyTransSelKey%3A%20%22t%22%2C%0A%09HotkeyTransSelModifiers%3A%20%22accel%2Calt%22%2C%0A%09HotkeyTransClipKey%3A%20%22v%22%2C%0A%09HotkeyTransClipModifiers%3A%20%22accel%2Calt%22%2C%0A%09PopupMaxStringLength%3A%201024%2C%0A%09PopupMaxWidth%3A%20450%2C%0A%09PopTransFailSafeOpenURLWhere%3A%202%2C%0A%09PopupShowFooter%3A%20true%2C%0A%09TransOnReleaseIconOffsetX%3A%2010%2C%0A%09TransOnReleaseIconOffsetY%3A%2010%2C%0A%09zButtonClickActionLeft%3A%201%2C%0A%09zButtonClickActionMiddle%3A%202%2C%0A%09zButtonClickActionLeftCtrl%3A%203%2C%0A%09zButtonClickActionLeftShift%3A%204%2C%0A%09zButtonClickActionLeftCtrlShift%3A%205%2C%0A%09zOpenOptionsInTab%3A%20true%2C%0A%09zPageTransURLBarIconLeftClick%3A%202%2C%0A%09zPageTransURLBarIconMiddleClick%3A%201%2C%0A%09zPageTransURLBarIconMenuMode%3A%20true%2C%0A%09zPageTransURLBarIconShow%3A%20true%2C%0A%09zPageTransEngine%3A%202%2C%0A%09zPageTransFromLang%3A%20%22%22%2C%0A%09zPageTransToLang%3A%20%22en%22%2C%0A%09zPopTransKeepItOpen%3A%20false%2C%0A%09zPopTransAutoCloseOnClick%3A%20false%2C%0A%09zPopTransAutoCopyOnClick%3A%20true%2C%0A%09zPopTransAnchorToSelection%3A%20true%2C%0A%09zPopTransShowTitleBar%3A%20true%2C%0A%09zPopTransFailSafe%3A%20false%2C%0A%09zPopTransEngine%3A%202%2C%0A%09zPopTransFromLang%3A%20%22%22%2C%0A%09zPopTransToLang%3A%20%22en%22%2C%0A%09zShowContextMenuItems%3A%20true%2C%0A%09zTransOnRelease%3A%20true%2C%0A%09zTransOnReleaseAltKey%3A%20false%2C%0A%09zTransOnReleaseControlKey%3A%20false%2C%0A%09zTransOnReleaseShowIcon%3A%20true%2C%0A%09zUseTransPageHotkey%3A%20true%2C%0A%09zUseTransSelHotkey%3A%20true%2C%0A%09zUseTransClipHotkey%3A%20true%2C%0A%7D%3B%0A%0Athis.MultiTranslator.Init%28%29%3B%0A%0Afunction%20notifyme%28aTitle%2C%20aMsg%2C%20aImg%2C%20aCallback%29%20%7B%20//%20Notification%20function%0A%09//%20The%20nsIAlertsService%20works%20whenever%20it%20wants%21%21%21%20So%20EFF%20IT%21%21%21%0A%09//%20var%20nsIAlertsService%20%3D%20Cc%5B%22@mozilla.org/alerts-service%3B1%22%5D.getService%28Ci.nsIAlertsService%29%3B%0A%09let%20origin%20%3D%20%28Services.prefs.getPrefType%28%22ui.alertNotificationOrigin%22%29%20%21%3D%3D%200%29%20%3F%0A%09%09Services.prefs.getIntPref%28%22ui.alertNotificationOrigin%22%29%20%3A%0A%09%09null%3B%0A%09//%20try%20%7B%0A%09//%20nsIAlertsService.showAlertNotification%28aImg%2C%20aTitle%2C%20aMsg%2C%20%21%21aCallback%2C%20%22%22%2C%20aCallback%20%3F%20aCallback%20%3A%20null%2C%20%22%22%29%3B%0A%09//%20nsIAlertsService.showAlertNotification%28aImg%2C%20aTitle%2C%20aMsg%2C%20false%2C%20%22%22%2C%20null%29%3B%0A%09//%20%7D%20catch%20%28aEr%29%20%7B%0A%09let%20win%20%3D%20Services.ww.openWindow%28null%2C%20%22chrome%3A//global/content/alerts/alert.xul%22%2C%0A%09%09%22_blank%22%2C%20%22chrome%2Ctitlebar%3Dno%2Cpopup%3Dyes%22%2C%20null%29%3B%0A%09win.arguments%20%3D%20%5BaImg%2C%20aTitle%2C%20aMsg%2C%20%21%21aCallback%2C%20%22%22%2C%20origin%2C%20%22%22%2C%20%22%22%2C%20null%2C%20%28%21%21aCallback%20%3F%20aCallback%20%3A%20null%29%5D%3B%0A%09//%20%7D%0A%7D%0A%0Afunction%20getHelp%28aPlaceholder%29%20%7B%20//%20Get%20specific%20data%2C%20surrounded%20by%20%22placeholders%22%2C%20from%20the%20Help%20tab.%0A%09return%20document.getElementById%28self.id%29.getAttribute%28%22Help%22%29.split%28%22%3C%21--%22%20+%20aPlaceholder%20+%20%22--%3E%22%29%5B1%5D%3B%0A%7D%0A%0Afunction%20parseXML%28aXML%29%20%7B%20//%20Return%20parsed%20XML%0A%09aXML%20%3D%20aXML.replace%28/%3E%5Cs+%3C/g%2C%20%22%3E%3C%22%29%3B%20//%20Linearize%20XML%0A%09return%20%28new%20DOMParser%29.parseFromString%28aXML%2C%20%22application/xml%22%29.documentElement%3B%0A%7D%0A%0Afunction%20styleSheet%28aCSS%2C%20aRemFlag%29%20%7B%0A%09var%20sss%20%3D%20Cc%5B%22@mozilla.org/content/style-sheet-service%3B1%22%5D.getService%28Ci.nsIStyleSheetService%29%3B%0A%09var%20uri%20%3D%20Services.io.newURI%28%22data%3Atext/css%2C%22%20+%20encodeURIComponent%28aCSS%29%2C%20null%2C%20null%29%3B%0A%09if%20%28sss.sheetRegistered%28uri%2C%20sss.USER_SHEET%29%29%0A%09%09sss.unregisterSheet%28uri%2C%20sss.USER_SHEET%29%3B%0A%09if%20%28aRemFlag%29%0A%09%09return%3B%0A%09sss.loadAndRegisterSheet%28uri%2C%20sss.USER_SHEET%29%3B%0A%7D%0A%0Afunction%20%24CNS%28aElName%2C%20aAttrs%2C%20aNS%29%20%7B%0A%09var%20el%20%3D%20document.createElementNS%28%28aNS%20%3F%20aNS%20%3A%20xulns%29%2C%20aElName%29%3B%0A%09if%20%28aAttrs%29%0A%09%09Object.keys%28aAttrs%29.forEach%28function%28n%29%20%7B%0A%09%09%09if%20%28aAttrs%5Bn%5D%20%21%3D%3D%20%22%22%29%0A%09%09%09%09el.setAttribute%28n%2C%20aAttrs%5Bn%5D%29%0A%09%09%7D%29%3B%0A%09return%20el%3B%0A%7D%0A%0Afunction%20%24C%28aElName%2C%20aAttrs%2C%20aParent%29%20%7B%0A%09var%20doc%20%3D%20aParent%20%3F%20aParent%20%3A%20document%3B%0A%09var%20el%20%3D%20doc.createElement%28aElName%29%3B%0A%09if%20%28aAttrs%29%0A%09%09Object.keys%28aAttrs%29.forEach%28function%28n%29%20%7B%0A%09%09%09if%20%28aAttrs%5Bn%5D%20%21%3D%3D%20%22%22%29%0A%09%09%09%09el.setAttribute%28n%2C%20aAttrs%5Bn%5D%29%0A%09%09%7D%29%3B%0A%09return%20el%3B%0A%7D%0A%0Afunction%20%24%28aID%2C%20aParent%29%20%7B%0A%09if%20%28%21aParent%29%0A%09%09return%20document.getElementById%28aID%29%3B%0A%09return%20aParent.getElementById%28aID%29%3B%0A%7D%0A%0Afunction%20%24%24%28aTagName%2C%20aParent%29%20%7B%0A%09if%20%28%21aParent%29%0A%09%09return%20document.getElementsByTagName%28aTagName%29%3B%0A%09return%20aParent.getElementsByTagName%28aTagName%29%3B%0A%7D%0A%0Afunction%20escHTML%28aStr%2C%20aIsAttr%29%20%7B%0A%09aStr%20%3D%20String%28aStr%29%0A%09%09.replace%28/%26/g%2C%20%22%26amp%3B%22%29%0A%09%09.replace%28/%3C/g%2C%20%22%26lt%3B%22%29%0A%09%09.replace%28/%3E/g%2C%20%22%26gt%3B%22%29%0A%09%09.replace%28/%22/g%2C%20%22%26quot%3B%22%29%0A%09%09.replace%28/%27/g%2C%20%22%26apos%3B%22%29%3B%0A%09if%20%28aIsAttr%29%20%7B%0A%09%09aStr%20%3D%20aStr%0A%09%09%09.replace%28/%5Ct/g%2C%20%22%26%23x9%3B%22%29%0A%09%09%09.replace%28/%5Cn/g%2C%20%22%26%23xA%3B%22%29%0A%09%09%09.replace%28/%5Cr/g%2C%20%22%26%23xD%3B%22%29%3B%0A%09%7D%0A%09return%20aStr%3B%0A%7D%0A%0Alet%20escapeHash%20%3D%20%7B%0A%09_%3A%20function%28input%29%20%7B%0A%09%09var%20ret%20%3D%20escapeHash%5Binput%5D%3B%0A%09%09if%20%28%21ret%29%20%7B%0A%09%09%09if%20%28input.length%20-%201%29%20%7B%0A%09%09%09%09ret%20%3D%20String.fromCharCode%28parseInt%28input.substring%28input.length%20-%203%20%3F%202%20%3A%201%29%2C%2016%29%29%3B%0A%09%09%09%7D%20else%20%7B%0A%09%09%09%09var%20code%20%3D%20input.charCodeAt%280%29%3B%0A%09%09%09%09ret%20%3D%20code%20%3C%20256%20%3F%20%22%25%22%20+%20%280%20+%20code.toString%2816%29%29.slice%28-2%29.toUpperCase%28%29%20%3A%20%22%25u%22%20+%20%28%22000%22%20+%20code.toString%2816%29%29.slice%28-4%29.toUpperCase%28%29%3B%0A%09%09%09%7D%0A%09%09%09escapeHash%5Bret%5D%20%3D%20input%3B%0A%09%09%09escapeHash%5Binput%5D%20%3D%20ret%3B%0A%09%09%7D%0A%09%09return%20ret%3B%0A%09%7D%0A%7D%3B%0A%0Afunction%20%24escape%28aStr%29%20%7B%0A%09return%20aStr.toString%28%29.replace%28/%5B%5E%5Cw%20@%5C*%5C-%5C+%5C.%5C/%5D/g%2C%20function%28aChar%29%20%7B%20//%20Per%20Liedman%0A%09%09return%20escapeHash._%28aChar%29%3B%0A%09%7D%29%3B%0A%7D%0A%0Afunction%20%24unescape%28aStr%29%20%7B%0A%09return%20aStr.toString%28%29.replace%28/%25%28u%5B%5Cda-f%5D%7B4%7D%7C%5B%5Cda-f%5D%7B2%7D%29/gi%2C%20function%28aSeq%29%20%7B%20//%20Per%20Liedman%0A%09%09return%20escapeHash._%28aSeq%29%3B%0A%09%7D%29%3B%0A%7D%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5B/*CODE*/%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B%5B%2C%5D%0A%3C%21--XULStyleSheet--%3E%0A/*%20Translation%20popup%20tweaks%20*/%0A%23_U_I_D__translationPopup%20%23_U_I_D__translationResultBox%2C%0A%23_U_I_D__translationPopup%20%23_U_I_D__translationOptionsBox%20%7B%0A%09padding%3A%205px%20%21important%3B%0A%7D%0A%23_U_I_D__translationPopup%20label%20%7B%0A%09font-weight%3A500%20%21important%3B%0A%7D%0A%23_U_I_D__translationOptionsButton%20%7B%0A%09min-width%3A%201em%20%21important%3B%0A%7D%0A/*%20Basic%20panel%20appearance%20for%20the%20URL%20bar%20icon%20menu%20*/%0A%23_U_I_D__self_popup%2C%0A%23_U_I_D__translationIconOnURLBarMenu%20%7B%0A%09-moz-appearance%3A%20none%20%21important%3B%0A%09-moz-binding%3A%20url%28%22chrome%3A//global/content/bindings/popup.xml%23arrowpanel%22%29%20%21important%3B%0A%09background%3A%20transparent%20%21important%3B%0A%09border%3A%20none%20%21important%3B%0A%09-moz-image-region%3A%20auto%20%21important%3B%0A%7D%0A%3C%21--XULStyleSheet--%3E%0A%0A%3C%21--HTMLStyleSheet--%3E%0A/*%20Tweaks%20for%20Google%20Translator%20pages%20*/%0A/*@-moz-document%20domain%28%22translate.google.com%22%29%20%7B*/%0A@-moz-document%20regexp%28%22%5Ehttps%3F%3A//translate%5C.google%5C..*%22%29%20%7B%0A%09/*%20Remove%20the%20offer%20to%20install%20that%20aberration%20called%20Chrome%21%21%21%20*/%0A%09%23gb%20.gb_9c.gb_ec.gb_g%20%7B%0A%09%09display%3A%20none%20%21important%3B%0A%09%7D%0A%7D%0A/*%20Removes%20tooltips%20showing%20original%20text%20*/%0A@-moz-document%20domain%28%22translate.googleusercontent.com%22%29%20%7B%0A%09span%5Bonmouseout%5D%5Bonmouseover%5D%5Bstyle%5D%20%7B%0A%09%09background-color%3A%20transparent%20%21important%3B%0A%09%7D%0A%09.gmnoprint%20%7B%0A%09%09display%3A%20none%20%21important%3B%0A%09%7D%0A%7D%0A%0A/*%20Tweaks%20for%20Microsoft%20translator%20pages%20*/%0A/*%20Remove%20tooltips%20showing%20original%20text%20*/%0ADIV%5Btranslate%3D%22no%22%5D%20%7B%0A%09display%3A%20none%20%21important%3B%0A%7D%0A%0A/*%20Translation%20popup%20tweaks%20*/%0A/*%20The%20next%20two%20selectors%20are%20HTML%20elements.%20That%27s%20why%20they%20are%20separated%20from%20the%20XULStyleSheet%20*/%0A%23_U_I_D__translationResultContent%20%7B%0A%09padding%3A%205px%20%21important%3B%0A%09font-weight%3A600%20%21important%3B%0A%7D%0A%23_U_I_D__translationResultContentFooter%20%7B%7D%0A%3C%21--HTMLStyleSheet--%3E%0A%0A%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%0A%23%23%23%20FROM%20HERE%20DOWN%20DO%20NOT%20TOUCH%20ANYTHING%21%21%21%21%20%23%23%23%0A%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%0A%0A%3C%21--MainPanel--%3E%3Cpanel%20id%3D%22_U_I_D__translationPopup%22%0A%09%09%09%09%09%20%20%20label%3D%22_L_A_B_E_L_%22%0A%09%09%09%09%09%20%20%20cb_id%3D%22_U_I_D_%22%0A%09%09%09%09%09%20%20%20orient%3D%22vertical%22%0A%09%09%09%09%09%20%20%20consumeoutsideclicks%3D%22false%22%0A%09%09%09%09%09%20%20%20close%3D%22true%22%0A%09%09%09%09%09%20%20%20level%3D%22top%22%0A%09%09%09%09%09%20%20%20backdrag%3D%22true%22%0A%09%09%09%09%09%20%20%20noautohide%3D%22true%22%0A%09%09%09%09%09%20%20%20onpopupshown%3D%22document.getElementById%28%27_S_E_L_F_I_D_%27%29.MultiTranslator.setMenulistsCheckedState%28%29%3B%22%0A%09%09%09%09%09%20%20%20xmlns%3D%22http%3A//www.mozilla.org/keymaster/gatekeeper/there.is.only.xul%22%0A%09%09%09%09%09%20%20%20xmlns%3Ahtml%3D%22http%3A//www.w3.org/1999/xhtml%22%3E%0A%09%3Cvbox%20id%3D%22_U_I_D__translationResultBox%22%20flex%3D%221%22%3E%0A%09%09%3Chtml%3Adiv%20id%3D%22_U_I_D__translationResultContent%22%0A%09%09%09%09%20%20type%3D%22content%22%0A%09%09%09%09%20%20onclick%3D%22event.stopPropagation%28%29%3Bdocument.getElementById%28%27_S_E_L_F_I_D_%27%29.MultiTranslator.clickOnTransResult%28this.textContent%29%3B%22%20/%3E%0A%09%09%3Chtml%3Adiv%20id%3D%22_U_I_D__translationResultContentFooter%22%20type%3D%22content%22%20/%3E%0A%09%3C/vbox%3E%0A%09%3Cspacer%20flex%3D%221%22/%3E%0A%09%3Chbox%20id%3D%22_U_I_D__translationOptionsBox%22%20align%3D%22center%22%3E%0A%09%09%3Chbox%20id%3D%22_U_I_D__languageSelectionBox%22%20align%3D%22center%22%20hidden%3D%22false%22%3E%0A%09%09%09%3Clabel%20value%3D%22From%3A%20%22%20/%3E%0A%09%09%09%3Cmenulist%20id%3D%22_U_I_D__languageSelectionMenulistFrom%22%20sizetopopup%3D%22none%22%20_pref%3D%22zPopTransFromLang%22%3E%0A%09%09%09%09%3Cmenupopup%20id%3D%22_U_I_D__languageSelectionPopupFrom%22%20onpopupshown%3D%22event.stopPropagation%28%29%3B%22%20/%3E%0A%09%09%09%3C/menulist%3E%0A%09%09%09%3Clabel%20value%3D%22To%3A%20%22%20/%3E%0A%09%09%09%3Cmenulist%20id%3D%22_U_I_D__languageSelectionMenulistTo%22%20sizetopopup%3D%22none%22%20_pref%3D%22zPopTransToLang%22%3E%0A%09%09%09%09%3Cmenupopup%20id%3D%22_U_I_D__languageSelectionPopupTo%22%20onpopupshown%3D%22event.stopPropagation%28%29%3B%22%20/%3E%0A%09%09%09%3C/menulist%3E%0A%09%09%3C/hbox%3E%0A%09%09%3Cspacer%20flex%3D%221%22/%3E%0A%09%09%3Ctoolbarbutton%20id%3D%22_U_I_D__translationOptionsButton%22%20image%3D%22_I_M_A_G_E_%22%20type%3D%22menu%22%20popup%3D%22_U_I_D__translation_options%22/%3E%0A%09%3C/hbox%3E%0A%3C/panel%3E%3C%21--MainPanel--%3E%0A%0A%3C%21--FrameScript--%3E%22use%20sctrict%22%3B%0Alet%20MultiTranslator%20%3D%20%7B%0A%09Init%3A%20function%28%29%20%7B%0A%09%09addMessageListener%28%22_Translate_Sel_ID_%22%2C%20this%29%3B%0A%09%09addMessageListener%28%22_On_Release_Icon_ID_%22%2C%20this%29%3B%0A%09%09//%20addMessageListener%28%22_Middle_Click_ID_%22%2C%20this%29%3B%20//%20Not%20in%20use%20for%20now.%20%AC%AC%0A%09%09addMessageListener%28%22_Move_Popup_ID_%22%2C%20this%29%3B%0A%09%7D%2C%0A%0A%09receiveMessage%3A%20function%28aMsg%29%20%7B%0A%09%09switch%20%28aMsg.name%29%20%7B%0A%09%09%09case%20%22_Translate_Sel_ID_%22%3A%0A%09%09%09%09this._getSelection%28true%29%3B%0A%09%09%09%09break%3B%0A%09%09%09case%20%22_On_Release_Icon_ID_%22%3A%0A%09%09%09%09this._onReleaseIcon%28aMsg.data%29%3B%0A%09%09%09%09break%3B%0A%09%09%09//%20case%20%22_Middle_Click_ID_%22%3A%20//%20Not%20in%20use%20for%20now.%20%AC%AC%0A%09%09%09//%20%09this.HandleListeners%28aMsg.data.onRelease%29%3B%0A%09%09%09//%20%09break%3B%0A%09%09%09case%20%22_Move_Popup_ID_%22%3A%0A%09%09%09%09this._movePopup%28aMsg.data%29%3B%0A%09%09%09%09break%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09HandleListeners%3A%20function%28aDel%29%20%7B%20//%20Not%20in%20use%20for%20now.%20%AC%AC%0A%09%09Components.utils.reportError%28aDel%29%3B%0A%09%09removeEventListener%28%22click%22%2C%20this._onMiddleClick%2C%20false%29%3B%0A%09%09removeEventListener%28%22mouseup%22%2C%20this._onMiddleClick%2C%20false%29%3B%0A%09%09removeEventListener%28%22mousedown%22%2C%20this._onMiddleClick%2C%20false%29%3B%0A%09%09if%20%28aDel%29%0A%09%09%09return%20true%3B%0A%09%09Components.utils.reportError%28aDel%29%3B%0A%09%09addEventListener%28%22click%22%2C%20this._onMiddleClick%2C%20false%29%3B%0A%09%09addEventListener%28%22mouseup%22%2C%20this._onMiddleClick%2C%20false%29%3B%0A%09%09addEventListener%28%22mousedown%22%2C%20this._onMiddleClick%2C%20false%29%3B%0A%09%7D%2C%0A%0A%09_getSelection%3A%20function%28aDirectTrans%29%20%7B%0A%09%09Components.utils.reportError%28%22BrowserUtils%22%20in%20content%29%3B%0A%09%09if%20%28content.getSelection%29%20%7B%0A%09%09%09var%20sel%3B%0A%09%09%09var%20activeEl%20%3D%20content.document.activeElement%3B%0A%09%09%09try%20%7B%0A%09%09%09%09sel%20%3D%20activeEl.value.substring%28activeEl.selectionStart%2C%20activeEl.selectionEnd%29%3B%0A%09%09%09%7D%20catch%20%28e%29%20%7B%0A%09%09%09%09sel%20%3D%20content.getSelection%28%29.toString%28%29%3B%0A%09%09%09%7D%20finally%20%7B%0A%09%09%09%09if%20%28aDirectTrans%29%20%7B%0A%09%09%09%09%09if%20%28sel%20%21%3D%3D%20%22%22%29%20%7B%0A%09%09%09%09%09%09sendAsyncMessage%28%22_Response_ID_%22%2C%20%7B%0A%09%09%09%09%09%09%09id%3A%201%2C%20//%20ID%202%20is%20the%20%22mouseover%22%20event%20to%20trigger%20the%20popup%20from%20the%20%22on%20realese%22%20icon.%0A%09%09%09%09%09%09%09sel%3A%20sel%2C%0A%09%09%09%09%09%09%7D%29%3B%0A%09%09%09%09%09%7D%0A%09%09%09%09%7D%20else%0A%09%09%09%09%09return%20sel%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%09return%20false%3B%0A%09%7D%2C%0A%0A%09_onMiddleClick%3A%20function%28aE%29%20%7B%0A%09%09let%20sel%20%3D%20MultiTranslator._getSelection%28%29%3B%0A%09%09switch%20%28aE.type%29%20%7B%0A%09%09%09case%20%22click%22%3A%0A%09%09%09%09if%20%28aE.button%20%21%3D%3D%201%29%0A%09%09%09%09%09return%3B%0A%09%09%09%09if%20%28sel%20%21%3D%3D%20%22%22%29%20%7B%0A%09%09%09%09%09aE.preventDefault%28%29%3B%0A%09%09%09%09%09aE.stopPropagation%28%29%3B%0A%09%09%09%09%7D%0A%09%09%09%09sendAsyncMessage%28%22_Response_ID_%22%2C%20%7B%0A%09%09%09%09%09id%3A%204%2C%20//%20ID%204%20is%20the%20middle%20click.%0A%09%09%09%09%09sel%3A%20sel%2C%0A%09%09%09%09%7D%29%3B%0A%09%09%09%09var%20target%20%3D%20aE.target%3B%0A%09%09%09%09if%20%28target%20instanceof%20content.HTMLAnchorElement%20%7C%7C%0A%09%09%09%09%09target%20instanceof%20content.HTMLAreaElement%20%7C%7C%0A%09%09%09%09%09target%20instanceof%20content.HTMLLinkElement%29%0A%09%09%09%09%09return%3B%0A%09%09%09%09break%3B%0A%09%09%09case%20%22mouseup%22%3A%0A%09%09%09case%20%22mousedown%22%3A%0A%09%09%09%09sendAsyncMessage%28%22_Response_ID_%22%2C%20%7B%0A%09%09%09%09%09id%3A%205%2C%20//%20ID%205%20handle%20KeepItOpen.%0A%09%09%09%09%7D%29%3B%0A%09%09%09%09if%20%28aE.button%20%21%3D%3D%201%29%0A%09%09%09%09%09return%3B%0A%09%09%09%09if%20%28sel%20%21%3D%3D%20%22%22%29%20%7B%0A%09%09%09%09%09aE.preventDefault%28%29%3B%0A%09%09%09%09%09aE.stopPropagation%28%29%3B%0A%09%09%09%09%7D%0A%09%09%09%09break%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09_onReleaseIcon%3A%20function%28aData%29%20%7B%0A%09%09var%20doc%20%3D%20content.document%3B%0A%09%09var%20body%20%3D%20this.%24%24%28%22body%22%2C%20doc%29%5B0%5D%3B%0A%09%09var%20div%20%3D%20this.%24%28aData._UID%20+%20%22onReleaseDiv%22%2C%20doc%29%3B%0A%09%09if%20%28div%29%0A%09%09%09div.parentNode.removeChild%28div%29%3B%0A%0A%09%09var%20sel%20%3D%20this._getSelection%28%29%3B%0A%0A%09%09if%20%28%21sel%20%7C%7C%20sel%20%3D%3D%3D%20%22%22%20%7C%7C%20%21body%29%0A%09%09%09return%3B%0A%0A%09%09var%20imgLookup%20%3D%20this.%24C%28%22img%22%2C%20%7B%0A%09%09%09border%3A%200%2C%0A%09%09%09src%3A%20aData.image%2C%0A%09%09%7D%2C%20doc%29%3B%0A%09%09div%20%3D%20this.%24C%28%22div%22%2C%20%7B%0A%09%09%09id%3A%20aData._UID%20+%20%22onReleaseDiv%22%2C%0A%09%09%09style%3A%20%22background-color%3Atransparent%3B%20color%3A%23000000%3B%20position%3Aabsolute%3B%20top%3A%22%20+%0A%09%09%09%09%28aData.clientY%20+%20content.window.pageYOffset%20+%20aData.iconOffsetY%29%20+%20%22px%3B%20left%3A%22%20+%0A%09%09%09%09%28aData.clientX%20+%20content.pageXOffset%20+%20aData.iconOffsetX%29%20+%0A%09%09%09%09%22px%3B%20padding%3A0px%3B%20z-index%3A10000%3B%20border-radius%3A2px%3B%22%2C%0A%09%09%7D%2C%20doc%29%3B%0A%09%09div.appendChild%28imgLookup.cloneNode%28false%29%29%3B%0A%09%09let%20listener%20%3D%20function%28aE%29%20%7B%0A%09%09%09aE.preventDefault%28%29%3B%0A%09%09%09sendAsyncMessage%28%22_Response_ID_%22%2C%20%7B%0A%09%09%09%09id%3A%202%2C%20//%20ID%202%20is%20the%20%22mouseover%22%20event%20to%20trigger%20the%20popup%20from%20the%20%22on%20realese%22%20icon.%0A%09%09%09%09sel%3A%20sel%2C%0A%09%09%09%7D%29%3B%0A%09%09%09if%20%28div%29%0A%09%09%09%09div.parentNode.removeChild%28div%29%3B%0A%09%09%09aE.stopPropagation%28%29%3B%0A%09%09%7D%3B%0A%09%09div.addEventListener%28%22mouseover%22%2C%20listener%2C%20false%29%3B%0A%09%09body.appendChild%28div%29%3B%0A%09%7D%2C%0A%0A%09_movePopup%3A%20function%28aData%29%20%7B%0A%09%09let%20fWin%20%3D%20content.window%3B%0A%09%09fWin.focus%28%29%3B%0A%09%09let%20rect%3B%0A%09%09try%20%7B%0A%09%09%09rect%20%3D%20fWin.getSelection%28%29.getRangeAt%280%29.getBoundingClientRect%28%29%3B%0A%09%09%7D%20catch%20%28aErr%29%20%7B%0A%09%09%09rect%20%3D%20false%3B%0A%09%09%7D%0A%09%09let%20posX%20%3D%20fWin.mozInnerScreenX%20+%20%28rect%20%3F%20rect.left%20%3A%20fWin.innerWidth%20/%202%29%3B%0A%09%09let%20posY%20%3D%20fWin.mozInnerScreenY%20+%20%28rect%20%3F%20rect.bottom%20%3A%20fWin.innerHeight%20/%202%29%20+%203%3B%0A%09%09let%20deltaX%20%3D%20posX%20-%20aData.width%3B%0A%09%09if%20%28deltaX%20%3E%200%29%0A%09%09%09posX%20-%3D%20deltaX%3B%0A%09%09let%20deltaY%20%3D%20posY%20-%20aData.height%3B%0A%09%09if%20%28deltaY%20%3E%200%29%0A%09%09%09posY%20-%3D%20deltaY%3B%0A%09%09let%20div%20%3D%20this.%24%28aData._UID%20+%20%22onReleaseDiv%22%2C%20content.document%29%3B%0A%09%09try%20%7B%0A%09%09%09sendAsyncMessage%28%22_Response_ID_%22%2C%20%7B%0A%09%09%09%09id%3A%203%2C%20//%20ID%203%20is%20the%20popup%20positioning%20coordinates.%0A%09%09%09%09posX%3A%20posX%2C%0A%09%09%09%09posY%3A%20posY%2C%0A%09%09%09%7D%29%3B%0A%09%09%7D%20finally%20%7B%0A%09%09%09div%20%26%26%20div.parentNode.removeChild%28div%29%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09%24C%3A%20function%28aElName%2C%20aAttrs%2C%20aParent%29%20%7B%0A%09%09var%20doc%20%3D%20aParent%20%3F%20aParent%20%3A%20document%3B%0A%09%09var%20el%20%3D%20doc.createElement%28aElName%29%3B%0A%09%09if%20%28aAttrs%29%0A%09%09%09Object.keys%28aAttrs%29.forEach%28function%28n%29%20%7B%0A%09%09%09%09if%20%28aAttrs%5Bn%5D%20%21%3D%3D%20%22%22%29%0A%09%09%09%09%09el.setAttribute%28n%2C%20aAttrs%5Bn%5D%29%0A%09%09%09%7D%29%3B%0A%09%09return%20el%3B%0A%09%7D%2C%0A%0A%09%24%3A%20function%28aID%2C%20aParent%29%20%7B%0A%09%09if%20%28%21aParent%29%0A%09%09%09return%20document.getElementById%28aID%29%3B%0A%09%09return%20aParent.getElementById%28aID%29%3B%0A%09%7D%2C%0A%0A%09%24%24%3A%20function%28aTagName%2C%20aParent%29%20%7B%0A%09%09if%20%28%21aParent%29%0A%09%09%09return%20document.getElementsByTagName%28aTagName%29%3B%0A%09%09return%20aParent.getElementsByTagName%28aTagName%29%3B%0A%09%7D%2C%0A%7D%3B%0AMultiTranslator.Init%28%29%3B%0A%3C%21--FrameScript--%3E%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" rel="nofollow" title="Install Multi Translator">
				<![CDATA[Install this button]]>
			</html:a>
		</html:div>
		<html:a id="about" href="https://addons.mozilla.org/addon/custom-buttons/">
			<![CDATA[About CustomButtons]]>
		</html:a>
		<html:div id="credits">
			<html:a href="http://custombuttons.sourceforge.net/forum/viewtopic.php?t=3599">
				<![CDATA[XML created with]]>
				<html:br/>
				<![CDATA[CB Context Menu Extended]]>
			</html:a>
		</html:div>
	</html:div>
</html:body>
  <name>Multi Translator</name>
  <image><![CDATA[data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABEElEQVQ4jaXSSUtDUQyG4afWCbFQwRERkW5EBX+AFUHQlbgQRV2oG1EodtWFOOA82x/t4qTQSWnxg8CFc5O8ST4alcEKXvxDRVS7SRhHCeWI6yhQrovzvwpM4Qb3TfGNDzzgshsi6MM7TuK7Yx1iD+tBsNFt52IkViX88W6Sh7GEpyhQwYwOR5jHGR5xi9MocoUjZJHHdlC2aBVf2MUkeqJoCW/oxWKM9YyB30iGMBEFmnUsLfg+GrZoMHArmGt6G5W8UIgxLqJZgzKBfyAtLl/3ti85dANb0q4W2lHkJPPMSteYxRg+g6Bm7TvsaHOhfqxJRnrFMjYlb0zX/VcMopF2FDUVpPPlJEPVL3YgyLI/5FwmASoiChQAAAAASUVORK5CYII=]]></image>
  <mode>0</mode>
  <initcode><![CDATA[var that = this.MultiTranslator = {
	URLBarEngines: {
		1: { // DO NOT EDIT THIS OBJECT!!!
			Label: "Bing Translator",
			Command: "javascript:(function(){var%20s%20=%20document.createElement('scr'+'ipt');" +
				"%20s.type%20=%20'text/javascript';%20s.src%20=%20'http://labs.microsofttranslator" +
				".com/bookmarklet/default.aspx?f=js&to=%%LNGTO%%';%20document.body." +
				"insertBefore(s,%20document.body.firstChild);})()",
			Image: 1,
			Tooltip: "Translate page with Bing Translator.\n\nThe source language is auto detected." +
				" The destination language is set from the Page translator options menu.",
		},

		2: { // DO NOT EDIT THIS OBJECT!!!
			Label: "Google Translator",
			Command: "https://translate.google.com/translate?u=%%URL%%&hl=%%LNGTO%%&langpair=%%LNGFROM%%|%%LNGTO%%&tbb=1&ie=UTF-8",
			Image: 2,
			Tooltip: "Translate page with Google Translator.\n\nThe source/destination languages " +
				"are set from the Page translator options menu.",
		},

		/**
		 * How to create a custom bookmarklet to be used as a page translator.
		 *
		 * Just un-comment one of the objects bellow and edit as needed.
		 * Objects must be named with a number. NEVER REPEAT A NUMBER AND NEVER USE 1 (one) nor 2 (two)!!!!
		 * Label (Mandatory): It will be displayed on the engine selection menus for the page translation.
		 * Command (Mandatory): The bookmarklet/code to be executed by the page translation options.
		 * Tooltip (Optional): Some descriptive text that will be displayed as tooltip on the engine selection menus.
		 * Image (Mandatory): It will set the image to be displayed inside the URL bar. It can be an URL to an image,
		 * a data: image or a number between 0 to 3.
		 * 0 = Generic image.
		 * 1 = Bing translator image.
		 * 2 = Google translator image.
		 * 3 = Yandex trnaslator image.
		 *
		 * Note: Some (optionals) placeholders can be used inside Command (No quotes):
		 * "%%URL%%": Used to "inject" the current page URL into the bookmarklet/code. See example in the Google Translator Command.
		 * "%%LNGTO%%" and/or "%%LNGFROM%%": Used to "inject" the language code to translate to/from.
		 * These language codes are configured from the language selection lists inside the options menu.
		 *
		 * #################### Where to get bookmarklets to translate pages? ####################
		 *
		 * Bing/Microsoft Translator Bookmarklets: http://labs.microsofttranslator.com/bookmarklet/
		 * Google Translator Bookmarklets: http://translate.google.com/translate_buttons
		 */

		3: { // ### Example ###
			Label: "Bing Translator Auto To English",
			Command: "javascript:(function(){var%20s%20=%20document.createElement('scr'+'ipt');" +
				"%20s.type%20=%20'text/javascript';%20s.src%20=%20'http://labs.microsofttranslator" +
				".com/bookmarklet/default.aspx?f=js&to=en';%20document.body." +
				"insertBefore(s,%20document.body.firstChild);})()",
			Image: 1,
		},

		4: { // ### Example ###
			Label: "Google Translator Auto To English",
			Command: "https://translate.google.com/translate?u=%%URL%%&hl=auto&langpair=auto|en&tbb=1&ie=UTF-8",
			Image: 2,
		},


		/*
		5: { // ### Example ###
			Label: "Google Translator En-Ru",
			Command: "https://translate.google.com/translate?u=%%URL%%&hl=ru&langpair=en|ru&tbb=1&ie=UTF-8",
			Image: 2,
		},
		*/

		/*
		6: { // ### Example ###
			Label: "Google Translator Ru-En",
			Command: "https://translate.google.com/translate?u=%%URL%%&hl=ru&langpair=ru|en&tbb=1&ie=UTF-8",
			Image: 2,
		},
		*/

		/*
		7: { // ### Example ###
			Label: "Bing Translator Auto To Russian",
			Command: "javascript:(function(){var%20s%20=%20document.createElement('scr'+'ipt');" +
				"%20s.type%20=%20'text/javascript';%20s.src%20=%20'http://labs.microsofttranslator" +
				".com/bookmarklet/default.aspx?f=js&to=ru';%20document.body." +
				"insertBefore(s,%20document.body.firstChild);})()",
			Image: 1,
		},
		*/
	},

	PopupEngines: {

		1: { // DO NOT EDIT THIS OBJECT!!!
			Label: "Bing Translator",
			Image: 1,
			method: "GET",
			Referer: "http://www.microsofttranslator.com/",
			action: "http://api.microsofttranslator.com/V2/Ajax.svc/Translate?from=%22%%LNGFROM%%%22" +
				"&to=%22%%LNGTO%%%22&loc=en&ctr=&text=%%SEL%%",
			code: "UTF-8",
		},

		2: { // DO NOT EDIT THIS OBJECT!!!
			Label: "Google Translator",
			Image: 2,
			method: "POST",
			Referer: "https://translate.google.com/",
			action: "https://translate.google.com/",
			post: "client=t&hl=auto&sl=%%LNGFROM%%&tl=%%LNGTO%%&multires=1&prev=btn&ssel=0&tsel=0&sc=1&text=%%SEL%%",
			code: "UTF-8",
			xpath: ".//span[@id=\"result_box\"]|.//div[@id=\"result_box\"]",
		},

		3: { // DO NOT EDIT THIS OBJECT!!!
			Label: "Yandex Translator",
			Image: 3,
			method: "GET",
			Referer: "https://translate.yandex.net/",
			action: "https://translate.yandex.net/api/v1.5/tr.json/translate?key=%%API_KEY%%&lang=%%LNGTO%%&text=%%SEL%%&options=1",
			code: "UTF-8",
		},

		/**
		 * ### How to create new engines for the popup translator. ###
		 *
		 * Objects must be named with a number. NEVER REPEAT A NUMBER AND NEVER USE 1 (one), 2 (two) nor 3 (three)!!!!
		 *
		 * Label: Menu item label.
		 * Image: It sets the image to be used by the menu button inside the popup translator and ,
		 *        if the option "Tanslate on release - Show icon" is enabled, it will show the image specified here.
		 *        If no image is specified, it will set by default a "generic image".
		 *        It can be an URL to an image, a data: image or a number between 0 to 3.
		 *        0 = Generic image.
		 *        1 = Bing translator image.
		 *        2 = Google translator image.
		 *        3 = Yandex trnaslator image.
		 * method: POST or GET.
		 * Referer: URL referrer.
		 * action: Destination URL (Read note bellow).
		 * post: In the case of a POST postdata (Read note bellow).
		 * code: Encoding method. Example: "UTF-8"
		 * xpath: Xpath expression entered to have HTML elements of the translation results.
		 * start: If you do not want to use xpath, a string of HTML document that immediately
		 *        precedes the translation results (regular expression)".
		 * end: If you do not want to use the xpath, a string of HTML document that is immediately
		 *      after the translation results (regular expression).
		 *
		 * Note: Some placeholders can be used inside "action" and "post" (No quotes):
		 * "%%SEL%%" (Mandatory): Used to "inject" the current page selection into "action" and "post" setions.
		 * "%%LNGTO%%" and/or "%%LNGFROM%%" (Optionals): Used to "inject" the language code to translate to/from.
		 * These language codes are configured from the language selection lists inside the popup translator.
		 */


		// ### Un-comment one or more of the elements bellow to display more translation engines. ###

		/*
		4:{ // ### Example ###
			Label: "Google En To Ru",
			Image: "https://translate.google.com/favicon.ico",
			method: "POST",
			Referer: "https://translate.google.com/?tab=yT#en",
			action: "https://translate.google.com/",
			post: "client=t&hl=en&sl=en&tl=ru&multires=1&prev=btn&ssel=0&tsel=0&sc=1&text=%%SEL%%",
			code: "UTF-8",
			xpath: ".//span[@id=\"result_box\"]|.//div[@id=\"result_box\"]",
		},
		*/

		/*
		5: { // ### Example ###
			Label: "Google Ru To En",
			Image: "https://translate.google.com/favicon.ico",
			method: "POST",
			Referer: "https://translate.google.com/?tab=yT#ru",
			action: "https://translate.google.com/",
			post: "client=t&hl=ru&sl=ru&tl=en&multires=1&prev=btn&ssel=0&tsel=0&sc=1&text=%%SEL%%",
			code: "UTF-8",
			xpath: ".//span[@id=\"result_box\"]|.//div[@id=\"result_box\"]",
		},
		*/

		/*
		6: { // ### Example ###
			Label: "Weblio Translation English-Japanese",
			Image: "http://www.westatic.com/img/favicon/ejje.ico",
			method: "POST",
			Referer: "http://translate.weblio.jp/",
			action: "http://translate.weblio.jp/",
			post: "lp=EJ&lpf=&rt=&translatedText=&tlt=english&prtRt=&originalText=%%SEL%%&sentenceStyle=spoken",
			code: "UTF-8",
			xpath: id(\"translatedText\"),
		},
		*/

		/*
		7: { // ### Example ###
			Label: "Weblio Translation Japanese-English",
			Image: "http://www.westatic.com/img/favicon/ejje.ico",
			method: "POST",
			Referer: "http://translate.weblio.jp/",
			action: "http://translate.weblio.jp/",
			post: "lp=JE&lpf=&rt=&translatedText=&tlt=english&prtRt=&originalText=%%SEL%%&sentenceStyle=spoken",
			code: "UTF-8",
			xpath: "id("translatedText")",
		},
		*/

		/*
		8: { // ### Example ###
			Label: "@niftyTranslation English-Japanese",
			Image: "http://honyaku.nifty.com/favicon.ico",
			method: "POST",
			Referer: "http://honyaku.nifty.com/",
			action: "http://honyaku-result.nifty.com/LUCNIFTY/text/text.php",
			post: "SLANG=en&TLANG=ja&XMODE=0&SSRC=%%SEL%%&txtDirection=enja",
			code: "UTF-8",
			xpath: ".//textarea[@id=\"txtTransArea2\"]",
		},
		*/

		/*
		9: { // ### Example ###
			Label: "@niftyTranslation Japanese-English",
			Image: "http://honyaku.nifty.com/favicon.ico",
			method: "POST",
			Referer: "http://honyaku.nifty.com/",
			action: "http://honyaku-result.nifty.com/LUCNIFTY/text/text.php",
			post: "SLANG=ja&TLANG=en&XMODE=0&SSRC=%%SEL%%&txtDirection=jaen",
			code: "UTF-8",
			xpath: ".//textarea[@id=\"txtTransArea2\"]",
		},
		*/

	},

	Init: function() {
		if (!("Services" in window))
			Cu.import("resource://gre/modules/Services.jsm");

		that.InitPrefs();

		if (!(that._UID in window)) {
			window[that._UID] = {
				Listeners: false,
				LastSelection: "",
				FrameScriptLoaded: false,
				XULStyleSheet: false,
				HTMLStyleSheet: false,
			};
		}

		self.tooltipText = "";
		self.setAttribute("tooltip", that._UID + "_self_tooltip");
		self.onclick = function(aE) {
			switch (aE.button) {
				case 0:
					aE.preventDefault();
					if (that._zButtonClickActionLeft !== 0 && !aE.shiftKey && !aE.ctrlKey && !aE.altKey)
						that._buttonClickActions(that._zButtonClickActionLeft, aE);
					else if (that._zButtonClickActionLeftCtrl !== 0 && !aE.shiftKey && aE.ctrlKey && !aE.altKey)
						that._buttonClickActions(that._zButtonClickActionLeftCtrl, aE);
					else if (that._zButtonClickActionLeftShift !== 0 && aE.shiftKey && !aE.ctrlKey && !aE.altKey)
						that._buttonClickActions(that._zButtonClickActionLeftShift, aE);
					else if (that._zButtonClickActionLeftCtrlShift !== 0 && aE.shiftKey && aE.ctrlKey && !aE.altKey)
						that._buttonClickActions(that._zButtonClickActionLeftCtrlShift, aE);
					break;
				case 1:
					aE.preventDefault();
					if (that._zButtonClickActionMiddle !== 0 && !aE.shiftKey && !aE.ctrlKey && !aE.altKey)
						that._buttonClickActions(that._zButtonClickActionMiddle, aE);
					break;
			}
			aE.stopPropagation();
		};

		that._randomID = parseInt(Math.random() * 10000, 10);
		window[that._UID]["RandomID"] = that._randomID;

		if (!(window[that._UID]["FrameScriptLoaded"]) && that._isMultiProcess) {
			window[that._UID]["FrameScriptLoaded"] = true;
			that._frameScript = "data:application/javascript," + encodeURIComponent(getHelp("FrameScript")
				.replace(/_Translate_Sel_ID_/g, that._translateSelMsgID)
				.replace(/_On_Release_Icon_ID_/g, that._onReleaseIconMsgID)
				.replace(/_Move_Popup_ID_/g, that._movePopupMsgID)
				.replace(/_Middle_Click_ID_/g, that._middleClickMsgID)
				.replace(/_Response_ID_/g, that._responseMsgID + that._randomID));
			that._globalMM.loadFrameScript(that._frameScript, true);
			that._globalMM.addMessageListener(that._responseMsgID + that._randomID, that._messageResponse);
		}

		for (let p in that.DefPrefs) {
			if (that.DefPrefs.hasOwnProperty(p))
				that["_" + p] = that.gPref(p);
		}

		that.XULCSSLoader();
		that.HTMLCSSLoader();
		that.CreateElements(true);
		that.HandlePrefListener();
		that.AddListeners();

		addDestructor(function(aReason) {
			if (aReason === "delete" || aReason === "update") {
				that.UnInit();
			}
			if (aReason === "delete") {
				(Services.prefs.getBranch(that.Branch)).deleteBranch("");
				Services.prefs.savePrefFile(null);
			}
		});

	},

	PopulateSelfTooltip: function(aNode) {
		aNode.textContent = "";

		var grid = aNode.appendChild($CNS("grid"));
		var cols = grid.appendChild($CNS("columns"));
		cols.appendChild($CNS("column", {
			flex: 2
		}));
		cols.appendChild($CNS("column", {
			flex: 3
		}));
		cols.appendChild($CNS("column", {
			flex: 1
		}));
		var rows = grid.appendChild($CNS("rows"));
		let AppendRow = function(aRowsNode, aLabel1, aLabel2, aLabel3, aEmpty) {
			let row = $CNS("row");
			if (aEmpty) {
				row.appendChild($CNS("label", {
					value: " ",
					width: 0,
				}));
			} else {
				row.appendChild($CNS("label", {
					value: aLabel1,
					style: "font-weight: bold;",
				}));
				row.appendChild($CNS("label", {
					value: aLabel2,
					style: "font-weight: bold;",
				}));
				let desc = $CNS("description", {
					width: 250,
				});
				desc.textContent = aLabel3; // Use of "textContent" to achieve word wrap. 
				row.appendChild(desc);
			}
			aRowsNode.appendChild(row);
		};
		let clickAction = function(aAction) {
			switch (aAction) {
				case 1:
					return "Open main menu";
				case 2:
					return "Translate selection";
				case 3:
					return "Translate current page";
				case 4:
					return "Translate clipboard content";
				case 5:
					return "Open page translation menu";
			}
		};
		AppendRow(rows, self.name, "", "ID = " + self.id.slice(20));
		AppendRow(rows, null, null, null, true);
		if (that._zButtonClickActionLeft !== 0)
			AppendRow(rows, "Left click", "", clickAction(that._zButtonClickActionLeft));
		if (that._zButtonClickActionMiddle !== 0)
			AppendRow(rows, "Middle click", "", clickAction(that._zButtonClickActionMiddle));
		if (that._zButtonClickActionLeftCtrl !== 0)
			AppendRow(rows, "Ctrl + Left click", "", clickAction(that._zButtonClickActionLeftCtrl));
		if (that._zButtonClickActionLeftShift !== 0)
			AppendRow(rows, "Shift + Left click", "", clickAction(that._zButtonClickActionLeftShift));
		if (that._zButtonClickActionLeftCtrlShift !== 0)
			AppendRow(rows, "Ctrl + Shift + Left click", "", clickAction(that._zButtonClickActionLeftCtrlShift));
		AppendRow(rows, null, null, null, true);
		let trigger = function() {
			if (!that._zTransOnRelease)
				return "Middle click on page content";
			else {
				return "Automatic after release";
			}
		};
		AppendRow(rows, "Trans. selection trigger", "", trigger());
		if (that._zTransOnReleaseControlKey && that._zTransOnRelease)
			AppendRow(rows, "", "", "Control key is required");
		if (that._zTransOnReleaseAltKey && that._zTransOnRelease)
			AppendRow(rows, "", "", "Alt key is required");
	},

	_buttonClickActions: function(aAction, aE) {
		switch (aAction) {
			case 1: // Open Main Menu
				let p = $(that._UID + "_self_popup");
				p && p.openPopup(self, "after_start", 0, 0, false, null, null);
				break;
			case 2: // Translate selection
				that.TranslateSelection();
				break;
			case 3: // Translate current page
				that.TranslatePage(aE, gBrowser.selectedTab.linkedBrowser.currentURI, false);
				break;
			case 4: // Translate clipboard content
				that.TranslateClipboardContent();
				break;
			case 5: // Open Page translation menu
				let m = $(that._UID + "_translationIconOnURLBarMenu");
				m && m.openPopup(self, "after_start", 0, 0, false, null, null);
				break;
		}
	},

	_messageResponse: {
		receiveMessage: function(aMsg) {
			if (aMsg.name !== that._responseMsgID + that._randomID)
				return;
			switch (aMsg.data.id) {
				case 1: // Translate selection directly
				case 2: // Translate selection from mouseover icon
					// case 4: // Translate selection on middle click // Not in use for now. 
					that.doTranslation(aMsg.data.sel);
					break;
				case 3: // Move the popup to selection
					let p = that.transPop;
					(p.state === "open") && p.moveTo(aMsg.data.posX, aMsg.data.posY);
					p.openPopupAtScreen(aMsg.data.posX, aMsg.data.posY, false);
					break;
					// case 5: // Handle KeepItOpen // Not in use for now. 
					// 	if (!that._zPopTransKeepItOpen)
					// 		that.HidePanel();
					// 	break;
			}
		},
	},

	UnInit: function() {
		that.HandlePrefListener(true);
		// A half-working nightmare!!! 
		// Frame scripts are not unloaded.
		if (that._isMultiProcess) {
			window[that._UID]["FrameScriptLoaded"] = false;
			that._globalMM.removeDelayedFrameScript(that._frameScript);
			that._globalMM.removeMessageListener(that._responseMsgID + window[that._UID]["RandomID"], that._messageResponse);
		}
		if (that.timer)
			clearTimeout(that.timer);
		that.RemoveListeners();
		let selfEls = document.getElementsByAttribute("cb_id", that._UID);
		Array.prototype.slice.call(selfEls).forEach(function(aEl) { // Delete all elements created by this button.
			aEl && aEl.parentNode.removeChild(aEl);
		});
	},

	AddListeners: function() {
		let tOnRel = that.gPref("zTransOnRelease");
		if (!window[that._UID]["Listeners"]) {
			let onRelease = tOnRel;
			let ltns = onRelease ? "OnReleaseListener" : "MiddleClickListener";
			// window.addEventListener("unload", that[ltns], false);
			["click", "mousedown", "mouseup"].forEach(function(aLi) {
				if ("gBrowser" in window) {
					gBrowser.addEventListener(aLi, that[ltns], true);
				} else if ($("tabpanelcontainer")) { // Thunderbird main window
					$("tabpanelcontainer").addEventListener(aLi, that[ltns], true);
				} else if ($("messagepane")) { // Message window
					$("messagepanebox").addEventListener(aLi, that[ltns], true);
				}
			});
		}
	},

	// aInverse argument is for when RemoveListeners is called from PrefListener (After the zTransOnRelease pref. is changed.).
	RemoveListeners: function(aInverse) {
		let tOnRel = that.gPref("zTransOnRelease");
		let onRelease = aInverse ? !tOnRel : tOnRel;
		let ltns = onRelease ? "OnReleaseListener" : "MiddleClickListener";
		// window.removeEventListener("unload", that[ltns], false);
		["click", "mousedown", "mouseup"].forEach(function(aLi) {
			if ("gBrowser" in window) {
				gBrowser.removeEventListener(aLi, that[ltns], true);
			} else if ($("tabpanelcontainer")) { // Thunderbird main window
				$("tabpanelcontainer").removeEventListener(aLi, that[ltns], true);
			} else if ($("messagepane")) { // Message window
				$("messagepanebox").removeEventListener(aLi, that[ltns], true);
			}
		});
		let ctxM = $("contentAreaContextMenu") || $("mailContext");
		ctxM.removeEventListener("popupshowing", that.ContextMenuListener, false);
		window[that._UID]["Listeners"] = false;
	},

	AssignImages: function(aNode) {
		Array.prototype.slice.call(aNode.getElementsByAttribute("_pop_eng", "*")).forEach(function(aMI) {
			aMI && aMI.setAttribute("image", that.getEng("image", aMI.getAttribute("_pop_eng") == "true"));
		});
	},

	CreateElements: function(aInit) {
		var mPop = $("mainPopupSet");
		let selfPop = $(that._UID + "_self_popup");
		if (mPop && !selfPop) {
			selfPop = mPop.appendChild($CNS("menupopup", {
				id: that._UID + "_self_popup",
				cb_id: that._UID,
				orient: "vertical",
				onpopupshowing: "document.getElementById('" + self.id + "')" + ".MultiTranslator.AssignImages(this);event.stopPropagation();",
				onpopuphidden: "event.stopPropagation();",
				oncommand: "event.stopPropagation();",
				onclick: "event.stopPropagation();",
			}));
			selfPop.appendChild($CNS("menuitem", {
				label: "Translate selection",
				class: "menuitem-iconic",
				_pop_eng: true,
				key: that._zUseTransSelHotkey ? "key" + that._UID + "_translate_selection" : "",
				onclick: "document.getElementById('" + self.id + "')" + ".MultiTranslator.TranslateSelection();",
			}));
			selfPop.appendChild($CNS("menuitem", {
				label: "Translate current page",
				class: "menuitem-iconic",
				_pop_eng: false,
				key: that._zUseTransPageHotkey ? "key" + that._UID + "_translate_page" : "",
				onclick: "document.getElementById('" + self.id + "')" + ".MultiTranslator.TranslatePage(event, gBrowser.selectedTab.linkedBrowser.currentURI, true);",
			}));
			selfPop.appendChild($CNS("menuitem", {
				label: "Translate clipboard content",
				class: "menuitem-iconic",
				_pop_eng: true,
				key: that._zUseTransClipHotkey ? "key" + that._UID + "_translate_clipboard" : "",
				onclick: "document.getElementById('" + self.id + "')" + ".MultiTranslator.TranslateClipboardContent();",
			}));
			selfPop.appendChild($CNS("menuseparator"));
			selfPop.appendChild($CNS("menu", {
				label: "Options",
			})).appendChild($CNS("menupopup", {
				onpopupshowing: "event.stopPropagation();document.getElementById('" + self.id +
					"').MultiTranslator.PopulateOptionsPopup(this)",
				menugenerated: true,
			}));
		}

		let selfTT = $(that._UID + "_self_tooltip");
		if (mPop && !selfTT) {
			mPop.appendChild($CNS("tooltip", {
				id: that._UID + "_self_tooltip",
				cb_id: that._UID,
				orient: "vertical",
				onpopupshowing: "event.stopPropagation();document.getElementById('" + self.id +
					"').MultiTranslator.PopulateSelfTooltip(this)",
				onpopuphidden: "event.stopPropagation();",
			}));
		}

		if (that._zShowContextMenuItems) {
			let ctxM = $("contentAreaContextMenu") || $("mailContext");
			let ctxTSelMI = $(that._UID + "_translate_selection_context");
			let ctxTPageMI = $(that._UID + "_translate_page_context");
			let ctxTPageM = $(that._UID + "_translate_page_menu_context");
			let ctxTClipMI = $(that._UID + "_translate_clipboard_context");
			let insertPoint = $("mailContext-spell-suggestions-separator") || $("spell-suggestions-separator");
			if (ctxM && !ctxTSelMI) {
				ctxTSelMI = $CNS("menuitem", {
					label: "Translate selection",
					cb_id: that._UID,
					id: that._UID + "_translate_selection_context",
					class: "menuitem-iconic",
					image: that.getEng("image", true),
					key: that._zUseTransSelHotkey ? "key" + that._UID + "_translate_selection" : "",
					onclick: "document.getElementById('" + self.id + "')" + ".MultiTranslator.TranslateSelection();",
				});
				ctxM.insertBefore(ctxTSelMI, insertPoint.nextSibling);
				ctxM.addEventListener("popupshowing", that.ContextMenuListener, false);
			}

			if (!that._zPageTransURLBarIconMenuMode && ctxM && !ctxTPageMI) {
				ctxTPageMI = $CNS("menuitem", {
					label: "Translate current page",
					cb_id: that._UID,
					id: that._UID + "_translate_page_context",
					class: "menuitem-iconic",
					image: that.getEng("image", false),
					key: that._zUseTransPageHotkey ? "key" + that._UID + "_translate_page" : "",
					onclick: "document.getElementById('" + self.id + "')" + ".MultiTranslator.TranslatePage(event, gBrowser.selectedTab.linkedBrowser.currentURI, true);",
				});
				ctxM.insertBefore(ctxTPageMI, insertPoint.nextSibling);
			} else if (that._zPageTransURLBarIconMenuMode && ctxM && !ctxTPageM) {
				ctxTPageM = $CNS("menu", {
					label: "Translate current page",
					cb_id: that._UID,
					id: that._UID + "_translate_page_menu_context",
					class: "menu-iconic",
					image: that.Images[0],
				});
				ctxTPageM.appendChild($CNS("menupopup", {
					onpopupshowing: "event.stopPropagation();document.getElementById('" + self.id +
						"').MultiTranslator.PopulateTranslatePageMenu(this);",
					oncommand: "event.stopPropagation();",
					onclick: "document.getElementById('" + self.id +
						"').MultiTranslator.TranslatePage(event, gBrowser.selectedTab.linkedBrowser.currentURI, null, true);",
					menugenerated: true,
				}));
				ctxM.insertBefore(ctxTPageM, insertPoint.nextSibling);
			}

			if (ctxM && !ctxTClipMI) {
				ctxTClipMI = $CNS("menuitem", {
					label: "Translate clipboard content",
					cb_id: that._UID,
					id: that._UID + "_translate_clipboard_context",
					class: "menuitem-iconic",
					image: that.getEng("image", true),
					key: that._zUseTransClipHotkey ? "key" + that._UID + "_translate_clipboard" : "",
					onclick: "document.getElementById('" + self.id + "')" + ".MultiTranslator.TranslateClipboardContent();",
				});
				ctxM.insertBefore(ctxTClipMI, insertPoint.nextSibling);
			}
		}

		let transPop = that.transPop;
		if (!transPop) {
			transPop = getHelp("MainPanel");
			transPop = transPop.replace(/_U_I_D_/g, that._UID)
				.replace(/_L_A_B_E_L_/g, that.getEng("label", true))
				.replace(/_I_M_A_G_E_/g, that.getEng("image", true))
				.replace(/_S_E_L_F_I_D_/g, self.id);
			transPop = parseXML(transPop);
			transPop.setAttribute("close", that._zPopTransShowTitleBar);
			that._zPopTransShowTitleBar && transPop.setAttribute("titlebar", "normal");
			mPop.appendChild(transPop);
		}

		let m = $(that._UID + "_translationOptionsMenu");
		if (mPop && !m) {
			mPop.appendChild($CNS("menupopup", {
				id: that._UID + "_translation_options",
				cb_id: that._UID,
				onpopupshowing: "event.stopPropagation();document.getElementById('" + self.id +
					"').MultiTranslator.PopulateOptionsPopup(this)",
				menugenerated: true,
				position: "after_start",
			}));
		}
		if (that._zPageTransURLBarIconShow) {
			let URLBar = $("urlbar-icons");
			if (URLBar && !$(that._UID + "_translationIconOnURLBar")) {
				URLBar.appendChild($CNS("image", {
					id: that._UID + "_translationIconOnURLBar",
					tooltip: that._UID + "_translationIconOnURLBarTooltip",
					cb_id: that._UID,
					class: "urlbar-icon",
					context: that._UID + "_translation_options",
					src: that.getEng("image"),
					oncommand: "event.stopPropagation();",
					onclick: that._zPageTransURLBarIconMenuMode ? "if (event.button === 0) document.getElementById('" + that._UID +
						"_translationIconOnURLBarMenu').openPopup(this, '', 0, 0, false, null, null);" : "document.getElementById('" +
						self.id + "').MultiTranslator.TranslatePage(event, gBrowser.selectedTab.linkedBrowser.currentURI);",
				}));
				if (!$(that._UID + "_translationIconOnURLBarTooltip"))
					mPop.appendChild($CNS("tooltip", {
						id: that._UID + "_translationIconOnURLBarTooltip",
						cb_id: that._UID,
						onpopupshowing: "event.stopPropagation();document.getElementById('" + self.id +
							"').MultiTranslator.updateIconOnURLBarTooltip(this)",
						menugenerated: true,
					}));
			}

			if (that._zPageTransURLBarIconMenuMode) {
				if (mPop && !$(that._UID + "_translationIconOnURLBarMenu")) {
					let urlMenu = mPop.appendChild($CNS("menupopup", {
						id: that._UID + "_translationIconOnURLBarMenu",
						orient: "vertical",
						menugenerated: true,
						cb_id: that._UID,
						position: "after_start",
						onpopupshowing: "event.stopPropagation();document.getElementById('" + self.id +
							"').MultiTranslator.PopulateTranslatePageMenu(this);",
						oncommand: "event.stopPropagation();",
						onclick: "document.getElementById('" + self.id +
							"').MultiTranslator.TranslatePage(event, gBrowser.selectedTab.linkedBrowser.currentURI, null, true);",
					}));
				}
			}
		}

		if (aInit) {
			that.PopulateLangLists();
			that.HandleHotkey();
		}
	},

	ContextMenuListener: function() {
		let mI = $(that._UID + "_translate_selection_context");
		mI.hidden = !(gContextMenu.isTextSelected);
		mI.image = that.getEng("image", true);
		that._zPageTransURLBarIconMenuMode || ($(that._UID + "_translate_page_context").image = that.getEng("image", false));
		$(that._UID + "_translate_clipboard_context").image = that.getEng("image", true);
	},

	PopulateTranslatePageMenu: function(aNode) {
		aNode.textContent = "";

		let URLBEng = that.URLBarEngines;
		for (let book in URLBEng) {
			if (URLBEng.hasOwnProperty(book)) {
				if (!!URLBEng[book].Label && !!URLBEng[book].Command) {
					let img = function(aKey) {
						if (typeof URLBEng[aKey].Image === "number")
							return that.Images[URLBEng[aKey].Image];
						return URLBEng[aKey].Image;
					};
					aNode.appendChild($CNS("menuitem", {
						label: URLBEng[book].Label,
						class: "menuitem-iconic",
						tooltiptext: !!URLBEng[book].Tooltip ? URLBEng[book].Tooltip : "",
						image: img(parseInt(book, 10)) || "",
						value: parseInt(book, 10),
					}));
				}
			}
		}
	},

	HandleHotkey: function() {
		let key1 = "key" + that._UID + "_translate_selection",
			key2 = "key" + that._UID + "_translate_page",
			key3 = "key" + that._UID + "_translate_clipboard",
			keySet = $("mailKeys") || $("mainKeyset"),
			usekey1 = that._zUseTransSelHotkey,
			usekey2 = that._zUseTransPageHotkey,
			usekey3 = that._zUseTransClipHotkey;
		let key1el = $(key1),
			key2el = $(key2),
			key3el = $(key3);

		if (!key1el) {
			keySet.appendChild($CNS("key", {
				id: key1,
				key: that._HotkeyTransSelKey,
				modifiers: that._HotkeyTransSelModifiers,
				oncommand: "event.stopPropagation();document.getElementById('" + self.id + "')" + ".MultiTranslator.TranslateSelection();",
			}));
		}
		if ("gBrowser" in window && !key2el) {
			keySet.appendChild($CNS("key", {
				id: key2,
				key: that._HotkeyTransPageKey,
				modifiers: that._HotkeyTransPageModifiers,
				oncommand: "document.getElementById('" + self.id + "')" +
					".MultiTranslator.TranslatePage(event, gBrowser.selectedTab.linkedBrowser.currentURI, true);",
			}));
		}
		if (!key3el) {
			keySet.appendChild($CNS("key", {
				id: key3,
				key: that._HotkeyTransClipKey,
				modifiers: that._HotkeyTransClipModifiers,
				oncommand: "document.getElementById('" + self.id + "')" +
					".MultiTranslator.TranslateClipboardContent();",
			}));
		}
		key1el && key1el.setAttribute("disabled", !usekey1);
		key2el && key2el.setAttribute("disabled", !usekey2);
		key3el && key3el.setAttribute("disabled", !usekey3);
	},

	TranslatePage: function(aE, aURI, aHotKey, aFromURLMenu) {
		aE.preventDefault();
		if (!aURI.schemeIs("http") && !aURI.schemeIs("https"))
			return false;

		let btn = aE.button;
		if (btn === 2)
			return;
		if (btn === 0 || aHotKey) // Left click and Hotkey triggers the same action.
			that.OpenURLIn(that._zPageTransURLBarIconLeftClick, aURI.spec, aE.target.value);
		else if (btn === 1)
			that.OpenURLIn(that._zPageTransURLBarIconMiddleClick, aURI.spec);
		aE.stopPropagation();
	},

	OpenURLIn: function(aWhere, aURL, aFromURLMenu) {
		var engine = aFromURLMenu ? aFromURLMenu : that._zPageTransEngine;
		var urlForNewTab = (/^javascript:/.test(that.URLBarEngines[engine].Command)) ? aURL : "about:blank";
		if (aWhere !== 1) {
			window.addEventListener("DOMContentLoaded", function _(aE) {
				window.removeEventListener("DOMContentLoaded", _, true);
				that.DoPageTranslation(engine, aURL, aE.target);
			}, true);
		}
		switch (aWhere) {
			case 1: // Current
				that.DoPageTranslation(engine, aURL);
				break;
			case 2: // Next to current
				let pos = gBrowser.selectedTab._tPos || gBrowser.tabContainer.selectedIndex; // Firefox || SeaMonkey
				gBrowser.moveTabTo(gBrowser.selectedTab = gBrowser.addTab(urlForNewTab), pos + 1);
				break;
			case 3: // New tab in background
				gBrowser.addTab(urlForNewTab);
				break;
			case 4: // New tab in foreground
				gBrowser.selectedTab = gBrowser.addTab(urlForNewTab);
				break;
		}
	},

	DoPageTranslation: function(aEngine, aURL, aETarget) {
		var lFrom = that._zPageTransFromLang,
			lTo = that._zPageTransToLang,
			cLoc = !!aETarget ? aETarget : content.document;
		var bookCmd = that.URLBarEngines[aEngine].Command;
		bookCmd = bookCmd.replace(/%%LNGTO%%/g, lTo.toString())
			.replace(/%%LNGFROM%%/g, ((lFrom === "" && aEngine === 2) ? "auto" : lFrom.toString()))
			.replace(/%%URL%%/g, encodeURIComponent(aURL));
		setTimeout(function() {
			loadURI(bookCmd);
		}, 100);
	},

	PopulateLangLists: function(aE) {
		let mLPops = {
			to: that._UID + "_languageSelectionPopupTo",
			from: that._UID + "_languageSelectionPopupFrom"
		};
		for (let dir in mLPops) {
			if (mLPops.hasOwnProperty(dir)) {
				let langs = that.langs;
				for (let lng in langs) {
					if (langs.hasOwnProperty(lng)) {
						if (lng === "" && dir === "to")
							continue;
						$(mLPops[dir]).appendChild($CNS("menuitem", {
							label: langs[lng],
							value: lng,
							seleted: (lng === that._zPopTransToLang),
							oncommand: "event.stopPropagation();document.getElementById('" + self.id +
								"').MultiTranslator.sPref(this.parentNode.parentNode.getAttribute('_pref'), this.value);",
						}));
					}
				}
			}
		}
	},

	updateIconOnURLBarTooltip: function(aNode) {
		aNode.textContent = "";

		var eng = that._zPageTransEngine,
			lC = that._zPageTransURLBarIconLeftClick,
			mC = that._zPageTransURLBarIconMiddleClick;
		let rows = aNode.appendChild($CNS("grid")).appendChild($CNS("rows"));
		let getWhere = function(aWhere) {
			switch (aWhere) {
				case 1:
					return "in current tab.";
				case 2:
					return "in new tab next to current one.";
				case 3:
					return "in a new tab in the background.";
				case 4:
					return "in a new tab in the foreground.";
			}
		};
		let appendRow = function(aLbl1, aLbl2) {
			let lbl1 = rows.appendChild($CNS("row"));
			lbl1.appendChild($CNS("label", {
				value: aLbl1,
				style: "font-weight: bold;",
			}));
			lbl1.appendChild($CNS("label", {
				value: aLbl2,
			}));
		};
		appendRow("Current engine : ", that.URLBarEngines[eng].Label);
		rows.appendChild($CNS("row")).appendChild($CNS("label", {
			value: " ",
		}));
		appendRow("Left click : ", (that._zPageTransURLBarIconMenuMode ? "Open menu - Translate page " : "Translate page ") + getWhere(lC));
		appendRow("Middle click : ", "Translate page " + getWhere(mC));
		rows.appendChild($CNS("row")).appendChild($CNS("label", {
			value: " ",
		}));
		appendRow("Right click : ", "Open options menu.");
	},

	setMenulistsCheckedState: function() {
		let mLs = [that._UID + "_languageSelectionMenulistTo", that._UID + "_languageSelectionMenulistFrom"];
		Array.prototype.slice.call(mLs).forEach(function(aMLID) {
			let mL = $(aMLID);
			let mIs = $$("menuitem", mL),
				mLPref = that["_" + mL.getAttribute("_pref")];
			Array.prototype.slice.call(mIs).forEach(function(aMI) {
				if (aMI.value === mLPref)
					mL.selectedIndex = mL.getIndexOfItem(aMI);
			});
		});
	},

	MiddleClickListener: function(aE) {
		switch (aE.type) {
			case "click":
				if (aE.button !== 1)
					return;
				if (that._getSelection() !== "") {
					aE.preventDefault();
					aE.stopPropagation();
				}
				that.TranslateSelection();
				var target = aE.target;
				if (target instanceof HTMLAnchorElement ||
					target instanceof HTMLAreaElement ||
					target instanceof HTMLLinkElement)
					return;
				break;
			case "mouseup":
			case "mousedown":
				if (aE.button !== 1)
					return;
				if (that._getSelection() !== "") {
					aE.preventDefault();
					aE.stopPropagation();
				}

				if (!that._zPopTransKeepItOpen)
					that.HidePanel();
				break;
		}
	},

	OnReleaseListener: function(aE) {
		switch (aE.type) {
			case "mouseup":
				if (aE.button !== 0 || !that.OnReleaseModifiers(aE))
					return;

				if (that._zTransOnReleaseShowIcon &&
					(that.place &&
						(that.place.namespaceURI !== xulns && !(/^html:/.test(that.place.tagName))))) {
					if (that.transPop.state === "open")
						that.TranslateSelection();
					else
						that.OnReleaseIcon(aE);
				} else
					that.TranslateSelection();
				break;
			case "click":
			case "mousedown":
				if (aE.button !== 0 && !that.OnReleaseModifiers(aE))
					return;

				that.place = that.contentDoc().activeElement;

				if (!that._zPopTransKeepItOpen)
					that.HidePanel();
				break;
		}
	},

	OnReleaseModifiers: function(aE) {
		let useCtrlKey = that._zTransOnReleaseControlKey,
			useAltKey = that._zTransOnReleaseAltKey;
		if (aE.ctrlKey && aE.altKey && (!useCtrlKey || !useAltKey))
			return false;
		// XOR http://www.howtocreate.co.uk/xor.html
		if (aE.ctrlKey ? !useCtrlKey : useCtrlKey)
			return false;
		if (aE.altKey ? !useAltKey : useAltKey)
			return false;
		return true;
	},

	HidePanel: function() {
		let p = that.transPop;
		(p && p.state === "open") && p.hidePopup();
	},

	OnReleaseIcon: function(aE) {
		if (that._isMultiProcess) {
			gBrowser.selectedTab.linkedBrowser.messageManager.sendAsyncMessage(that._onReleaseIconMsgID, {
				iconOffsetY: that._TransOnReleaseIconOffsetY,
				iconOffsetX: that._TransOnReleaseIconOffsetX,
				_UID: that._UID,
				btnID: self.id,
				clientY: aE.clientY,
				clientX: aE.clientX,
				image: that.getEng("image", true),
			});
			return true;
		}
		var doc = content.document;
		var body = $$("body", doc)[0];
		var div = $(that._UID + "onReleaseDiv", doc);
		if (div)
			div.parentNode.removeChild(div);

		var sel = that._getSelection();
		if (!sel || sel === "" || !body)
			return;

		var imgLookup = $C("img", {
			border: 0,
			src: that.getEng("image", true),
		}, doc);
		console.info(aE.clientY);
		console.info(window.pageYOffset);
		console.info(aE.clientX);
		console.info(window.pageXOffset);
		div = $C("div", {
			id: that._UID + "onReleaseDiv",
			style: "background-color:transparent; color:#000000; position:absolute; top:" +
				(aE.clientY + window.pageYOffset + that._TransOnReleaseIconOffsetY) + "px; left:" +
				(aE.clientX + window.pageXOffset + that._TransOnReleaseIconOffsetX) +
				"px; padding:0px; z-index:10000; border-radius:2px;",
		}, doc);
		div.appendChild(imgLookup.cloneNode(false));
		let listener = function(aE) {
			aE.preventDefault();
			that.TranslateSelection();
			try {
				this.parentNode.removeChild(this);
			} catch (aErr) {}
			aE.stopPropagation();
		};
		div.addEventListener("mouseover", listener, false);
		body.appendChild(div);
	},

	TranslateSelection: function() {
		if (that._isMultiProcess) {
			gBrowser.selectedTab.linkedBrowser.messageManager.sendAsyncMessage(that._translateSelMsgID);
			return true;
		}
		that.place = that.contentDoc().activeElement;

		let sel = that._getSelection();

		if (!sel || sel === "")
			return;

		that.doTranslation(sel);
	},

	TranslateClipboardContent: function() {
		that.doTranslation(gClipboard.read());
	},

	doTranslation: function(aStr) {
		let engine = that.getEng(null, true);
		engine && that.getTranslateResult(aStr, engine);
	},

	contentDoc: function() {
		var contentWindow = window.content ? window.content : window.getBrowser().selectedBrowser.contentWindowAsCPOW;
		return contentWindow.document;
	},

	// Get the current window
	_getFocusedWindow: function() {
		fWin = document.commandDispatcher.focusedWindow;
		if (!fWin || fWin == window)
			return window.gBrowser.selectedBrowser.contentWindowAsCPOW;
		else
			return fWin;
	},

	// _getSelection: function() {
	// 	let fWin = {};
	// 	let fEl = Services.focus.getFocusedElementForWindow(window, true, fWin);
	// 	fWin = fWin.value;
	// 	let selStr = fWin.getSelection().toString();
	// 	if (!selStr && fEl instanceof Ci.nsIDOMNSEditableElement) {
	// 		if (fEl instanceof Ci.nsIDOMHTMLTextAreaElement ||
	// 			(fEl instanceof Ci.nsIDOMHTMLInputElement &&
	// 				fEl.mozIsTextField(true))) {
	// 			selStr = fEl.editor.selection.toString();
	// 		}
	// 	}
	// 	return selStr;
	// },

	_getSelection: function() {
		if ("BrowserUtils" in window)
			return BrowserUtils.getSelectionDetails(window, 10000).text;

		if (content.getSelection) {
			var sel;
			var activeEl = content.document.activeElement;
			try {
				sel = activeEl.value.substring(activeEl.selectionStart, activeEl.selectionEnd);
			} catch (e) {
				sel = content.getSelection().toString();
			} finally {
				return sel;
			}
		}
		return false;
	},

	getEng: function(aProp, aForPopup) {
		var engs = aForPopup ? that.PopupEngines : that.URLBarEngines;
		let selProp = function(aProp, aKey) {
			switch (aProp) {
				case "image":
					if (typeof engs[aKey].Image === "number")
						return that.Images[engs[aKey].Image];
					return engs[aKey].Image;
				case "label":
					return engs[aKey].Label;
				default:
					return aKey;
			}
		};

		for (var book in engs) {
			if (engs.hasOwnProperty(book)) {
				if (parseInt(book, 10) === parseInt((aForPopup ? that._zPopTransEngine : that._zPageTransEngine), 10))
					return selProp(aProp, parseInt(book, 10));
			}
		}

		that.sPref(aForPopup ? "zPopTransEngine" : "zPageTransEngine", 2); // Defaults to Google translator
		return selProp(aProp, 2);
	},

	getMaxLengthForEng: function(aEngine) {
		switch (aEngine) {
			case 1: // Bing
				return 150;
			case 3: // Yandex
				return 500;
			default: // Everything else
				return parseInt(that._PopupMaxStringLength, 10);
		}
	},

	openFailSafeURL: function(aURL) {
		if (!("gBrowser" in window)) {
			try {
				openContentTab(aURL);
			} catch (aError) {
				loadURI(aURL);
			}
			return;
		}
		switch (that._zPopTransFailSafeOpenURLWhere) {
			case 1: // Current
				loadURI(aURL);
				break;
			case 2: // Next to current
				let pos = gBrowser.selectedTab._tPos || gBrowser.tabContainer.selectedIndex; // Firefox || SeaMonkey
				gBrowser.moveTabTo(gBrowser.selectedTab = gBrowser.addTab(aURL), pos + 1);
				break;
			case 3: // New tab in background
				gBrowser.addTab(aURL);
				break;
			case 4: // New tab in foreground
				gBrowser.selectedTab = gBrowser.addTab(aURL);
				break;
		}
	},

	getTranslateResult: function(aStr, aEngine) {
		var Exp, xpath,
			popEng = that.PopupEngines[aEngine],
			maxLength = that.getMaxLengthForEng(aEngine);
		var SUC = Cc["@mozilla.org/intl/scriptableunicodeconverter"]
			.createInstance(Ci.nsIScriptableUnicodeConverter);
		SUC.charset = popEng.code;
		var str = SUC.ConvertFromUnicode(aStr),
			lgFrom = that._zPopTransFromLang,
			lgTo = that._zPopTransToLang;
		str = str.replace(/\s+/g, " ");
		if (that._zPopTransFailSafe && str.length > maxLength && aEngine <= 3) {
			str = $escape(str);
			switch (aEngine) {
				case 1:
					that.openFailSafeURL("https://www.bing.com/translator/?from=" + lgFrom + "&to=" + lgTo + "&text=" + str);
					return;
				case 2:
					// that.openFailSafeURL("https://translate.google.com/#" + lgFrom + "/" + lgTo + "/" + str);
					that.openFailSafeURL("https://translate.google.com/?hl=" + lgTo + "&eotf=0&sl=" + lgFrom + "&tl=" + lgTo + "&text=" + str);
					return;
				case 3:
					that.openFailSafeURL("https://translate.yandex.ru/?from=" + lgFrom + "&to=" + lgTo + "&text=" + str);
					return;
			}
		}
		str = str.substring(0, maxLength);
		if (popEng.method === "POST") {
			var url = popEng.action;
			var data = popEng.post.replace(/%%LNGTO%%/g, lgTo).replace(/%%LNGFROM%%/g, lgFrom);
			data = data.replace(/%%SEL%%/g, $escape(str).replace(/\+/g, "%2B"));
		} else {
			var url = (aEngine === 3) ?
				popEng.action :
				popEng.action.replace(/%%LNGTO%%/g, lgTo).replace(/%%LNGFROM%%/g, lgFrom);
			url = url.replace(/%%SEL%%/g, $escape(str).replace(/\+/g, "%2B"));
			var data = null;
		}
		if (!popEng.xpath || popEng.xpath === "")
			Exp = new RegExp(popEng.start + "((.|\\r|\\n)*)" + popEng.end, "i");
		else
			xpath = popEng.xpath;
		that.show("Translating...");
		if (aEngine === 1) {
			that.BingAPI(popEng, url);
		} else if (aEngine === 3) {
			that.YandexAPI(popEng, url);
		} else {
			that.GM_xmlhttpRequest({
				method: popEng.method,
				overrideMimeType: "text/html; charset=" + popEng.code,
				url: url,
				data: data,
				headers: {
					"Referer": popEng.Referer,
					"Content-Type": "application/x-www-form-urlencoded"
				},
				onload: function(aDetails) {
					var txt = aDetails.responseText.toString();
					var res = null;
					try {
						if (!xpath) {
							res = txt.match(new RegExp(Exp.source, "i"));
							res = RegExp.$1;
						} else {
							var hdoc = that.str2dom(txt);
							var result = hdoc.evaluate(xpath, hdoc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
							var node = result.snapshotLength > 0 ? result.snapshotItem(0) : null;
							res = node.textContent || node.value;
							node = hdoc = result = null;
						}
					} catch (e) {
						that.show("Failure to obtain.");
					}
					//res = res.trim();
					res = res.replace(/\n/g, "<html:br />");
					if (!!res) {
						that.show(res);
					} else {
						that.show("Failure to obtain.");
					}
				},
				onerror: function(aErr) {
					that.show("Error " + aErr.status + " occurred while receiving the document.");
				},
				ontimeout: function() {
					that.show("Timeout. Couldn't obtain translation result.");
				}
			});
		}
	},

	YandexAPI: function(aEngine, aURL) {
		var random = Math.floor(Math.random() * that.APIKeysYandex.length - 1) + 1,
			lgFrom = that._zPopTransFromLang,
			lgTo = that._zPopTransToLang;
		var url = aURL.replace("%%API_KEY%%", that.APIKeysYandex[random])
			.replace("%%LNGTO%%", ((lgFrom === "") ? lgTo : lgFrom + "-" + lgTo));
		that.GM_xmlhttpRequest({
			method: aEngine.method,
			overrideMimeType: "text/html; charset=" + aEngine.code,
			url: url,
			data: null,
			headers: {
				"Content-Type": "application/x-www-form-urlencoded"
			},
			onload: function(aRes) {
				if (aRes.readyState === 4 && aRes.status === 200) {
					let txt = JSON.parse(aRes.responseText).text.toString();
					txt = txt.replace(/\n/g, "<html:br />");
					if (txt !== "")
						that.show(txt);
					else
						that.show("Failure to obtain.");
				}
			},
			onerror: function(aErr) {
				that.show("Error " + aErr.status + " occurred while trying to obtain translation result.");
			},
			ontimeout: function() {
				that.show("Timeout. Couldn't obtain translation result.");
			}
		});
	},

	BingAPI: function(aEngine, aURL) {
		var random = Math.floor(Math.random() * that.APIKeysBing.length - 1) + 1;
		that.GM_xmlhttpRequest({
			method: "POST",
			overrideMimeType: "text/html; charset=" + aEngine.code,
			url: "https://datamarket.accesscontrol.windows.net/v2/OAuth2-13",
			data: "grant_type=client_credentials&client_id=" + encodeURIComponent(that.APIKeysBing[random][0]) +
				"&client_secret=" + encodeURIComponent(that.APIKeysBing[random][1]) + "&scope=http://api.microsofttranslator.com",
			headers: {
				"Content-Type": "application/x-www-form-urlencoded"
			},
			onload: function(aRes) {
				if (aRes.readyState === 4 && aRes.status === 200) {
					that.GM_xmlhttpRequest({
						method: aEngine.method,
						overrideMimeType: "text/html; charset=" + aEngine.code,
						url: aURL,
						data: null,
						headers: {
							"Authorization": "bearer " + JSON.parse(aRes.responseText).access_token,
							"Content-Type": "application/x-www-form-urlencoded"
						},
						onload: function(aRes2) {
							if (aRes2.readyState === 4 && aRes2.status === 200) {
								let txt = aRes2.responseText.toString().replace(/^\"/g, "").replace(/\"$/g, "");
								txt = txt.replace(/\n/g, "<html:br />");
								if (txt !== "")
									that.show(txt);
								else
									that.show("Failure to obtain.");
							}
						},
						onerror: function(aErr) {
							that.show("Error " + aErr.status + " occurred while trying to obtain translation result.");
						},
						ontimeout: function() {
							that.show("Timeout. Couldn't obtain translation result.");
						}
					});
				}
			},
			onerror: function(aErr) {
				that.show("Error " + aErr.status + " occurred while trying to obtain Bing API credentials.");
			},
			ontimeout: function() {
				that.show("Timeout. Couldn't obtain Bing API credentials.");
			}
		});
	},


	str2dom: function(aStr) {
		var xsl = (new DOMParser()).parseFromString([
			"<?xml version=\"1.0\"?>",
			"<stylesheet version=\"1.0\" xmlns=\"http://www.w3.org/1999/XSL/Transform\">",
			"<output method=\"html\"/>",
			"</stylesheet>"
		].join("\n"), "text/xml");

		var xsltp = new XSLTProcessor();
		xsltp.importStylesheet(xsl);
		var htmldoc = xsltp.transformToDocument(document.implementation.createDocument("", "", null));

		var range = htmldoc.createRange();
		htmldoc.appendChild(htmldoc.createElement("html"));
		range.selectNodeContents(htmldoc.documentElement);

		htmldoc.documentElement.appendChild(range.createContextualFragment(aStr));
		return htmldoc;
	},

	req: null,
	GM_xmlhttpRequest: function(aObj) {
		if (typeof(aObj) !== "object" || (typeof(aObj.url) !== "string" && !(aObj.url instanceof String)))
			return;
		if (!that.req)
			that.req = new XMLHttpRequest();
		var req = that.req;
		req.abort();
		req.timeout = that.TIMEOUT;

		req.reqestUrl = aObj.url;
		req.open(aObj.method || "GET", aObj.url, true);

		if (typeof(aObj.headers) === "object") {
			for (var i in aObj.headers)
				req.setRequestHeader(i, aObj.headers[i], false);
		}

		["onload", "onerror", "onreadystatechange", "ontimeout"].forEach(function(k) {
			if (aObj[k] && (typeof(aObj[k]) === "function" || aObj[k] instanceof Function))
				req[k] = function() {
					aObj[k]({
						status: (req.readyState === 4) ? req.status : 0,
						statusText: (req.readyState === 4) ? req.statusText : "",
						responseHeaders: (req.readyState === 4) ? req.getAllResponseHeaders() : "",
						responseText: req.responseText,
						readyState: req.readyState,
						finalUrl: (req.readyState === 4) ? req.channel.URI.spec : ""
					});
				};
		});

		if (aObj.overrideMimeType)
			req.overrideMimeType(aObj.overrideMimeType);
		if (typeof aObj.data === "string")
			req.send(aObj.data); // For POST
		else
			req.send(null); // For GET
	},

	openPage: function(aURL, aE) {
		try {
			gBrowser.selectedTab = gBrowser.addTab(aURL);
		} catch (aEr) {
			try {
				openContentTab(aURL);
			} catch (aError) {
				openUILink(aURL, aE);
			}
		}
	},

	setFooter: function() {
		let eng = that._zPopTransEngine;
		let data = [
			["Bing", "http://www.bing.com/translator/"],
			["Google", "https://translate.google.com/"],
			["Yandex", "http://translate.yandex.ru/"],
		];
		let footer = "<html:br /><html:span style=\"font-size:x-small;float:right;\">Service provided by " +
			"<html:span onclick=\"event.stopPropagation();document.getElementById('" +
			self.id + "').MultiTranslator.openPage('" + data[eng - 1][1] + "', " +
			"event);\" style=\"font-weight:bold;cursor:pointer;\">" + data[eng - 1][0] + " Translator" +
			"</html:span></html:span>";
		try {
			$(that._UID + "_translationResultContentFooter").innerHTML = that._PopupShowFooter ? footer : "";
		} catch (aErr) {}
	},

	show: function(aRes) {
		var popup = that.transPop;
		$(that._UID + "_translationResultContent").innerHTML = escHTML(aRes);
		that.setFooter();
		that.sizeChange();
		if (that.timer)
			clearTimeout(that.timer);
		if (that._zPopTransAnchorToSelection) {
			if (that._isMultiProcess) {
				gBrowser.selectedTab.linkedBrowser.messageManager.sendAsyncMessage(that._movePopupMsgID, {
					_UID: that._UID,
					width: (fullScreen ? screen.width : screen.availWidth),
					height: (fullScreen ? screen.height : screen.availHeight),
				});
			} else {
				let fWin = that._getFocusedWindow();
				let rect;
				try {
					rect = fWin.getSelection().getRangeAt(0).getBoundingClientRect();
				} catch (aErr) {
					rect = false;
				}
				let posX = fWin.mozInnerScreenX + (rect ? rect.left : fWin.innerWidth / 2);
				let posY = fWin.mozInnerScreenY + (rect ? rect.bottom : fWin.innerHeight / 2) + 3;
				let deltaX = posX - (fullScreen ? screen.width : screen.availWidth);
				if (deltaX > 0)
					posX -= deltaX;
				let deltaY = posY - (fullScreen ? screen.height : screen.availHeight);
				if (deltaY > 0)
					posY -= deltaY;
				let div = $(that._UID + "onReleaseDiv", content.document);
				try {
					(popup.state === "open") && popup.moveTo(posX, posY);
					popup.openPopupAtScreen(posX, posY, false);
				} finally {
					div && div.parentNode.removeChild(div);
				}
			}
		} else
			that.openTransPop();
		setTimeout(function() {
			that.sizeChange();
		}, 0);
	},

	openTransPop: function() {
		let node = $("content");
		if (!node)
			node = $("messagepane");
		that.transPop.openPopup(node, "overlap", 0, 0, false, null, null);
	},

	sizeChange: function() {
		let p = that.transPop;
		let b = $(that._UID + "_translationResultBox");
		p.sizeTo(that._PopupMaxWidth, Math.max(b.boxObject.height * 1.0 + 5, 23));
	},

	PopulateOptionsPopup: function(aNode) {
		let engine = that.getEng();
		engine = that.getEng(null, true);
		delete engine;
		let tNode = aNode.triggerNode;
		aNode.textContent = "";

		aNode.onclick = function(aE) {
			aE.stopPropagation();
		};
		if (!tNode || (tNode && tNode.id !== that._UID + "_translationIconOnURLBar")) {
			aNode.appendChild($CNS("dialogheader", {
				title: "Engine for popup",
				tooltiptext: "Choose default engine for the popup translator.",
				style: "margin: 0 0 7px 0;padding: 2px 0 2px 5px;border:none;font-size:smaller;",
			}));
			let rGPop = aNode.appendChild($CNS("radiogroup"));
			var pEngs = that.PopupEngines;
			for (eng in pEngs) {
				if (pEngs.hasOwnProperty(eng)) {
					rGPop.appendChild($CNS("menuitem", {
						label: pEngs[eng].Label,
						type: "radio",
						closemenu: "none",
						oncommand: "event.stopPropagation();document.getElementById('" + self.id +
							"').MultiTranslator.sPref('zPopTransEngine', " + parseInt(eng, 10) + ");",
						checked: (that._zPopTransEngine === parseInt(eng, 10)),
					}));
				}
			}

			aNode.appendChild($CNS("separator"));
		}

		if ("gBrowser" in window && (!tNode || (tNode && tNode.id !== that._UID + "_translationOptionsButton"))) {
			aNode.appendChild($CNS("dialogheader", {
				title: "Engine for page translator",
				tooltiptext: "Choose default engine for the page translator.",
				style: "margin: 0 0 7px 0;padding: 2px 0 2px 5px;border:none;font-size:smaller;",
			}));
			let rGURL = aNode.appendChild($CNS("radiogroup"));
			let URLBEng = that.URLBarEngines;
			for (var book in URLBEng) {
				if (URLBEng.hasOwnProperty(book)) {
					if (!!URLBEng[book].Label && !!URLBEng[book].Command) {
						rGURL.appendChild($CNS("menuitem", {
							label: URLBEng[book].Label,
							type: "radio",
							closemenu: "none",
							tooltiptext: !!URLBEng[book].Tooltip ? URLBEng[book].Tooltip : "",
							checked: (that._zPageTransEngine === parseInt(book, 10)),
							oncommand: "event.stopPropagation();document.getElementById('" + self.id +
								"').MultiTranslator.sPref('zPageTransEngine', " + parseInt(book, 10) + ");",
						}));
					}
				}
			}

			aNode.appendChild($CNS("separator"));
		}

		var genOpts = aNode.appendChild($CNS("menu", {
			label: "General options",
		})).appendChild($CNS("menupopup", {
			menugenerated: true,
			onpopupshowing: "event.stopPropagation();",
		}));
		[
			["zOpenOptionsInTab",
				"Open options in tab"
			],
			["zShowContextMenuItems",
				"Show in context menu"
			],
			["zUseTransPageHotkey",
				"Use Translate Page hotkey"
			],
			["zUseTransSelHotkey",
				"Use Translate Selection hotkey"
			],
			["zUseTransClipHotkey",
				"Use Trasnlate Clipboard hotkey"
			]
		].forEach(function(aP) {
			genOpts.appendChild($CNS("menuitem", {
				label: aP[1],
				type: "checkbox",
				closemenu: "none",
				tooltiptext: that.optionsDesc[aP[0]],
				checked: that["_" + aP[0]],
				oncommand: "event.stopPropagation();document.getElementById('" + self.id +
					"').MultiTranslator.sPref('" + aP[0] + "', !document.getElementById('" + self.id +
					"').MultiTranslator.gPref('" + aP[0] + "'));",
			}));
		});

		genOpts.appendChild($CNS("dialogheader", {
			title: "Click actions",
			tooltiptext: "Click actions on Multi Translator button.",
			style: "margin: 0 0 7px 0;padding: 2px 0 2px 5px;border:none;font-size:smaller;",
		}));
		let what = [
			[0, "...disabled."],
			[1, "...opens main menu."],
			[2, "...translates selection."],
			[3, "...translates current page."],
			[4, "...translates clipboard content."],
			[5, "...opens page translation menu."],
		];
		[
			["zButtonClickActionLeft", "Left click..."],
			["zButtonClickActionMiddle", "Middle click..."],
			["zButtonClickActionLeftCtrl", "Ctrl + Left click..."],
			["zButtonClickActionLeftShift", "Shift + Left click..."],
			["zButtonClickActionLeftCtrlShift", "Ctrl + Shift + Left click..."]
		].forEach(function(aP) {
			let actClick = genOpts.appendChild($CNS("menu", {
				label: aP[1],
			})).appendChild($CNS("menupopup", {
				menugenerated: true,
				onpopupshowing: "event.stopPropagation();",
			})).appendChild($CNS("radiogroup", {
				_pref: aP[0],
				oncommand: "console.info(event.target.value);event.stopPropagation();document.getElementById('" + self.id +
					"').MultiTranslator.sPref(this.getAttribute('_pref'), parseInt(event.target.value, 10));",
			}));
			what.forEach(function(aAct) {
				actClick.appendChild($CNS("menuitem", {
					label: aAct[1],
					type: "radio",
					closemenu: "none",
					value: aAct[0],
					checked: (aAct[0] === that["_" + aP[0]]),
				}));
			});
		});



		if (!tNode || (tNode && tNode.id !== that._UID + "_translationIconOnURLBar")) {
			var popOpts = aNode.appendChild($CNS("menu", {
				label: "Popup options",
			})).appendChild($CNS("menupopup", {
				menugenerated: true,
				onpopupshowing: "event.stopPropagation();",
			}));
			[
				["zPopTransAnchorToSelection",
					"Anchor to selection"
				],
				["zPopTransAutoCloseOnClick",
					"Auto close on click"
				],
				["zPopTransAutoCopyOnClick",
					"Auto copy on click"
				],
				["zPopTransFailSafe",
					"Fail safe translation"
				],
				["zPopTransKeepItOpen",
					"Keep it open"
				],
				["zPopTransShowTitleBar",
					"Show titlebar"
				],
				["zTransOnRelease",
					"Translate on release"
				],
				["zTransOnReleaseControlKey",
					"Translate on release - Require Ctrl key"
				],
				["zTransOnReleaseAltKey",
					"Translate on release - Require Alt key"
				],
				["zTransOnReleaseShowIcon",
					"Translate on release - Show icon"
				]
			].forEach(function(aP) {
				popOpts.appendChild($CNS("menuitem", {
					label: aP[1],
					type: "checkbox",
					closemenu: "none",
					tooltiptext: that.optionsDesc[aP[0]],
					checked: that["_" + aP[0]],
					oncommand: "event.stopPropagation();document.getElementById('" + self.id +
						"').MultiTranslator.sPref('" + aP[0] + "', !document.getElementById('" + self.id +
						"').MultiTranslator.gPref('" + aP[0] + "'));",
				}));
			});
		}

		if ("gBrowser" in window && (!tNode || (tNode && tNode.id !== that._UID + "_translationOptionsButton"))) {
			var urlBarOpts = aNode.appendChild($CNS("menu", {
				label: "Page translator options",
			})).appendChild($CNS("menupopup", {
				menugenerated: true,
				onpopupshowing: "event.stopPropagation();",
			}));
			[
				["zPageTransURLBarIconShow",
					"Show icon inside URL bar"
				],
				["zPageTransURLBarIconMenuMode",
					"Menu mode"
				]
			].forEach(function(aP) {
				urlBarOpts.appendChild($CNS("menuitem", {
					label: aP[1],
					type: "checkbox",
					closemenu: "none",
					tooltiptext: that.optionsDesc[aP[0]],
					checked: that["_" + aP[0]],
					oncommand: "event.stopPropagation();document.getElementById('" + self.id +
						"').MultiTranslator.sPref('" + aP[0] + "', !document.getElementById('" + self.id +
						"').MultiTranslator.gPref('" + aP[0] + "'));",
				}));
			});
			let where = [
				[1, "...opens page in current tab."],
				[2, "...opens page in new tab next to current one."],
				[3, "...opens page in new tab in background."],
				[4, "...opens page in new tab in foreground."],
			];

			let lClick = urlBarOpts.appendChild($CNS("menu", {
				label: "Left click...",
				tooltiptext: "Left click action on URL bar icon.",
			})).appendChild($CNS("menupopup", {
				menugenerated: true,
				onpopupshowing: "event.stopPropagation();",
			})).appendChild($CNS("radiogroup"));
			where.forEach(function(aP) {
				lClick.appendChild($CNS("menuitem", {
					label: aP[1],
					type: "radio",
					closemenu: "none",
					checked: (that._zPageTransURLBarIconLeftClick === aP[0]),
					oncommand: "event.stopPropagation();document.getElementById('" + self.id +
						"').MultiTranslator.sPref('zPageTransURLBarIconLeftClick', " + parseInt(aP[0], 10) + ");",
				}));
			});

			let mClick = urlBarOpts.appendChild($CNS("menu", {
				label: "Middle click...",
				tooltiptext: "Middle click action on URL bar icon.",
			})).appendChild($CNS("menupopup", {
				menugenerated: true,
				onpopupshowing: "event.stopPropagation();",
			})).appendChild($CNS("radiogroup"));
			where.forEach(function(aP) {
				mClick.appendChild($CNS("menuitem", {
					label: aP[1],
					type: "radio",
					closemenu: "none",
					checked: (that._zPageTransURLBarIconMiddleClick === aP[0]),
					oncommand: "event.stopPropagation();document.getElementById('" + self.id +
						"').MultiTranslator.sPref('zPageTransURLBarIconMiddleClick', " + parseInt(aP[0], 10) + ");",
				}));
			});

			let toLang = urlBarOpts.appendChild($CNS("menu", {
				label: "Source language",
			})).appendChild($CNS("menupopup", {
				menugenerated: true,
				onpopupshowing: "event.stopPropagation();",
			})).appendChild($CNS("radiogroup", {
				_pref: "zPageTransFromLang",
				oncommand: "event.stopPropagation();document.getElementById('" + self.id +
					"').MultiTranslator.sPref(this.getAttribute('_pref'), event.target.value);",
			}));
			let langs = that.langs;
			for (let lngF in langs) {
				if (langs.hasOwnProperty(lngF)) {
					toLang.appendChild($CNS("menuitem", {
						label: langs[lngF],
						type: "radio",
						closemenu: "none",
						group: that._UID + "_pageFromLng",
						value: lngF,
						checked: (lngF === that._zPageTransFromLang),
					}));
				}
			}

			let fromLang = urlBarOpts.appendChild($CNS("menu", {
				label: "Destination language",
			})).appendChild($CNS("menupopup", {
				menugenerated: true,
				onpopupshowing: "event.stopPropagation();",
			})).appendChild($CNS("radiogroup", {
				_pref: "zPageTransToLang",
				oncommand: "event.stopPropagation();document.getElementById('" + self.id +
					"').MultiTranslator.sPref(this.getAttribute('_pref'), event.target.value);",
			}));
			for (let lngT in langs) {
				if (langs.hasOwnProperty(lngT)) {
					if (lngT === "")
						continue;
					fromLang.appendChild($CNS("menuitem", {
						label: langs[lngT],
						type: "radio",
						closemenu: "none",
						group: that._UID + "_pageToLng",
						value: lngT,
						checked: (lngT === that._zPageTransToLang),
					}));
				}
			}
		}

		aNode.appendChild($CNS("separator"));
		aNode.appendChild($CNS("menuitem", {
			label: "More options",
			tooltiptext: "Open Multi Translator options page.\n\nNote: Preferences prefixed with " +
				"\"z\" (the letter ZED) can already be changed from this popup and some are used internally. " +
				"So there is no need to change them manually.",
			oncommand: "event.stopPropagation();document.getElementById('" + self.id +
				"').MultiTranslator._options.Init();",
		}));
	},

	_options: {
		Init: function() {
			var url = "about:config?filter=" + that.Branch;
			var onDocLoad = function onDocLoad(aE) {
				window.removeEventListener("DOMContentLoaded", onDocLoad, true);
				that._options.loadDesc(aE);
			};
			if (that.gPref("zOpenOptionsInTab") && ("gBrowser" in window)) {
				let tab = gBrowser.visibleTabs.find(tab => tab.linkedBrowser.currentURI.spec === url);
				!!tab || window.addEventListener("DOMContentLoaded", onDocLoad, true);
				gBrowser.selectedTab = tab || gBrowser.addTab(url);
			} else {
				let observer = {
					observe: function(aSubject, aTopic, aData) {
						aSubject.addEventListener("load", function _(aE) {
							Services.obs.removeObserver(observer, "domwindowopened");
							aE.target.removeEventListener("load", _, false);
							that._options.loadDesc(aE);
						}, true);
					},
				};
				let win = Services.wm.getMostRecentWindow("Preferences:ConfigManager");
				if (win) {
					win.focus();
					return;
				}
				Services.obs.addObserver(observer, "domwindowopened", false);
				setTimeout(function() {
					toOpenWindowByType("Preferences:ConfigManager", url);
				}, 10);
			}
		},

		loadDesc: function(aE) {
			const ROOT = that.Branch;

			var doc = aE.target,
				win;
			if (!doc && !(doc.location.href.startsWith("chrome://global/content/config.xul") ||
					doc.location.href.startsWith("about:config")))
				return;
			if (!doc.getElementById("configTree"))
				return;
			win = doc.defaultView;

			var curTab = document.getElementsByTagName("tab");
			for (let i = curTab.length - 1; i >= 0; i--) {
				if (curTab[i].selected) {
					let newLabel = self.name + " preference window.";
					curTab[i].setAttribute("visibleLabel", newLabel);
					curTab[i].setAttribute("label", newLabel);
				}
			}
			var tB = win.document.getElementById("textbox");
			tB.value = ROOT;
			tB.doCommand();
			tB.setAttribute("readonly", true);
			setTimeout(function() {
				var tree = win.document.getElementById("configTree");
				var treecols = tree.firstChild;
				var newSplit = win.document.createElement("splitter");
				newSplit.setAttribute("class", "tree-splitter");
				var newCol = win.document.createElement("treecol");
				newCol.setAttribute("id", "descCol");
				newCol.setAttribute("label", "Description");
				newCol.setAttribute("flex", 12);
				treecols.appendChild(newSplit);
				treecols.appendChild(newCol);
				var prefsArr = win.gPrefArray;
				for (let i = prefsArr.length - 1; i >= 0; i--) {
					if (prefsArr[i].prefCol.match(ROOT)) {
						var prefName = prefsArr[i].prefCol;
						let prefDesc = that.optionsDesc[prefName.slice(ROOT.length)];
						prefsArr[i].descCol = prefDesc;
					}
				}
				let branch = Services.prefs.getBranch(ROOT);
				var prefListener = {
					observe: function(subject, topic, prefName) {
						if (topic !== "nsPref:changed")
							return;
						win.setTimeout(function() {
							var prefObj = win.gPrefHash[ROOT + prefName];
							if (!prefObj)
								return;
							var viewIndex = win.getViewIndexOfPref(prefObj);
							var arrayIndex = win.getIndexOfPref(prefObj);
							let prefDesc = that.optionsDesc[prefName];
							win.gPrefArray[arrayIndex].descCol = prefDesc;
							if (viewIndex >= 0) {
								win.gPrefView[viewIndex] = win.gPrefArray[arrayIndex];
								tree.treeBoxObject.invalidateRow(viewIndex);
							}
						}, 100);
					}
				};
				branch.addObserver("", prefListener, false);
				let unLoad = function unLoad() {
					win.removeEventListener("unload", unLoad, false);
					branch.removeObserver("", prefListener);
				};
				win.addEventListener("unload", unLoad, false);
			}, 250);
		},
	},

	clickOnTransResult: function(aValue) {
		if (that._zPopTransAutoCopyOnClick)
			gClipboard.write(aValue);
		if (that._zPopTransAutoCloseOnClick)
			that.HidePanel();
	},

	HTMLCSSLoader: function() {
		let css;
		try {
			css = "@namespace url(" + xhtmlns + ");\n" + getHelp("HTMLStyleSheet").replace(/_U_I_D_/g, that._UID);
		} catch (aErr) {
			css = false;
		}
		if (!css)
			return;

		if (!window[that._UID]["HTMLStyleSheet"]) {
			window[that._UID]["HTMLStyleSheet"] = css;
			styleSheet(css);
		} else if (window[that._UID]["HTMLStyleSheet"] && window[that._UID]["HTMLStyleSheet"] !== css) {
			styleSheet(window[that._UID]["HTMLStyleSheet"], true);
			window[that._UID]["HTMLStyleSheet"] = css;
			styleSheet(css);
		}
	},

	XULCSSLoader: function() {
		let css;
		try {
			css = "@namespace url(" + xulns + ");\n" + getHelp("XULStyleSheet")
				.replace(/_B_I_N_D_I_N_G_/g, that._isSM ? "" : "")
				.replace(/_U_I_D_/g, that._UID);
		} catch (aErr) {
			css = false;
		}
		if (!css)
			return;

		if (!window[that._UID]["XULStyleSheet"]) {
			window[that._UID]["XULStyleSheet"] = css;
			styleSheet(css);
		} else if (window[that._UID]["XULStyleSheet"] && window[that._UID]["XULStyleSheet"] !== css) {
			styleSheet(window[that._UID]["XULStyleSheet"], true);
			window[that._UID]["XULStyleSheet"] = css;
			styleSheet(css);
		}
	},

	HandlePrefListener: function(aRem) {
		var prefs = that.DefPrefs;
		for (let key in prefs) {
			let pref = that.Branch + key;
			if (prefs.hasOwnProperty(key)) {
				if (aRem)
					Services.prefs.removeObserver(pref, that.PrefListener, false);
				else
					Services.prefs.addObserver(pref, that.PrefListener, false);
			}
		}
	},

	PrefListener: {
		observe: function(aSubject, aTopic, aPStr) {
			if (aTopic === "nsPref:changed") {
				let prefName = aPStr.slice(that.Branch.length);
				that["_" + prefName] = that.gPref(prefName);
				switch (prefName) {
					case "zPopTransFromLang":
					case "zPopTransToLang":
						that.TranslateSelection();
						break;
					case "PopupShowFooter":
						that.setFooter();
						break;
					case "zPopTransEngine":
						if (that.transPop.state === "open")
							that.TranslateSelection();
						that.transPop.label = that.getEng("label", true);
						$(that._UID + "_translationOptionsButton").image = that.getEng("image", true);
						that.setFooter();
						break;
					case "zUseTransPageHotkey":
					case "zUseTransSelHotkey":
					case "zUseTransClipHotkey":
						that.HandleHotkey();
						break;
					case "zShowContextMenuItems":
					case "zPopTransShowTitleBar":
						that._cleanSlate();
						break;
					case "zTransOnRelease":
						try {
							that.RemoveListeners(true);
						} finally {
							if (that._isMultiProcess) {
								if (!that._zTransOnRelease) {
									notifyme(self.name, "You are using Firefox multi-process. " +
										"Is not possible to disable this option for now.", that.Images[2]);
								}
								that._zTransOnRelease = true;
								that.sPref("zTransOnRelease", true);
								// Services.prompt.alert(null, self.name, "You are using Firefox multi-process.\n" +
								// "Is not possible to disable this option for now.");
							}
							that.AddListeners();
						}
						break;
					case "HotkeyTransSelKey":
					case "HotkeyTransSelModifiers":
					case "HotkeyTransPageKey":
					case "HotkeyTransPageModifiers":
					case "HotkeyTransClipKey":
					case "HotkeyTransClipModifiers":
						notifyme(self.name, "The application needs to be restarted " +
							"for the new hotkey to take effect.", that.Images[2]);
						break;
					case "zPageTransEngine":
						let icon = $(that._UID + "_translationIconOnURLBar");
						icon && (icon.hidden = (that._zPageTransEngine === 0));
						icon && icon.setAttribute("src", that.getEng("image"));
						that.AssignImages(document.getElementById(that._UID + "_self_popup"));
						break;
				}
			}
		}
	},

	_cleanSlateTimer: 0,
	_cleanSlate: function() {
		clearTimeout(that._cleanSlateTimer);
		that._cleanSlateTimer = setTimeout(function() {
			self.destroy("update");
			setTimeout(function() {
				self.init();
			}, 100);
		}, 100);
	},

	Images: {
		// "Generic" image.
		0: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAlUlEQVQ4jZ2SsQ3" +
			"AIAwEPQZ1RmUHFshAjMAEKB10EamQHvMmJJbcIPv8bywiIsd5NZayE9gQYvkO6Y253kMiYAnE6bneLcQyKGH" +
			"1FKAVdIilerKgFTAA3Q9aQNDKgmnj1zfuxNYA51NzPk1T+7uVtIgB8FZCLHMtm67huGyqeGVB34llWbQVBKA" +
			"NE2AB8bhMC28QtuwH60eZmq06S4kAAAAASUVORK5CYII=",
		// Bing translator image.
		1: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAG1BMVEX///9TrE0" +
			"9h7JGm8pYosyQwImytLKpw9Itmkc183vaAAAAAXRSTlMAQObYZgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAGB" +
			"JREFUeF4tisEJw0AMBCcCE5VwTyEM+buEVGB34BKuBPl3ZUcLmceiGYQgDEFmQLxzErLvxDLhs0M07AdGhJG" +
			"pwRDZDVaBAjh/vFjK6yn8Kl7n1iO5+xhDxcsf9FMF8AODfBEY/ip2BgAAAABJRU5ErkJggg==",
		// Google translator image.
		2: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAG1BMVEUAAAB3eHh" +
			"NjPR9kp9SjvGwvc7W2dzl5eZJVpIrrSH9AAAAAXRSTlMAQObYZgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAGF" +
			"JREFUeF5dyUEOQDAQheE5y4u6gLBXo/ZEHUBML0B6Aoljm1Ib/2y+zCNmtqQl4A+LJcaoOOAe9B4mKFA6a1Y" +
			"fCIOMqKqFMBc76lon1usanVJtIy/M9GETSl2nZPgMfcgN6PAcsIoF//oAAAAASUVORK5CYII=",
		// Yandex image.
		3: "data:image/gif;base64,R0lGODlhEAAQAHMAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCgAPACwAAAAAEAA" +
			"QAIMAAAD/EQ0iIiIzMzNERERVVVVmZmZ3d3eJiYn2c3Grq6vxtrXd0tLp6Ojy+fkAAAAEUvBJ2Zx1beq37m1" +
			"LsgWdtwRoMKUVlqSplCZNA6PJIr34nTC1B+iW6tSOjtPNeEQqUaVmpsULVKSUSpWBaWYdVeZ1op1hLpsGw4z" +
			"eCMMYtwbmjgAAOw==",
	},
	_UID: "__multi_translator_" + self.id.slice(20),
	globalMM: Cc["@mozilla.org/globalmessagemanager;1"].getService(Ci.nsIMessageListenerManager),
	place: null,
	timer: null,
	TIMEOUT: 15000,
	_globalMM: Cc["@mozilla.org/globalmessagemanager;1"].getService(Ci.nsIMessageListenerManager),
	_randomID: null,

	get transPop() {
		return document.getElementById(that._UID + "_translationPopup");
	},

	get _responseMsgID() {
		return "CB:MultiTranslator:Response:" + self.id.slice(14) + "-";
	},

	get _onReleaseIconMsgID() {
		return "CB:MultiTranslator:TranslateOnReleaseIcon:" + self.id.slice(14) + "-" + that._randomID;
	},

	get _middleClickMsgID() {
		return "CB:MultiTranslator:TranslateOnReleaseIcon:" + self.id.slice(14) + "-" + that._randomID;
	},

	get _translateSelMsgID() {
		return "CB:MultiTranslator:TranslateSelection:" + self.id.slice(14) + "-" + that._randomID;
	},

	get _movePopupMsgID() {
		return "CB:MultiTranslator:MovePopup:" + self.id.slice(14) + "-" + that._randomID;
	},

	get _isMultiProcess() {
		let a = "gMultiProcessBrowser" in window;
		return a ? gMultiProcessBrowser : false;
	},

	get _isSM() {
		return Services.appinfo.ID === "{92650c4d-4b8e-4d2a-b7eb-24ecf4f6b63a}";
	},
};

this.MultiTranslator.optionsDesc = {};

this.MultiTranslator.optionsDesc.where = "1 = Current tab.\n2 = In a new tab next to current one.\n3" +
	" = In a new tab in the background.\n4 = In a new tab in the foreground.";

this.MultiTranslator.optionsDesc.what = "\nPossible actions are:\n0 = Disable. It disables the cli" +
	"ck combination on Multi Translator button.\n" +
	"1 = Open main menu.\n" +
	"2 = Translate selection.\n" +
	"3 = Translate current page.\n" +
	"4 = Translate clipboard content.\n" +
	"5 = Open page translation menu.";

this.MultiTranslator.optionsDesc = {
	zButtonClickActionLeft: "Left click on button action." + that.optionsDesc.what,
	zButtonClickActionMiddle: "Middle click on button action." + that.optionsDesc.what,
	zButtonClickActionLeftCtrl: "Ctrl + left click on button action." + that.optionsDesc.what,
	zButtonClickActionLeftShift: "Shift + left click on button action." + that.optionsDesc.what,
	zButtonClickActionLeftCtrlShift: "Ctrl + Shift + left click on button action." + that.optionsDesc.what,
	zOpenOptionsInTab: "If enabled/checked, it will open the Multi Translator options page in a ne" +
		"w tab. If disabled/unchecked, the Multi Translator options page will be openend in a new " +
		"window.",
	zShowContextMenuItems: "If enabled/checked, all the translate options will be added to the pag" +
		"e context menu.",
	zUseTransPageHotkey: "Enable/Disable the use of \"Translate Page\" hotkey.",
	zUseTransSelHotkey: "Enable/Disable the use of \"Translate Selection\" hotkey.",
	zUseTransClipHotkey: "Enable/Disable the use of \"Translate Clipboard Content\" hotkey.",
	zPageTransURLBarIconMenuMode: "With this mode enabled, a left click on the URL bar icon will d" +
		"isplay a menu with all avaiable engines. Clicking on any menu item will directly translat" +
		"e the current page without the need to change the default engine.\nThe translated page wi" +
		"ll be opened obeying the preference \"Left click...\"",
	zPopTransAnchorToSelection: "If enabled/checked, the popup with the translation will be displa" +
		"yed anchored to the selected text. If disabled/unchecked, the popup will be displayed anc" +
		"hored to the top-left corner of the page content.",
	zPopTransAutoCloseOnClick: "If enabled/checked, the popup will be closed when the translation " +
		"result is clicked.",
	zPopTransAutoCopyOnClick: "If enabled/checked, the translation result inside the popup will be" +
		" copied to the clipboard when the text is clicked.",
	zPopTransFailSafe: "If enabled/checked, and the selected text exceeds the max. length of chara" +
		"cters allowed for the current translation engine, instead of showing the popup with the c" +
		"ut down text translated, it will translate the full length of the selection on a new tab.",
	zPopTransKeepItOpen: "If enabled/checked, the popup with the translation will only be closed w" +
		"hen \"Popup auto close on click\" is enabled or when clicking the close button on the tit" +
		"lebar (if \"Popup show titlebar\" is enabled). If disabled/unchecked, the popup will clos" +
		"e every time you click outside of it.",
	zPopTransShowTitleBar: "If enabled/checked, the popup with the translation will dispay a title" +
		"bar.",
	zTransOnRelease: "If enabled/checked, the popup with the translation will show up when you fin" +
		"ish to select text and the mouse button is released. If disabled/unchecked, the translati" +
		"opup will show up only when pressing the Middle mouse button (on the selection oron p any" +
		"where on the page).",
	zTransOnReleaseControlKey: "If enabled/checked, the popup with the translation will ONLY show " +
		"up if the Control key is pressed when the mouse button is released.\n\nCan be combined wi" +
		"th \"Require Alt key\" option.",
	zTransOnReleaseAltKey: "If enabled/checked, the popup with the translation will ONLY show up i" +
		"f the Alt key is pressed when the mouse button is released.\n\nCan be combined with \"Req" +
		"uire Ctrl key\" option.",
	zTransOnReleaseShowIcon: "If enabled/checked, and \"Translate on release\" is enabled, instead" +
		" of directly displaying the popup with the translation \"on release\", it will show an ic" +
		"on. The popup with the translation will show up only when hovering over this icon.",
	HotkeyTransPageKey: "Key for the page translation hotkey.",
	HotkeyTransPageModifiers: "Modifier/s for the page translation hotkey.",
	HotkeyTransSelKey: "Key for the translate selection hotkey.",
	HotkeyTransSelModifiers: "Modifier/s for the translate selection hotkey",
	HotkeyTransClipKey: "Key for the translate clipboard content hotkey",
	HotkeyTransClipModifiers: "Modifier/s for the translate clipboard content hotkey",
	PopupMaxStringLength: "Maximum amount of characters to translate from the selected text.\nDefa" +
		"ult 1024\nBing translator is cut down automatically to 150 characters and Yandex translat" +
		"or is cut down automatically to 500 characters.",
	PopupMaxWidth: "Max. width for the translation popup.",
	PopTransFailSafeOpenURLWhere: "Where to open the page if the option \"Fail safe translation\" " +
		"is enabled.\n" + that.optionsDesc.where,
	PopupShowFooter: "Show \"Service provided by...\" footer inside the popup translatipn.\nClicki" +
		"ng on it will open the translation service provider page.",
	TransOnReleaseIconOffsetX: "Horizontal offset with respect to the cursor in which the \"Transl" +
		"ate in release\" icon should appear.",
	TransOnReleaseIconOffsetY: "Vertical offset with respect to the cursor in which the \"Translat" +
		"e in release\" icon should appear.",
	zPageTransURLBarIconLeftClick: "Where to open the translated page when left-clicking the URL b" +
		"ar icon.\n" + that.optionsDesc.where,
	zPageTransURLBarIconMiddleClick: "Where to open the translated page when middle-clicking the U" +
		"RL bar icon.\n" + that.optionsDesc.where,
	zPageTransURLBarIconShow: "Show \"Page translator\" icon inside the URL bar.",
	zPageTransEngine: "Engine for the Page translator.",
	zPageTransFromLang: "Source language for the URL bar icon engine.",
	zPageTransToLang: "Destination language for the URL bar icon engine.",
	zPopTransEngine: "Engine for the popup translator.",
	zPopTransFromLang: "Source language for the popup translator engine.",
	zPopTransToLang: "Destination language for the popup translator engine.",
};

this.MultiTranslator.Branch = "CB.MultiTranslator.Id" + self.id.slice(20) + ".";

this.MultiTranslator.gPref = function(aKey) {
	let branch = Services.prefs.getBranch(that.Branch);
	switch (typeof that.DefPrefs[aKey]) {
		case "boolean":
			return branch.getBoolPref(aKey);
			break;
		case "number":
			return branch.getIntPref(aKey);
			break;
		case "string":
			return branch.getComplexValue(aKey, Ci.nsISupportsString).data;
			break;
	}
	return null;
};

this.MultiTranslator.sPref = function(aKey, aVal) {
	let branch = Services.prefs.getBranch(that.Branch);
	switch (typeof aVal) {
		case "boolean":
			branch.setBoolPref(aKey, aVal);
			break;
		case "number":
			branch.setIntPref(aKey, aVal);
			break;
		case "string":
			let str = Cc["@mozilla.org/supports-string;1"].createInstance(Ci.nsISupportsString);
			str.data = aVal;
			branch.setComplexValue((aKey), Ci.nsISupportsString, str);
			break;
	}
};

this.MultiTranslator.InitPrefs = function() {
	let branch = Services.prefs.getDefaultBranch(that.Branch),
		defaults = that.DefPrefs;
	for (let key in defaults) {
		if (defaults.hasOwnProperty(key)) {
			let val = defaults[key];
			switch (typeof val) {
				case "boolean":
					branch.setBoolPref(key, val);
					break;
				case "number":
					branch.setIntPref(key, val);
					break;
				case "string":
					let str = Cc["@mozilla.org/supports-string;1"].createInstance(Ci.nsISupportsString);
					str.data = val;
					branch.setComplexValue((key),
						Ci.nsISupportsString, str);
					break;
			}
		}
	}
};

// You can comment the languages that you don't want to be displayed in the language selection menu lists.
// Languages with (B) in their names are ONLY supported by Bing translator.
// Languages with (G) in their names are ONLY supported by Google translator.
// Languages with (Y) in their names are ONLY supported by Yandex translator.
// All the other languages are supported by Bing/Google/Yandex translators.
// Beware that commented languages will be hidden from ALL language selection lists (From the popup and the URL bar icon).
this.MultiTranslator.langs = {
	"": "Auto", // NEVER COMMENT/DELETE "Auto"!!!!!
	"af": "Afrikaans (G)",
	"sq": "Albanian (G)(Y)",
	"ar": "Arabic",
	"hy": "Armenian (Y)",
	"az": "Azerbaijani (G)(Y)",
	"eu": "Basque (G)",
	"be": "Belarusian (G)(Y)",
	"bn": "Bengali (G)",
	"bs": "Bosnian (Y)",
	"bs-Latn": "Bosnian (Latin) (B)",
	"bg": "Bulgarian",
	"ca": "Catalan",
	"zh": "Chinese (Y)",
	"zh-CHS": "Chinese Simplified (B)",
	"zh-CN": "Chinese Simplified (G)",
	"zh-CHT": "Chinese Traditional (B)",
	"zh-TW": "Chinese Traditional (G)",
	"hr": "Croatian",
	"cs": "Czech",
	"da": "Danish",
	"nl": "Dutch",
	"en": "English", // NEVER COMMENT/DELETE "English"!!!!!
	// "eo": "Esperanto (G)",
	"et": "Estonian",
	"tl": "Filipino (G)",
	"fi": "Finnish",
	"fr": "French",
	"gl": "Galician (G)",
	"de": "German",
	"ka": "Georgian (G)(Y)",
	"el": "Greek",
	"gu": "Gujarati (G)",
	"ht": "Haitian Creole",
	"he": "Hebrew (B)(Y)",
	"iw": "Hebrew (G)",
	"hi": "Hindi",
	"mww": "Hmong Daw (B)",
	"hu": "Hungarian",
	"is": "Icelandic (G)(Y)",
	"id": "Indonesian",
	"ga": "Irish (G)",
	"it": "Italian",
	"ja": "Japanese",
	"kn": "Kannada (G)",
	// "tlh": "Klingon (B)",
	// "tlh-Qaak": "Klingon (pIqaD) (B)",
	"ko": "Korean",
	"la": "Latin (G)",
	"lv": "Latvian",
	"lt": "Lithuanian",
	"mk": "Macedonian (G)(Y)",
	"ms": "Malay",
	"mt": "Maltese",
	"no": "Norwegian",
	"fa": "Persian",
	"pl": "Polish",
	"pt": "Portuguese",
	"otq": "Quertaro Otomi (B)",
	"ro": "Romanian",
	"ru": "Russian",
	"sr-Cyrl": "Serbian (Cyrillic) (B)",
	"sr-Latn": "Serbian (Latin) (B)",
	"sr": "Serbian (G)(Y)",
	"sk": "Slovak",
	"sl": "Slovenian",
	"es": "Spanish",
	"sw": "Swahili (G)",
	"sv": "Swedish",
	"ta": "Tamil (G)",
	"te": "Telugu (G)",
	"th": "Thai",
	"tr": "Turkish",
	"uk": "Ukrainian",
	"ur": "Urdu",
	"vi": "Vietnamese",
	"cy": "Welsh",
	"yi": "Yiddish (G)",
	"yua": "Yucatec Maya (B)",
};


/**
 * To get more Bing API keys, follow this instructions: http://blogs.msdn.com/b/translation/p/gettingstarted1.aspx
 *
 * ### In a nutshell ###
 * 1- Register for an account on Windows Azure Marketplace with a Microsoft account.
 *    https://datamarket.azure.com/home/
 * 2- Sign up for the Microsoft Translator API using your registered account. Sign up for the free one ($0.00).
 *    https://datamarket.azure.com/dataset/bing/microsofttranslator
 * 3- Register your application on Windows Azure Marketplace.
 *    https://datamarket.azure.com/developer/applications/register
 * 4- Get the Client ID and Client Secret for your registered application.
 *  - Fill out the Client ID, and Name fields.
 *  - The Client Secret field is already completed for you. DO NOT CHANGE IT.
 *  - Fill out the Redirect URI field with any valid URL that uses https, for example https://microsoft.com.
 *    This field is not used by the Microsoft Translator API.
 *  - You can also leave the Enable subdomain access checkbox unchecked, as Translator doesnt use it.
 *  - Remember and note the Client ID and Client Secret fields and replace those found inside the APIKeysBing
 *    object bellow with these newlly generated. NEVER MAKE THESE KEYS PUBLIC!!!
 *
 * Note: Step 3 can be repeated several times to get several Client IDs and Client Secrets. DO NOT ABUSE!!!
 */
this.MultiTranslator.APIKeysBing = [
	// ### Example ###
	// ["Client_ID", "Client_Secret"],
	["TradutorInstantaneo", "D36qcBNDopLmUz2cYpAgPZ0ZPezQEs79QeTp88gZ4hc="],
	["ngochuong-bing-translator", "vIOFDe2FdSy4c0BTdYoPvHhwWIPoRFBo5ryuhOjxo84="],
	["webtranslator8601", "38tnkL0LkSI5DjHq3mhFU0f7DKsm1/rizwEmMylZxtc="],
	["SublimeBingTranslator", "0fjvxMgcSZreEk9xPN8Vse+KDz3XlI+W11XJxC8peEA="],
	["bing_translator_test_xuemind", "taiwTXXvLKe/UzpXXK6X6gxkpac5GpOdKOb69gYWMgk="],
	["Subtitles", "Xv2Oae6Vki4CnYcSF1SxSSBtO1x4rX47zhLUE/OqVds="],
	["3a7a26d9254FFC08", "SuNwPHKH6UbvhyZ34FlqOWJ9z2zN6KS8djzHpf8NvOI="],
];

/**
 * Get more Yandex API keys here: https://tech.yandex.ru/key/form.xml?service=trnsl
 *
 * ### In a nutshell ###
 * 1- Visit the provided link and register a Yandex account. It's the right button inside the middle box.
 * 2- You will need to resolve a captcha with cyrillic letters. DO NOT PANIC!!! LOL
 *    You can just go to https://translate.google.com, select Russian as source language and open
 *    the cyrilic on-screen keyboard to type the needed characters.
 * 3- Once you successfully finish creating the Yandex account, you can visit the link provided
 *    at the beginning several times to create several API keys. DO NOT ABUSE!!!
 * 4- Once you have several API keys, just replace the ones found inside the APIKeysYandex object bellow
 *    for the ones you generated. NEVER MAKE THESE KEYS PUBLIC!!!
 */
this.MultiTranslator.APIKeysYandex = [
	"trnsl.1.1.20130818T214524Z.9983e6055ae94787.74d98f42e84f8abac4a19cb1333dfecb7427165d",
	"trnsl.1.1.20130806T140102Z.d80a7ce00b1a3c38.30de98386f6f6d594993fa93c0907aac5996aab9",
	"trnsl.1.1.20140602T085017Z.ea6ecac642816084.4df3b3711b35ed773720c92acdcebb11e793b8ab",
	"trnsl.1.1.20140911T223045Z.34ca44edca3e6ebd.f6807b1158e50190a2ae10c40d8a31a426647e98",
	"trnsl.1.1.20140731T144606Z.639639bc480e82b7.7cb97a33d3b2e88fa363e789fe03e2426478c53a",
	"trnsl.1.1.20141206T164332Z.8497d97d7ca05dc2.411e9116711b1860da655ffba56840469a3b2af1",
	"trnsl.1.1.20140218T130206Z.7923fc89a1c1bd16.aba4c3d98792c68c157c59f5a385339a03f0d736",
	"trnsl.1.1.20140213T084832Z.2e599cd43e74002d.d935bc98da1909103ec212bc9ce71adeaac9de4a",
];

this.MultiTranslator.DefPrefs = {
	HotkeyTransPageKey: "p",
	HotkeyTransPageModifiers: "accel,alt",
	HotkeyTransSelKey: "t",
	HotkeyTransSelModifiers: "accel,alt",
	HotkeyTransClipKey: "v",
	HotkeyTransClipModifiers: "accel,alt",
	PopupMaxStringLength: 1024,
	PopupMaxWidth: 450,
	PopTransFailSafeOpenURLWhere: 2,
	PopupShowFooter: true,
	TransOnReleaseIconOffsetX: 10,
	TransOnReleaseIconOffsetY: 10,
	zButtonClickActionLeft: 1,
	zButtonClickActionMiddle: 2,
	zButtonClickActionLeftCtrl: 3,
	zButtonClickActionLeftShift: 4,
	zButtonClickActionLeftCtrlShift: 5,
	zOpenOptionsInTab: true,
	zPageTransURLBarIconLeftClick: 2,
	zPageTransURLBarIconMiddleClick: 1,
	zPageTransURLBarIconMenuMode: true,
	zPageTransURLBarIconShow: true,
	zPageTransEngine: 2,
	zPageTransFromLang: "",
	zPageTransToLang: "en",
	zPopTransKeepItOpen: false,
	zPopTransAutoCloseOnClick: false,
	zPopTransAutoCopyOnClick: true,
	zPopTransAnchorToSelection: true,
	zPopTransShowTitleBar: true,
	zPopTransFailSafe: false,
	zPopTransEngine: 2,
	zPopTransFromLang: "",
	zPopTransToLang: "en",
	zShowContextMenuItems: true,
	zTransOnRelease: true,
	zTransOnReleaseAltKey: false,
	zTransOnReleaseControlKey: false,
	zTransOnReleaseShowIcon: true,
	zUseTransPageHotkey: true,
	zUseTransSelHotkey: true,
	zUseTransClipHotkey: true,
};

this.MultiTranslator.Init();

function notifyme(aTitle, aMsg, aImg, aCallback) { // Notification function
	// The nsIAlertsService works whenever it wants!!! So EFF IT!!!
	// var nsIAlertsService = Cc["@mozilla.org/alerts-service;1"].getService(Ci.nsIAlertsService);
	let origin = (Services.prefs.getPrefType("ui.alertNotificationOrigin") !== 0) ?
		Services.prefs.getIntPref("ui.alertNotificationOrigin") :
		null;
	// try {
	// nsIAlertsService.showAlertNotification(aImg, aTitle, aMsg, !!aCallback, "", aCallback ? aCallback : null, "");
	// nsIAlertsService.showAlertNotification(aImg, aTitle, aMsg, false, "", null);
	// } catch (aEr) {
	let win = Services.ww.openWindow(null, "chrome://global/content/alerts/alert.xul",
		"_blank", "chrome,titlebar=no,popup=yes", null);
	win.arguments = [aImg, aTitle, aMsg, !!aCallback, "", origin, "", "", null, (!!aCallback ? aCallback : null)];
	// }
}

function getHelp(aPlaceholder) { // Get specific data, surrounded by "placeholders", from the Help tab.
	return document.getElementById(self.id).getAttribute("Help").split("<!--" + aPlaceholder + "-->")[1];
}

function parseXML(aXML) { // Return parsed XML
	aXML = aXML.replace(/>\s+</g, "><"); // Linearize XML
	return (new DOMParser).parseFromString(aXML, "application/xml").documentElement;
}

function styleSheet(aCSS, aRemFlag) {
	var sss = Cc["@mozilla.org/content/style-sheet-service;1"].getService(Ci.nsIStyleSheetService);
	var uri = Services.io.newURI("data:text/css," + encodeURIComponent(aCSS), null, null);
	if (sss.sheetRegistered(uri, sss.USER_SHEET))
		sss.unregisterSheet(uri, sss.USER_SHEET);
	if (aRemFlag)
		return;
	sss.loadAndRegisterSheet(uri, sss.USER_SHEET);
}

function $CNS(aElName, aAttrs, aNS) {
	var el = document.createElementNS((aNS ? aNS : xulns), aElName);
	if (aAttrs)
		Object.keys(aAttrs).forEach(function(n) {
			if (aAttrs[n] !== "")
				el.setAttribute(n, aAttrs[n])
		});
	return el;
}

function $C(aElName, aAttrs, aParent) {
	var doc = aParent ? aParent : document;
	var el = doc.createElement(aElName);
	if (aAttrs)
		Object.keys(aAttrs).forEach(function(n) {
			if (aAttrs[n] !== "")
				el.setAttribute(n, aAttrs[n])
		});
	return el;
}

function $(aID, aParent) {
	if (!aParent)
		return document.getElementById(aID);
	return aParent.getElementById(aID);
}

function $$(aTagName, aParent) {
	if (!aParent)
		return document.getElementsByTagName(aTagName);
	return aParent.getElementsByTagName(aTagName);
}

function escHTML(aStr, aIsAttr) {
	aStr = String(aStr)
		.replace(/&/g, "&amp;")
		.replace(/</g, "&lt;")
		.replace(/>/g, "&gt;")
		.replace(/"/g, "&quot;")
		.replace(/'/g, "&apos;");
	if (aIsAttr) {
		aStr = aStr
			.replace(/\t/g, "&#x9;")
			.replace(/\n/g, "&#xA;")
			.replace(/\r/g, "&#xD;");
	}
	return aStr;
}

let escapeHash = {
	_: function(input) {
		var ret = escapeHash[input];
		if (!ret) {
			if (input.length - 1) {
				ret = String.fromCharCode(parseInt(input.substring(input.length - 3 ? 2 : 1), 16));
			} else {
				var code = input.charCodeAt(0);
				ret = code < 256 ? "%" + (0 + code.toString(16)).slice(-2).toUpperCase() : "%u" + ("000" + code.toString(16)).slice(-4).toUpperCase();
			}
			escapeHash[ret] = input;
			escapeHash[input] = ret;
		}
		return ret;
	}
};

function $escape(aStr) {
	return aStr.toString().replace(/[^\w @\*\-\+\.\/]/g, function(aChar) { // Per Liedman
		return escapeHash._(aChar);
	});
}

function $unescape(aStr) {
	return aStr.toString().replace(/%(u[\da-f]{4}|[\da-f]{2})/gi, function(aSeq) { // Per Liedman
		return escapeHash._(aSeq);
	});
}]]></initcode>
  <code><![CDATA[/*CODE*/]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help><![CDATA[[,]
<!--XULStyleSheet-->
/* Translation popup tweaks */
#_U_I_D__translationPopup #_U_I_D__translationResultBox,
#_U_I_D__translationPopup #_U_I_D__translationOptionsBox {
	padding: 5px !important;
}
#_U_I_D__translationPopup label {
	font-weight:500 !important;
}
#_U_I_D__translationOptionsButton {
	min-width: 1em !important;
}
/* Basic panel appearance for the URL bar icon menu */
#_U_I_D__self_popup,
#_U_I_D__translationIconOnURLBarMenu {
	-moz-appearance: none !important;
	-moz-binding: url("chrome://global/content/bindings/popup.xml#arrowpanel") !important;
	background: transparent !important;
	border: none !important;
	-moz-image-region: auto !important;
}
<!--XULStyleSheet-->

<!--HTMLStyleSheet-->
/* Tweaks for Google Translator pages */
/*@-moz-document domain("translate.google.com") {*/
@-moz-document regexp("^https?://translate\.google\..*") {
	/* Remove the offer to install that aberration called Chrome!!! */
	#gb .gb_9c.gb_ec.gb_g {
		display: none !important;
	}
}
/* Removes tooltips showing original text */
@-moz-document domain("translate.googleusercontent.com") {
	span[onmouseout][onmouseover][style] {
		background-color: transparent !important;
	}
	.gmnoprint {
		display: none !important;
	}
}

/* Tweaks for Microsoft translator pages */
/* Remove tooltips showing original text */
DIV[translate="no"] {
	display: none !important;
}

/* Translation popup tweaks */
/* The next two selectors are HTML elements. That's why they are separated from the XULStyleSheet */
#_U_I_D__translationResultContent {
	padding: 5px !important;
	font-weight:600 !important;
}
#_U_I_D__translationResultContentFooter {}
<!--HTMLStyleSheet-->

################################################
### FROM HERE DOWN DO NOT TOUCH ANYTHING!!!! ###
################################################

<!--MainPanel--><panel id="_U_I_D__translationPopup"
					   label="_L_A_B_E_L_"
					   cb_id="_U_I_D_"
					   orient="vertical"
					   consumeoutsideclicks="false"
					   close="true"
					   level="top"
					   backdrag="true"
					   noautohide="true"
					   onpopupshown="document.getElementById('_S_E_L_F_I_D_').MultiTranslator.setMenulistsCheckedState();"
					   xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
					   xmlns:html="http://www.w3.org/1999/xhtml">
	<vbox id="_U_I_D__translationResultBox" flex="1">
		<html:div id="_U_I_D__translationResultContent"
				  type="content"
				  onclick="event.stopPropagation();document.getElementById('_S_E_L_F_I_D_').MultiTranslator.clickOnTransResult(this.textContent);" />
		<html:div id="_U_I_D__translationResultContentFooter" type="content" />
	</vbox>
	<spacer flex="1"/>
	<hbox id="_U_I_D__translationOptionsBox" align="center">
		<hbox id="_U_I_D__languageSelectionBox" align="center" hidden="false">
			<label value="From: " />
			<menulist id="_U_I_D__languageSelectionMenulistFrom" sizetopopup="none" _pref="zPopTransFromLang">
				<menupopup id="_U_I_D__languageSelectionPopupFrom" onpopupshown="event.stopPropagation();" />
			</menulist>
			<label value="To: " />
			<menulist id="_U_I_D__languageSelectionMenulistTo" sizetopopup="none" _pref="zPopTransToLang">
				<menupopup id="_U_I_D__languageSelectionPopupTo" onpopupshown="event.stopPropagation();" />
			</menulist>
		</hbox>
		<spacer flex="1"/>
		<toolbarbutton id="_U_I_D__translationOptionsButton" image="_I_M_A_G_E_" type="menu" popup="_U_I_D__translation_options"/>
	</hbox>
</panel><!--MainPanel-->

<!--FrameScript-->"use sctrict";
let MultiTranslator = {
	Init: function() {
		addMessageListener("_Translate_Sel_ID_", this);
		addMessageListener("_On_Release_Icon_ID_", this);
		// addMessageListener("_Middle_Click_ID_", this); // Not in use for now. 
		addMessageListener("_Move_Popup_ID_", this);
	},

	receiveMessage: function(aMsg) {
		switch (aMsg.name) {
			case "_Translate_Sel_ID_":
				this._getSelection(true);
				break;
			case "_On_Release_Icon_ID_":
				this._onReleaseIcon(aMsg.data);
				break;
			// case "_Middle_Click_ID_": // Not in use for now. 
			// 	this.HandleListeners(aMsg.data.onRelease);
			// 	break;
			case "_Move_Popup_ID_":
				this._movePopup(aMsg.data);
				break;
		}
	},

	HandleListeners: function(aDel) { // Not in use for now. 
		Components.utils.reportError(aDel);
		removeEventListener("click", this._onMiddleClick, false);
		removeEventListener("mouseup", this._onMiddleClick, false);
		removeEventListener("mousedown", this._onMiddleClick, false);
		if (aDel)
			return true;
		Components.utils.reportError(aDel);
		addEventListener("click", this._onMiddleClick, false);
		addEventListener("mouseup", this._onMiddleClick, false);
		addEventListener("mousedown", this._onMiddleClick, false);
	},

	_getSelection: function(aDirectTrans) {
		Components.utils.reportError("BrowserUtils" in content);
		if (content.getSelection) {
			var sel;
			var activeEl = content.document.activeElement;
			try {
				sel = activeEl.value.substring(activeEl.selectionStart, activeEl.selectionEnd);
			} catch (e) {
				sel = content.getSelection().toString();
			} finally {
				if (aDirectTrans) {
					if (sel !== "") {
						sendAsyncMessage("_Response_ID_", {
							id: 1, // ID 2 is the "mouseover" event to trigger the popup from the "on realese" icon.
							sel: sel,
						});
					}
				} else
					return sel;
			}
		}
		return false;
	},

	_onMiddleClick: function(aE) {
		let sel = MultiTranslator._getSelection();
		switch (aE.type) {
			case "click":
				if (aE.button !== 1)
					return;
				if (sel !== "") {
					aE.preventDefault();
					aE.stopPropagation();
				}
				sendAsyncMessage("_Response_ID_", {
					id: 4, // ID 4 is the middle click.
					sel: sel,
				});
				var target = aE.target;
				if (target instanceof content.HTMLAnchorElement ||
					target instanceof content.HTMLAreaElement ||
					target instanceof content.HTMLLinkElement)
					return;
				break;
			case "mouseup":
			case "mousedown":
				sendAsyncMessage("_Response_ID_", {
					id: 5, // ID 5 handle KeepItOpen.
				});
				if (aE.button !== 1)
					return;
				if (sel !== "") {
					aE.preventDefault();
					aE.stopPropagation();
				}
				break;
		}
	},

	_onReleaseIcon: function(aData) {
		var doc = content.document;
		var body = this.$$("body", doc)[0];
		var div = this.$(aData._UID + "onReleaseDiv", doc);
		if (div)
			div.parentNode.removeChild(div);

		var sel = this._getSelection();

		if (!sel || sel === "" || !body)
			return;

		var imgLookup = this.$C("img", {
			border: 0,
			src: aData.image,
		}, doc);
		div = this.$C("div", {
			id: aData._UID + "onReleaseDiv",
			style: "background-color:transparent; color:#000000; position:absolute; top:" +
				(aData.clientY + content.window.pageYOffset + aData.iconOffsetY) + "px; left:" +
				(aData.clientX + content.pageXOffset + aData.iconOffsetX) +
				"px; padding:0px; z-index:10000; border-radius:2px;",
		}, doc);
		div.appendChild(imgLookup.cloneNode(false));
		let listener = function(aE) {
			aE.preventDefault();
			sendAsyncMessage("_Response_ID_", {
				id: 2, // ID 2 is the "mouseover" event to trigger the popup from the "on realese" icon.
				sel: sel,
			});
			if (div)
				div.parentNode.removeChild(div);
			aE.stopPropagation();
		};
		div.addEventListener("mouseover", listener, false);
		body.appendChild(div);
	},

	_movePopup: function(aData) {
		let fWin = content.window;
		fWin.focus();
		let rect;
		try {
			rect = fWin.getSelection().getRangeAt(0).getBoundingClientRect();
		} catch (aErr) {
			rect = false;
		}
		let posX = fWin.mozInnerScreenX + (rect ? rect.left : fWin.innerWidth / 2);
		let posY = fWin.mozInnerScreenY + (rect ? rect.bottom : fWin.innerHeight / 2) + 3;
		let deltaX = posX - aData.width;
		if (deltaX > 0)
			posX -= deltaX;
		let deltaY = posY - aData.height;
		if (deltaY > 0)
			posY -= deltaY;
		let div = this.$(aData._UID + "onReleaseDiv", content.document);
		try {
			sendAsyncMessage("_Response_ID_", {
				id: 3, // ID 3 is the popup positioning coordinates.
				posX: posX,
				posY: posY,
			});
		} finally {
			div && div.parentNode.removeChild(div);
		}
	},

	$C: function(aElName, aAttrs, aParent) {
		var doc = aParent ? aParent : document;
		var el = doc.createElement(aElName);
		if (aAttrs)
			Object.keys(aAttrs).forEach(function(n) {
				if (aAttrs[n] !== "")
					el.setAttribute(n, aAttrs[n])
			});
		return el;
	},

	$: function(aID, aParent) {
		if (!aParent)
			return document.getElementById(aID);
		return aParent.getElementById(aID);
	},

	$$: function(aTagName, aParent) {
		if (!aParent)
			return document.getElementsByTagName(aTagName);
		return aParent.getElementsByTagName(aTagName);
	},
};
MultiTranslator.Init();
<!--FrameScript-->]]></help>
  <attributes/>
</custombutton>