<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/"
              xmlns:html="http://www.w3.org/1999/xhtml">
  <html:head>
    <html:title><![CDATA[data:URI Generator]]></html:title>
    <html:link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAEG0lEQVR4AQEQBO/7Af///wAAAAAAAAAAAAAAAACIqt3/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHlXJE7///+zAAAAAAAAAAAA////AP///wD///8A////AIep3P/+/v7/////////////////+/3///H4//+Hqdz/k7vm/wAAAE3///8A////AAIAAAAAAAAAAAAAAACIqt3/ZEkdAAEBAQAAAAAAAAAAAPz+AAD2+wAA+Pv+AAAAAAC7+BkAbKjgsgEBAU0AAAAAAgAAAAAAAAAAAAAAAAAAAABEjzYA3OrcAAAAAAD8/gAA9vsAAPv9AADu8/sA/Pr/ACPj1wAA5vAAhJ+/sgEBAU0CAAAAAAAAAAAAAAAA+fPzAAwPAwBNnUMA9fr4APb7AAD7/QAA+f0AAAYIBwBQQSQAWEgpAEo2LwD76eQAAAAACwIAAAAAAAAAAIGd0P87NfkA+fz5ACY5CQA0jC8A+/0AAPn9AAD4/AAA+fwAAPoCAAD/BQAA8u/5AIF4XXQAAAC/BDqRNP86SRUA9DH0AKHx9QAjMQAA9P/+AP0g7QA/jy4AsmrSAPn8AAD3/AAA+/0AAPb8AADz7+kAAAAA5f///+kEAAAAABUWDQAICP8ABQb9APf3AADt8fYA/AP+APv89wD5/AAA9/wAAPv9AAD2/AAA+fMAAODjvgAAAAAAAAAAAATy9PoAo5XYAAAAAAAAAAAAAAAAABEz/QDx2v0Asl/FAPf8AAD7/QAA9vwAAPv9AAD15/gA4+PgAAAAAAAAAAAAAtV8005VGKIAv2vGAMFx0gAAAAAA780PAII/pAAJBxYA+/0AAPb8AAD7/QAA+fwAAPXs5gCimIF0AAAAvwAAAAAC////s/z5+QABBgsA+f0AAAAAAAA/JFIAOSVOAPv9AAD2/AAA+/0AAPn8AAD89wAA1tm8AAAAAOX////pAAAAAAIAAAAA/fr6APr9AQD4/AAALRk9AGM+gAD7/QAA9vwAAPv9AAD5/AAA9/wAAALw+ADm6OUAAAAAAAAAAAAAAAAAAm98r/9lWC0A+PwAAPn8AAB1SZUA+/0AAPb8AAD7/QAA+fwAAPf8AAD5/AAA+OviAPf48gAAAAAAAAAAAAAAAAAEAAAAAL/G6gD//eYA/v38AP79/QD+/f0A/f79AP/9/AD+/fwA/v38AP/9/QDl6d4ArKKQdAAAAL8AAAAAAAAAAAEAAABNAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADK////6QAAAAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABG02wnJgS1xwAAAABJRU5ErkJggg=="/>
    <html:style type="text/css"><![CDATA[body { font-size: medium; margin: 0; }
body, code:before, help:before, initcode:before {
  font-family: "Verdana", sans-serif;
}
#wrapper { position: fixed; top: 1em; right: 1em; text-align: center; }
p { font-size: small; text-align: center; }
#button {
  background-color: rgb(85, 168, 2);
  background-image: linear-gradient(to bottom, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -moz-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -o-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -webkit-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  border: 1px solid rgb(58, 116, 4);
  border-radius: .5em;
  -moz-border-radius: .5em;
  -webkit-border-radius: .5em;
  padding: 0;
  margin-bottom: 1em;
  box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -moz-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -o-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -webkit-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
}
#button a {
  color: #000;
  text-shadow: -1pt -1px 0pt rgba(255, 255, 255, .5);
  padding: 1em;
  text-decoration: none;
}
#button a, code, code:before, initcode, initcode:before, help, help:before {
  display: block;
}
#credits { position: fixed; bottom: 1em; right: 1em; font-size: small; }
custombutton { background-color: rgb(171, 171, 171); margin: 1em; }
date, image, mode, accelkey { display: none; }
name { font-weight: bold; font-size: x-large; }
code:before, help:before, initcode:before {
  font-weight: bold;
  font-size: large;
  margin: 0 0 1em;
  padding: .5em;
}
code:before { content: "CODE"; }
help:before { content: "Help"; }
initcode:before { content: "Initialization Code"; }
code, initcode, help {
  background-color: rgb(255, 255, 255);
  border: 1px inset rgb(170, 170, 170);
  font: medium monospace;
  margin: 1em 1em 2em 0;
  padding: 1em;
  text-align: left;
  width: 840px;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.clear { clear: both; }
]]></html:style>
  </html:head>
  <html:body>
    <html:div id="wrapper">
      <html:div id="button">
        <html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3Edata%3AURI%20Generator%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAEG0lEQVR4AQEQBO/7Af///wAAAAAAAAAAAAAAAACIqt3/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHlXJE7///+zAAAAAAAAAAAA////AP///wD///8A////AIep3P/+/v7/////////////////+/3///H4//+Hqdz/k7vm/wAAAE3///8A////AAIAAAAAAAAAAAAAAACIqt3/ZEkdAAEBAQAAAAAAAAAAAPz+AAD2+wAA+Pv+AAAAAAC7+BkAbKjgsgEBAU0AAAAAAgAAAAAAAAAAAAAAAAAAAABEjzYA3OrcAAAAAAD8/gAA9vsAAPv9AADu8/sA/Pr/ACPj1wAA5vAAhJ+/sgEBAU0CAAAAAAAAAAAAAAAA+fPzAAwPAwBNnUMA9fr4APb7AAD7/QAA+f0AAAYIBwBQQSQAWEgpAEo2LwD76eQAAAAACwIAAAAAAAAAAIGd0P87NfkA+fz5ACY5CQA0jC8A+/0AAPn9AAD4/AAA+fwAAPoCAAD/BQAA8u/5AIF4XXQAAAC/BDqRNP86SRUA9DH0AKHx9QAjMQAA9P/+AP0g7QA/jy4AsmrSAPn8AAD3/AAA+/0AAPb8AADz7+kAAAAA5f///+kEAAAAABUWDQAICP8ABQb9APf3AADt8fYA/AP+APv89wD5/AAA9/wAAPv9AAD2/AAA+fMAAODjvgAAAAAAAAAAAATy9PoAo5XYAAAAAAAAAAAAAAAAABEz/QDx2v0Asl/FAPf8AAD7/QAA9vwAAPv9AAD15/gA4+PgAAAAAAAAAAAAAtV8005VGKIAv2vGAMFx0gAAAAAA780PAII/pAAJBxYA+/0AAPb8AAD7/QAA+fwAAPXs5gCimIF0AAAAvwAAAAAC////s/z5+QABBgsA+f0AAAAAAAA/JFIAOSVOAPv9AAD2/AAA+/0AAPn8AAD89wAA1tm8AAAAAOX////pAAAAAAIAAAAA/fr6APr9AQD4/AAALRk9AGM+gAD7/QAA9vwAAPv9AAD5/AAA9/wAAALw+ADm6OUAAAAAAAAAAAAAAAAAAm98r/9lWC0A+PwAAPn8AAB1SZUA+/0AAPb8AAD7/QAA+fwAAPf8AAD5/AAA+OviAPf48gAAAAAAAAAAAAAAAAAEAAAAAL/G6gD//eYA/v38AP79/QD+/f0A/f79AP/9/AD+/fwA/v38AP/9/QDl6d4ArKKQdAAAAL8AAAAAAAAAAAEAAABNAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADK////6QAAAAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABG02wnJgS1xwAAAABJRU5ErkJggg%3D%3D%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5B//%20http%3A//blog.userstyles.org/2007/01/28/creating-a-data-uri-from-a-file/%0A%0Avar%20Cc%20%3D%20Components.classes%3B%0Avar%20Ci%20%3D%20Components.interfaces%3B%0A%0A//%20Open%20a%20file%0Afunction%20getFile%28%29%20%7B%0A%20%20const%20nsIFilePicker%20%3D%20Ci.nsIFilePicker%3B%0A%20%20var%20fp%20%3D%20Cc%5B%27@mozilla.org/filepicker%3B1%27%5D.%0A%20%20%20%20%20%20%20%20%20%20%20createInstance%28nsIFilePicker%29%3B%0A%20%20fp.init%28window%2C%20gNavigatorBundle.getString%28%22openFile%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nsIFilePicker.modeOpen%29%3B%0A%20%20fp.appendFilters%28nsIFilePicker.filterAll%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nsIFilePicker.filterText%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nsIFilePicker.filterImages%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nsIFilePicker.filterXML%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nsIFilePicker.filterHTML%29%3B%0A%20%20fp.appendFilter%28%22JavaScript%22%2C%20%22*.js%22%29%3B%0A%20%20fp.appendFilter%28%22CSS%22%2C%20%22*.css%22%29%3B%0A%20%20fp.appendFilter%28%22XUL%22%2C%20%22*.xul%22%29%3B%0A%20%20if%20%28fp.show%28%29%20%3D%3D%20nsIFilePicker.returnCancel%29%20return%3B%0A%0A%20%20var%20localFile%20%3D%20Cc%5B%22@mozilla.org/file/local%3B1%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.createInstance%28Ci.nsILocalFile%29%3B%0A%20%20localFile.initWithPath%28fp.file.path%29%3B%0A%20%20return%20localFile%3B%0A%7D%0A%0A//%20Generate%20data%3AURI%20from%20a%20file%0Afunction%20generateDataURI%28aFile%29%20%7B%0A%20%20var%20contentType%20%3D%20Cc%5B%22@mozilla.org/mime%3B1%22%5D.getService%28Ci.nsIMIMEService%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.getTypeFromFile%28aFile%29%3B%0A%20%20var%20inputStream%20%3D%20Cc%5B%22@mozilla.org/network/file-input-stream%3B1%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.createInstance%28Ci.nsIFileInputStream%29%3B%0A%20%20inputStream.init%28aFile%2C%200x01%2C%200600%2C%200%29%3B%0A%20%20var%20stream%20%3D%20Cc%5B%22@mozilla.org/binaryinputstream%3B1%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.createInstance%28Ci.nsIBinaryInputStream%29%3B%0A%20%20stream.setInputStream%28inputStream%29%3B%0A%20%20var%20encoded%20%3D%20btoa%28stream.readBytes%28stream.available%28%29%29%29%3B%0A%20%20//var%20encoded%20%3D%20escape%28stream.readBytes%28stream.available%28%29%29%3B%0A%20%20return%20%22data%3A%22%20+%20contentType%20+%20%22%3Bbase64%2C%22%20+%20encoded%3B%0A%7D%0A%0A//%20Load%20data%3AURI%20to%20a%20new%20tab%0Afunction%20loadDataURI%28%29%20%7B%0A%20%20var%20file%20%3D%20getFile%28%29%3B%0A%20%20if%20%28%21file%29%20return%3B%0A%20%20var%20dataURI%20%3D%20generateDataURI%28file%29%3B%0A%20%20gBrowser.loadOneTab%28dataURI%2C%20null%2C%20null%2C%20null%2C%20false%29%3B%0A%7D%0A%0A//%20Show%20data%3AURI%20in%20location%20bar%0Afunction%20showDataURI%28%29%20%7B%0A%20%20var%20file%20%3D%20getFile%28%29%3B%0A%20%20if%20%28%21file%29%20return%3B%0A%20%20var%20dataURI%20%3D%20generateDataURI%28file%29%3B%0A%20%20gURLBar.value%20%3D%20dataURI%3B%0A%7D%0A%0A//%20Copy%20data%3AURI%20to%20clipboard%0Afunction%20copyDataURI%28%29%20%7B%0A%20%20var%20file%20%3D%20getFile%28%29%3B%0A%20%20if%20%28%21file%29%20return%3B%0A%20%20var%20dataURI%20%3D%20generateDataURI%28file%29%3B%0A%20%20Cc%5B%22@mozilla.org/widget/clipboardhelper%3B1%22%5D.%0A%20%20getService%28Ci.nsIClipboardHelper%29.copyString%28dataURI%29%3B%0A%20%20custombuttons.alertBox%28this.name%2C%20%22Copied%20to%20Clipboard%22%29%3B%0A%7D%0A%0A/*%20%20I%20don%27t%20like%20this%20gQuot%20function%0A%20%20%20%20It%20gave%20me%20delay%20when%20I%20clicked%20the%20button%0A%0Athis.leftclick%20%3D%20showDataURI%3B%0Athis.rightclick%20%3D%20copyDataURI%3B%0Athis.setAttribute%28%22onclick%22%2C%20%22gQuot%28event%2C%20this%29%22%29%3B%20%0A*/%0A%0Athis.onclick%20%3D%20function%28aEvent%29%20%7B%0A%20%20aEvent.preventDefault%28%29%3B%0A%20%20switch%20%28aEvent.button%29%20%7B%0A%20%20%20%20case%200%3A%20showDataURI%28%29%3B%20break%3B%20//%20left-click%0A%20%20%20%20case%202%3A%20copyDataURI%28%29%3B%20break%3B%20//%20right-click%0A%20%20%20%20default%3A%0A%20%20%20%20%20%20let%20x%20%3D%20this.boxObject.x%20+%20%28this.boxObject.width%20%20/%202%29%3B%0A%20%20%20%20%20%20let%20y%20%3D%20this.boxObject.y%20+%20%28this.boxObject.height%20/%202%29%3B%0A%20%20%20%20%20%20document.popupNode%20%3D%20this%3B%0A%20%20%20%20%20%20custombuttons.getCbContextObj%28this%29.oMenu%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.openPopup%28null%2C%20%22after_start%22%2C%20x%2C%20y%2C%20true%2C%20false%29%0A%20%20%7D%0A%7D%0A%0Athis.tooltipText%20%3D%20this.Help%3B%0A%0A%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5B/*CODE*/%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B%0ALeft-click%3A%20display%20the%20result%20in%20location%20bar%0A%0AMiddle-click%3A%20copy%20the%20result%20to%20clipboard%0A%0A%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" rel="nofollow" title="Install data:URI Generator">
        <![CDATA[Install this button]]>
        </html:a>
      </html:div>
      <html:a href="https://addons.mozilla.org/addon/custom-buttons/?src=custom-buttons-xml">
        <![CDATA[What's this?]]>
      </html:a>
      <html:div id="credits">
        <html:a href="http://custombuttons.sourceforge.net/forum/viewtopic.php?t=78#p197">
          <![CDATA[Custom Buttons XML]]><html:br/><![CDATA[Exporter/Importer]]>
        </html:a>
      </html:div>
    </html:div>
  </html:body>
  <date id="date" value="20120329"/>
  <name>data:URI Generator</name>
  <image><![CDATA[data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAEG0lEQVR4AQEQBO/7Af///wAAAAAAAAAAAAAAAACIqt3/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHlXJE7///+zAAAAAAAAAAAA////AP///wD///8A////AIep3P/+/v7/////////////////+/3///H4//+Hqdz/k7vm/wAAAE3///8A////AAIAAAAAAAAAAAAAAACIqt3/ZEkdAAEBAQAAAAAAAAAAAPz+AAD2+wAA+Pv+AAAAAAC7+BkAbKjgsgEBAU0AAAAAAgAAAAAAAAAAAAAAAAAAAABEjzYA3OrcAAAAAAD8/gAA9vsAAPv9AADu8/sA/Pr/ACPj1wAA5vAAhJ+/sgEBAU0CAAAAAAAAAAAAAAAA+fPzAAwPAwBNnUMA9fr4APb7AAD7/QAA+f0AAAYIBwBQQSQAWEgpAEo2LwD76eQAAAAACwIAAAAAAAAAAIGd0P87NfkA+fz5ACY5CQA0jC8A+/0AAPn9AAD4/AAA+fwAAPoCAAD/BQAA8u/5AIF4XXQAAAC/BDqRNP86SRUA9DH0AKHx9QAjMQAA9P/+AP0g7QA/jy4AsmrSAPn8AAD3/AAA+/0AAPb8AADz7+kAAAAA5f///+kEAAAAABUWDQAICP8ABQb9APf3AADt8fYA/AP+APv89wD5/AAA9/wAAPv9AAD2/AAA+fMAAODjvgAAAAAAAAAAAATy9PoAo5XYAAAAAAAAAAAAAAAAABEz/QDx2v0Asl/FAPf8AAD7/QAA9vwAAPv9AAD15/gA4+PgAAAAAAAAAAAAAtV8005VGKIAv2vGAMFx0gAAAAAA780PAII/pAAJBxYA+/0AAPb8AAD7/QAA+fwAAPXs5gCimIF0AAAAvwAAAAAC////s/z5+QABBgsA+f0AAAAAAAA/JFIAOSVOAPv9AAD2/AAA+/0AAPn8AAD89wAA1tm8AAAAAOX////pAAAAAAIAAAAA/fr6APr9AQD4/AAALRk9AGM+gAD7/QAA9vwAAPv9AAD5/AAA9/wAAALw+ADm6OUAAAAAAAAAAAAAAAAAAm98r/9lWC0A+PwAAPn8AAB1SZUA+/0AAPb8AAD7/QAA+fwAAPf8AAD5/AAA+OviAPf48gAAAAAAAAAAAAAAAAAEAAAAAL/G6gD//eYA/v38AP79/QD+/f0A/f79AP/9/AD+/fwA/v38AP/9/QDl6d4ArKKQdAAAAL8AAAAAAAAAAAEAAABNAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADK////6QAAAAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABG02wnJgS1xwAAAABJRU5ErkJggg==]]></image>
  <mode>0</mode>
  <initcode><![CDATA[// http://blog.userstyles.org/2007/01/28/creating-a-data-uri-from-a-file/

var Cc = Components.classes;
var Ci = Components.interfaces;

// Open a file
function getFile() {
  const nsIFilePicker = Ci.nsIFilePicker;
  var fp = Cc['@mozilla.org/filepicker;1'].
           createInstance(nsIFilePicker);
  fp.init(window, gNavigatorBundle.getString("openFile"),
                   nsIFilePicker.modeOpen);
  fp.appendFilters(nsIFilePicker.filterAll |
                   nsIFilePicker.filterText |
                   nsIFilePicker.filterImages |
                   nsIFilePicker.filterXML |
                   nsIFilePicker.filterHTML);
  fp.appendFilter("JavaScript", "*.js");
  fp.appendFilter("CSS", "*.css");
  fp.appendFilter("XUL", "*.xul");
  if (fp.show() == nsIFilePicker.returnCancel) return;

  var localFile = Cc["@mozilla.org/file/local;1"]
                      .createInstance(Ci.nsILocalFile);
  localFile.initWithPath(fp.file.path);
  return localFile;
}

// Generate data:URI from a file
function generateDataURI(aFile) {
  var contentType = Cc["@mozilla.org/mime;1"].getService(Ci.nsIMIMEService)
                                             .getTypeFromFile(aFile);
  var inputStream = Cc["@mozilla.org/network/file-input-stream;1"]
                      .createInstance(Ci.nsIFileInputStream);
  inputStream.init(aFile, 0x01, 0600, 0);
  var stream = Cc["@mozilla.org/binaryinputstream;1"]
                 .createInstance(Ci.nsIBinaryInputStream);
  stream.setInputStream(inputStream);
  var encoded = btoa(stream.readBytes(stream.available()));
  //var encoded = escape(stream.readBytes(stream.available());
  return "data:" + contentType + ";base64," + encoded;
}

// Load data:URI to a new tab
function loadDataURI() {
  var file = getFile();
  if (!file) return;
  var dataURI = generateDataURI(file);
  gBrowser.loadOneTab(dataURI, null, null, null, false);
}

// Show data:URI in location bar
function showDataURI() {
  var file = getFile();
  if (!file) return;
  var dataURI = generateDataURI(file);
  gURLBar.value = dataURI;
}

// Copy data:URI to clipboard
function copyDataURI() {
  var file = getFile();
  if (!file) return;
  var dataURI = generateDataURI(file);
  Cc["@mozilla.org/widget/clipboardhelper;1"].
  getService(Ci.nsIClipboardHelper).copyString(dataURI);
  custombuttons.alertBox(this.name, "Copied to Clipboard");
}

/*  I don't like this gQuot function
    It gave me delay when I clicked the button

this.leftclick = showDataURI;
this.rightclick = copyDataURI;
this.setAttribute("onclick", "gQuot(event, this)"); 
*/

this.onclick = function(aEvent) {
  aEvent.preventDefault();
  switch (aEvent.button) {
    case 0: showDataURI(); break; // left-click
    case 2: copyDataURI(); break; // right-click
    default:
      let x = this.boxObject.x + (this.boxObject.width  / 2);
      let y = this.boxObject.y + (this.boxObject.height / 2);
      document.popupNode = this;
      custombuttons.getCbContextObj(this).oMenu
                   .openPopup(null, "after_start", x, y, true, false)
  }
}

this.tooltipText = this.Help;

]]></initcode>
  <code><![CDATA[/*CODE*/]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help><![CDATA[
Left-click: display the result in location bar

Middle-click: copy the result to clipboard

]]></help>
  <attributes/>
</custombutton>