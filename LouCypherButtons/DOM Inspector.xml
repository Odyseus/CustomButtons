<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/"
              xmlns:html="http://www.w3.org/1999/xhtml">
  <html:head>
    <html:title><![CDATA[DOM Inspector]]></html:title>
    <html:link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAB3RJTUUH1QgECxw1jaSNNQAAAAlwSFlzAAAK8AAACvABQqw0mAAAADBQTFRFAAAA/wAA/20A/4UA/60AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwJ3q+AAAAEFJREFUeNpjYIABFhcwcAAxGBggDAYlJQYwg0lJSQHEcFACAhZ0hhEKA6jYWACunQVqoAODA9QKuF0OcEvhjmAAAOEEEW5k07z8AAAAAElFTkSuQmCC"/>
    <html:style type="text/css"><![CDATA[
body { font-size: medium; margin: 0; }
body, code:before, help:before, initcode:before {
  font-family: "Verdana", sans-serif;
}
#wrapper { position: fixed; top: 1em; right: 1em; text-align: center; }
p { font-size: small; text-align: center; }
#button {
  background-color: rgb(85, 168, 2);
  background-image: linear-gradient(to bottom, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -moz-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -o-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -webkit-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  border: 1px solid rgb(58, 116, 4);
  border-radius: .5em;
  -moz-border-radius: .5em;
  -webkit-border-radius: .5em;
  padding: 0;
  margin-bottom: 1em;
  box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -moz-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -o-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -webkit-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
}
#button a {
  color: #000;
  text-shadow: -1pt -1px 0pt rgba(255, 255, 255, .5);
  padding: 1em;
  text-decoration: none;
}
:-moz-any-link:focus {
  color: white;
  outline-color: transparent;
  text-decoration: none;
}
#button a, code, code:before, initcode, initcode:before, help, help:before {
  display: block;
}
#credits { position: fixed; bottom: 1em; right: 1em; font-size: small; }
custombutton { background-color: rgb(171, 171, 171); margin: 1em; }
date, image, mode, accelkey { display: none; }
name { font-weight: bold; font-size: x-large; }
code:before, help:before, initcode:before {
  font-weight: bold;
  font-size: large;
  margin: 0 0 1em;
  padding: .5em;
}
code:before { content: "CODE"; }
help:before { content: "Help"; }
initcode:before { content: "Initialization Code"; }
code, initcode, help {
  background-color: rgb(255, 255, 255);
  border: 1px inset rgb(170, 170, 170);
  font: medium monospace;
  margin: 1em 1em 2em 0;
  padding: 1em;
  text-align: left;
  width: 840px;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.clear { clear: both; }
]]></html:style>
  </html:head>
  <html:body>
    <html:div id="wrapper">
      <html:div id="button">
        <html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3EDOM%20Inspector%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAB3RJTUUH1QgECxw1jaSNNQAAAAlwSFlzAAAK8AAACvABQqw0mAAAADBQTFRFAAAA/wAA/20A/4UA/60AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwJ3q+AAAAEFJREFUeNpjYIABFhcwcAAxGBggDAYlJQYwg0lJSQHEcFACAhZ0hhEKA6jYWACunQVqoAODA9QKuF0OcEvhjmAAAOEEEW5k07z8AAAAAElFTkSuQmCC%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5B//%20Check%20if%20DOMI%20is%20available%0Aif%20%28typeof%20inspectDOMDocument%20%21%3D%20%22function%22%29%20%7B%0A%20%20var%20domi%20%3D%20%22DOM%20Inspector%22%0A%20%20//%20Change%20button%20tooltip%0A%20%20this.tooltipText%20%3D%20this.name%20+%20%22%20button%20requires%20%22%20+%20domi%20+%20%22%20extension.%5Cn%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22Click%20the%20button%20to%20%22%0A%20%20AddonManager.getAddonByID%28%22inspector@mozilla.org%22%2C%20function%28addon%29%20%7B%0A%20%20%20%20if%20%28addon%29%20//%20If%20DOMI%20is%20installed%0A%20%20%20%20%20%20self.tooltipText%20+%3D%20%22enable%20%22%20+%20domi%20+%20%22.%22%3B%20%20%20//%20change%20button%20tooltip%0A%20%20%20%20else%20%20//%20If%20DOMI%20is%20not%20installed%0A%20%20%20%20%20%20self.tooltipText%20+%3D%20%22install%20%22%20+%20domi%20+%20%22.%22%3B%20%20//%20change%20button%20tooltip%0A%0A%20%20%20%20self.Help%20%3D%20self.tooltipText%3B%20//%20Change%20button%20help%20text%0A%20%20%7D%29%0A%20%20return%20false%3B%0A%7D%0A%0Athis.tooltipText%20%3D%20%22%5Cn%22%20+%20this.name%20+%20%22%5Cn%5Cn%22%20+%20this.Help%20+%22%5Cn%5Cn%22%3B%0Athis.tooltipProp%20%3D%20this.tooltipText%3B%0Athis.className%20%3D%20%22%22%3B%0A%0Afunction%20%24%28aId%29%20%7B%0A%20%20return%20document.getElementById%28aId%29%3B%0A%7D%0A%0Afunction%20makeXML%28aXMLString%29%20%7B%0A%20%20return%20%28new%20DOMParser%29.parseFromString%28aXMLString%2C%20%22application/xml%22%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.documentElement%3B%0A%7D%0A%0Afunction%20%24xml%28aNode%2C%20aXML%29%20%7B%0A%20%20aNode.appendChild%28makeXML%28aXML%29%29%3B%0A%7D%0A%0Aif%20%28typeof%20closeMenus%20%21%3D%20%22function%22%29%20%7B%0A%20%20closeMenus%20%3D%20function%20closeMenus%28node%29%20%7B%0A%20%20%20%20if%20%28%22tagName%22%20in%20node%29%20%7B%0A%20%20%20%20%20%20if%20%28node.namespaceURI%20%3D%3D%20xulns%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%28node.tagName%20%3D%3D%20%22menupopup%22%20%7C%7C%20node.tagName%20%3D%3D%20%22popup%22%29%29%20%7B%0A%20%20%20%20%20%20%20%20node.hidePopup%28%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20closeMenus%28node.parentNode%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%0Avar%20inspectomatic%20%3D%20%22custombuttons.DOMInspector.Inspectomatic.enable%22%3B%0A%0A//%20Check%20if%20Inspectomatic%20is%20enabled%20%28disabled%20by%20default%29%0Athis.checkInspectomatic%20%3D%20function%28%29%20%7B%0A%20%20try%20%7B%0A%20%20%20%20return%20cbu.ps.getBoolPref%28inspectomatic%29%3B%0A%20%20%7D%20catch%28ex%29%20%7B%0A%20%20%20%20return%20false%3B%0A%20%20%7D%0A%7D%0A%0Athis.toggleInspectomatic%20%3D%20function%28%29%20%7B%0A%20%20cbu.ps.setBoolPref%28inspectomatic%2C%20%21this.checkInspectomatic%28%29%29%0A%7D%0A%0A//%20Append%20menuitems%0Afunction%20addItem%28aNode%2C%20aLabel%2C%20aKey%2C%20aStatus%2C%20aValue%29%20%7B%0A%20%20/*%24xml%28aNode%2C%0A%20%20%20%20%20%20%20%3Cmenuitem%20xmlns%3D%7Bxulns%7D%20label%3D%7BaLabel%7D%20statustext%3D%7BaStatus%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20accesskey%3D%7BaKey%7D%20value%3D%7BaValue%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%22this.parentNode.parentNode.inspectWin%28event%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onmouseover%3D%22this.parentNode.parentNode.setStatus%28this.statusText%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onmouseout%3D%22this.parentNode.parentNode.setStatus%28%27%27%29%3B%22/%3E%29%3B*/%0A%20%20var%20m%20%3D%20aNode.appendChild%28document.createElement%28%22menuitem%22%29%29%3B%0A%20%20m.setAttribute%28%22label%22%2C%20aLabel%29%3B%0A%20%20m.statusText%20%3D%20aStatus%3B%0A%20%20m.accessKey%20%3D%20aKey%3B%0A%20%20m.value%20%3D%20aValue%3B%0A%20%20m.setAttribute%28%22oncommand%22%2C%20%22this.parentNode.parentNode.inspectWin%28event%29%3B%22%29%3B%0A%20%20m.setAttribute%28%22onmouseover%22%2C%20%22this.parentNode.parentNode.setStatus%28this.statusText%29%3B%22%29%3B%0A%20%20m.setAttribute%28%22onmouseout%22%2C%20%22this.parentNode.parentNode.setStatus%28%27%27%29%3B%22%29%3B%0A%7D%0A%0A//%20Enumerate%20open%20windows%0Afunction%20getWindowEnumerator%28%29%20%7B%0A%20%20return%20Cc%5B%22@mozilla.org/embedcomp/window-watcher%3B1%22%5D.%0A%20%20%20%20%20%20%20%20%20getService%28Ci.nsIWindowWatcher%29.getWindowEnumerator%28%29%3B%0A%7D%0A%0A//%20Display%20window%20URL%20on%20statusbar%0Athis.setStatus%20%3D%20function%28aString%29%20%7B%0A%20%20XULBrowserWindow.setOverLink%28aString%29%3B%0A%7D%0A%0A//%20Regenerate%20menuitems%0Athis.popupShowing%20%3D%20function%28aNode%29%20%7B%0A%20%20while%20%28aNode.firstChild%29%20%7B%0A%20%20%20%20if%20%28aNode.localName%20%3D%3D%20%22menuseparator%22%29%20break%3B%0A%20%20%20%20aNode.removeChild%28aNode.firstChild%29%3B%0A%20%20%7D%0A%20%20var%20index%20%3D%201%3B%0A%20%20var%20enumerator%20%3D%20getWindowEnumerator%28%29%3B%0A%20%20while%20%28enumerator.hasMoreElements%28%29%29%20%7B%0A%20%20%20%20let%20win%20%3D%20enumerator.getNext%28%29%3B%0A%20%20%20%20addItem%28aNode%2C%20index%20+%20%22%20%22%20+%20win.document.title%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20index%2C%20win.location%2C%20index++%29%3B%0A%20%20%7D%0A%20%20//%20Add%20Options%20menu%0A%20%20/*%24xml%28aNode%2C%20%3Cmenuseparator%20xmlns%3D%7Bxulns%7D/%3E%29%3B%0A%20%20%24xml%28aNode%2C%20%3Cmenuitem%20xmlns%3D%7Bxulns%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20label%3D%22Enable%20Inspectomatic%22%20type%3D%22checkbox%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%7B%22this.parentNode.parentNode.%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22toggleInspectomatic%28%29%3B%22%7D/%3E%29%3B*/%0A%20%20var%20sep%20%3D%20aNode.appendChild%28document.createElement%28%22menuseparator%22%29%29%3B%0A%20%20sep.id%20%3D%20this.id%20+%20%22-separator%22%3B%0A%20%20var%20mi%20%3D%20aNode.appendChild%28document.createElement%28%22menuitem%22%29%29%3B%0A%20%20mi.label%3D%22Enable%20Inspectomatic%22%3B%0A%20%20mi.type%3D%22checkbox%22%3B%0A%20%20mi.setAttribute%28%22oncomand%22%2C%20%22this.parentNode.parentNode.toggleInspectomatic%28%29%3B%22%29%3B%0A%20%20aNode.lastChild.setAttribute%28%22checked%22%2C%20this.checkInspectomatic%28%29%29%3B%0A%7D%0A%0A//%20Inspect%20document/window%0Athis.inspectWin%20%3D%20function%28aEvent%29%20%7B%0A%20%20if%20%28aEvent%29%20%7B%0A%20%20%20%20if%20%28aEvent.target.nodeName%20%21%3D%20%22toolbarbutton%22%29%20%7B%0A%20%20%20%20%20%20var%20windowIndex%20%3D%20parseInt%28aEvent.target.getAttribute%28%22value%22%29%29%3B%0A%20%20%20%20%20%20var%20enumerator%20%3D%20getWindowEnumerator%28%29%3B%0A%20%20%20%20%20%20var%20index%20%3D%201%3B%0A%20%20%20%20%20%20while%20%28enumerator.hasMoreElements%28%29%29%20%7B%0A%20%20%20%20%20%20%20%20let%20win%20%3D%20enumerator.getNext%28%29%3B%0A%20%20%20%20%20%20%20%20if%20%28index++%20%3D%3D%20windowIndex%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20%28this.checkInspectomatic%28%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20this.Inspectomatic.selectByClick%28win.document%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20win.focus%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20inspectDOMDocument%28win.document%29%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%20else%20%7B%0A%20%20%20%20//%20Inspect%20document%20in%20active%20tab%0A%20%20%20%20inspectDOMDocument%28content.document%29%3B%0A%20%20%7D%0A%7D%0A%0A//%20Middle%20click%20to%20inspect%20chrome%20document%20instead%20of%20content%0Athis.onclick%20%3D%20function%28aEvent%29%20%7B%0A%20%20if%20%28%28aEvent.button%20%21%3D%201%29%20%7C%7C%20%28aEvent.target.id%20%21%3D%20this.id%29%29%20return%3B%0A%20%20if%20%28this.checkInspectomatic%28%29%29%20%7B%0A%20%20%20%20inspectDOMDocument%28content.document%29%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20inspectDOMDocument%28document.documentElement%29%3B%0A%20%20%7D%0A%7D%0A%0A/*%24xml%28this%2C%20%3Cmenupopup%20xmlns%3D%7Bxulns%7D%20context%3D%22toolbar-context-menu%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onpopupshowing%3D%22this.parentNode.popupShowing%28this%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onmouseout%3D%22event.stopPropagation%28%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%22event.stopPropagation%28%29%3B%22/%3E%29%3B*/%0Avar%20mp%20%3D%20this.appendChild%28document.createElement%28%22menupopup%22%29%29%3B%0Amp.setAttribute%28%22context%22%2C%20%22toolbar-context-menu%22%29%3B%0Amp.setAttribute%28%22onpopupshowing%22%2C%20%22this.parentNode.popupShowing%28this%29%3B%22%29%3B%0Amp.setAttribute%28%22onmouseout%22%2C%20%22event.stopPropagation%28%29%3B%22%29%3B%0Amp.setAttribute%28%22oncommand%22%2C%20%22event.stopPropagation%28%29%3B%22%29%3B%0Athis.type%20%3D%20%22menu-button%22%3B%0A%0A%0A//-------------------------%20Add%20%22Inspect%20Element%22%20-------------------------//%0A%0A//%20Remove%20element%20if%20it%20exists%0Afunction%20removeNode%28aId%29%20%7B%0A%20%20var%20node%20%3D%20%24%28aId%29%3B%0A%20%20if%20%28node%29%20%7B%0A%20%20%20%20node.parentNode.removeChild%28node%29%3B%0A%20%20%7D%0A%7D%0A%0A//%20Append%20menuitem%20into%20a%20menupopup%0Afunction%20addInspector%28aMenupopup%2C%20aId%2C%20aImage%29%20%7B%0A%20%20//%20Remove%20previously%20created%20menuitem%0A%20%20//%20to%20avoid%20duplicate%20during%20button%20initiation%0A%20%20removeNode%28aId%29%3B%0A%0A%20%20//%20Create%20a%20new%20one%0A%20%20/*%24xml%28aMenupopup%2C%0A%20%20%20%20%20%20%20%3Cmenuitem%20xmlns%3D%7Bxulns%7D%20id%3D%7BaId%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20class%3D%22menuitem-iconic%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20image%3D%7BaImage%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20label%3D%22Inspect%20Element%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%7B%22inspectDOMNode%28%27triggerNode%27%20in%20this.parentNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3F%20this.parentNode.triggerNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3A%20document.popupNode%29%3B%22%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onclick%3D%7B%22if%20%28event.button%20%3D%3D%201%29%20%7B%20inspectObject%28%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%27triggerNode%27%20in%20this.parentNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3F%20this.parentNode.triggerNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3A%20document.popupNode%29%3B%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22closeMenus%28this%29%3B%20%7D%22%7D/%3E%29%3B*/%0A%20%20var%20mi%20%3D%20aMenupopup.appendChild%28document.createElement%28%22menuitem%22%29%29%3B%0A%20%20mi.id%20%3D%20aId%3B%0A%20%20mi.className%20%3D%20%22menuitem-iconic%22%3B%0A%20%20mi.setAttribute%28%22image%22%2C%20aImage%29%3B%0A%20%20mi.setAttribute%28%22label%22%2C%20%22Inspect%20Element%22%29%3B%0A%20%20mi.setAttribute%28%22oncommand%22%2C%20%22inspectDOMNode%28%27triggerNode%27%20in%20this.parentNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3F%20this.parentNode.triggerNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3A%20document.popupNode%29%3B%22%29%3B%0A%20%20mi.setAttribute%28%22onclick%22%2C%20%22if%20%28event.button%20%3D%3D%201%29%20%7B%20inspectObject%28%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%27triggerNode%27%20in%20this.parentNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3F%20this.parentNode.triggerNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3A%20document.popupNode%29%3B%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22closeMenus%28this%29%3B%20%7D%22%29%3B%0A%7D%0A%0Afunction%20initMenupopups%28aMenupopups%2C%20aButton%29%20%7B%0A%20%20if%20%28%21aMenupopups.length%29%20return%3B%0A%20%20for%20%28let%20i%20%3D%200%3B%20i%20%3C%20aMenupopups.length%3B%20i++%29%20%7B%0A%20%20%20%20let%20menupopup%20%3D%20aMenupopups%5Bi%5D%3B%0A%20%20%20%20if%20%28%21menupopup.hasAttribute%28%22onclick%22%29%20%26%26%0A%20%20%20%20%20%20%20%20%28menupopup.id%20%21%3D%20%22stylish-popup%22%29%29%20%7B%0A%20%20%20%20%20%20menupopup.setAttribute%28%22onclick%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22if%20%28event.button%20%3D%3D%202%29%20%7B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20event.preventDefault%28%29%3B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20event.stopPropagation%28%29%3B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20inspectDOMNode%28event.target%29%3B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20closeMenus%28this%29%3B%20%7D%22%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20%28%28%28menupopup.parentNode%20%3D%3D%20popupset%29%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%28menupopup.parentNode%20%3D%3D%20document.documentElement%29%29%20%26%26%0A%20%20%20%20%20%20%20%20%28%21/%5Estylish/.test%28menupopup.id%29%29%29%20%7B%0A%20%20%20%20%20%20addInspector%28menupopup%2C%20id%20+%20menupopup.id%2C%20aButton.image%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%0Avar%20id%20%3D%20%22inspector-%22%3B%0Avar%20winId%20%3D%20document.documentElement.id%3B%0Avar%20popupsets%20%3D%20document.querySelectorAll%28%22%23%22%20+%20winId%20+%20%22%20%3E%20popupset%22%29%3B%0Afor%20%28let%20i%20%3D%200%3B%20i%20%3C%20popupsets.length%3B%20i++%29%20%7B%0A%20%20var%20popupset%20%3D%20popupsets%5Bi%5D%3B%0A%20%20initMenupopups%28popupset.getElementsByTagName%28%22menupopup%22%29%2C%20this%29%3B%0A%7D%0A%0AinitMenupopups%28document.querySelectorAll%28%22%23%22%20+%20winId%20+%20%22%20%3E%20menupopup%22%29%2C%20this%29%3B%0A%0A/*var%20winContext%20%3D%20%3Cmenupopup%20xmlns%3D%7Bxulns%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%3D%22inspect-context%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onpopupshown%3D%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22var%20popupNode%20%3D%20%28%27triggerNode%27%20in%20this%29%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%3F%20this.triggerNode%20%3A%20document.popupNode%3B%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22if%20%28popupNode.id%20%3D%3D%20%27content%27%29%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20closeMenus%28this%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20id%3D%22inspect-chrome%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20class%3D%22menuitem-iconic%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20image%3D%7Bthis.image%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20label%3D%22Inspect%20Element%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%7B%22inspectDOMNode%28%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%27triggerNode%27%20in%20this.parentNode%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%3F%20this.parentNode.triggerNode%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%3A%20document.popupNode%29%22%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onclick%3D%7B%22if%20%28event.button%20%3D%3D%201%29%20%7B%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22inspectObject%28%27triggerNode%27%20in%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22this.parentNode%20%3F%20this.parentNode.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22triggerNode%20%3A%20document.popupNode%29%3B%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22closeMenus%28this%29%3B%20%7D%22%7D/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/menupopup%3E%3B*/%0A%0Avar%20winContext%20%3D%20document.createElement%28%22menupopup%22%29%3B%0AwinContext.id%20%3D%20%22inspect-context%22%3B%0AwinContext.setAttribute%28%22onpopupshown%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22var%20popupNode%20%3D%20%28%27triggerNode%27%20in%20this%29%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%3F%20this.triggerNode%20%3A%20document.popupNode%3B%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22if%20%28popupNode.id%20%3D%3D%20%27content%27%29%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20closeMenus%28this%29%3B%22%29%3B%0A%0Avar%20mi%20%3D%20winContext.appendChild%28document.createElement%28%22menuitem%22%29%29%3B%0Ami.id%20%3D%20%22inspect-chrome%22%3B%0Ami.className%20%3D%20%22menuitem-iconic%22%3B%0Ami.setAttribute%28%22image%22%2C%20this.image%29%3B%0Ami.setAttribute%28%22label%22%2C%20%22Inspect%20Element%22%29%3B%0Ami.setAttribute%28%22oncommand%22%2C%20%22inspectDOMNode%28%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%27triggerNode%27%20in%20this.parentNode%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%3F%20this.parentNode.triggerNode%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%3A%20document.popupNode%29%22%29%3B%0Ami.setAttribute%28%22onclick%22%2C%20%22if%20%28event.button%20%3D%3D%201%29%20%7B%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22inspectObject%28%27triggerNode%27%20in%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22this.parentNode%20%3F%20this.parentNode.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22triggerNode%20%3A%20document.popupNode%29%3B%20%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22closeMenus%28this%29%3B%20%7D%22%29%3B%0A%0AremoveNode%28%22inspect-context%22%29%3B%0A%0A/*%24xml%28%28popupset.id%20%3D%3D%20%22mainPopupSet%22%29%20%3F%20popupset%20%3A%20document.documentElement%2C%0A%20%20%20%20%20winContext%29%3B*/%0A%28%28popupset.id%20%3D%3D%20%22mainPopupSet%22%29%20%3F%20popupset%20%3A%20document.documentElement%29.appendChild%28winContext%29%3B%0A%0A//%20main%20window%0Adocument.documentElement.setAttribute%28%22context%22%2C%20%22inspect-context%22%29%3B%0A%0A//%20sidebar%0Aif%20%28%24%28%22sidebar%22%29%29%20%24%28%22sidebar%22%29.setAttribute%28%22context%22%2C%20%22inspect-context%22%29%3B%0A%0A//--------------------%20For%20Firefox%20prior%20to%20version%204%20--------------------//%0A%0Avar%20popups%20%3D%20popupset.getElementsByTagName%28%22popup%22%29%3B%0Afor%20%28var%20j%20%3D%200%3B%20j%20%3C%20popups.length%3B%20j++%29%20%7B%0A%20%20let%20popup%20%3D%20popups%5Bj%5D%3B%0A%20%20if%20%28%21popup.hasAttribute%28%22onclick%22%29%29%20%7B%0A%20%20%20%20popup.setAttribute%28%22onclick%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22if%20%28event.button%20%3D%3D%202%29%20%7B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20event.preventDefault%28%29%3B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20event.stopPropagation%28%29%3B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20inspectDOMNode%28event.target%29%3B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20closeMenus%28this%29%3B%20%7D%22%29%3B%0A%20%20%7D%0A%20%20if%20%28popup.parentNode%20%3D%3D%20popupset%29%20%7B%0A%20%20%20%20addInspector%28popup%2C%20id%20+%20popup.id%2C%20this.image%29%3B%0A%20%20%7D%0A%7D%0A%0Avar%20tabParent%20%3D%20null%3B%0Aif%20%28%22gBrowser%22%20in%20window%29%20%7B%0A%20%20tabParent%20%3D%20gBrowser%3B%0A%7D%20else%20if%20%28%24%28%22tabmail%22%29%29%20%7B%0A%20%20tabParent%20%3D%20%24%28%22tabmail%22%29%3B%0A%7D%0A%0A//%20Tab%20contextmenu%0Avar%20tabContext%20%3D%20document.getAnonymousElementByAttribute%28%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20tabParent%2C%20%22anonid%22%2C%20%22tabContextMenu%22%29%3B%0Aif%20%28tabContext%29%20%7B%0A%20%20addInspector%28tabContext%2C%20id%20+%20%22tabContextMenu%22%2C%20this.image%29%3B%0A%7D%0A%0A//%20Content%20contextmenu%0Aif%20%28%24%28%22context-inspect%22%29%29%20%7B%0A%20%20%24%28%22contentAreaContextMenu%22%29.insertBefore%28%24%28%22inspector-contentAreaContextMenu%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24%28%22context-inspect%22%29%29%3B%0A%7D%0A%0A///////////////////////////%20Begin%20Inspectomatic%20///////////////////////////%0A%0A/*%20*****%20BEGIN%20LICENSE%20BLOCK%20*****%0A%20*%20Version%3A%20MPL%201.1/GPL%202.0/LGPL%202.1%0A%20*%0A%20*%20The%20contents%20of%20this%20file%20are%20subject%20to%20the%20Mozilla%20Public%20License%20Version%0A%20*%201.1%20%28the%20%22License%22%29%3B%20you%20may%20not%20use%20this%20file%20except%20in%20compliance%20with%0A%20*%20the%20License.%20You%20may%20obtain%20a%20copy%20of%20the%20License%20at%0A%20*%20http%3A//www.mozilla.org/MPL/%0A%20*%0A%20*%20Software%20distributed%20under%20the%20License%20is%20distributed%20on%20an%20%22AS%20IS%22%20basis%2C%0A%20*%20WITHOUT%20WARRANTY%20OF%20ANY%20KIND%2C%20either%20express%20or%20implied.%20See%20the%20License%0A%20*%20for%20the%20specific%20language%20governing%20rights%20and%20limitations%20under%20the%0A%20*%20License.%0A%20*%0A%20*%20The%20Original%20Codes%20were%20mozEngineer%20and%20inspectThis%20for%20Phoenix%20browser.%0A%20*%0A%20*%20The%20Initial%20Developers%20of%20the%20Original%20Codes%20are%3A%0A%20*%20%20%20Joe%20Hewitt%20%20%20-%20mozEngineer%0A%20*%20%20%20Gilles%20Durys%20-%20inspectThis%0A%20*%0A%20*%20No%20portions%20of%20the%20Original%20Codes%20nor%20any%20portions%20of%20this%20Derivative%0A%20*%20Code%20are%20copyrighted.%0A%20*%0A%20*%20Contributor%28s%29%3A%0A%20*%20%20Patrick%20Thompson%20%28sailfish@unforgettable.com%29%0A%20*%20%20LouCypher%20%28modified%20for%20Custom%20Buttons%29%0A%20*%0A%20*%20Alternatively%2C%20the%20contents%20of%20this%20file%20may%20be%20used%20under%20the%20terms%20of%0A%20*%20either%20the%20GNU%20General%20Public%20License%20Version%202%20or%20later%20%28the%20%22GPL%22%29%2C%20or%0A%20*%20the%20GNU%20Lesser%20General%20Public%20License%20Version%202.1%20or%20later%20%28the%20%22LGPL%22%29%2C%0A%20*%20in%20which%20case%20the%20provisions%20of%20the%20GPL%20or%20the%20LGPL%20are%20applicable%20instead%0A%20*%20of%20those%20above.%20If%20you%20wish%20to%20allow%20use%20of%20your%20version%20of%20this%20file%20only%0A%20*%20under%20the%20terms%20of%20either%20the%20GPL%20or%20the%20LGPL%2C%20and%20not%20to%20allow%20others%20to%0A%20*%20use%20your%20version%20of%20this%20file%20under%20the%20terms%20of%20the%20MPL%2C%20indicate%20your%0A%20*%20decision%20by%20deleting%20the%20provisions%20above%20and%20replace%20them%20with%20the%20notice%0A%20*%20and%20other%20provisions%20required%20by%20the%20GPL%20or%20the%20LGPL.%20If%20you%20do%20not%20delete%0A%20*%20the%20provisions%20above%2C%20a%20recipient%20may%20use%20your%20version%20of%20this%20file%20under%0A%20*%20the%20terms%20of%20any%20one%20of%20the%20MPL%2C%20the%20GPL%20or%20the%20LGPL.%0A%20*%0A%20*%20*****%20END%20LICENSE%20BLOCK%20*****%20*/%0A%0Athis.Inspectomatic%20%3D%20%7B%0A%20%20mSelecting%3A%20false%2C%0A%20%20mSelectDocs%3A%20null%2C%0A%20%20mFlasher%3A%20null%2C%0A%0A%20%20selectByClick%3A%20function%28aDocument%29%20%7B%0A%20%20%20%20if%20%28this.mSelecting%29%20%7B%0A%20%20%20%20%20%20this.mSelecting%20%3D%20false%3B%0A%20%20%20%20%20%20this.removeClickListeners%28%29%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20this.mDocument%20%3D%20aDocument%3B%0A%20%20%20%20%20%20//%20wait%20until%20after%20user%20releases%20the%20mouse%0A%20%20%20%20%20%20//%20after%20selecting%20this%20command%20from%20a%20UI%20element%0A%20%20%20%20%20%20var%20event%20%3D%20%7B%0A%20%20%20%20%20%20%20%20notify%3A%20function%28timer%29%20%7B%20self.Inspectomatic.startSelectByClick%28%29%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20//%20Now%20it%20is%20time%20to%20create%20the%20timer...%20%20%0A%20%20%20%20var%20timer%20%3D%20Cc%5B%22@mozilla.org/timer%3B1%22%5D.createInstance%28Ci.nsITimer%29%3B%0A%0A%20%20%20%20//%20...%20and%20to%20initialize%20it%2C%20we%20want%20to%20call%20event.notify%28%29%20...%0A%20%20%20%20//%20...%20one%20time%20after%20exactly%20ten%20second.%20%0A%20%20%20%20%20%20timer.initWithCallback%28event%2C%201%2C%20Ci.nsITimer.TYPE_ONE_SHOT%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%20%20%0A%20%20startSelectByClick%3A%20function%28%29%20%7B%0A%20%20%20%20if%20%28%21this.mFlasher%29%0A%20%20%20%20%20%20this.mFlasher%20%3D%20Cc%5B%22@mozilla.org/inspector/flasher%3B1%22%5D.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20getService%28Ci.inIFlasher%29%3B%0A%0A%20%20%20%20this.mSelecting%20%3D%20true%3B%0A%20%20%20%20this.mSelectDocs%20%3D%20this.getAllDocuments%28this.mDocument%29%3B%0A%0A%20%20%20%20for%20%28var%20i%20%3D%200%3B%20i%20%3C%20this.mSelectDocs.length%3B%20++i%29%20%7B%0A%20%20%20%20%20%20this.mSelectDocs%5Bi%5D.addEventListener%28%22mousedown%22%2C%20this.onMouseDown%2C%20true%29%3B%0A%20%20%20%20%20%20this.mSelectDocs%5Bi%5D.addEventListener%28%22mouseup%22%2C%20this.onMouseUp%2C%20true%29%3B%0A%20%20%20%20%20%20this.mSelectDocs%5Bi%5D.addEventListener%28%22click%22%2C%20this.onClick%2C%20true%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%0A%20%20doSelectByClick%3A%20function%28aTarget%29%20%7B%0A%20%20%20%20if%20%28aTarget.nodeType%20%3D%3D%20Node.TEXT_NODE%29%0A%20%20%20%20%20%20aTarget%20%3D%20aTarget.parentNode%3B%0A%20%20%20%20%20%20%0A%20%20%20%20this.mSelecting%20%3D%20false%3B%0A%20%20%20%20%0A%20%20%20%20inspectDOMNode%28aTarget%29%3B%0A%20%20%7D%2C%0A%0A%20%20removeClickListeners%3A%20function%28%29%20%7B%0A%20%20%20%20for%20%28var%20i%20%3D%200%3B%20i%20%3C%20this.mSelectDocs.length%3B%20++i%29%20%7B%0A%20%20%20%20%20%20this.mSelectDocs%5Bi%5D.removeEventListener%28%22mousedown%22%2C%20this.onMouseDown%2C%20true%29%3B%0A%20%20%20%20%20%20this.mSelectDocs%5Bi%5D.removeEventListener%28%22mouseup%22%2C%20this.onMouseUp%2C%20true%29%3B%0A%20%20%20%20%20%20this.mSelectDocs%5Bi%5D.removeEventListener%28%22click%22%2C%20this.onClick%2C%20true%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%0A%20%20////////////////////////////////////////////////////////////////////////////%0A%20%20////%20Listeners%0A%0A%20%20onMouseDown%3A%20function%28aEvent%29%20%7B%0A%20%20%20%20aEvent.stopPropagation%28%29%3B%0A%20%20%20%20aEvent.preventDefault%28%29%3B%0A%0A%20%20%20%20var%20node%20%3D%20aEvent.target%3B%0A%20%20%20%20while%20%28node%20%26%26%20node.nodeType%20%21%3D%20Node.ELEMENT_NODE%29%0A%20%20%20%20%20%20node%20%3D%20node.parentNode%3B%0A%0A%20%20%20%20this.mCurrentNode%20%3D%20node%3B%0A%20%20%20%20self.Inspectomatic.mFlasher.drawElementOutline%28node%2C%20%22aa0000%22%2C%204%2C%20true%29%3B%0A%20%20%7D%2C%0A%20%20%0A%20%20onMouseUp%3A%20function%28aEvent%29%20%7B%0A%20%20%20%20aEvent.stopPropagation%28%29%3B%0A%20%20%20%20aEvent.preventDefault%28%29%3B%0A%0A%20%20%20%20self.Inspectomatic.mFlasher.repaintElement%28this.mCurrentNode%29%3B%0A%20%20%7D%2C%0A%0A%20%20onClick%3A%20function%28aEvent%29%20%7B%0A%20%20%20%20aEvent.stopPropagation%28%29%3B%0A%20%20%20%20aEvent.preventDefault%28%29%3B%0A%0A%20%20%20%20self.Inspectomatic.doSelectByClick%28aEvent.target%29%3B%0A%20%20%20%20self.Inspectomatic.removeClickListeners%28%29%3B%0A%20%20%7D%2C%0A%0A%20%20////////////////////////////////////////////////////////////////////////////%0A%20%20////%20Uncategorized%0A%20%20%0A%20%20getAllDocuments%3A%20function%28aDocument%29%20%7B%0A%20%20%20%20var%20results%20%3D%20%5BaDocument%5D%3B%0A%20%20%20%20this.findDocuments%28aDocument%2C%20results%29%3B%0A%20%20%20%20return%20results%3B%0A%20%20%7D%2C%0A%20%20%0A%20%20findDocuments%3A%20function%28aDoc%2C%20aArray%29%20%7B%0A%20%20%20%20this.addKidsToArray%28aDoc.getElementsByTagName%28%22frame%22%29%2C%20aArray%29%3B%0A%20%20%20%20this.addKidsToArray%28aDoc.getElementsByTagName%28%22iframe%22%29%2C%20aArray%29%3B%0A%20%20%20%20this.addKidsToArray%28aDoc.getElementsByTagNameNS%28xulns%2C%20%22browser%22%29%2C%20aArray%29%3B%0A%20%20%20%20this.addKidsToArray%28aDoc.getElementsByTagNameNS%28xulns%2C%20%22tabbrowser%22%29%2C%20aArray%29%3B%0A%20%20%20%20this.addKidsToArray%28aDoc.getElementsByTagNameNS%28xulns%2C%20%22editor%22%29%2C%20aArray%29%3B%0A%20%20%7D%2C%0A%20%20%0A%20%20addKidsToArray%3A%20function%28aKids%2C%20aArray%29%20%7B%0A%20%20%20%20for%20%28var%20i%20%3D%200%3B%20i%20%3C%20aKids.length%3B%20++i%29%20%7B%0A%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20if%20%28aKids%5Bi%5D.localName%20%3D%3D%20%22editor%22%29%0A%20%20%20%20%20%20%20%20%20%20aArray.push%28aKids%5Bi%5D.editorShell.editorDocument%29%3B%0A%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20aArray.push%28aKids%5Bi%5D.contentDocument%29%3B%0A%20%20%20%20%20%20%7D%20catch%20%28ex%29%20%7B%0A%20%20%20%20%20%20%20%20//%20if%20we%20can%27t%20access%20the%20content%20document%2C%20skip%20it%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%0A//--------------------------%20End%20Inspectomatic%20--------------------------//%0A%0A////////////////////////////%20Start%20WindowHook%20////////////////////////////%0A%0A/*%20%3A%3A%3A%3A%3A%3A%3A%3A%20WindowHook%20%3A%3A%3A%3A%3A%3A%3A%3A%20*/%0A//%20by%20Zeniko%20http%3A//forums.mozillazine.org/viewtopic.php%3Fp%3D2169699%23p2169699%0A%0Avar%20WindowHook%20%3D%20%7B%0A%20%20observe%3A%20function%28aSubject%2C%20aTopic%2C%20aData%29%20%7B%0A%20%20%20%20if%20%28%21aSubject.DOMI_WindowHook%29%20%7B%0A%20%20%20%20%20%20aSubject.DOMI_WindowHook%20%3D%20this%3B%0A%20%20%20%20%20%20aSubject.addEventListener%28%22load%22%2C%20this.onLoad_window%2C%20false%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%0A%20%20onLoad_window%3A%20function%28%29%20%7B%0A%20%20%20%20this.removeEventListener%28%22load%22%2C%20this.DOMI_WindowHook.onLoad_window%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20false%29%3B%0A%20%20%20%20var%20funcs%20%3D%20this.DOMI_WindowHook.mFuncs%5Bthis.document.location.href%5D%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20null%3B%0A%20%20%20%20if%20%28funcs%29%20%7B%20funcs.forEach%28function%28aFunc%29%20%7B%20aFunc%28this%29%20%7D%2C%20this%29%20%7D%0A%20%20%20%20delete%20this.DOMI_WindowHook%3B%0A%20%20%7D%2C%0A%0A%20%20register%3A%20function%28aURL%2C%20aFunc%29%20%7B%0A%20%20%20%20if%20%28%21this.mFuncs%29%20%7B%0A%20%20%20%20%20%20this.mFuncs%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20Cc%5B%22@mozilla.org/observer-service%3B1%22%5D.getService%28Ci.nsIObserverService%29.%0A%20%20%20%20%20%20addObserver%28this%2C%20%22domwindowopened%22%2C%20false%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20%28%21this.mFuncs%5BaURL%5D%29%20%7B%0A%20%20%20%20%20%20this.mFuncs%5BaURL%5D%20%3D%20%5B%5D%3B%0A%20%20%20%20%7D%0A%20%20%20%20this.mFuncs%5BaURL%5D.push%28aFunc%29%3B%0A%20%20%7D%0A%7D%0A%0A//%20About%20dialog%20for%20add-on%0AWindowHook.register%28%22chrome%3A//mozapps/content/extensions/about.xul%22%2C%0A%20%20function%28aWindow%29%20%7B%0A%20%20%20%20let%20popset%20%3D%20aWindow.document.createElement%28%22popupset%22%29%3B%0A%20%20%20%20let%20%7BdocumentElement%7D%20%3D%20aWindow.document%3B%0A%20%20%20%20documentElement.setAttribute%28%22context%22%2C%20%22inspect-context%22%29%3B%0A%20%20%20%20documentElement.appendChild%28popset%29%3B%0A%20%20%20%20popset.appendChild%28winContext.cloneNode%28true%29%29%3B%0A%20%20%20%20aWindow.inspectDOMNode%20%3D%20inspectDOMNode%3B%0A%20%20%7D%0A%29%0A%0A//%20Library%20%28Bookmarks%20and%20History%29%0AWindowHook.register%28%22chrome%3A//browser/content/places/places.xul%22%2C%0A%20%20function%28aWindow%29%20%7B%0A%20%20%20%20let%20pop%20%3D%20aWindow.document.getElementById%28%22placesContext%22%29%3B%0A%20%20%20%20addInspector%28pop%2C%20self.id%20+%20%22-inspector%22%2C%20self.image%29%3B%0A%20%20%20%20aWindow.inspectDOMNode%20%3D%20inspectDOMNode%3B%0A%20%20%20%20aWindow.inspectItem%20%3D%20function%20inspectItem%28aNode%29%20%7B%0A%20%20%20%20%20%20var%20view%20%3D%20PlacesUIUtils.getViewForNode%28aNode%29%3B%0A%20%20%20%20%20%20window.openDialog%28%22chrome%3A//inspector/content/object.xul%22%2C%20%22_blank%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22chrome%2Call%2Cdialog%3Dno%22%2C%20view.selectedNode%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20let%20inspectItem%20%3D%20pop.lastChild%3B%0A%20%20%20%20inspectItem.setAttribute%28%22label%22%2C%20%22Inspect%20Places%20Item%22%29%3B%0A%20%20%20%20inspectItem.setAttribute%28%22oncommand%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22inspectItem%28%27triggerNode%27%20in%20this.parentNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3F%20this.parentNode.triggerNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3A%20document.popupNode%29%3B%22%29%3B%0A%20%20%20%20let%20popset%20%3D%20aWindow.document.getElementById%28%22placesPopupset%22%29%3B%0A%20%20%20%20//%24xml%28popset%2C%20winContext%29%3B%0A%20%20%20%20popset.appendChild%28winContext.cloneNode%28true%29%29%3B%0A%20%20%20%20aWindow.document.documentElement%0A%20%20%20%20%20%20%20%20%20%20%20.setAttribute%28%22context%22%2C%20%22inspect-context%22%29%3B%0A%20%20%7D%0A%29%0A%0A//%20SeaMonkey%20Bookmarks%20Manager%0AWindowHook.register%28%22chrome%3A//communicator/content/bookmarks/bookmarksManager.xul%22%2C%0A%20%20function%28aWindow%29%20%7B%0A%20%20%20%20let%20pop%20%3D%20aWindow.document.getElementById%28%22placesContext%22%29%3B%0A%20%20%20%20addInspector%28pop%2C%20self.id%20+%20%22-inspector%22%2C%20self.image%29%3B%0A%20%20%20%20aWindow.inspectDOMNode%20%3D%20inspectDOMNode%3B%0A%20%20%20%20aWindow.inspectItem%20%3D%20function%20inspectItem%28aNode%29%20%7B%0A%20%20%20%20%20%20var%20view%20%3D%20PlacesUIUtils.getViewForNode%28aNode%29%3B%0A%20%20%20%20%20%20window.openDialog%28%22chrome%3A//inspector/content/object.xul%22%2C%20%22_blank%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22chrome%2Call%2Cdialog%3Dno%22%2C%20view.selectedNode%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20let%20inspectItem%20%3D%20pop.lastChild%3B%0A%20%20%20%20inspectItem.setAttribute%28%22label%22%2C%20%22Inspect%20Bookmark%20Item%22%29%3B%0A%20%20%20%20inspectItem.setAttribute%28%22oncommand%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22inspectItem%28%27triggerNode%27%20in%20this.parentNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3F%20this.parentNode.triggerNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3A%20document.popupNode%29%3B%22%29%3B%0A%20%20%20%20let%20popset%20%3D%20aWindow.document.getElementById%28%22placesPopupset%22%29%3B%0A%20%20%20%20//%24xml%28popset%2C%20winContext%29%3B%0A%20%20%20%20popset.appendChild%28winContext.cloneNode%28true%29%29%3B%0A%20%20%20%20aWindow.document.documentElement%0A%20%20%20%20%20%20%20%20%20%20%20.setAttribute%28%22context%22%2C%20%22inspect-context%22%29%3B%0A%20%20%7D%0A%29%0A%0A//%20SeaMonkey%20History%20window%0AWindowHook.register%28%22chrome%3A//communicator/content/history/history.xul%22%2C%0A%20%20function%28aWindow%29%20%7B%0A%20%20%20%20let%20pop%20%3D%20aWindow.document.getElementById%28%22placesContext%22%29%3B%0A%20%20%20%20addInspector%28pop%2C%20self.id%20+%20%22-inspector%22%2C%20self.image%29%3B%0A%20%20%20%20aWindow.inspectDOMNode%20%3D%20inspectDOMNode%3B%0A%20%20%20%20aWindow.inspectItem%20%3D%20function%20inspectItem%28aNode%29%20%7B%0A%20%20%20%20%20%20var%20view%20%3D%20PlacesUIUtils.getViewForNode%28aNode%29%3B%0A%20%20%20%20%20%20window.openDialog%28%22chrome%3A//inspector/content/object.xul%22%2C%20%22_blank%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22chrome%2Call%2Cdialog%3Dno%22%2C%20view.selectedNode%29%3B%0A%20%20%20%20%7D%0A%20%20%20%20let%20inspectItem%20%3D%20pop.lastChild%3B%0A%20%20%20%20inspectItem.setAttribute%28%22label%22%2C%20%22Inspect%20History%20Item%22%29%3B%0A%20%20%20%20inspectItem.setAttribute%28%22oncommand%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22inspectItem%28%27triggerNode%27%20in%20this.parentNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3F%20this.parentNode.triggerNode%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22%20%3A%20document.popupNode%29%3B%22%29%3B%0A%20%20%20%20let%20popset%20%3D%20aWindow.document.getElementById%28%22placesPopupset%22%29%3B%0A%20%20%20%20//%24xml%28popset%2C%20winContext%29%3B%0A%20%20%20%20popset.appendChild%28winContext.cloneNode%28true%29%29%3B%0A%20%20%20%20aWindow.document.documentElement%0A%20%20%20%20%20%20%20%20%20%20%20.setAttribute%28%22context%22%2C%20%22inspect-context%22%29%3B%0A%20%20%7D%0A%29%0A%0A%0A//%20Firefox%20Options%20dialog%0AWindowHook.register%28%22chrome%3A//browser/content/preferences/preferences.xul%22%2C%0A%20%20function%28aWindow%29%20%7B%0A%20%20%20%20let%20popset%20%3D%20aWindow.document.createElement%28%22popupset%22%29%3B%0A%20%20%20%20aWindow.document.documentElement.appendChild%28popset%29%3B%0A%20%20%20%20//%24xml%28popset%2C%20winContext%29%3B%0A%20%20%20%20popset.appendChild%28winContext.cloneNode%28true%29%29%3B%0A%20%20%20%20aWindow.document.documentElement%0A%20%20%20%20%20%20%20%20%20%20%20.setAttribute%28%22context%22%2C%20%22inspect-context%22%29%3B%0A%20%20%20%20aWindow.inspectDOMNode%20%3D%20inspectDOMNode%3B%0A%20%20%7D%0A%29%0A%0A//%20Thunderbird%20Options%20dialog%0A//%20by%20morat%0A//%20http%3A//custombuttons.sourceforge.net/forum/viewtopic.php%3Fp%3D301%23p301%0AWindowHook.register%28%22chrome%3A//messenger/content/preferences/preferences.xul%22%2C%0A%20%20function%28aWindow%29%20%7B%0A%20%20%20%20let%20popset%20%3D%20aWindow.document.createElement%28%22popupset%22%29%3B%0A%20%20%20%20aWindow.document.documentElement.appendChild%28popset%29%3B%0A%20%20%20%20//%24xml%28popset%2C%20winContext%29%3B%0A%20%20%20%20popset.appendChild%28winContext.cloneNode%28true%29%29%3B%0A%20%20%20%20aWindow.document.documentElement%0A%20%20%20%20%20%20%20%20%20%20%20.setAttribute%28%22context%22%2C%20%22inspect-context%22%29%3B%0A%20%20%20%20aWindow.inspectDOMNode%20%3D%20inspectDOMNode%3B%0A%20%20%7D%0A%29%0A%0A//%20Chatzilla%0AWindowHook.register%28%22chrome%3A//chatzilla/content/chatzilla.xul%22%2C%0A%20%20function%28aWindow%29%20%7B%0A%20%20%20%20let%20popset%20%3D%20aWindow.document.createElement%28%22popupset%22%29%3B%0A%20%20%20%20aWindow.document.documentElement.appendChild%28popset%29%3B%0A%20%20%20%20//%24xml%28popset%2C%20winContext%29%3B%0A%20%20%20%20popset.appendChild%28winContext.cloneNode%28true%29%29%3B%0A%20%20%20%20aWindow.document.documentElement%0A%20%20%20%20%20%20%20%20%20%20%20.setAttribute%28%22context%22%2C%20%22inspect-context%22%29%3B%0A%20%20%20%20aWindow.inspectDOMNode%20%3D%20inspectDOMNode%3B%0A%20%20%7D%0A%29%0A%0A/*%0A//%20Download%20Manager%0AWindowHook.register%28%22chrome%3A//mozapps/content/downloads/downloads.xul%22%2C%0A%20%20function%28aWindow%29%20%7B%0A%20%20%20%20let%20popset%20%3D%20aWindow.document.createElement%28%22popupset%22%29%3B%0A%20%20%20%20aWindow.document.documentElement.appendChild%28popset%29%3B%0A%20%20%20%20//%24xml%28popset%2C%20winContext%29%3B%0A%20%20%20%20popset.appendChild%28winContext%29%3B%0A%20%20%20%20aWindow.document.documentElement%0A%20%20%20%20%20%20%20%20%20%20%20.setAttribute%28%22context%22%2C%20%22inspect-context%22%29%3B%0A%20%20%20%20let%20pop%20%3D%20aWindow.document.getElementById%28%22downloadContextMenu%22%29%3B%0A%20%20%20%20pop.addEventListener%28%22popupshowing%22%2C%20appendInspector%20%3D%20function%28e%29%20%7B%0A%20%20%20%20%20%20addInspector%28e.target%2C%20self.id%20+%20%22-inspector%22%2C%20self.image%29%3B%0A%20%20%20%20%7D%2C%20false%29%3B%0A%20%20%20%20pop.removeEventListener%28%22popuphiding%22%2C%20appendInspector%2C%20false%29%3B%0A%20%20%20%20aWindow.inspectDOMNode%20%3D%20inspectDOMNode%3B%0A%20%20%7D%0A%29%0A*/%0A%0A/*%20End%20WindowHook%20*/%0A%0A//%20Remove%20contextmenu%20items%20when%20this%20button%20is%20deleted%0Athis.onDestroy%20%3D%20function%28reason%29%20%7B%0A%20%20%24%28kIDs%5B0%5D%29.parentNode.removeEventListener%28%22popupshowing%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initCbPopup%2C%20false%29%3B%0A%0A%20%20if%20%28reason%20%3D%3D%20%22delete%22%29%20%7B%0A%20%20%20%20document.documentElement.removeAttribute%28%22context%22%29%3B%0A%20%20%20%20%24%28%22sidebar%22%29.removeAttribute%28%22context%22%29%3B%0A%20%20%20%20var%20ms%20%3D%20document.querySelectorAll%28%22menuitem%5Bid%5E%3D%27%22%20+%20id%20+%20%22%27%5D%22%29%3B%0A%20%20%20%20LOG%28ms%29%3B%0A%20%20%20%20for%20%28var%20i%20%3D%20ms.length%20-%201%3B%20i%20%3E%3D%200%3B%20i--%29%20%7B%0A%20%20%20%20%20%20LOG%28ms%5Bi%5D.id%29%3B%0A%20%20%20%20%20%20removeNode%28ms%5Bi%5D.id%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%0A////////////////////////////////////////////////////////////////////////////%0A///////////////////////////%20Start%20Button%20updater%20///////////////////////////%0A%0A/*%20*****%20BEGIN%20LICENSE%20BLOCK%20*****%0A%20*%20Version%3A%20MPL%201.1/GPL%202.0%0A%20*%0A%20*%20The%20contents%20of%20this%20file%20are%20subject%20to%20the%20Mozilla%20Public%20License%0A%20*%20Version%201.1%20%28the%20%22License%22%29%3B%20you%20may%20not%20use%20this%20file%20except%20in%0A%20*%20compliance%20with%20the%20License.%20You%20may%20obtain%20a%20copy%20of%20the%20License%20at%0A%20*%20http%3A//www.mozilla.org/MPL/1.1/%0A%20*%0A%20*%20Software%20distributed%20under%20the%20License%20is%20distributed%20on%20an%20%22AS%20IS%22%20basis%2C%0A%20*%20WITHOUT%20WARRANTY%20OF%20ANY%20KIND%2C%20either%20express%20or%20implied.%20See%20the%20License%0A%20*%20for%20the%20specific%20language%20governing%20rights%20and%20limitations%20under%20the%0A%20*%20License.%0A%20*%0A%20*%20Original%20code%20is%20Button%20Updater%20for%20Custom%20Buttons%20extension%0A%20*%0A%20*%20The%20Initial%20Developer%20of%20the%20Original%20Code%20is%20LouCypher.%0A%20*%20Portions%20created%20by%20the%20Initial%20Developer%20are%20Copyright%20%28C%29%202011%0A%20*%20the%20Initial%20Developer.%20All%20Rights%20Reserved.%0A%20*%0A%20*%20Contributor%28s%29%3A%0A%20*%20-%20LouCypher%3A%20original%20code%0A%20*%0A%20*%20Alternatively%2C%20the%20contents%20of%20this%20file%20may%20be%20used%20under%20the%20terms%20of%0A%20*%20the%20GNU%20General%20Public%20License%20Version%202%20or%20later%20%28the%20%22GPL%22%29%2C%20in%20which%0A%20*%20case%20the%20provisions%20of%20the%20GPL%20are%20applicable%20instead%20of%20those%20above.%0A%20*%0A%20*%20*****%20END%20LICENSE%20BLOCK%20*****%20*/%0A%0Athis.updater%20%3D%20%7B%0A%20%20btnClick%3A%20self.onclick%2C%0A%20%20btnImage%3A%20self.image%2C%0A%20%20btnType%3A%20self.type%2C%0A%20%20btnTooltip%3A%20self.tooltipText%2C%0A%0A%20%20baseURL%3A%20%22https%3A//loucypher.googlecode.com/svn/custombuttons/xml/%22%2C%0A%0A%20%20get%20updateURL%28%29%20%7B%0A%20%20%20%20return%20this.baseURL%20+%20encodeURIComponent%28self.name.replace%28/%28%5C/%7C%3A%29/g%2C%20%22-%22%29%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22.xml%22%3B%0A%20%20%7D%2C%0A%0A%20%20openUpdateURL%3A%20function%20updater_openUpdateURL%28%29%20%7B%0A%20%20%20%20switchToTabHavingURI%28this.updateURL%29%3B%0A%20%20%7D%2C%0A%0A%20%20get%20stdIcon%28%29%20%7B%0A%20%20%20%20var%20stdIcon%20%3D%20parseInt%28self.cbStdIcon.match%28/%5Cd/%29%29%3B%0A%20%20%20%20switch%20%28stdIcon%29%20%7B%0A%20%20%20%20%20%20%20case%204%3A%20return%20%22chrome%3A//custombuttons/skin/stdicons/bbutton.png%22%3B%0A%20%20%20%20%20%20%20case%203%3A%20return%20%22chrome%3A//custombuttons/skin/stdicons/gbutton.png%22%3B%0A%20%20%20%20%20%20%20case%202%3A%20return%20%22chrome%3A//custombuttons/skin/stdicons/rbutton.png%22%3B%0A%20%20%20%20%20%20default%3A%20return%20%22chrome%3A//custombuttons/skin/button.png%22%3B%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%0A%20%20get%20bsyIcon%28%29%20%7B%0A%20%20%20%20switch%20%28Application.id%29%20%7B%0A%20%20%20%20%20%20case%20%22%7Bec8030f7-c20a-464f-9b0e-13a3a9e97384%7D%22%3A%0A%20%20%20%20%20%20%20%20if%20%28Application.version%20%3E%3D%20%224%22%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20%22chrome%3A//browser/skin/tabbrowser/connecting.png%22%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20%22chrome%3A//global/skin/icons/loading_16.png%22%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20case%20%22%7B92650c4d-4b8e-4d2a-b7eb-24ecf4f6b63a%7D%22%3A%0A%20%20%20%20%20%20%20%20return%20%22chrome%3A//communicator/skin/icons/loading.gif%22%3B%0A%20%20%20%20%20%20default%3A%0A%20%20%20%20%20%20%20%20return%20%22chrome%3A//global/skin/icons/loading_16.png%22%3B%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%0A%20%20//%20Check%20if%20the%20URI%20is%20Custom%20Button%20URI%20%28custombutton%3A//...%29%0A%20%20isValidCbURI%3A%20function%20updater_isValidCbURI%28aURL%29%20%7B%0A%20%20%20%20if%20%28%21aURL%29%20return%20false%3B%0A%20%20%20%20return%20/%5Ecustombutton%5C%3A%5C/%5C//.test%28aURL%29%3B%0A%20%20%7D%2C%0A%0A%20%20//%20Convert%20%27custombutton%3A%27%20URI%20to%20DOM%0A%20%20convertURItoDOM%3A%20function%20updater_convertURItoDOM%28aURL%29%20%7B%0A%20%20%20%20if%20%28%21this.isValidCbURI%28aURL%29%29%20%7B%0A%20%20%20%20%20%20custombuttons.alertBox%28self.name%2C%20%22Not%20a%20Custom%20Buttons%20link%21%22%29%3B%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%20%20%20%20var%20string%20%3D%20unescape%28aURL.replace%28/%5Ecustombutton%5C%3A%5C/%5C//%2C%20%22%22%29.toString%28%29%29%3B%0A%20%20%20%20var%20parser%20%3D%20new%20DOMParser%28%29%3B%0A%20%20%20%20var%20dom%20%3D%20parser.parseFromString%28string%2C%20%22text/xml%22%29%3B%0A%20%20%20%20if%20%28dom.documentElement.nodeName%20%3D%3D%20%22parsererror%22%29%20%7B%0A%20%20%20%20%20%20return%20null%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20return%20dom.documentElement%3B%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%0A%20%20//%20Get%20value%20from%20XML%20element%0A%20%20getParamValue%3A%20function%20updater_getParamValue%28aDocument%2C%20aNodeName%29%20%7B%0A%20%20%20%20var%20node%20%3D%20aDocument.querySelector%28aNodeName%29%3B%0A%20%20%20%20if%20%28%21node%29%20return%20%22%22%3B%0A%20%20%20%20if%20%28%21node.firstChild%20%7C%7C%20%28node.firstChild%20%26%26%0A%20%20%20%20%20%20%20%20%28node.firstChild.nodeType%20%3D%3D%20node.TEXT_NODE%29%29%29%20%7B%0A%20%20%20%20%20%20return%20node.textContent%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20return%20node.firstChild.textContent%3B%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%0A%20%20//%20Set%20button%20parameters%20from%20XML%20alement%0A%20%20getButtonParameters%3A%20function%20updater_getButtonParameters%28aButtonLink%2C%20aURL%29%20%7B%0A%20%20%20%20var%20dom%20%3D%20this.convertURItoDOM%28aURL%29%3B%0A%20%20%20%20var%20params%20%3D%20custombuttons.cbService.getButtonParameters%28aButtonLink%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.wrappedJSObject%3B%0A%20%20%20%20params.name%20%20%20%20%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22name%22%29%0A%20%20%20%20params.date%20%20%20%20%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22date%22%29%20%7C%7C%20%22%22%3B%0A%20%20%20%20params.image%20%20%20%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22image%22%29%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.getParamValue%28dom%2C%20%22stdicon%22%29%3B%0A%20%20%20%20params.code%20%20%20%20%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22code%22%29%0A%20%20%20%20params.initCode%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22initcode%22%29%0A%20%20%20%20params.help%20%20%20%20%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22help%22%29%0A%20%20%20%20params.accelkey%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22accelkey%22%29%0A%20%20%20%20params.mode%20%20%20%20%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22mode%22%29%0A%20%20%20%20params.wrappedJSObject%20%20%3D%20params%3B%0A%20%20%20%20return%20params%3B%0A%20%20%7D%2C%0A%0A%20%20//%20Reset%20button%20attribute%20if%20user%20click%20the%20button%20during%20update%0A%20%20resetAttributes%3A%20function%20updater_resetAttributes%28%29%20%7B%0A%20%20%20%20self.image%20%3D%20this.btnImage%3B%0A%20%20%20%20self.tooltipText%20%3D%20self.name%3B%0A%20%20%20%20self.removeAttribute%28%22busy%22%29%3B%0A%20%20%20%20self.onclick%20%3D%20this.btnClick%3B%0A%20%20%20%20self.type%20%3D%20this.btnType%3B%0A%20%20%20%20self.tooltipText%20%3D%20this.btnTooltip%3B%0A%20%20%7D%2C%0A%0A%20%20//%20Check%20button%20for%20update%0A%20%20checkForUpdate%3A%20function%20updater_checkForUpdate%28aCallback%29%20%7B%0A%20%20%20%20if%20%28%21navigator.onLine%29%20%7B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20browser%20is%20in%20offline%20mode%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20ask%20to%20switch%20to%20online%0A%20%20%20%20%20%20var%20online%20%3D%20custombuttons.confirmBox%28self.name%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Firefox%20is%20currently%20in%20offline%20mode.%5Cn%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%22Switch%20to%20online%20mode%20and%20try%20again%3F%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Yes%22%2C%20%22No%22%29%3B%0A%20%20%20%20%20%20if%20%28%21online%29%20return%3B%0A%20%20%20%20%20%20BrowserOffline.toggleOfflineStatus%28%29%3B%20//%20switch%20to%20online%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20url%20%3D%20this.updateURL%20+%20%22%3F%22%20+%20Date.now%28%29%3B%0A%20%20%20%20var%20req%20%3D%20new%20XMLHttpRequest%28%29%3B%0A%20%20%20%20req.open%28%22GET%22%2C%20url%2C%20true%29%3B%0A%20%20%20%20if%20%28self.hasAttribute%28%22busy%22%29%29%20%7B%0A%20%20%20%20%20%20this.resetAttributes%28%29%3B%0A%20%20%20%20%20%20return%0A%20%20%20%20%7D%0A%20%20%20%20var%20updater%20%3D%20this%3B%0A%20%20%20%20req.onreadystatechange%20%3D%20function%20%28aEvent%29%20%7B%0A%20%20%20%20%20%20self.onclick%20%3D%20function%28aEvent%29%20%7B%0A%20%20%20%20%20%20%20%20aEvent.preventDefault%28%29%3B%0A%20%20%20%20%20%20%20%20req.abort%28%29%3B%0A%20%20%20%20%20%20%20%20self.updater.resetAttributes%28%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20self.image%20%3D%20updater.bsyIcon%3B%0A%20%20%20%20%20%20self.setAttribute%28%22busy%22%2C%20%22%22%29%3B%0A%20%20%20%20%20%20self.removeAttribute%28%22type%22%29%3B%0A%20%20%20%20%20%20self.tooltipText%20%3D%20%22Checking%20for%20update...%5CnClick%20to%20abort.%22%3B%0A%20%20%20%20%20%20if%20%28req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200%29%20%7B%0A%20%20%20%20%20%20%20%20updater.resetAttributes%28%29%3B%0A%20%20%20%20%20%20%20%20aCallback%28req.responseXML%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20req.send%28null%29%3B%0A%20%20%7D%2C%0A%0A%20%20//%20Get%20update%20from%20XML%0A%20%20getUpdate%3A%20function%20updater_getUpdate%28aDocument%29%20%7B%0A%20%20%20%20if%20%28aDocument.documentElement.localName%20%21%3D%20%22custombutton%22%29%20%7B%0A%20%20%20%20%20%20custombuttons.alertBox%28self.name%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Not%20a%20valid%20Custom%20Buttons%20XML%20file%21%22%29%3B%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20//inspectDOMDocument%28aDocument%29%3B%20return%3B%0A%20%20%20%20let%20icon%20%3D%20self.updater.btnImage%20%3F%20self.updater.btnImage%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20self.updater.stdIcon%3B%0A%20%20%20%20let%20button%20%3D%20aDocument.getElementById%28%22button%22%29%3B%0A%20%20%20%20let%20link%20%3D%20button.getElementsByTagNameNS%28xhtmlns%2C%20%22a%22%29%5B0%5D%3B%0A%20%20%20%20if%20%28link.href%20%3D%3D%20self.URI%29%20%7B%0A%20%20%20%20%20%20let%20as%20%3D%20Cc%5B%27@mozilla.org/alerts-service%3B1%27%5D.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20getService%28Ci.nsIAlertsService%29%3B%0A%20%20%20%20%20%20as.showAlertNotification%28icon%2C%20%22No%20update%20found%21%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Finish%20checking%22%2C%20false%2C%20%22%22%2C%20null%29%3B%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%20%0A%0A%20%20%20%20var%20install%20%3D%20custombuttons.confirmBox%28self.name%2C%20%22Update%20found%21%20%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Update%20this%20button%3F%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Yes%22%2C%20%22No%22%29%3B%0A%20%20%20%20if%20%28%21install%29%20return%3B%0A%20%20%20%20let%20btnLink%20%3D%20custombuttons.makeButtonLink%28%22update%22%2C%20self.id%29%3B%0A%20%20%20%20let%20params%20%3D%20self.updater.getButtonParameters%28btnLink%2C%20link.href%29%3B%0A%20%20%20%20//inspectObject%28params%29%3B%20return%3B%0A%20%20%20%20custombuttons.cbService.installButton%28params%29%3B%0A%20%20%20%20custombuttons.alertBox%28self.name%2C%20%22Button%20updated%21%22%29%3B%0A%20%20%20%20self.setAttribute%28%22cb-edit-state%22%2C%20%22active%22%29%3B%0A%20%20%7D%2C%0A%0A%20%20init%3A%20function%20updater_onLoad%28%29%20%7B%0A%0A%20%20%20%20var%20icon%20%3D%20this.btnImage%20%3F%20this.btnImage%20%3A%20this.stdIcon%3B%0A%0A%20%20%20%20function%20%24%28aId%29%20%7B%0A%20%20%20%20%20%20return%20document.getElementById%28aId%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20addMenuItem%28aNewIDs%2C%20aNodeIDs%2C%20aSeparator%29%20%7B%0A%20%20%20%20%20%20//%20Remove%20previously%20created%20menuitems%20if%20any%0A%20%20%20%20%20%20if%20%28%24%28aNewIDs%29%29%20%7B%0A%20%20%20%20%20%20%20%20if%20%28aSeparator%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%28%24%28aNewIDs%29.nextSibling.localName%20%3D%3D%20%22menuseparator%22%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%24%28aNewIDs%29.parentNode.removeChild%28%24%28aNewIDs%29.nextSibling%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%24%28aNewIDs%29.parentNode.removeChild%28%24%28aNewIDs%29%29%3B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20var%20mi%20%3D%20makeXML%28%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27%3Cmenuitem%20xmlns%3D%22%27%20+%20xulns%20+%20%27%22%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%27%20id%3D%22%27%20+%20aNewIDs%20+%20%27%22%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%27%20class%3D%22menuitem-iconic%22%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%27%20image%3D%22%27%20+%20icon%20+%20%27%22%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%27%20label%3D%22Check%20for%20updates%20for%20this%20button%22%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%27%20onclick%3D%22if%20%28event.button%20%3D%3D%201%29%20%7B%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%27%20var%20btn%20%3D%20document.getElementById%28%5C%27%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20self.id%20+%20%27%5C%27%29%3B%20btn.updater.openUpdateURL%28%29%3B%20%7D%22%20%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%27%20oncommand%3D%22var%20btn%20%3D%20document.getElementById%28%5C%27%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20self.id%20+%20%27%5C%27%29%3B%20btn.updater.checkForUpdate%28%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%27btn.updater.getUpdate%29%3B%22%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%27%20observes%3D%22custombuttons-contextbroadcaster-primary%22/%3E%27%29%3B%0A%20%20%20%20%20%20%24%28aNodeIDs%29.parentNode.insertBefore%28mi%2C%20%24%28aNodeIDs%29.nextSibling%29%3B%0A%20%20%20%20%20%20if%20%28aSeparator%29%20%7B%0A%20%20%20%20%20%20%20%20var%20sep%20%3D%20makeXML%28%27%3Cmenuseparator%20xmlns%3D%22%27%20+%20xulns%20+%20%27%22%27%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%20%27%20id%3D%22%27%20+%20mi.id%20+%20%27-separator%22/%3E%27%29%3B%0A%20%20%20%20%20%20%20%20mi.parentNode.insertBefore%28sep%2C%20mi.nextSibling%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20initUpdaterCbPopup%28aEvent%29%20%7B%0A%20%20%20%20%20%20var%20popupNode%20%3D%20%22triggerNode%22%20in%20aEvent.target%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3F%20aEvent.target.triggerNode%20%3A%20document.popupNode%3B%0A%20%20%20%20%20%20%24%28kIDs%29.hidden%20%3D%20%28popupNode%20%21%3D%20self%29%3B%0A%20%20%20%20%20%20%28%24%28kIDs%29.nextSibling.id%20%3D%3D%20%24%28kIDs%29.id%20+%20%22-separator%22%29%20%26%26%0A%20%20%20%20%20%20%28%24%28kIDs%29.nextSibling.hidden%20%3D%20%28popupNode%20%21%3D%20self%29%29%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20kIDs%20%3D%20self.id%20+%20%22-checkForUpdate%22%3B%0A%20%20%20%20var%20uIDs%20%3D%20%22custombuttons-contextpopup-updateButton%22%3B%0A%0A%20%20%20%20//%20Add%20%27Check%20for%20Update...%27%20menuitem%20to%20CB%20contextmenu%0A%20%20%20%20addMenuItem%28kIDs%2C%20uIDs%2C%20true%29%3B%0A%0A%20%20%20%20%24%28uIDs%29.parentNode.addEventListener%28%22popupshowing%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initUpdaterCbPopup%2C%20false%29%3B%0A%20%20%20%20%24%28uIDs%29.parentNode.removeEventListener%28%22popuphiding%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initUpdaterCbPopup%2C%20false%29%3B%0A%0A%20%20%20%20self.onDestroy%20%3D%20function%28aReason%29%20%7B%0A%20%20%20%20%20%20if%20%28aReason%20%21%3D%20%22delete%22%29%20return%3B%0A%20%20%20%20%20%20%24%28uIDs%29.parentNode.removeEventListener%28%22popupshowing%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20initUpdaterCbPopup%2C%20false%29%3B%0A%20%20%20%20%20%20%24%28kIDs%29.parentNode.removeChild%28%24%28kIDs%20+%20%22-separator%22%29%29%3B%0A%20%20%20%20%20%20%24%28kIDs%29.parentNode.removeChild%28%24%28kIDs%29%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%0Athis.updater.init%28%29%3B%0A%0A////////////////////////////%20End%20Button%20updater%20////////////////////////////%0A////////////////////////////////////////////////////////////////////////////%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5B/*%20----------------------------------------------------------------%0A%20%20%20%20%20DOM%20Inspector%0A%0A%20%20%20%20%20Idea%20for%20this%20button%20was%20taken%20from%0A%20%20%20%20%20InspectorWidget%20extension%20by%20Sailfish%0A%20%20%20%20%20https%3A//addons.mozilla.org/firefox/63/%0A%20%20%20----------------------------------------------------------------%20*/%0A%0A%0A//%20Check%20if%20DOMI%20is%20available%0Aif%20%28typeof%20inspectObject%20%21%3D%20%22function%22%29%20%7B%0A%20%20AddonManager.getAddonByID%28%22inspector@mozilla.org%22%2C%20function%28addon%29%20%7B%0A%20%20%20%20let%20msg%20%3D%20%22This%20button%20requires%20DOM%20Inspector%20extension.%5Cn%22%3B%0A%20%20%20%20if%20%28addon%29%20%7B%20//%20If%20DOMI%20is%20installed%0A%20%20%20%20%20%20addon.userDisabled%20%3D%20false%3B%20//%20enable%20it%0A%20%20%20%20%20%20//%20Ask%20to%20restart%0A%20%20%20%20%20%20let%20restart%20%3D%20custombuttons.confirmBox%28self.name%2C%20msg%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20addon.name%20+%20%22%20will%20be%20enabled%20after%20you%20restart%20%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Application.name%20+%20%22.%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Restart%20now%22%2C%20%22Undo%22%29%3B%0A%20%20%20%20%20%20if%20%28restart%29%20%7B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20%27Yes%27%0A%20%20%20%20%20%20%20%20Application.restart%28%29%3B%20%20%20%20%20%20//%20restart%20application%0A%20%20%20%20%20%20%20%20return%20true%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20else%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20If%20%27No%27%0A%20%20%20%20%20%20%09addon.userDisabled%20%3D%20true%3B%20%20//%20disable%20DOMI%0A%20%20%20%20%7D%0A%20%20%20%20else%20%7B%20%20//%20If%20DOMI%20is%20not%20installed%0A%20%20%20%20%20%20//%20Ask%20to%20install%0A%20%20%20%20%20%20let%20install%20%3D%20custombuttons.confirmBox%28self.name%2C%20msg%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Install%20DOM%20Inspector%20from%20Mozilla%20Add-ons%3F%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Install%22%2C%20%22Cancel%22%29%3B%0A%20%20%20%20%20%20if%20%28%21install%29%0A%20%20%20%20%20%20%20%20return%20false%3B%0A%0A%20%20%20%20%20%20//%20install%20DOMI%20latest%20version%20from%20AMO%0A%20%20%20%20%20%20loadURI%28%22https%3A//addons.mozilla.org/firefox/downloads/latest/dom-inspector-6622/%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%3Fsrc%3Dexternal-LouCypher%22%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%29%0A%20%20return%20false%3B%0A%7D%0A%0Aif%20%28this.checkInspectomatic%28%29%29%20%7B%0A%20%20if%20%28event.target.id%20%3D%3D%20this.id%29%20%7B%0A%20%20%20%20this.Inspectomatic.selectByClick%28document%29%3B%0A%20%20%7D%0A%20%20return%3B%0A%7D%0A%0Athis.inspectWin%28%29%3B%0A%0A%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B*%20left%20click%20button%20-%20inspect%20content%20document%0A*%20middle%20click%20button%20-%20inspect%20chrome%20document%0A*%20right%20click%20button%20-%20open%20custom%20button%20context%20popup%0A*%20left%20click%20inspect%20element%20-%20inspect%20dom%20node%0A*%20middle%20click%20inspect%20element%20-%20inspect%20javascript%20object%0A%0Adisable%20inspectomatic%20%28default%29%0A%0A*%20left%20click%20%23%20window%20title%20-%20inspect%20chrome%20document%0A%0Aenable%20inspectomatic%0A%0A*%20left%20click%20%23%20window%20title%20-%20enable%20the%20next%20mouse%20click%20to%20inspect%20dom%20node%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" rel="nofollow" title="Install DOM Inspector">
        <![CDATA[Install this button]]>
        </html:a>
      </html:div>
      <html:a href="https://addons.mozilla.org/addon/custom-buttons/?src=external-custombuttons-xml">
        <![CDATA[What's this?]]>
      </html:a>
      <html:div id="credits">
        <html:a href="http://custombuttons.sourceforge.net/forum/viewtopic.php?t=78#p197">
          <![CDATA[Custom Buttons XML]]><html:br/><![CDATA[Exporter/Importer]]>
        </html:a>
      </html:div>
    </html:div>
  </html:body>
  <name>DOM Inspector</name>
  <image><![CDATA[data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAB3RJTUUH1QgECxw1jaSNNQAAAAlwSFlzAAAK8AAACvABQqw0mAAAADBQTFRFAAAA/wAA/20A/4UA/60AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwJ3q+AAAAEFJREFUeNpjYIABFhcwcAAxGBggDAYlJQYwg0lJSQHEcFACAhZ0hhEKA6jYWACunQVqoAODA9QKuF0OcEvhjmAAAOEEEW5k07z8AAAAAElFTkSuQmCC]]></image>
  <mode>0</mode>
  <initcode><![CDATA[// Check if DOMI is available
if (typeof inspectDOMDocument != "function") {
  var domi = "DOM Inspector"
  // Change button tooltip
  this.tooltipText = this.name + " button requires " + domi + " extension.\n"
                   + "Click the button to "
  AddonManager.getAddonByID("inspector@mozilla.org", function(addon) {
    if (addon) // If DOMI is installed
      self.tooltipText += "enable " + domi + ".";   // change button tooltip
    else  // If DOMI is not installed
      self.tooltipText += "install " + domi + ".";  // change button tooltip

    self.Help = self.tooltipText; // Change button help text
  })
  return false;
}

this.tooltipText = "\n" + this.name + "\n\n" + this.Help +"\n\n";
this.tooltipProp = this.tooltipText;
this.className = "";

function $(aId) {
  return document.getElementById(aId);
}

function makeXML(aXMLString) {
  return (new DOMParser).parseFromString(aXMLString, "application/xml")
                        .documentElement;
}

function $xml(aNode, aXML) {
  aNode.appendChild(makeXML(aXML));
}

if (typeof closeMenus != "function") {
  closeMenus = function closeMenus(node) {
    if ("tagName" in node) {
      if (node.namespaceURI == xulns &&
          (node.tagName == "menupopup" || node.tagName == "popup")) {
        node.hidePopup();
      }
      closeMenus(node.parentNode);
    }
  }
}

var inspectomatic = "custombuttons.DOMInspector.Inspectomatic.enable";

// Check if Inspectomatic is enabled (disabled by default)
this.checkInspectomatic = function() {
  try {
    return cbu.ps.getBoolPref(inspectomatic);
  } catch(ex) {
    return false;
  }
}

this.toggleInspectomatic = function() {
  cbu.ps.setBoolPref(inspectomatic, !this.checkInspectomatic())
}

// Append menuitems
function addItem(aNode, aLabel, aKey, aStatus, aValue) {
  /*$xml(aNode,
       <menuitem xmlns={xulns} label={aLabel} statustext={aStatus}
                 accesskey={aKey} value={aValue}
                 oncommand="this.parentNode.parentNode.inspectWin(event);"
                 onmouseover="this.parentNode.parentNode.setStatus(this.statusText);"
                 onmouseout="this.parentNode.parentNode.setStatus('');"/>);*/
  var m = aNode.appendChild(document.createElement("menuitem"));
  m.setAttribute("label", aLabel);
  m.statusText = aStatus;
  m.accessKey = aKey;
  m.value = aValue;
  m.setAttribute("oncommand", "this.parentNode.parentNode.inspectWin(event);");
  m.setAttribute("onmouseover", "this.parentNode.parentNode.setStatus(this.statusText);");
  m.setAttribute("onmouseout", "this.parentNode.parentNode.setStatus('');");
}

// Enumerate open windows
function getWindowEnumerator() {
  return Cc["@mozilla.org/embedcomp/window-watcher;1"].
         getService(Ci.nsIWindowWatcher).getWindowEnumerator();
}

// Display window URL on statusbar
this.setStatus = function(aString) {
  XULBrowserWindow.setOverLink(aString);
}

// Regenerate menuitems
this.popupShowing = function(aNode) {
  while (aNode.firstChild) {
    if (aNode.localName == "menuseparator") break;
    aNode.removeChild(aNode.firstChild);
  }
  var index = 1;
  var enumerator = getWindowEnumerator();
  while (enumerator.hasMoreElements()) {
    let win = enumerator.getNext();
    addItem(aNode, index + " " + win.document.title,
            index, win.location, index++);
  }
  // Add Options menu
  /*$xml(aNode, <menuseparator xmlns={xulns}/>);
  $xml(aNode, <menuitem xmlns={xulns}
                        label="Enable Inspectomatic" type="checkbox"
                        oncommand={"this.parentNode.parentNode." +
                                   "toggleInspectomatic();"}/>);*/
  var sep = aNode.appendChild(document.createElement("menuseparator"));
  sep.id = this.id + "-separator";
  var mi = aNode.appendChild(document.createElement("menuitem"));
  mi.label="Enable Inspectomatic";
  mi.type="checkbox";
  mi.setAttribute("oncomand", "this.parentNode.parentNode.toggleInspectomatic();");
  aNode.lastChild.setAttribute("checked", this.checkInspectomatic());
}

// Inspect document/window
this.inspectWin = function(aEvent) {
  if (aEvent) {
    if (aEvent.target.nodeName != "toolbarbutton") {
      var windowIndex = parseInt(aEvent.target.getAttribute("value"));
      var enumerator = getWindowEnumerator();
      var index = 1;
      while (enumerator.hasMoreElements()) {
        let win = enumerator.getNext();
        if (index++ == windowIndex) {
          if (this.checkInspectomatic()) {
            this.Inspectomatic.selectByClick(win.document);
            win.focus();
          } else {
            inspectDOMDocument(win.document);
          }
          return;
        }
      }
    }
  } else {
    // Inspect document in active tab
    inspectDOMDocument(content.document);
  }
}

// Middle click to inspect chrome document instead of content
this.onclick = function(aEvent) {
  if ((aEvent.button != 1) || (aEvent.target.id != this.id)) return;
  if (this.checkInspectomatic()) {
    inspectDOMDocument(content.document);
  } else {
    inspectDOMDocument(document.documentElement);
  }
}

/*$xml(this, <menupopup xmlns={xulns} context="toolbar-context-menu"
                      onpopupshowing="this.parentNode.popupShowing(this);"
                      onmouseout="event.stopPropagation();"
                      oncommand="event.stopPropagation();"/>);*/
var mp = this.appendChild(document.createElement("menupopup"));
mp.setAttribute("context", "toolbar-context-menu");
mp.setAttribute("onpopupshowing", "this.parentNode.popupShowing(this);");
mp.setAttribute("onmouseout", "event.stopPropagation();");
mp.setAttribute("oncommand", "event.stopPropagation();");
this.type = "menu-button";


//------------------------- Add "Inspect Element" -------------------------//

// Remove element if it exists
function removeNode(aId) {
  var node = $(aId);
  if (node) {
    node.parentNode.removeChild(node);
  }
}

// Append menuitem into a menupopup
function addInspector(aMenupopup, aId, aImage) {
  // Remove previously created menuitem
  // to avoid duplicate during button initiation
  removeNode(aId);

  // Create a new one
  /*$xml(aMenupopup,
       <menuitem xmlns={xulns} id={aId}
                 class="menuitem-iconic"
                 image={aImage}
                 label="Inspect Element"
                 oncommand={"inspectDOMNode('triggerNode' in this.parentNode"
                          + " ? this.parentNode.triggerNode"
                          + " : document.popupNode);"}
                 onclick={"if (event.button == 1) { inspectObject("
                        + "'triggerNode' in this.parentNode"
                        + " ? this.parentNode.triggerNode"
                        + " : document.popupNode); "
                        + "closeMenus(this); }"}/>);*/
  var mi = aMenupopup.appendChild(document.createElement("menuitem"));
  mi.id = aId;
  mi.className = "menuitem-iconic";
  mi.setAttribute("image", aImage);
  mi.setAttribute("label", "Inspect Element");
  mi.setAttribute("oncommand", "inspectDOMNode('triggerNode' in this.parentNode"
                             + " ? this.parentNode.triggerNode"
                             + " : document.popupNode);");
  mi.setAttribute("onclick", "if (event.button == 1) { inspectObject("
                           + "'triggerNode' in this.parentNode"
                           + " ? this.parentNode.triggerNode"
                           + " : document.popupNode); "
                           + "closeMenus(this); }");
}

function initMenupopups(aMenupopups, aButton) {
  if (!aMenupopups.length) return;
  for (let i = 0; i < aMenupopups.length; i++) {
    let menupopup = aMenupopups[i];
    if (!menupopup.hasAttribute("onclick") &&
        (menupopup.id != "stylish-popup")) {
      menupopup.setAttribute("onclick",
                             "if (event.button == 2) {" +
                             " event.preventDefault();" +
                             " event.stopPropagation();" +
                             " inspectDOMNode(event.target);" +
                             " closeMenus(this); }");
    }
    if (((menupopup.parentNode == popupset) ||
         (menupopup.parentNode == document.documentElement)) &&
        (!/^stylish/.test(menupopup.id))) {
      addInspector(menupopup, id + menupopup.id, aButton.image);
    }
  }
}

var id = "inspector-";
var winId = document.documentElement.id;
var popupsets = document.querySelectorAll("#" + winId + " > popupset");
for (let i = 0; i < popupsets.length; i++) {
  var popupset = popupsets[i];
  initMenupopups(popupset.getElementsByTagName("menupopup"), this);
}

initMenupopups(document.querySelectorAll("#" + winId + " > menupopup"), this);

/*var winContext = <menupopup xmlns={xulns}
                            id="inspect-context"
                            onpopupshown={
                              "var popupNode = ('triggerNode' in this) "
                            + "? this.triggerNode : document.popupNode; "
                            + "if (popupNode.id == 'content') "
                            + " closeMenus(this);"
                            }>
                   <menuitem id="inspect-chrome"
                             class="menuitem-iconic"
                             image={this.image}
                             label="Inspect Element"
                             oncommand={"inspectDOMNode("
                                      + "'triggerNode' in this.parentNode "
                                      + "? this.parentNode.triggerNode "
                                      + ": document.popupNode)"}
                             onclick={"if (event.button == 1) { "
                                    + "inspectObject('triggerNode' in "
                                    + "this.parentNode ? this.parentNode."
                                    + "triggerNode : document.popupNode); "
                                    + "closeMenus(this); }"}/>
                 </menupopup>;*/

var winContext = document.createElement("menupopup");
winContext.id = "inspect-context";
winContext.setAttribute("onpopupshown",
                        "var popupNode = ('triggerNode' in this) "
                      + "? this.triggerNode : document.popupNode; "
                      + "if (popupNode.id == 'content') "
                      + " closeMenus(this);");

var mi = winContext.appendChild(document.createElement("menuitem"));
mi.id = "inspect-chrome";
mi.className = "menuitem-iconic";
mi.setAttribute("image", this.image);
mi.setAttribute("label", "Inspect Element");
mi.setAttribute("oncommand", "inspectDOMNode("
                           + "'triggerNode' in this.parentNode "
                           + "? this.parentNode.triggerNode "
                           + ": document.popupNode)");
mi.setAttribute("onclick", "if (event.button == 1) { "
                         + "inspectObject('triggerNode' in "
                         + "this.parentNode ? this.parentNode."
                         + "triggerNode : document.popupNode); "
                         + "closeMenus(this); }");

removeNode("inspect-context");

/*$xml((popupset.id == "mainPopupSet") ? popupset : document.documentElement,
     winContext);*/
((popupset.id == "mainPopupSet") ? popupset : document.documentElement).appendChild(winContext);

// main window
document.documentElement.setAttribute("context", "inspect-context");

// sidebar
if ($("sidebar")) $("sidebar").setAttribute("context", "inspect-context");

//-------------------- For Firefox prior to version 4 --------------------//

var popups = popupset.getElementsByTagName("popup");
for (var j = 0; j < popups.length; j++) {
  let popup = popups[j];
  if (!popup.hasAttribute("onclick")) {
    popup.setAttribute("onclick",
                       "if (event.button == 2) {" +
                       " event.preventDefault();" +
                       " event.stopPropagation();" +
                       " inspectDOMNode(event.target);" +
                       " closeMenus(this); }");
  }
  if (popup.parentNode == popupset) {
    addInspector(popup, id + popup.id, this.image);
  }
}

var tabParent = null;
if ("gBrowser" in window) {
  tabParent = gBrowser;
} else if ($("tabmail")) {
  tabParent = $("tabmail");
}

// Tab contextmenu
var tabContext = document.getAnonymousElementByAttribute(
                    tabParent, "anonid", "tabContextMenu");
if (tabContext) {
  addInspector(tabContext, id + "tabContextMenu", this.image);
}

// Content contextmenu
if ($("context-inspect")) {
  $("contentAreaContextMenu").insertBefore($("inspector-contentAreaContextMenu"),
                                           $("context-inspect"));
}

/////////////////////////// Begin Inspectomatic ///////////////////////////

/* ***** BEGIN LICENSE BLOCK *****
 * Version: MPL 1.1/GPL 2.0/LGPL 2.1
 *
 * The contents of this file are subject to the Mozilla Public License Version
 * 1.1 (the "License"); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 * http://www.mozilla.org/MPL/
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
 * for the specific language governing rights and limitations under the
 * License.
 *
 * The Original Codes were mozEngineer and inspectThis for Phoenix browser.
 *
 * The Initial Developers of the Original Codes are:
 *   Joe Hewitt   - mozEngineer
 *   Gilles Durys - inspectThis
 *
 * No portions of the Original Codes nor any portions of this Derivative
 * Code are copyrighted.
 *
 * Contributor(s):
 *  Patrick Thompson (sailfish@unforgettable.com)
 *  LouCypher (modified for Custom Buttons)
 *
 * Alternatively, the contents of this file may be used under the terms of
 * either the GNU General Public License Version 2 or later (the "GPL"), or
 * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
 * in which case the provisions of the GPL or the LGPL are applicable instead
 * of those above. If you wish to allow use of your version of this file only
 * under the terms of either the GPL or the LGPL, and not to allow others to
 * use your version of this file under the terms of the MPL, indicate your
 * decision by deleting the provisions above and replace them with the notice
 * and other provisions required by the GPL or the LGPL. If you do not delete
 * the provisions above, a recipient may use your version of this file under
 * the terms of any one of the MPL, the GPL or the LGPL.
 *
 * ***** END LICENSE BLOCK ***** */

this.Inspectomatic = {
  mSelecting: false,
  mSelectDocs: null,
  mFlasher: null,

  selectByClick: function(aDocument) {
    if (this.mSelecting) {
      this.mSelecting = false;
      this.removeClickListeners();
    } else {
      this.mDocument = aDocument;
      // wait until after user releases the mouse
      // after selecting this command from a UI element
      var event = {
        notify: function(timer) { self.Inspectomatic.startSelectByClick() }
      }

    // Now it is time to create the timer...  
    var timer = Cc["@mozilla.org/timer;1"].createInstance(Ci.nsITimer);

    // ... and to initialize it, we want to call event.notify() ...
    // ... one time after exactly ten second. 
      timer.initWithCallback(event, 1, Ci.nsITimer.TYPE_ONE_SHOT);
    }
  },
  
  startSelectByClick: function() {
    if (!this.mFlasher)
      this.mFlasher = Cc["@mozilla.org/inspector/flasher;1"].
                      getService(Ci.inIFlasher);

    this.mSelecting = true;
    this.mSelectDocs = this.getAllDocuments(this.mDocument);

    for (var i = 0; i < this.mSelectDocs.length; ++i) {
      this.mSelectDocs[i].addEventListener("mousedown", this.onMouseDown, true);
      this.mSelectDocs[i].addEventListener("mouseup", this.onMouseUp, true);
      this.mSelectDocs[i].addEventListener("click", this.onClick, true);
    }
  },

  doSelectByClick: function(aTarget) {
    if (aTarget.nodeType == Node.TEXT_NODE)
      aTarget = aTarget.parentNode;
      
    this.mSelecting = false;
    
    inspectDOMNode(aTarget);
  },

  removeClickListeners: function() {
    for (var i = 0; i < this.mSelectDocs.length; ++i) {
      this.mSelectDocs[i].removeEventListener("mousedown", this.onMouseDown, true);
      this.mSelectDocs[i].removeEventListener("mouseup", this.onMouseUp, true);
      this.mSelectDocs[i].removeEventListener("click", this.onClick, true);
    }
  },

  ////////////////////////////////////////////////////////////////////////////
  //// Listeners

  onMouseDown: function(aEvent) {
    aEvent.stopPropagation();
    aEvent.preventDefault();

    var node = aEvent.target;
    while (node && node.nodeType != Node.ELEMENT_NODE)
      node = node.parentNode;

    this.mCurrentNode = node;
    self.Inspectomatic.mFlasher.drawElementOutline(node, "aa0000", 4, true);
  },
  
  onMouseUp: function(aEvent) {
    aEvent.stopPropagation();
    aEvent.preventDefault();

    self.Inspectomatic.mFlasher.repaintElement(this.mCurrentNode);
  },

  onClick: function(aEvent) {
    aEvent.stopPropagation();
    aEvent.preventDefault();

    self.Inspectomatic.doSelectByClick(aEvent.target);
    self.Inspectomatic.removeClickListeners();
  },

  ////////////////////////////////////////////////////////////////////////////
  //// Uncategorized
  
  getAllDocuments: function(aDocument) {
    var results = [aDocument];
    this.findDocuments(aDocument, results);
    return results;
  },
  
  findDocuments: function(aDoc, aArray) {
    this.addKidsToArray(aDoc.getElementsByTagName("frame"), aArray);
    this.addKidsToArray(aDoc.getElementsByTagName("iframe"), aArray);
    this.addKidsToArray(aDoc.getElementsByTagNameNS(xulns, "browser"), aArray);
    this.addKidsToArray(aDoc.getElementsByTagNameNS(xulns, "tabbrowser"), aArray);
    this.addKidsToArray(aDoc.getElementsByTagNameNS(xulns, "editor"), aArray);
  },
  
  addKidsToArray: function(aKids, aArray) {
    for (var i = 0; i < aKids.length; ++i) {
      try {
        if (aKids[i].localName == "editor")
          aArray.push(aKids[i].editorShell.editorDocument);
        else
          aArray.push(aKids[i].contentDocument);
      } catch (ex) {
        // if we can't access the content document, skip it
      }
    }
  }
}

//-------------------------- End Inspectomatic --------------------------//

//////////////////////////// Start WindowHook ////////////////////////////

/* :::::::: WindowHook :::::::: */
// by Zeniko http://forums.mozillazine.org/viewtopic.php?p=2169699#p2169699

var WindowHook = {
  observe: function(aSubject, aTopic, aData) {
    if (!aSubject.DOMI_WindowHook) {
      aSubject.DOMI_WindowHook = this;
      aSubject.addEventListener("load", this.onLoad_window, false);
    }
  },

  onLoad_window: function() {
    this.removeEventListener("load", this.DOMI_WindowHook.onLoad_window,
                             false);
    var funcs = this.DOMI_WindowHook.mFuncs[this.document.location.href] ||
                null;
    if (funcs) { funcs.forEach(function(aFunc) { aFunc(this) }, this) }
    delete this.DOMI_WindowHook;
  },

  register: function(aURL, aFunc) {
    if (!this.mFuncs) {
      this.mFuncs = {};
      Cc["@mozilla.org/observer-service;1"].getService(Ci.nsIObserverService).
      addObserver(this, "domwindowopened", false);
    }
    if (!this.mFuncs[aURL]) {
      this.mFuncs[aURL] = [];
    }
    this.mFuncs[aURL].push(aFunc);
  }
}

// About dialog for add-on
WindowHook.register("chrome://mozapps/content/extensions/about.xul",
  function(aWindow) {
    let popset = aWindow.document.createElement("popupset");
    let {documentElement} = aWindow.document;
    documentElement.setAttribute("context", "inspect-context");
    documentElement.appendChild(popset);
    popset.appendChild(winContext.cloneNode(true));
    aWindow.inspectDOMNode = inspectDOMNode;
  }
)

// Library (Bookmarks and History)
WindowHook.register("chrome://browser/content/places/places.xul",
  function(aWindow) {
    let pop = aWindow.document.getElementById("placesContext");
    addInspector(pop, self.id + "-inspector", self.image);
    aWindow.inspectDOMNode = inspectDOMNode;
    aWindow.inspectItem = function inspectItem(aNode) {
      var view = PlacesUIUtils.getViewForNode(aNode);
      window.openDialog("chrome://inspector/content/object.xul", "_blank",
                        "chrome,all,dialog=no", view.selectedNode);
    }
    let inspectItem = pop.lastChild;
    inspectItem.setAttribute("label", "Inspect Places Item");
    inspectItem.setAttribute("oncommand",
                             "inspectItem('triggerNode' in this.parentNode"
                           + " ? this.parentNode.triggerNode"
                           + " : document.popupNode);");
    let popset = aWindow.document.getElementById("placesPopupset");
    //$xml(popset, winContext);
    popset.appendChild(winContext.cloneNode(true));
    aWindow.document.documentElement
           .setAttribute("context", "inspect-context");
  }
)

// SeaMonkey Bookmarks Manager
WindowHook.register("chrome://communicator/content/bookmarks/bookmarksManager.xul",
  function(aWindow) {
    let pop = aWindow.document.getElementById("placesContext");
    addInspector(pop, self.id + "-inspector", self.image);
    aWindow.inspectDOMNode = inspectDOMNode;
    aWindow.inspectItem = function inspectItem(aNode) {
      var view = PlacesUIUtils.getViewForNode(aNode);
      window.openDialog("chrome://inspector/content/object.xul", "_blank",
                        "chrome,all,dialog=no", view.selectedNode);
    }
    let inspectItem = pop.lastChild;
    inspectItem.setAttribute("label", "Inspect Bookmark Item");
    inspectItem.setAttribute("oncommand",
                             "inspectItem('triggerNode' in this.parentNode"
                           + " ? this.parentNode.triggerNode"
                           + " : document.popupNode);");
    let popset = aWindow.document.getElementById("placesPopupset");
    //$xml(popset, winContext);
    popset.appendChild(winContext.cloneNode(true));
    aWindow.document.documentElement
           .setAttribute("context", "inspect-context");
  }
)

// SeaMonkey History window
WindowHook.register("chrome://communicator/content/history/history.xul",
  function(aWindow) {
    let pop = aWindow.document.getElementById("placesContext");
    addInspector(pop, self.id + "-inspector", self.image);
    aWindow.inspectDOMNode = inspectDOMNode;
    aWindow.inspectItem = function inspectItem(aNode) {
      var view = PlacesUIUtils.getViewForNode(aNode);
      window.openDialog("chrome://inspector/content/object.xul", "_blank",
                        "chrome,all,dialog=no", view.selectedNode);
    }
    let inspectItem = pop.lastChild;
    inspectItem.setAttribute("label", "Inspect History Item");
    inspectItem.setAttribute("oncommand",
                             "inspectItem('triggerNode' in this.parentNode"
                           + " ? this.parentNode.triggerNode"
                           + " : document.popupNode);");
    let popset = aWindow.document.getElementById("placesPopupset");
    //$xml(popset, winContext);
    popset.appendChild(winContext.cloneNode(true));
    aWindow.document.documentElement
           .setAttribute("context", "inspect-context");
  }
)


// Firefox Options dialog
WindowHook.register("chrome://browser/content/preferences/preferences.xul",
  function(aWindow) {
    let popset = aWindow.document.createElement("popupset");
    aWindow.document.documentElement.appendChild(popset);
    //$xml(popset, winContext);
    popset.appendChild(winContext.cloneNode(true));
    aWindow.document.documentElement
           .setAttribute("context", "inspect-context");
    aWindow.inspectDOMNode = inspectDOMNode;
  }
)

// Thunderbird Options dialog
// by morat
// http://custombuttons.sourceforge.net/forum/viewtopic.php?p=301#p301
WindowHook.register("chrome://messenger/content/preferences/preferences.xul",
  function(aWindow) {
    let popset = aWindow.document.createElement("popupset");
    aWindow.document.documentElement.appendChild(popset);
    //$xml(popset, winContext);
    popset.appendChild(winContext.cloneNode(true));
    aWindow.document.documentElement
           .setAttribute("context", "inspect-context");
    aWindow.inspectDOMNode = inspectDOMNode;
  }
)

// Chatzilla
WindowHook.register("chrome://chatzilla/content/chatzilla.xul",
  function(aWindow) {
    let popset = aWindow.document.createElement("popupset");
    aWindow.document.documentElement.appendChild(popset);
    //$xml(popset, winContext);
    popset.appendChild(winContext.cloneNode(true));
    aWindow.document.documentElement
           .setAttribute("context", "inspect-context");
    aWindow.inspectDOMNode = inspectDOMNode;
  }
)

/*
// Download Manager
WindowHook.register("chrome://mozapps/content/downloads/downloads.xul",
  function(aWindow) {
    let popset = aWindow.document.createElement("popupset");
    aWindow.document.documentElement.appendChild(popset);
    //$xml(popset, winContext);
    popset.appendChild(winContext);
    aWindow.document.documentElement
           .setAttribute("context", "inspect-context");
    let pop = aWindow.document.getElementById("downloadContextMenu");
    pop.addEventListener("popupshowing", appendInspector = function(e) {
      addInspector(e.target, self.id + "-inspector", self.image);
    }, false);
    pop.removeEventListener("popuphiding", appendInspector, false);
    aWindow.inspectDOMNode = inspectDOMNode;
  }
)
*/

/* End WindowHook */

// Remove contextmenu items when this button is deleted
this.onDestroy = function(reason) {
  $(kIDs[0]).parentNode.removeEventListener("popupshowing",
                                            initCbPopup, false);

  if (reason == "delete") {
    document.documentElement.removeAttribute("context");
    $("sidebar").removeAttribute("context");
    var ms = document.querySelectorAll("menuitem[id^='" + id + "']");
    LOG(ms);
    for (var i = ms.length - 1; i >= 0; i--) {
      LOG(ms[i].id);
      removeNode(ms[i].id);
    }
  }
}

////////////////////////////////////////////////////////////////////////////
/////////////////////////// Start Button updater ///////////////////////////

/* ***** BEGIN LICENSE BLOCK *****
 * Version: MPL 1.1/GPL 2.0
 *
 * The contents of this file are subject to the Mozilla Public License
 * Version 1.1 (the "License"); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at
 * http://www.mozilla.org/MPL/1.1/
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
 * for the specific language governing rights and limitations under the
 * License.
 *
 * Original code is Button Updater for Custom Buttons extension
 *
 * The Initial Developer of the Original Code is LouCypher.
 * Portions created by the Initial Developer are Copyright (C) 2011
 * the Initial Developer. All Rights Reserved.
 *
 * Contributor(s):
 * - LouCypher: original code
 *
 * Alternatively, the contents of this file may be used under the terms of
 * the GNU General Public License Version 2 or later (the "GPL"), in which
 * case the provisions of the GPL are applicable instead of those above.
 *
 * ***** END LICENSE BLOCK ***** */

this.updater = {
  btnClick: self.onclick,
  btnImage: self.image,
  btnType: self.type,
  btnTooltip: self.tooltipText,

  baseURL: "https://loucypher.googlecode.com/svn/custombuttons/xml/",

  get updateURL() {
    return this.baseURL + encodeURIComponent(self.name.replace(/(\/|:)/g, "-"))
                        + ".xml";
  },

  openUpdateURL: function updater_openUpdateURL() {
    switchToTabHavingURI(this.updateURL);
  },

  get stdIcon() {
    var stdIcon = parseInt(self.cbStdIcon.match(/\d/));
    switch (stdIcon) {
       case 4: return "chrome://custombuttons/skin/stdicons/bbutton.png";
       case 3: return "chrome://custombuttons/skin/stdicons/gbutton.png";
       case 2: return "chrome://custombuttons/skin/stdicons/rbutton.png";
      default: return "chrome://custombuttons/skin/button.png";
    }
  },

  get bsyIcon() {
    switch (Application.id) {
      case "{ec8030f7-c20a-464f-9b0e-13a3a9e97384}":
        if (Application.version >= "4") {
          return "chrome://browser/skin/tabbrowser/connecting.png";
        } else {
          return "chrome://global/skin/icons/loading_16.png";
        }
      case "{92650c4d-4b8e-4d2a-b7eb-24ecf4f6b63a}":
        return "chrome://communicator/skin/icons/loading.gif";
      default:
        return "chrome://global/skin/icons/loading_16.png";
    }
  },

  // Check if the URI is Custom Button URI (custombutton://...)
  isValidCbURI: function updater_isValidCbURI(aURL) {
    if (!aURL) return false;
    return /^custombutton\:\/\//.test(aURL);
  },

  // Convert 'custombutton:' URI to DOM
  convertURItoDOM: function updater_convertURItoDOM(aURL) {
    if (!this.isValidCbURI(aURL)) {
      custombuttons.alertBox(self.name, "Not a Custom Buttons link!");
      return;
    }
    var string = unescape(aURL.replace(/^custombutton\:\/\//, "").toString());
    var parser = new DOMParser();
    var dom = parser.parseFromString(string, "text/xml");
    if (dom.documentElement.nodeName == "parsererror") {
      return null;
    } else {
      return dom.documentElement;
    }
  },

  // Get value from XML element
  getParamValue: function updater_getParamValue(aDocument, aNodeName) {
    var node = aDocument.querySelector(aNodeName);
    if (!node) return "";
    if (!node.firstChild || (node.firstChild &&
        (node.firstChild.nodeType == node.TEXT_NODE))) {
      return node.textContent;
    } else {
      return node.firstChild.textContent;
    }
  },

  // Set button parameters from XML alement
  getButtonParameters: function updater_getButtonParameters(aButtonLink, aURL) {
    var dom = this.convertURItoDOM(aURL);
    var params = custombuttons.cbService.getButtonParameters(aButtonLink)
                                        .wrappedJSObject;
    params.name             = this.getParamValue(dom, "name")
    params.date             = this.getParamValue(dom, "date") || "";
    params.image            = this.getParamValue(dom, "image") ||
                              this.getParamValue(dom, "stdicon");
    params.code             = this.getParamValue(dom, "code")
    params.initCode         = this.getParamValue(dom, "initcode")
    params.help             = this.getParamValue(dom, "help")
    params.accelkey         = this.getParamValue(dom, "accelkey")
    params.mode             = this.getParamValue(dom, "mode")
    params.wrappedJSObject  = params;
    return params;
  },

  // Reset button attribute if user click the button during update
  resetAttributes: function updater_resetAttributes() {
    self.image = this.btnImage;
    self.tooltipText = self.name;
    self.removeAttribute("busy");
    self.onclick = this.btnClick;
    self.type = this.btnType;
    self.tooltipText = this.btnTooltip;
  },

  // Check button for update
  checkForUpdate: function updater_checkForUpdate(aCallback) {
    if (!navigator.onLine) {                // If browser is in offline mode
                                            // ask to switch to online
      var online = custombuttons.confirmBox(self.name,
                             "Firefox is currently in offline mode.\n"
                           + "Switch to online mode and try again?",
                             "Yes", "No");
      if (!online) return;
      BrowserOffline.toggleOfflineStatus(); // switch to online
    }

    var url = this.updateURL + "?" + Date.now();
    var req = new XMLHttpRequest();
    req.open("GET", url, true);
    if (self.hasAttribute("busy")) {
      this.resetAttributes();
      return
    }
    var updater = this;
    req.onreadystatechange = function (aEvent) {
      self.onclick = function(aEvent) {
        aEvent.preventDefault();
        req.abort();
        self.updater.resetAttributes();
      }
      self.image = updater.bsyIcon;
      self.setAttribute("busy", "");
      self.removeAttribute("type");
      self.tooltipText = "Checking for update...\nClick to abort.";
      if (req.readyState == 4 && req.status == 200) {
        updater.resetAttributes();
        aCallback(req.responseXML);
      }
    }
    req.send(null);
  },

  // Get update from XML
  getUpdate: function updater_getUpdate(aDocument) {
    if (aDocument.documentElement.localName != "custombutton") {
      custombuttons.alertBox(self.name,
                             "Not a valid Custom Buttons XML file!");
      return;
    }

    //inspectDOMDocument(aDocument); return;
    let icon = self.updater.btnImage ? self.updater.btnImage
                                     : self.updater.stdIcon;
    let button = aDocument.getElementById("button");
    let link = button.getElementsByTagNameNS(xhtmlns, "a")[0];
    if (link.href == self.URI) {
      let as = Cc['@mozilla.org/alerts-service;1'].
               getService(Ci.nsIAlertsService);
      as.showAlertNotification(icon, "No update found!",
                               "Finish checking", false, "", null);
      return;
    } 

    var install = custombuttons.confirmBox(self.name, "Update found! " +
                                           "Update this button?",
                                           "Yes", "No");
    if (!install) return;
    let btnLink = custombuttons.makeButtonLink("update", self.id);
    let params = self.updater.getButtonParameters(btnLink, link.href);
    //inspectObject(params); return;
    custombuttons.cbService.installButton(params);
    custombuttons.alertBox(self.name, "Button updated!");
    self.setAttribute("cb-edit-state", "active");
  },

  init: function updater_onLoad() {

    var icon = this.btnImage ? this.btnImage : this.stdIcon;

    function $(aId) {
      return document.getElementById(aId);
    }

    function addMenuItem(aNewIDs, aNodeIDs, aSeparator) {
      // Remove previously created menuitems if any
      if ($(aNewIDs)) {
        if (aSeparator &&
            ($(aNewIDs).nextSibling.localName == "menuseparator")) {
          $(aNewIDs).parentNode.removeChild($(aNewIDs).nextSibling);
        }
        $(aNewIDs).parentNode.removeChild($(aNewIDs));
      }

      var mi = makeXML(
                    '<menuitem xmlns="' + xulns + '"'
                  + ' id="' + aNewIDs + '"'
                  + ' class="menuitem-iconic"'
                  + ' image="' + icon + '"'
                  + ' label="Check for updates for this button"'
                  + ' onclick="if (event.button == 1) {'
                  + ' var btn = document.getElementById(\''
                  + self.id + '\'); btn.updater.openUpdateURL(); }" '
                  + ' oncommand="var btn = document.getElementById(\''
                  + self.id + '\'); btn.updater.checkForUpdate('
                  + 'btn.updater.getUpdate);"'
                  + ' observes="custombuttons-contextbroadcaster-primary"/>');
      $(aNodeIDs).parentNode.insertBefore(mi, $(aNodeIDs).nextSibling);
      if (aSeparator) {
        var sep = makeXML('<menuseparator xmlns="' + xulns + '"'
                            + ' id="' + mi.id + '-separator"/>');
        mi.parentNode.insertBefore(sep, mi.nextSibling);
      }
    }

    function initUpdaterCbPopup(aEvent) {
      var popupNode = "triggerNode" in aEvent.target
                        ? aEvent.target.triggerNode : document.popupNode;
      $(kIDs).hidden = (popupNode != self);
      ($(kIDs).nextSibling.id == $(kIDs).id + "-separator") &&
      ($(kIDs).nextSibling.hidden = (popupNode != self));
    }

    var kIDs = self.id + "-checkForUpdate";
    var uIDs = "custombuttons-contextpopup-updateButton";

    // Add 'Check for Update...' menuitem to CB contextmenu
    addMenuItem(kIDs, uIDs, true);

    $(uIDs).parentNode.addEventListener("popupshowing",
                                           initUpdaterCbPopup, false);
    $(uIDs).parentNode.removeEventListener("popuphiding",
                                              initUpdaterCbPopup, false);

    self.onDestroy = function(aReason) {
      if (aReason != "delete") return;
      $(uIDs).parentNode.removeEventListener("popupshowing",
                                             initUpdaterCbPopup, false);
      $(kIDs).parentNode.removeChild($(kIDs + "-separator"));
      $(kIDs).parentNode.removeChild($(kIDs));
    }
  }
}

this.updater.init();

//////////////////////////// End Button updater ////////////////////////////
////////////////////////////////////////////////////////////////////////////]]></initcode>
  <code><![CDATA[/* ----------------------------------------------------------------
     DOM Inspector

     Idea for this button was taken from
     InspectorWidget extension by Sailfish
     https://addons.mozilla.org/firefox/63/
   ---------------------------------------------------------------- */


// Check if DOMI is available
if (typeof inspectObject != "function") {
  AddonManager.getAddonByID("inspector@mozilla.org", function(addon) {
    let msg = "This button requires DOM Inspector extension.\n";
    if (addon) { // If DOMI is installed
      addon.userDisabled = false; // enable it
      // Ask to restart
      let restart = custombuttons.confirmBox(self.name, msg +
                                             addon.name + " will be enabled after you restart " +
                                             Application.name + ".",
                                             "Restart now", "Undo");
      if (restart) {                // If 'Yes'
        Application.restart();      // restart application
        return true;
      }
      else                          // If 'No'
      	addon.userDisabled = true;  // disable DOMI
    }
    else {  // If DOMI is not installed
      // Ask to install
      let install = custombuttons.confirmBox(self.name, msg +
                                             "Install DOM Inspector from Mozilla Add-ons?",
                                             "Install", "Cancel");
      if (!install)
        return false;

      // install DOMI latest version from AMO
      loadURI("https://addons.mozilla.org/firefox/downloads/latest/dom-inspector-6622/" +
              "?src=external-LouCypher");
    }
  })
  return false;
}

if (this.checkInspectomatic()) {
  if (event.target.id == this.id) {
    this.Inspectomatic.selectByClick(document);
  }
  return;
}

this.inspectWin();

]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help><![CDATA[* left click button - inspect content document
* middle click button - inspect chrome document
* right click button - open custom button context popup
* left click inspect element - inspect dom node
* middle click inspect element - inspect javascript object

disable inspectomatic (default)

* left click # window title - inspect chrome document

enable inspectomatic

* left click # window title - enable the next mouse click to inspect dom node]]></help>
  <attributes/>
</custombutton>