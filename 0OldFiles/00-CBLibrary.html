<!DOCTYPE HTML><html>
<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<title>Custom Buttons Library</title>
	<link rel="shortcut icon" type="image/x-icon" href="lib/img/index.png" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link type="text/css" rel="stylesheet" href="lib/css/bootstrap.min.css" />
	<link type="text/css" rel="stylesheet" href="lib/css/highlight.css" />
	<link type="text/css" rel="stylesheet" href="lib/css/bootstrap.odyseus.css" />
	<link type="text/css" rel="stylesheet" href="lib/css/bootstrap.docs.css" />
</head>
<body data-spy="scroll" data-target="#index-sidebar" data-offset="140">
<noscript><div class="alert alert-danger">
<strong>Oh snap! This page needs JavaScript enabled to display correctly.</strong>
</div></noscript>
<div id="mainarea" style="display: none">
<span id="headmenu">
<!-- Inserted via jQuery -->
</span>
<div class="container cb-docs-container">
<div class="row">
<div class="col-md-9" role="main">

<h1 id="effing_index">CBLibrary.jsm</h1>


<p>This is a JavaScript library/module for use with CustomButtons addon. </p>

<h3>How to use the library</h3>

<p>First, download the <a href="www.link.to/CBLibrary.jsm">CBLibrary.jsm file</a> and save it inside the
folder called "custombuttons" inside your application profile. To load the library, just insert
the code below at the beginning of the Initialization tab of your button.</p>

<p>On applications using <strong>Gecko version greater than 27</strong>, that is latest versions of Firefox
(from ESR to Nightly), SeaMonkey and Thunderbird.</p>

<pre><code>if (!("_CustomButtonsLibrary" in window))
    Cu.import(OS.Path.toFileURI(OS.Path.join(OS.Constants.Path.profileDir, "custombuttons", "CBLibrary.jsm")));

var $ = _CustomButtonsLibrary;
</code></pre>

<p>On applications using <strong>Gecko version less than or equal 27</strong>, that is latest versions of Palemoon and FossaMail.</p>

<pre><code>var libPath = Services.dirsvc.get("ProfD", Ci.nsIFile);
libPath.append("custombuttons");
libPath.append("CBLibrary.jsm");
if (!("_CustomButtonsLibrary" in window))
    Cu.import(Services.io.newFileURI(libPath).spec);

var $ = _CustomButtonsLibrary;
</code></pre>

<p><strong>Note 1:</strong> In theory, the CBLibrary.jsm file could be stored anywhere in your hard drive,
but as this is a library for use with CustomButtons, what better place to put it than
inside CustomButtons' folder.</p>

<p><strong>Note 2:</strong> <code>var $ = _CustomButtonsLibrary;</code> is declared for the sole purpose of shortening the
use of the functions of this library. In all following examples, I will use the <code>$</code> variable.</p>

<p><strong>Author:</strong> Odyseus</p>

<p><strong>Version:</strong> 1.0.0</p>

<h2>appID(aAbbr)</h2>

<p>Application ID boolean return.</p>

<h4>Usage</h4>

<pre><code>if ($.appID("FX"))
    LOG("This is Firefox"); // Same as Cyberfox
else if ($.appID("PM"))
    LOG("This is Palemoon");
else if ($.appID("SM"))
    LOG("This is SeaMonkey");
else if ($.appID("TB"))
    LOG("This is Thunderbird"); // Same as FossaMail
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aAbbr</strong> <em>{String}</em> Application name "abbreviation".</li>
</ul>

<h2>gID(aId)</h2>

<p>Return element by id.</p>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aId</strong> <em>{String}</em> String id of element.</li>
</ul>

<h2>getHelp(aMarker, aBtnHelp)</h2>

<p>Get specific data, surrounded by "markers", from the Help tab.</p>

<p><strong>IMPORTANT!!!</strong> Markers should <strong>ALWAYS</strong> exist in pairs and be unique.</p>

<h4>Usage</h4>

<pre><code>var css = $.getHelp("StyleSheet", this.Help);
</code></pre>

<p>Help tab content:</p>

<pre><code>&lt;!--StyleSheet--&gt;
menupopup .menu-accel-container {
    display: none !important;
}
&lt;!--StyleSheet--&gt;
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aMarker</strong> <em>{String}</em> The "name" of the marker as a string.</li>
<li>
<strong>aBtnHelp</strong> <em>{String}</em> The content of the Help tab of the button. Could be passed as <code>this.Help</code> or <code>this.getAttrinute("Help")</code>.</li>
</ul>

<h2>utf8_to_b64(aStr)</h2>

<p>String to Base64. Unicode workaround without using "unescape".</p>

<h4>Usage</h4>

<pre><code>var encodedString = $.utf8_to_b64("Текстовый Unicode");
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aStr</strong> <em>{String}</em> String to be encoded to Base64. </li>
</ul>

<h2>b64_to_utf8(aStr)</h2>

<p>Base64 to String. Unicode workaround without using "escape".</p>

<h4>Usage</h4>

<pre><code>var decodedString = $.b64_to_utf8("0KLQtdC60YHRgtC+0LLRi9C5IFVuaWNvZGU=");
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aStr</strong> <em>{String}</em> Base64 encoded string to be decoded. </li>
</ul>

<h2>gBP(aKey)</h2>

<p>Get boolean preferences.</p>

<h4>Usage</h4>

<pre><code>var clickHoldContextMenu = $.gBP("ui.click_hold_context_menus");
</code></pre>

<p>or by specifying a brach...</p>

<pre><code>const PREF_BRANCH = "myUniqueBranch.Id" + (self.id).split("-button")[1] + ".";
var prefValue = $.gBP("prefName01", PREF_BRANCH);
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aKey</strong> <em>{String}</em> Preference key.</li>
</ul>

<h4>Returns:</h4>

<ul>
<li>
<strong>Boolean</strong> Preference value.</li>
</ul>

<h2>sBP(aKey, aVal)</h2>

<p>Set boolean preferences.</p>

<h4>Usage</h4>

<pre><code>$.sBP("ui.click_hold_context_menus", true);
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aKey</strong> <em>{String}</em> Preference key.</li>
<li>
<strong>aVal</strong> <em>{Boolean}</em> Preference value.</li>
</ul>

<h2>gIP(aKey)</h2>

<p>Get integer preferences.</p>

<h4>Usage</h4>

<pre><code>var tooltipDelay = $.gIP("ui.tooltipDelay");
</code></pre>

<p>or by specifying a brach...</p>

<pre><code>const PREF_BRANCH = "myUniqueBranch.Id" + (self.id).split("-button")[1] + ".";
var prefValue = $.gIP("prefName02", PREF_BRANCH);
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aKey</strong> <em>{String}</em> Preference key.</li>
</ul>

<h4>Returns:</h4>

<ul>
<li>
<strong>Integer</strong> Preference value.</li>
</ul>

<h2>sIP(aKey, aVal)</h2>

<p>Set integer preferences.</p>

<h4>Usage</h4>

<pre><code>$.sIP("ui.tooltipDelay", 100);
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aKey</strong> <em>{String}</em> Preference key.</li>
<li>
<strong>aVal</strong> <em>{Integer}</em> Preference value.</li>
</ul>

<h2>gCV(aKey)</h2>

<p>Get string preferences with unicode support.</p>

<h4>Usage</h4>

<pre><code>var downloadFolder =  $.gCV("browser.download.dir");
</code></pre>

<p>or by specifying a brach...</p>

<pre><code>const PREF_BRANCH = "myUniqueBranch.Id" + (self.id).split("-button")[1] + ".";
var prefValue = $.gCV("prefName03", PREF_BRANCH);
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aKey</strong> <em>{String}</em> Preference key.</li>
</ul>

<h4>Returns:</h4>

<ul>
<li>
<strong>String</strong> Preference value.</li>
</ul>

<h2>sCV(aKey, aVal)</h2>

<p>Set string preferences with unicode support</p>

<h4>Usage</h4>

<pre><code>$.sCV("browser.download.dir", "D:\\Загрузок\\Music"); // Windows path.

$.sCV("browser.download.dir", "/home/user/Загрузок"); // "Linux" path.
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aKey</strong> <em>{String}</em> Preference key.</li>
<li>
<strong>aVal</strong> <em>{String}</em> Preference value.</li>
</ul>

<h2>notifyme(aTitle, aMsg, aImg)</h2>

<p>Notification function</p>

<h4>Usage</h4>

<pre><code>notifyme("Title", "Message"); // No image specified.
</code></pre>

<p>or...</p>

<pre><code>notifyme("Title", "Message", ""); // With a custom image.
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aTitle</strong> <em>{String}</em> String title for the notification.</li>
<li>
<strong>aMsg</strong> <em>{String}</em> String message for the notification.</li>
<li>
<strong>aImg</strong> <em>{String}</em> Image URL/URI. Could be null.</li>
</ul>

<h2>styleSheet(aCSS, aRemFlag)</h2>

<p>Load/Unload stylesheets.</p>

<h4>Usage</h4>

<pre><code>var css = this.Help; // The "pure" css code is stored inside the Help tab of the button.

$.styleSheet(css); // Load the stylesheet.

$.styleSheet(css, true); // Unload the stylesheet.
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aCSS</strong> <em>{String}</em> String stylesheet to load.</li>
<li>
<strong>aRemFlag</strong> <em>{Boolean}</em> (Optional) if true unload aCSS.</li>
</ul>

<h2>parseXML(aXML)</h2>

<p>Converts an XML string into a DOM document ready to be appended to any  application's element.</p>

<h4>Usage</h4>

<pre><code>var xulString = this.Help; // The "pure" XUL code is stored inside the Help tab of the button.

this.appendChild($.parseXML(xulString));
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aXML</strong> <em>{String}</em> XML sring to parse.</li>
</ul>

<h4>Returns:</h4>

<ul>
<li>
<strong>Object</strong> Returns a document ready to be appended.</li>
</ul>

<h2>readFile(aPath)</h2>

<p>Return file data content.</p>

<h4>Usage</h4>

<pre><code>var fileContent = $.readFile(OS.Path.join(OS.Constants.Path.profileDir, "prefs.js"));
</code></pre>

<p>or...</p>

<pre><code>var libPath = Services.dirsvc.get("ProfD", Ci.nsIFile);
libPath.append("prefs.js");
var fileContent = $.readFile(libPath.path);
</code></pre>

<p>or...</p>

<pre><code>var fileContent = $.readFile("C:\\Windows\\System32\\drivers\\etc\\hosts");
</code></pre>

<p>or...</p>

<pre><code>var fileContent = $.readFile("/etc/hosts");
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aPath</strong> <em>{String}</em> Full path to a file.</li>
</ul>

<h2>writeFile(aPath, aData, aSaveType)</h2>

<p>Write data to file.</p>

<h4>Usage</h4>

<pre><code>var data = "Some data to save into a file.";
var filePath = "C:\\file.txt";
</code></pre>

<p>If file exists, append the data to it:</p>

<pre><code>$.writeFile(filePath, data, "append");
</code></pre>

<p>If file exists, create a new one:</p>

<pre><code>$.writeFile(filePath, data, "unique");
</code></pre>

<p>If file exists, overwrite it (default behaivor when no third argument is used):</p>

<pre><code>$.writeFile(filePath, data);
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aPath</strong> <em>{String}</em> </li>
<li>
<strong>aData</strong> <em>{String}</em> </li>
<li>
<strong>aSaveType</strong> <em>{String}</em> </li>
</ul>

<h2>refreshLibrary()</h2>

<p>Used to refresh the library after library update. The application will restart after this
function executes.</p>

<h4>Usage</h4>

<pre><code>$.refreshLibrary();
</code></pre>

<h2>unloadLibrary()</h2>

<p>Used to refresh the library after library update. The application will restart after this
function executes.</p>

<h4>Usage</h4>

<pre><code>$.refreshLibrary();
</code></pre>

<h2>img_to_b64(aURI, aCallback)</h2>

<p>Converts any image from any source to Base64.</p>

<h4>Usage</h4>

<pre><code>var imageURL = "https://developer.cdn.mozilla.net/media/redesign/img/favicon32.png";
</code></pre>

<p>or...</p>

<pre><code>var imageURL = "chrome://branding/content/icon32.png";
</code></pre>

<p>or...</p>

<pre><code>var imageURL = "resource://gre/chrome/toolkit/skin/classic/global/icons/information-64.png";
</code></pre>

<p>or...</p>

<pre><code>var imageURL = "file:///C:/Users/UserName/Desktop/img.ico";
</code></pre>

<p>or...</p>

<pre><code>var imageFile = OS.Path.join(OS.Constants.Path.desktopDir, "img.ico");
var imageURL = OS.Path.toFileURI(imageFile);
</code></pre>

<pre><code>$.img_to_b64(imageURL, function (aImg) {
    if (!aImg)
        return;
    gBrowser.addTab(aImg);
    custombuttons.alertSlide("Image converted to Base64.");
});
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aURI</strong> <em>{Object|String}</em> An URI object or an URL string to the image.</li>
<li>
<strong>aCallback</strong> <em>{Function}</em> A function whose argument will be the Base64 image code. </li>
</ul>

<p><strong>Contributor/s:</strong> Morat</p>

<h2>padding(aNumber, aLength, aFiller)</h2>

<h4>Usage</h4>

<pre><code>$.padding(15, 4);      // 0015
$.padding(7, 4);       // 0007
$.padding(456, 4);     // 0456
$.padding(15, 4, "*"); // **10
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aNumber</strong> <em>{Integer|String}</em> </li>
<li>
<strong>aLength</strong> <em>{Integer}</em> </li>
<li>
<strong>aFiller</strong> <em>{String}</em> </li>
</ul>

<h4>Returns:</h4>

<ul>
<li>
<strong>String</strong> </li>
</ul>

<p><strong>Author:</strong> <a href="http://stackoverflow.com/a/10073788">Pointy</a></p>

<h2>escHTML(aStr)</h2>

<p>Escape HTML entities.</p>

<h4>Usage</h4>

<pre><code>var escapedHTMLTag = $.escHTML("&lt;code&gt;"); // "&amp;lt;code&amp;gt;"
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aStr</strong> <em>{String}</em> String with HTML characters to be escaped.</li>
</ul>

<h4>Returns:</h4>

<ul>
<li>
<strong>String</strong> </li>
</ul>

<h2>shorten(aStr, aLimit)</h2>

<p>Shortens strings removing white spaces.</p>

<h4>Usage</h4>

<pre><code>var shortenedString = $.shorten("A string with more than 500 characters...", 500);
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aStr</strong> <em>{String}</em> </li>
<li>
<strong>aLimit</strong> <em>{Integer}</em> </li>
</ul>

<h2>getCurSel(aWindow)</h2>

<p>Get selected text from current loaded page.</p>

<h4>Usage</h4>

<pre><code>var selectedText = $.getCurSel(self.ownerDocument.defaultView);
</code></pre>

<p>or...</p>

<pre><code>var selectedText = $.getCurSel(window);
</code></pre>

<h4>Arguments:</h4>

<ul>
<li>
<strong>aWindow</strong> <em>{Object}</em> The window object from which to look for the selected text. </li>
</ul>

<p><strong>Author:</strong> <a href="https://addons.mozilla.org/firefox/user/erlendorf/">Franz Erlendorf</a>. This function is based on a function found on his<br> addon.</p>

<h2>CBLSecondary.jsm</h2>

<p>This file is a "secondary library" that, if the file actually exists, it will be automatically loaded 
when the CBLibrary.jsm file ("primary library") is loaded.</p>

<p>I created this "secondary library" so people can add their own functions without having to 
edit the CBLibrary.jsm file.</p>

<p>For the "secondary library" to work, only two elements need to be declared.</p>

<pre><code>this.EXPORTED_SYMBOLS = ["_CBLSecondary"];

let _CBLSecondary = {
    // Declare your functions in here.
};
</code></pre>

<h4>Practical example</h4>

<pre><code>this.EXPORTED_SYMBOLS = ["_CBLSecondary"];

const {
    classes : Cc,
    interfaces : Ci,
    utils : Cu,
    results : Cr
}
     = Components;

Cu.import("resource://gre/modules/Services.jsm");

var hwindow = Services.appShell.hiddenDOMWindow;

let _CBLSecondary = {
    funcOne : function () {
        hwindow.console.info("_CBLSecondary.funcOne()");
    },
    funcTwo : function () {
        hwindow.console.info("_CBLSecondary.funcTwo()");
    },
    funcThree : function () {
        hwindow.console.info("_CBLSecondary.funcThree()");
    },
    funcFour : function () {
        hwindow.console.info("_CBLSecondary.funcFour()");
    }
};
</code></pre>


</div> <!-- //.col-sm-9 .col-md-9 -->

<div class="col-md-3" role="complementary">
	<nav id="index-sidebar" class="hidden-print hidden-xs hidden-sm">
		<ul id="index-sidebar-list" class="nav cb-docs-sidenav">
			<li class="effing_index"><a href="#effing_index">Index</a></li>
		</ul>
	</nav>
</div> <!-- //.col-xs-3 .col-sm-3 .col-md-3 -->
</div> <!-- //.row -->


</div> <!-- .container .boxed -->

<div id="footer" class="navbar navbar-default">
<!-- Inserted via jQuery -->
</div>
</div> <!-- #mainarea -->

<span id="top-link-block" class="hidden">
	<a id="top-link" href="#top" rel="nofollow" class="well">
		<i class="glyphicon glyphicon-chevron-up"></i>
	</a>
</span><!-- /#top-link-block -->

	<script type="text/javascript" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
	<script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="lib/js/highlight.pack.js"></script>
	<script type="text/javascript" src="lib/js/myFunctions.js"></script>
	<script type="text/javascript">
var isIndex = 3;
hljs.configure({ // Replace all tabs in code blocks.
	tabReplace : '  '
});
hljs.initHighlightingOnLoad();
$(document).ready(function () {
	var headings = $("h2");
	$.each(headings, function (aIndex, aVal) {
		// Set IDs to all h2 tags.
		$(aVal).attr("id", "_" + aIndex);
		// Create all list items for the sidebar.
		$("<li><a></a></li>") // li
		.find("a") // a
		.attr("href", "#" + aVal.id) // a
		.html($(aVal).text()) // a
		.end() // li
		.appendTo("#index-sidebar-list");
	});
	$('#index-sidebar ul.nav li a').on('click', function () {
		var $target = $($(this).attr('href'));
		$('html, body').animate({
			scrollTop : $($target).offset().top - 70
		}, 'slow');
	});
	$(document).ajaxStop(function () {
		$('[data-spy="scroll"]').each(function () {
			var $spy = $(this).scrollspy('refresh');
		});
		setTimeout(function () {
			var sideB = $("#index-sidebar");
			sideB.affix({
				offset : {
					top : function () {
						var sideBOffset = sideB.offset().top,
						sideBMarTop = parseInt(sideB.children(0).css("margin-top"), 10),
						navBHeight = $("#headmenu").height();
						return this.top = sideBOffset - navBHeight - sideBMarTop;
					},
					bottom : function () {
						return this.bottom = $("#footer").outerHeight(!0);
					}
				}
			});
		}, 100);
	});
});
	</script>
</body>
</html>

